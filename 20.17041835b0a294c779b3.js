(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/LayerView":1633,"esri/views/2d/engine/vectorTiles/renderers/rendererUtils":1707,"esri/views/2d/engine/vectorTiles/MemoryBuffer":1768,"esri/views/2d/engine/vectorTiles/TileHandler":2023,"esri/views/2d/engine/vectorTiles/RectangleBinPack":2024,"esri/views/2d/engine/vectorTiles/renderers/Renderer":2025,"esri/views/2d/engine/vectorTiles/GlyphMosaic":2483,"esri/views/2d/engine/vectorTiles/GlyphSource":2484,"esri/views/2d/engine/vectorTiles/SpriteMosaic":2485,"esri/views/2d/engine/vectorTiles/renderers/BackgroundRenderer":2487,"esri/views/2d/engine/vectorTiles/renderers/CircleRenderer":2488,"esri/views/2d/engine/vectorTiles/renderers/FadeRecorder":2489,"esri/views/2d/engine/vectorTiles/renderers/FillRenderer":2490,"esri/views/2d/engine/vectorTiles/renderers/LineRenderer":2491,"esri/views/2d/engine/vectorTiles/renderers/SymbolRenderer":2492,"esri/views/2d/engine/vectorTiles/renderers/IconRenderer":2493,"esri/views/2d/engine/vectorTiles/renderers/SDFRenderer":2494,"esri/views/2d/engine/vectorTiles/renderers/TileInfoRenderer":2495,"esri/views/2d/engine/vectorTiles/renderers/shaders/ProgramCache":2496,"esri/views/2d/engine/vectorTiles/renderers/shaders/Programs":2497,"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/resolver":2498,"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/shaderRepository":2499})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1633:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(16),i(49),i(282),i(284),i(6),i(225),i(7),i(0)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u,d,f){return function(e){function t(t){var i=e.call(this)||this;return i.layer=null,i.parent=null,i}return i(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+i+"')",t),d.reject(t)}})},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},r([f.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r([f.property()],t.prototype,"layer",void 0),r([f.property()],t.prototype,"parent",void 0),r([f.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),r([f.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),r([f.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r([f.subclass("esri.views.layers.LayerView")],t)}(f.declared(a.HandleOwnerMixin(s.IdentifiableMixin(u.EsriPromiseMixin(o.EventedMixin(n))))))}.apply(null,r))||(e.exports=n)},1707:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=new Uint32Array(1),r=new Uint8Array(i.buffer);t.int32To4Bytes=function(e){return i[0]=0|e,[r[0],r[1],r[2],r[3]]},t.HIGH_RES_CUTOFF=1.15}.apply(null,r))||(e.exports=n)},1768:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}return Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.array.length=0},e.prototype.toBuffer=function(){return new Uint32Array(this._array).buffer},e.i1616to32=function(e,t){return 65535&e|t<<16},e.i8888to32=function(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24},e.i8816to32=function(e,t,i){return 255&e|(255&t)<<8|i<<16},e}()}.apply(null,r))||(e.exports=n)},2023:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(10),i(11),i(44),i(58),i(18),i(665),i(305),i(7),i(407),i(405),i(409),i(2483),i(2484),i(2485),i(705),i(307),i(165),i.dj.m(e)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u,d,f,c,_,h,p,m,v,g,y,x){var b=new l(10),w=new Map;return function(){function t(e,t,i,r,n){this._vectorTileLayer=e,this.devicePixelRatio=t,this.allowUpdates=i,this._container=r,this._memCache=n,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}return t.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(e){return e.abort()}),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(t.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then(function(){return e._spriteMosaic})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),t.prototype.start=function(t){return n(this,void 0,void 0,function(){var n,o,l,u,_,v=this;return r(this,function(r){for(l in n=this._vectorTileLayer.sourceNameToSource,o=[],n)o.push(this._fetchTileMap(n[l],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then(function(e){v._spriteMosaic=new m(1024,1024,250),v._spriteMosaic.setSpriteSource(e),s("stable-symbol-rendering")&&v._spriteMosaic.preloadSpriteItems()}),u=this._vectorTileLayer.styleRepository,_=new p(u.glyphs),this._glyphMosaic=new h(1024,1024,_),this._broadcastPromise=a.safeCast(c.open(f.getAbsMid("./WorkerTileHandler",e,x),{client:this,scheduler:t.scheduler,signal:t.signal})).then(function(e){return v._connection=e,d.all(v._connection.broadcast("setLayers",u.styleJSON,i({},t)))}),[2,d.all(o)]})})},t.prototype.updateStyle=function(){return n(this,void 0,void 0,function(){var e,t=this;return r(this,function(i){switch(i.label){case 0:return[4,this._broadcastPromise];case 1:return i.sent(),this._updateToAbortController.forEach(function(e){return e.abort()}),this._updateToAbortController.clear(),e=this._vectorTileLayer.styleRepository,this._broadcastPromise=d.create(function(i,r){d.all(t._connection.broadcast("updateStyle",e.styleJSON)).then(i,r)}),[2,this._broadcastPromise]}})})},t.prototype.abortTileUpdate=function(e){this._updateToAbortController.has(e)&&(this._updateToAbortController.get(e).abort(),this._updateToAbortController.delete(e))},t.prototype.updateTile=function(e,t){return n(this,void 0,void 0,function(){var i,n,o,a,s=this;return r(this,function(r){switch(r.label){case 0:return this.allowUpdates&&e.isReady?[4,this._broadcastPromise]:[2,null];case 1:return r.sent(),i=Math.round(_.degToByte(t.state.rotation)),e.rotation===i?[2,null]:(o=e.key,this._updateToAbortController.has(o.id)&&((n=this._updateToAbortController.get(o.id)).abort(),this._updateToAbortController.delete(o.id)),n=d.createAbortController(),e.rotation=i,a=e.client.invoke("updateSymbols",{key:e.id,rotation:i},{signal:n.signal}).then(function(t){return s._updateToAbortController.delete(o.id),e.isReady&&e.updateSymbolData(t),t}).catch(function(e){d.isAbortError(e)||s._updateToAbortController.delete(o.id)}),this._updateToAbortController.set(e.id,n),[2,a])}})})},t.prototype.updateTileData=function(e){for(var t,i=e.tileId,r=this._container.children,n=0;n<r.length;n++)if((t=r[n]).id===i){t.updateTileData(e.tileData);break}},t.prototype.getVectorTile=function(e,t,i){return n(this,void 0,void 0,function(){var n,o,a,s,l;return r(this,function(r){switch(r.label){case 0:return n=new y(e,t,i,0),this._memCache&&(o=this._memCache.get(n.id))?(o.reference(),[2,o]):[4,this._getVectorTileData(n,null)];case 1:return a=r.sent(),this._memCache&&(s=this._memCache.get(n.id))?(s.reference(),[2,s]):(l=g.pool.acquire(n,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0),a&&a.tileData?(l.setData(a.tileData,a.client),this._memCache&&(l.reference(),this._memCache.put(l.key.id,l,l.getMemoryUsage()*l.referenced,u.MIN_PRIORITY))):l.setData(null,null),[2,l])}})})},t.prototype.releaseVectorTile=function(e){!this._memCache||e.release()?g.pool.release(e):this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)},t.prototype.fetchTileData=function(e,t){return n(this,void 0,void 0,function(){var i,n,o,a;return r(this,function(r){switch(r.label){case 0:return[4,this._getRefKeys(e,t)];case 1:for(a in i=r.sent(),n=this._vectorTileLayer.sourceNameToSource,o=[],n)o.push(a);return[2,this._getSourcesData(o,i,t)]}})})},t.prototype.parseTileData=function(e,t,o){return n(this,void 0,void 0,function(){var n,a,l,u,d,f,c,h;return r(this,function(r){switch(r.label){case 0:return(n=e&&e.data)?(a=n.sourceName2DataAndRefKey,l=n.transferList,0===Object.keys(a).length?[2,null]:[4,this._broadcastPromise]):[2,null];case 1:return r.sent(),u=Math.round(_.degToByte(t)),[4,(d=this._connection.getAvailableClient()).invoke("createTileAndParse",{key:e.key.id,rotation:u,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:a},i({},o,{transferList:l}))];case 2:if(f=r.sent(),s("esri-vector-tiles-debug")){for(h in c={},a)c[h]=a[h].refKey;return[2,{tileData:f,client:d,refKeys:c}]}return[2,{tileData:f,client:d}]}})})},Object.defineProperty(t.prototype,"updating",{get:function(){return this._ongoingTileRequests.size>0},enumerable:!0,configurable:!0}),t.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(e){return e.abort()}),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},t.prototype.getSprites=function(e){var t=this;return this._spriteSourcePromise.then(function(){return t._spriteMosaic.getSpriteItems(e)})},t.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.tileID,e.font,e.codePoints)},t.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},t.prototype._getTilePayload=function(e,t,a){return n(this,void 0,void 0,function(){var n,s,l,u;return r(this,function(r){switch(r.label){case 0:return n=y.pool.acquire(e.id),s=this._vectorTileLayer.sourceNameToSource,l=s[t],u=l.getSourceTileUrl(n.level,n.row,n.col),y.pool.release(n),[4,o(u,i({responseType:"array-buffer"},a))];case 1:return[2,{protobuff:r.sent().data,sourceName:t}]}})})},t.prototype._fetchTileMap=function(e,t){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return d.resolve();if(!e.tileMapURL)return d.resolve();var i=b.get(e.tileMapURL);if(i)return e.tileIndex=i,d.resolve();if(w.has(e.tileMapURL))return w.get(e.tileMapURL).then(function(t){e.tileIndex=new v(t.data)});var r=o(e.tileMapURL,t);return r.then(function(t){e.tileIndex=new v(t.data),w.delete(e.tileMapURL),b.put(e.tileMapURL,e.tileIndex)}),w.set(e.tileMapURL,r),r},t.prototype._getRefKeys=function(e,t){return n(this,void 0,void 0,function(){var i,n,o,a,s;return r(this,function(r){for(o in i=this._vectorTileLayer.sourceNameToSource,n=new Array,i)a=i[o],s=a.getRefKey(e,t),n.push(s);return[2,d.eachAlways(n)]})})},t.prototype._getSourcesData=function(e,t,i){return n(this,void 0,void 0,function(){var n,o,a,s,l,u,f;return r(this,function(r){switch(r.label){case 0:for(n=[],u=0;u<t.length;u++)null==t[u].value||null==e[u]?n.push(null):(o=this._getTilePayload(t[u].value,e[u],i),n.push(o));return[4,d.eachAlways(n)];case 1:for(a=r.sent(),s={},l=[],u=0;u<a.length;u++)a[u].value&&a[u].value&&a[u].value.protobuff&&a[u].value.protobuff.byteLength>0&&(f=t[u].value.id,s[a[u].value.sourceName]={refKey:f,protobuff:a[u].value.protobuff},l.push(a[u].value.protobuff));return[2,{sourceName2DataAndRefKey:s,transferList:l}]}})})},t.prototype._getVectorTileData=function(e,t){return n(this,void 0,void 0,function(){var i,n,o,a,s,l=this;return r(this,function(r){return i=e.id,this._ongoingTileRequests.has(i)?[2,this._ongoingTileRequests.get(i)]:(n=new AbortController,o={signal:n.signal},a=t&&t.signal,s=this._getParsedVectorTileData(e,o).then(function(e){return l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i),e}).catch(function(){return l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i),null}),this._ongoingTileRequests.set(i,s),this._ongoingRequestToController.set(i,n),a&&d.onAbort(a,function(){n.abort(),l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i)}),[2,s])})})},t.prototype._getParsedVectorTileData=function(e,t){return n(this,void 0,void 0,function(){var i;return r(this,function(r){switch(r.label){case 0:return[4,this.fetchTileData(e,t)];case 1:return i=r.sent(),[2,this.parseTileData({key:e,data:i},0,t)]}})})},t}()}.apply(null,r))||(e.exports=n)},2024:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(171)],void 0===(n=function(e,t,i){return function(){function e(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new i.default(0,0,e,t))}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new i.default;for(var r=null,n=-1,o=0;o<this._free.length;++o){var a=this._free[o];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,n=o)}return null===r?new i.default:(this._free.splice(n,1),r.width<r.height?(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,e,r.height-t))),new i.default(r.x,r.y,e,t))},e.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},e}()}.apply(null,r))||(e.exports=n)},2025:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(21),i(290),i(288),i(167),i(38),i(184),i(409),i(2487),i(2488),i(2489),i(2490),i(2491),i(2492),i(2495),i(2496)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u,d,f,c,_,h,p,m){return a.enums.CompareFunction,a.enums.DepthStencilTargetType,a.enums.Face,a.enums.PixelFormat,a.enums.PixelType,a.enums.StencilOperation,a.enums.TargetType,a.enums.TextureSamplingMode,function(){function e(e,t,i){void 0===i&&(i=!0),this._extrudeMatrix=r.mat4f32.create(),this._extrudeNoRotationMatrix=r.mat4f32.create(),this._extrudeRotateVector=n.vec3f32.fromValues(0,0,1),this._extrudeScaleVector=n.vec3f32.fromValues(1,1,1),this._backgroundColor=o.vec4f32.fromValues(1,0,0,1),this._state={rotation:0,size:[0,0]},this._cachedWidth=0,this._cachedHeight=0,this._cachedRotation=0,this._blitRenderer=new s.BitBlitRenderer,this._globalOpacityFBO=null,this._boundFBO=null,this._programCache=null,this._spriteMosaic=e,this._glyphMosaic=t,this._ignoreSpeed=!i,this._fadeRecorder=new f.FadeRecorder(400)}return e.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null),this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null),this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null),this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null),this._circleRenderer&&(this._circleRenderer.dispose(),this._circleRenderer=null),this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null),this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null),this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._boundFBO=null,this._programCache&&(this._programCache.dispose(),this._programCache=null),this._cachedWidth=0,this._cachedHeight=0,this._cachedRotation=0},e.prototype.initializeProgramCache=function(e){if(null===this._programCache){var t=new m.default;t.initialize(e),this._backgroundRenderer=new u(t),this._lineRenderer=new _(t),this._fillRenderer=new c(t),this._symbolRenderer=new h(t),this._circleRenderer=new d(t),this._tileInfoRenderer=new p(t),this._programCache=t}},e.prototype.setStateParams=function(e,t,r){this._fadeRecorder.recordLevel(r),this._state=e,this._state.size[0]===this._cachedWidth&&this._state.size[1]===this._cachedHeight&&this._state.rotation===this._cachedRotation||(this._extrudeScaleVector[0]=2/e.size[0],this._extrudeScaleVector[1]=-2/e.size[1],i.mat4.identity(this._extrudeMatrix),i.mat4.rotate(this._extrudeMatrix,this._extrudeMatrix,-e.rotation*l.C_DEG_TO_RAD,this._extrudeRotateVector),i.mat4.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),i.mat4.transpose(this._extrudeMatrix,this._extrudeMatrix),i.mat4.identity(this._extrudeNoRotationMatrix),i.mat4.scale(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix,this._extrudeScaleVector),i.mat4.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.size[0],this._cachedHeight=this._state.size[1],this._cachedRotation=this._state.rotation)},e.prototype.drawClippingMasks=function(e,t){if(0!==t.length){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setClearStencil(0);var i=e.gl;e.clear(i.STENCIL_BUFFER_BIT);for(var r=0,n=t;r<n.length;r++){var o=n[r];o.attached&&o.visible&&(e.setStencilFunctionSeparate(1032,519,o.stencilData.reference,o.stencilData.mask),this._backgroundRenderer.renderSolidColor(e,{u_matrix:o.tileTransform.transform,u_normalized_origin:o.tileTransform.displayCoord,u_coord_range:o.coordRange,u_depth:0,u_color:this._backgroundColor}))}e.setColorMask(!0,!0,!0,!0),e.setBlendingEnabled(!0)}},e.prototype.renderDebug=function(e,t){var i=t.key;this._backgroundColor.set([i.col%2,i.row%2,i.col%2==0&&i.row%2==0?1:0,.5]),this._backgroundRenderer.renderSolidColor(e,{u_matrix:t.tileTransform.transform,u_normalized_origin:t.tileTransform.displayCoord,u_coord_range:t.coordRange,u_depth:0,u_color:this._backgroundColor})},e.prototype.renderBackGroundLayer=function(e,t,i,r,n,o,a){return this._backgroundRenderer.render(e,t,i,r,n,o,this._spriteMosaic,this._spriteMosaic.pixelRatio,a)},e.prototype.getBackGroundRenderer=function(){return this._backgroundRenderer},e.prototype.getSpriteMosaic=function(){return this._spriteMosaic},e.prototype.renderBucket=function(e,t,i,r,n,o,a,s){if(!a||void 0!==a.minzoom&&a.minzoom>i+1e-6||void 0!==a.maxzoom&&a.maxzoom<=i-1e-6)return 0;switch(t.type){case 1:if(3!==n)return this._renderFill(e,t,i,n,o,a,s);break;case 2:if(2===n||4===n)return this._renderLine(e,t,i,n,o,a,s);break;case 3:if(3===n||4===n)return this._renderSymbol(e,t,i,n,r,o,a,s);break;case 4:if(3===n||4===n)return this._renderCircle(e,t,i,n,r,o,a,s)}return 0},e.prototype.renderTileInfo=function(e,t){this._tileInfoRenderer.render(e,t)},e.prototype.setGlobalOpacity=function(e,t,i){if(1!==i){this._boundFBO=e.getBoundFramebufferObject();var r=t.pixelRatio,n=t.state.size,o=n[0],s=n[1],l=Math.round(o*r),u=Math.round(s*r);null!==this._globalOpacityFBO&&this._globalOpacityFBO.width===l&&this._globalOpacityFBO.height===u||(null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=a.FramebufferObject.create(e,{colorTarget:0,depthStencilTarget:3,width:l,height:u})),e.bindFramebuffer(this._globalOpacityFBO),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}},e.prototype.applyGlobalOpacity=function(e,t,i){if(1!==i){var r=t.pixelRatio,n=t.state.size,o=n[0],a=n[1],s=e.getViewport();e.setViewport(0,0,r*o,r*a),e.bindFramebuffer(this._boundFBO);var l=this._globalOpacityFBO.colorTexture;this._blitRenderer.render(e,l,9728,i),e.setViewport(s.x,s.y,s.width,s.height),this._boundFBO=null}},e.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()},e.prototype.hitTest=function(e,t,i,r,n,o,s){var l=[0,0],u=[0,0],d=e.state;d.toMap(l,[0,0]),d.toMap(u,[o,o]);var f=r.filter(function(e){return!(l[0]>e.bounds[2]||u[0]<e.bounds[0]||l[1]<e.bounds[3]||u[1]>e.bounds[1])});if(0===f.length)return[];f.sort(function(e,t){return e.key.level-t.key.level});for(var c=f.length,_=1;_<=c;_++){(y=f[_-1]).attached&&(y.stencilData.reference=_,y.stencilData.mask=255)}s(d,n,f);var h=e.context;this._hittestFBO||(this._hittestFBO=a.FramebufferObject.create(h,{colorTarget:0,depthStencilTarget:3,width:o,height:o}));var p=h.getViewport(),m=h.getBoundFramebufferObject();h.bindFramebuffer(this._hittestFBO),h.setViewport(0,0,o,o);var v=h.gl;h.setDepthWriteEnabled(!0),h.setStencilWriteMask(255),h.setClearColor(1,1,1,1),h.setClearDepth(1),h.setClearStencil(0),h.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT),h.setDepthWriteEnabled(!1),this.drawClippingMasks(h,f),h.setBlendingEnabled(!1),h.setStencilWriteMask(0),h.setStencilOp(7680,7680,7681),h.setDepthFunction(515),h.setDepthTestEnabled(!0),h.setDepthWriteEnabled(!0),h.setStencilTestEnabled(!0);for(var g=0;g<c;g++){var y;(y=f[g]).attached&&y.doRender(e)}h.setStencilTestEnabled(!1),h.setDepthTestEnabled(!1),this._readbackBuffer||(this._readbackBuffer=new Uint8Array(4*o*o),this._readbackBuffer32=new Uint32Array(this._readbackBuffer.buffer)),this._hittestFBO.readPixels(0,0,o,o,6408,5121,this._readbackBuffer);var x=new Set,b=o*o,w=Math.round(b/2),D=this._readbackBuffer32[w];4294967295!==D&&x.add(D);for(_=0;_<b;_++)4294967295!==(D=this._readbackBuffer32[_])&&x.add(D);h.bindFramebuffer(m),h.setViewport(p.x,p.y,p.width,p.height);var T=[];return x.forEach(function(e){T.push(e)}),T},e.prototype._renderLine=function(e,t,i,r,n,o,a){return this._lineRenderer.render(e,t,i,r,this._state,n,o,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,a)},e.prototype._renderFill=function(e,t,i,r,n,o,a){return this._fillRenderer.render(e,t,i,this._state.rotation,r,n,o,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,a)},e.prototype._renderCircle=function(e,t,i,r,n,o,a,s){var l=!0;return n===o.key.level&&(l=!1),e.setStencilTestEnabled(l),this._circleRenderer.render(e,t,i,r,this._state.rotation,o,a,this._extrudeMatrix,s)},e.prototype._renderSymbol=function(e,t,i,r,n,o,a,s){var l=!0;return n===o.key.level&&(l=!1),e.setStencilTestEnabled(l),this._symbolRenderer.render(e,t,i,r,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),o,a,this._spriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._spriteMosaic.pixelRatio,s)},e}()}.apply(null,r))||(e.exports=n)},2483:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(18),i(7),i(38),i(2024),i(171)],void 0===(n=function(e,t,i,r,n,o,a){var s;return n.enums.PixelFormat,n.enums.PixelType,function(){function e(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!s&&i("stable-symbol-rendering")&&(s=new Set),this.width=e,this.height=t,this._glyphSource=r,this._binPack=new o(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}return e.prototype.getGlyphItems=function(e,t,n){for(var l=this,u=[],d=this._glyphSource,f=new Set,c=0,_=n;c<_.length;c++){var h=_[c],p=Math.floor(h*(1/256));f.add(p)}var m=[];return f.forEach(function(e){if(e<=256){var i=t+e;if(l._rangePromises.has(i))m.push(l._rangePromises.get(i));else{var r=d.getRange(t,e).then(function(){l._rangePromises.delete(i)},function(){l._rangePromises.delete(i)});l._rangePromises.set(i,r),m.push(r)}}}),r.all(m).then(function(e){var r,c=l._glyphIndex[t];if(c||(c={},l._glyphIndex[t]=c),i("stable-symbol-rendering")){s.clear();for(var _=0,h=n;_<h.length;_++){var p=h[_];s.add(p)}var m=[];f.forEach(function(e){m.push(e)}),m.sort(),r=[];for(var v=0,g=m;v<g.length;v++)for(var y=g[v],x=0;x<256;++x)r.push(256*y+x)}else r=n;for(var b=0,w=r;b<w.length;b++){var D=c[p=w[b]];if(D)i("stable-symbol-rendering")&&!s.has(p)||(u[p]={sdf:!0,rect:D.rect,metrics:D.metrics,page:D.page});else{var T=d.getGlyph(t,p);if(T&&T.metrics){var P=T.metrics,M=void 0;if(0===P.width)M=new a.default(0,0,0,0);else{var C=P.width+6,O=P.height+6,z=C%4?4-C%4:4,A=O%4?4-O%4:4;1===z&&(z=5),1===A&&(A=5),(M=l._binPack.allocate(C+z,O+A)).isEmpty&&(l._dirties[l._currentPage]||(l._glyphData[l._currentPage]=null),l._currentPage=l._glyphData.length,l._glyphData.push(new Uint8Array(l.width*l.height)),l._dirties.push(!0),l._textures.push(void 0),l._binPack=new o(l.width-4,l.height-4),M=l._binPack.allocate(C+z,O+A));var V=l._glyphData[l._currentPage],R=T.bitmap,I=void 0,S=void 0;if(R)for(var U=0;U<O;U++){I=C*U,S=l.width*(M.y+U+1)+M.x;for(var j=0;j<C;j++)V[S+j+1]=R[I+j]}}c[p]={rect:M,metrics:P,tileIDs:null,page:l._currentPage},i("stable-symbol-rendering")&&!s.has(p)||(u[p]={sdf:!0,rect:M,metrics:P,page:l._currentPage}),l._dirties[l._currentPage]=!0}}}return u})},e.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var o=this._glyphData[r.page],a=r.rect,s=void 0,l=void 0,u=0;u<a.height;u++)for(s=this.width*(a.y+u)+a.x,l=0;l<a.width;l++)o[s+l]=0;delete i[n],this._dirties[r.page]=!0}}}},e.prototype.bind=function(e,t,i,r){void 0===r&&(r=0),this._textures[i]||(this._textures[i]=new n.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var o=this._textures[i];o.setSamplingMode(t),this._dirties[i]&&o.setData(this._glyphData[i]),e.bindTexture(o,r),this._dirties[i]=!1},e.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},2484:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(44),i(18),i(639),i(7)],void 0===(n=function(e,t,i,r,n,o){var a=function(){function e(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var i=t.getMessage(),r=void 0,n=void 0,o=void 0,a=void 0,s=void 0,l=void 0,u=void 0;i.next();)switch(i.tag()){case 1:r=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:o=i.getUInt32();break;case 4:a=i.getUInt32();break;case 5:s=i.getSInt32();break;case 6:l=i.getSInt32();break;case 7:u=i.getUInt32();break;default:i.skip()}i.release(),r&&(this._metrics[r]={width:o,height:a,left:s,top:l,advance:u},this._bitmaps[r]=n);break;default:t.skip()}t.release();break;default:e.skip()}}return e.prototype.getMetrics=function(e){return this._metrics[e]},e.prototype.getBitmap=function(e){return this._bitmaps[e]},e}(),s=function(){function e(){this._ranges=[]}return e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.addRange=function(e,t){this._ranges[e]=t},e}();return function(){function e(e){this._glyphInfo={},this._baseURL=e}return e.prototype.getRange=function(e,t){var s=this._getFontStack(e);if(r("stable-symbol-rendering")&&t>0)return s.addRange(t,new a),o.resolve();if(s.getRange(t))return o.resolve();var l=256*t,u=l+255,d=this._baseURL.replace("{fontstack}",e).replace("{range}",l+"-"+u);return i(d,{responseType:"array-buffer"}).then(function(e){s.addRange(t,new a(new n(new Uint8Array(e.data),new DataView(e.data))))}).catch(function(){s.addRange(t,new a)})},e.prototype.getGlyph=function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},e.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new s),t},e}()}.apply(null,r))||(e.exports=n)},2485:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(38),i(2024),i(171)],void 0===(n=function(e,t,i,r,n){return i.enums.PixelFormat,i.enums.PixelType,function(){function e(e,t,i){void 0===i&&(i=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new r(e-4,t-4)}return e.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},e.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},e.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new r(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),n=new Uint32Array(t*i);this._mosaicsData[0]=n,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},e.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var i=this._mosaicRects[e];if(i)return i;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var r=this._sprites.getSpriteInfo(e);if(!r||!r.width||!r.height||r.width<0||r.height<0)return null;var n=r.width,o=r.height,a=this._allocateImage(n,o),s=a[0],l=a[1],u=a[2];return s.width<=0?null:(this._copy(s,r,l,u,t),i={rect:s,width:n,height:o,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:l},this._mosaicRects[e]=i,i)},e.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++){var i=t[e];this.getSpriteItem(i,!0)}},e.prototype.getSpriteItems=function(e){for(var t={},i=0,r=e;i<r.length;i++){var n=r[i];t[n]=this.getSpriteItem(n)}return t},e.prototype.getMosaicItemPosition=function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,o=i.height;return{size:[i.width,i.height],tl:[(r.x+2)/this._size[i.page][0],(r.y+2)/this._size[i.page][1]],br:[(r.x+2+n)/this._size[i.page][0],(r.y+2+o)/this._size[i.page][1]],page:i.page}},e.prototype.bind=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._textures[r]||(this._textures[r]=new i.Texture(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var o=this._textures[r];o.setSamplingMode(t),this._dirties[r]&&o.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(o,n),this._dirties[r]=!1},e._copyBits=function(e,t,i,r,n,o,a,s,l,u,d){var f=r*t+i,c=s*o+a;if(d){c-=o;for(var _=-1;_<=u;f=((++_+u)%u+r)*t+i,c+=o)for(var h=-1;h<=l;h++)n[c+h]=e[f+(h+l)%l]}else for(_=0;_<u;_++){for(h=0;h<l;h++)n[c+h]=e[f+h];f+=t,c+=o}},e.prototype._copy=function(t,i,r,n,o,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var s=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&s||console.error("Source or target images are uninitialized!");var u=a?i.width:this._sprites.width;e._copyBits(s,u,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,o),this._dirties[r]=!0}},e.prototype._allocateImage=function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var o=new n.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[o,this._mosaicsData.length-1,[e,t]]}var a=e%4?4-e%4:4,s=t%4?4-t%4:4;1===a&&(a=5),1===s&&(s=5);var l=this._binPack.allocate(e+a,t+s);return l.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new r(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},2487:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(87),i(308),i(167),i(38),i(1768),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s){return o.enums.DataType,o.enums.PrimitiveType,o.enums.TextureSamplingMode,o.enums.Usage,function(){function e(e){this._patternMatrix=r.mat3f32.create(),this._color=n.vec4f32.create(),this._solidrendererInitialized=!1,this._rendererInitialized=!1,this._programOptions={id:!1,pattern:!1},this._programCache=e,this._color.set([1,0,0,1])}return e.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)},e.prototype.renderSolidColor=function(e,t){this._solidrendererInitialized||this._initializeSolidRenderer(e),e.bindVAO(this._solidVertexArrayObject);var i=this._programOptions;i.id=!1,i.pattern=!1;var r=this._programCache.getProgram(0,0,i);e.bindProgram(r),r.setUniformMatrix4fv("u_transformMatrix",t.u_matrix),r.setUniform2fv("u_normalized_origin",t.u_normalized_origin),r.setUniform1f("u_coord_range",t.u_coord_range||4096),r.setUniform1f("u_depth",t.u_depth||0),r.setUniform4fv("u_color",t.u_color||this._color),e.drawArrays(5,0,4),e.bindVAO()},e.prototype.render=function(e,t,r,n,o,a,l,u,d){this._rendererInitialized||this._initialize(e);var f=t.getPaintValue("background-color",o),c=d*t.getPaintValue("background-opacity",o),_=t.getPaintValue("background-pattern",o),h=void 0!==_,p=f[3]*c,m=4===a,v=(m?1:0)<<1|(h?1:0),g=this._programOptions;g.id=m,g.pattern=h;var y=this._programCache.getProgram(0,v,g);if(e.bindVAO(this._vertexArrayObject),e.bindProgram(y),y.setUniform1f("u_coord_range",n.coordRange),y.setUniform1f("u_depth",t.z||0),y.setUniformMatrix4fv("u_transformMatrix",n.tileTransform.transform),y.setUniform2fv("u_normalized_origin",n.tileTransform.displayCoord),h){var x=l.getMosaicItemPosition(_,!0);if(!x)return 0;var b=512*(u>s.HIGH_RES_CUTOFF?2:1)*Math.max(Math.pow(2,Math.round(o)-n.key.level),1);i.mat3.identity(this._patternMatrix);var w=b/x.size[0],D=b/x.size[1];this._patternMatrix[0]=w,this._patternMatrix[4]=D,l.bind(e,9729,x.page,5),y.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),y.setUniform1f("u_opacity",c),y.setUniform2f("u_pattern_tl",x.tl[0],x.tl[1]),y.setUniform2f("u_pattern_br",x.br[0],x.br[1]),y.setUniform1i("u_texture",5)}else this._color[0]=p*f[0],this._color[1]=p*f[1],this._color[2]=p*f[2],this._color[3]=p,y.setUniform4fv("u_color",this._color);if(m){var T=s.int32To4Bytes(r);y.setUniform4f("u_id",T[0],T[1],T[2],T[3])}return e.drawArrays(5,0,4),e.bindVAO(),2},e.prototype._initializeSolidRenderer=function(e){if(this._solidrendererInitialized)return!0;var t=new Int8Array([0,0,1,0,0,1,1,1]),i=o.BufferObject.createVertex(e,35044,t),r=new o.VertexArrayObject(e,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:i});return this._solidVertexArrayObject=r,this._solidrendererInitialized=!0,!0},e.prototype._initialize=function(e){if(this._rendererInitialized)return!0;var t=[];t.push(a.i1616to32(0,0)),t.push(a.i1616to32(1,0)),t.push(a.i1616to32(0,1)),t.push(a.i1616to32(1,1));var i=new Uint32Array(t),r=o.BufferObject.createVertex(e,35044,i),n=new o.VertexArrayObject(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:r});return this._vertexArrayObject=n,this._rendererInitialized=!0,!0},e}()}.apply(null,r))||(e.exports=n)},2488:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(21),i(290),i(288),i(167),i(38),i(409),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s,l){return a.enums.DataType,a.enums.PrimitiveType,function(){function e(e){this._viewProjMat=r.mat4f32.create(),this._offsetVector=n.vec3f32.create(),this._color=o.vec4f32.create(),this._strokeColor=o.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,r,n,o,a,u,d,f){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var c=u.hasDataDrivenRadius?1:u.getPaintValue("circle-radius",r),_=u.hasDataDrivenColor?[1,1,1,1]:u.getPaintValue("circle-color",r),h=u.hasDataDrivenOpacity?1:u.getPaintValue("circle-opacity",r),p=u.hasDataDrivenStrokeWidth?1:u.getPaintValue("circle-stroke-width",r),m=u.hasDataDrivenStrokeColor?[1,1,1,1]:u.getPaintValue("circle-stroke-color",r),v=u.hasDataDrivenStrokeOpacity?1:u.getPaintValue("circle-stroke-opacity",r),g=u.hasDataDrivenBlur?0:u.getPaintValue("circle-blur",r),y=h*_[3]*f;this._color[0]=y*_[0],this._color[1]=y*_[1],this._color[2]=y*_[2],this._color[3]=y,y=v*m[3]*f,this._strokeColor[0]=y*m[0],this._strokeColor[1]=y*m[1],this._strokeColor[2]=y*m[2],this._strokeColor[3]=y;var x=a.tileTransform.transform,b=u.getPaintValue("circle-translate",r);if(0!==b[0]||0!==b[1]){i.mat4.copy(this._viewProjMat,a.tileTransform.transform);var w=b[0],D=b[1],T=0,P=0,M=a.coordRange/512,C=(1<<a.key.level)/Math.pow(2,r)*M;if(1===u.getPaintValue("circle-translate-anchor",r)){var O=-s.C_DEG_TO_RAD*o,z=Math.sin(O),A=Math.cos(O);T=C*(w*A-D*z),P=C*(w*z+D*A)}else T=C*w,P=C*D;this._offsetVector[0]=T,this._offsetVector[1]=P,this._offsetVector[2]=0,i.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),x=this._viewProjMat}var V=this._getCircleVAO(e,a);if(!V)return 0;e.bindVAO(V);var R=4===n,I=R?1:0,S=this._programOptions;S.id=R;var U=this._programCache.getProgram(5,I,S);if(e.bindProgram(U),U.setUniformMatrix4fv("u_transformMatrix",x),U.setUniformMatrix4fv("u_extrudeMatrix",d),U.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),U.setUniform1f("u_depth",u.z),U.setUniform1f("u_radius",c),U.setUniform4fv("u_color",this._color),U.setUniform1f("u_blur",g),U.setUniform1f("u_stroke_width",p),U.setUniform4fv("u_stroke_color",this._strokeColor),U.setUniform1f("u_antialiasingWidth",1.2),R){var j=l.int32To4Bytes(t.layerID);U.setUniform4f("u_id",j[0],j[1],j[2],j[3])}return e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleCount()},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getCircleVAO=function(e,t){if(t.circleVertexArrayObject)return t.circleVertexArrayObject;var i=t.circleVertexBuffer,r=t.circleIndexBuffer;return i&&r?(t.circleVertexArrayObject=new a.VertexArrayObject(e,this._programCache.getProgramAttributes(5),this._vertexAttributes,{geometry:i},r),t.circleVertexArrayObject):null},e}()}.apply(null,r))||(e.exports=n)},2489:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(133)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,i,r){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=i,this.fadeChange=r}}();t.FadeProperties=r;var n=function(){function e(e){void 0===e&&(e=300),this._levelSnapshots=[],this._duration=e}return e.prototype.recordLevel=function(e){var t=i(),r=this._levelSnapshots;0===r.length&&(r.push({level:e,now:0}),r.push({level:e,now:0})),2!==r.length&&r[0].level===e||r.push({level:e,now:t})},e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,i=t.length,r=t[i-1],n=-1;i>n+1&&t[n+1].now+e<r.now;)n++;for(n<0&&(n=0);n<i;n++)if(t[n].level!==r.level)return!0;return!1},e.prototype.getFadeValues=function(e){void 0===e&&(e=!1);for(var t=this._duration,r=i(),n=this._levelSnapshots;n.length>3&&n[1].now+t<r;)n.shift();n[1].now+t<r&&(n[0].level=n[1].level);var o=n[0].level,a=n[n.length-1],s=a.level,l=Math.min(o,s),u=Math.max(o,s),d=(a.level-n[1].level)/((a.now-n[1].now)/t),f=(r-a.now)/t*d;return e?{fadeSpeed:0,minfadeLevel:l,maxfadeLevel:u,fadeChange:0}:{fadeSpeed:d,minfadeLevel:l,maxfadeLevel:u,fadeChange:f}},e}();t.FadeRecorder=n}.apply(null,r))||(e.exports=n)},2490:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(87),i(308),i(21),i(290),i(288),i(167),i(38),i(409),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u,d){return l.enums.DataType,l.enums.PrimitiveType,l.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=o.mat4f32.create(),this._offsetVector=a.vec3f32.create(),this._patternMatrix=r.mat3f32.create(),this._color=s.vec4f32.create(),this._outlineColor=s.vec4f32.create(),this._initialized=!1,this._fillProgramOptions={id:!1,dd:!1,pattern:!1},this._outlineProgramOptions={id:!1,dd:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,i,r,o,a,s,l,f,c,_){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var h=void 0!==s.getPaintValue("fill-pattern",i),p=s.hasDataDrivenColor?[1,1,1,1]:s.getPaintValue("fill-color",i),m=s.hasDataDrivenOpacity?1:s.getPaintValue("fill-opacity",i),v=m*p[3]*_;this._color[0]=v*p[0],this._color[1]=v*p[1],this._color[2]=v*p[2],this._color[3]=v;var g,y=4===o;y&&(g=d.int32To4Bytes(t.layerID));var x=a.tileTransform.transform,b=a.coordRange/512,w=s.getPaintValue("fill-translate",i);if(0!==w[0]||0!==w[1]){n.mat4.copy(this._viewProjMat,a.tileTransform.transform);var D=w[0],T=w[1],P=0,M=0,C=(1<<a.key.level)/Math.pow(2,i)*b;if(1===s.getPaintValue("fill-translate-anchor",i)){var O=-u.C_DEG_TO_RAD*r,z=Math.sin(O),A=Math.cos(O);P=C*(D*A-T*z),M=C*(D*z+T*A)}else P=C*D,M=C*T;this._offsetVector[0]=P,this._offsetVector[1]=M,this._offsetVector[2]=0,n.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),x=this._viewProjMat}var V=this._drawFill(e,t,i,o,a,s,l,x,c,_,y,g);if(!(s.getPaintValue("fill-antialias",i)&&!h&&t.outlineElementCount>0)||2!==o&&4!==o)return V;var R=s.hasDataDrivenOutline;if(s.outlineUsesFillColor){if(1!==this._color[3])return t.triangleElementCount/3;this._outlineColor[0]=this._color[0],this._outlineColor[1]=this._color[1],this._outlineColor[2]=this._color[2],this._outlineColor[3]=this._color[3]}else{var I=s.hasDataDrivenOutlineColor?[1,1,1,1]:s.getPaintValue("fill-outline-color",i),S=m*I[3]*_;this._outlineColor[0]=S*I[0],this._outlineColor[1]=S*I[1],this._outlineColor[2]=S*I[2],this._outlineColor[3]=S}var U=.75/c,j=this._getOutlineVAO(e,a,R);if(!j)return V;e.bindVAO(j);var k=(y?1:0)<<1|(R?1:0),F=this._outlineProgramOptions;F.id=y,F.dd=R;var B=this._programCache.getProgram(2,k,F);return e.bindProgram(B),B.setUniformMatrix4fv("u_transformMatrix",x),B.setUniformMatrix4fv("u_extrudeMatrix",f),B.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),B.setUniform1f("u_depth",s.z+1/65536),B.setUniform1f("u_outline_width",U),B.setUniform4fv("u_color",this._outlineColor),y&&B.setUniform4f("u_id",g[0],g[1],g[2],g[3]),e.drawElements(4,t.outlineElementCount,5125,12*t.outlineElementStart),e.bindVAO(),V+t.outlineElementCount/3},e.prototype._initialize=function(e){return!!this._initialized||(this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]},this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]},this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]},this._initialized=!0,!0)},e.prototype._drawFill=function(e,t,r,n,o,a,s,l,u,f,c,_){var h=a.getPaintValue("fill-pattern",r),p=void 0!==h,m=a.hasDataDrivenOpacity?1:f*a.getPaintValue("fill-opacity",r),v=a.hasDataDrivenColor?[1,1,1,1]:a.getPaintValue("fill-color",r),g=m*v[3]*f;this._color[0]=g*v[0],this._color[1]=g*v[1],this._color[2]=g*v[2],this._color[3]=g;var y=a.hasDataDrivenFill,x=p||g<1||y;if(x&&1===n)return 0;if(!x&&2===n)return 0;var b=this._getFillVAO(e,o,y);if(!b)return 0;e.bindVAO(b);var w=(c?1:0)<<2|(y?1:0)<<1|(p?1:0),D=this._fillProgramOptions;D.id=c,D.dd=y,D.pattern=p;var T=this._programCache.getProgram(1,w,D);if(e.bindProgram(T),p){var P=s.getMosaicItemPosition(h,!0);if(!P)return e.bindVAO(),void e.bindProgram();var M=u>d.HIGH_RES_CUTOFF?2:1,C=Math.max(Math.pow(2,Math.round(r)-o.key.level),1),O=o.coordRange/(512*M*C);i.mat3.identity(this._patternMatrix);var z=1/(P.size[0]*O),A=1/(P.size[1]*O);this._patternMatrix[0]=z,this._patternMatrix[4]=A,s.bind(e,9729,P.page,5),T.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),T.setUniform2f("u_pattern_tl",P.tl[0],P.tl[1]),T.setUniform2f("u_pattern_br",P.br[0],P.br[1]),T.setUniform1i("u_texture",5)}return T.setUniformMatrix4fv("u_transformMatrix",l),T.setUniform2fv("u_normalized_origin",o.tileTransform.displayCoord),T.setUniform1f("u_depth",a.z+1/65536),T.setUniform4fv("u_color",this._color),c&&T.setUniform4f("u_id",_[0],_[1],_[2],_[3]),e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleElementCount/3},e.prototype._getFillVAO=function(e,t,i){if(i){if(t.fillDDVertexArrayObject)return t.fillDDVertexArrayObject;var r=t.fillDDVertexBuffer,n=t.fillIndexBuffer;return r&&n?(t.fillDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:r},n),t.fillDDVertexArrayObject):null}if(t.fillVertexArrayObject)return t.fillVertexArrayObject;r=t.fillVertexBuffer,n=t.fillIndexBuffer;return r&&n?(t.fillVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(1),this._fillVertexAttributes,{geometry:r},n),t.fillVertexArrayObject):null},e.prototype._getOutlineVAO=function(e,t,i){if(i){if(t.outlineDDVertexArrayObject)return t.outlineDDVertexArrayObject;var r=t.outlineDDVertexBuffer,n=t.outlineIndexBuffer;return r&&n?(t.outlineDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:r},n),t.outlineDDVertexArrayObject):null}if(t.outlineVertexArrayObject)return t.outlineVertexArrayObject;r=t.outlineVertexBuffer,n=t.outlineIndexBuffer;return r&&n?(t.outlineVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:r},n),t.outlineVertexArrayObject):null},e}()}.apply(null,r))||(e.exports=n)},2491:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(21),i(290),i(85),i(288),i(167),i(38),i(409),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u){return s.enums.DataType,s.enums.PrimitiveType,s.enums.TextureSamplingMode,function(){function e(e){this._initialized=!1,this._viewProjMat=r.mat4f32.create(),this._offsetVector=o.vec3f32.create(),this._color=a.vec4f32.create(),this._dashArray=n.vec2f32.create(),this._programOptions={id:!1,dd:!1,pattern:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,r,n,o,a,s,d,f,c,_){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var h=a.tileTransform.transform,p=a.coordRange/512,m=s.getPaintValue("line-translate",r);if(0!==m[0]||0!==m[1]){i.mat4.copy(this._viewProjMat,a.tileTransform.transform);var v=m[0],g=m[1],y=0,x=0,b=(1<<a.key.level)/Math.pow(2,r)*p,w=o.rotation;if(1===s.getPaintValue("line-translate-anchor",r)){var D=-l.C_DEG_TO_RAD*w,T=Math.sin(D),P=Math.cos(D);y=b*(v*P-g*T),x=b*(v*T+g*P)}else y=b*v,x=b*g;this._offsetVector[0]=y,this._offsetVector[1]=x,this._offsetVector[2]=0,i.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),h=this._viewProjMat}var M=s.getPaintValue("line-pattern",r),C=void 0!==M,O=1/c,z=s.getPaintValue("line-blur",r),A=s.hasDataDrivenColor?[1,1,1,1]:s.getPaintValue("line-color",r),V=s.hasDataDrivenOpacity?1:s.getPaintValue("line-opacity",r),R=s.hasDataDrivenWidth?1:s.getPaintValue("line-width",r),I=V*A[3]*_;this._color[0]=I*A[0],this._color[1]=I*A[1],this._color[2]=I*A[2],this._color[3]=I;var S,U=s.hasDataDrivenLine,j=4===n;j&&(S=u.int32To4Bytes(t.layerID));var k=this._getLineVAO(e,a,U);if(!k)return 0;e.bindVAO(k);var F=(j?1:0)<<2|(U?1:0)<<1|(C?1:0),B=this._programOptions;B.id=j,B.dd=U,B.pattern=C;var E=this._programCache.getProgram(3,F,B);if(e.bindProgram(E),E.setUniformMatrix4fv("u_transformMatrix",h),E.setUniformMatrix4fv("u_extrudeMatrix",f),E.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),E.setUniform1f("u_depth",s.z),E.setUniform1f("u_blur",z),E.setUniform1f("u_antialiasing",O),E.setUniform4fv("u_color",this._color),E.setUniform1f("u_width",R),j&&E.setUniform4f("u_id",S[0],S[1],S[2],S[3]),C){var L=d.getMosaicItemPosition(M,!0);L&&(d.bind(e,9729,L.page,5),E.setUniform2f("u_pattern_tl",L.tl[0],L.br[1]),E.setUniform2f("u_pattern_br",L.br[0],L.tl[1]),E.setUniform2f("u_spriteSize",p*L.size[0],L.size[1]),E.setUniform1i("u_texture",5))}else{var W=s.getPaintValue("line-dasharray",r);W.length<2&&(W=[1,-1]);var N=p;this._dashArray[0]=N*W[0],this._dashArray[1]=N*W[1],E.setUniform2fv("u_dasharray",this._dashArray)}return e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleCount()},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getLineVAO=function(e,t,i){if(i){if(t.lineDDVertexArrayObject)return t.lineDDVertexArrayObject;var r=t.lineDDVertexBuffer,n=t.lineIndexBuffer;return r&&n?(t.lineDDVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(3),this._vertexAttributesDD,{geometry:r},n),t.lineDDVertexArrayObject):null}if(t.lineVertexArrayObject)return t.lineVertexArrayObject;r=t.lineVertexBuffer,n=t.lineIndexBuffer;return r&&n?(t.lineVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(3),this._vertexAttributes,{geometry:r},n),t.lineVertexArrayObject):null},e}()}.apply(null,r))||(e.exports=n)},2492:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2493),i(2494)],void 0===(n=function(e,t,i,r){return function(){function e(e){this._iconRenderer=new i(e),this._sdfRenderer=new r(e)}return e.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null),this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)},e.prototype.render=function(e,t,i,r,n,o,a,s,l,u,d,f,c,_){return t.hasData()?(t.markerPerPageElementsMap.size>0&&this._iconRenderer.render(e,t,i,r,n,o,a,s,l,d,f,_),t.glyphPerPageElementsMap.size>0&&this._sdfRenderer.render(e,t,i,r,n,o,a,s,u,d,f,c,_),t.triangleCount()):0},e}()}.apply(null,r))||(e.exports=n)},2493:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(21),i(290),i(85),i(288),i(167),i(38),i(409),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u){return s.enums.DataType,s.enums.PrimitiveType,s.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=r.mat4f32.create(),this._offsetVector=o.vec3f32.create(),this._spritesTextureSize=n.vec2f32.create(),this._color=a.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1,dd:!1,sdf:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,r,n,o,a,s,d,f,c,_,h){var p=this;this._initialized||this._initialize(e);var m=d.hasDataDrivenIconSize?1:d.getLayoutValue("icon-size",r),v=d.hasDataDrivenIconColor?[1,1,1,1]:d.getPaintValue("icon-color",r),g=d.hasDataDrivenIconOpacity?1:d.getPaintValue("icon-opacity",r),y=v[3]*g*h;this._color[0]=y*v[0],this._color[1]=y*v[1],this._color[2]=y*v[2],this._color[3]=y;var x=d.getLayoutValue("icon-rotation-alignment",r);2===x&&(x=1===d.getLayoutValue("symbol-placement",r)?0:1);var b=0===x,w=t.isSDF,D=d.hasDataDrivenIcon,T=4===n,P=l.degToByte(o),M=s.tileTransform.transform,C=d.getPaintValue("icon-translate",r);if(0!==C[0]||0!==C[1]){i.mat4.copy(this._viewProjMat,s.tileTransform.transform);var O=C[0],z=C[1],A=0,V=0,R=s.coordRange/512,I=(1<<s.key.level)/Math.pow(2,r)*R;if(1===d.getPaintValue("icon-translate-anchor",r)){var S=-l.C_DEG_TO_RAD*o,U=Math.sin(S),j=Math.cos(S);A=I*(O*j-z*U),V=I*(O*U+z*j)}else A=I*O,V=I*z;this._offsetVector[0]=A,this._offsetVector[1]=V,this._offsetVector[2]=0,i.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),M=this._viewProjMat}var k=b?c:_,F=this._getIconVAO(e,s,D);if(F){e.bindVAO(F);var B=(T?1:0)<<2|(D?1:0)<<1|(w?1:0),E=this._programOptions;E.id=T,E.dd=D,E.sdf=w;var L=this._programCache.getProgram(4,B,E);if(e.bindProgram(L),w){var W=d.getPaintValue("icon-halo-color",r),N=d.getPaintValue("icon-halo-width",r);L.setUniform4f("u_outlineColor",W[0],W[1],W[2],W[3]),L.setUniform1f("u_outlineSize",N)}if(L.setUniformMatrix4fv("u_transformMatrix",M),L.setUniformMatrix4fv("u_extrudeMatrix",k),L.setUniform2fv("u_normalized_origin",s.tileTransform.displayCoord),L.setUniform1f("u_depth",d.z),L.setUniform1f("u_mapRotation",P),L.setUniform1f("u_keepUpright",0),L.setUniform1f("u_level",10*r),L.setUniform1f("u_fadeSpeed",10*a.fadeSpeed),L.setUniform1f("u_minfadeLevel",10*a.minfadeLevel),L.setUniform1f("u_maxfadeLevel",10*a.maxfadeLevel),L.setUniform1f("u_fadeChange",10*(r+a.fadeChange)),L.setUniform1i("u_texture",5),L.setUniform1f("u_size",m),L.setUniform4fv("u_color",this._color),T){var H=u.int32To4Bytes(t.layerID);L.setUniform4f("u_id",H[0],H[1],H[2],H[3])}t.markerPerPageElementsMap.forEach(function(t,i){p._spritesTextureSize[0]=f.getWidth(i)/4,p._spritesTextureSize[1]=f.getHeight(i)/4,L.setUniform2fv("u_mosaicSize",p._spritesTextureSize),f.bind(e,9729,i,5),e.drawElements(4,t[1],5125,12*t[0])}),e.bindVAO()}},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getIconVAO=function(e,t,i){if(i){if(t.iconDDVertexArrayObject)return t.iconDDVertexArrayObject;var r=t.iconDDVertexBuffer,n=t.iconIndexBuffer;return r&&n?(t.iconDDVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(4),this._vertexAttributesDD,{geometry:r},n),t.iconDDVertexArrayObject):null}if(t.iconVertexArrayObject)return t.iconVertexArrayObject;r=t.iconVertexBuffer,n=t.iconIndexBuffer;return r&&n?(t.iconVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(4),this._vertexAttributes,{geometry:r},n),t.iconVertexArrayObject):null},e}()}.apply(null,r))||(e.exports=n)},2494:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(18),i(21),i(290),i(85),i(288),i(167),i(38),i(409),i(1707)],void 0===(n=function(e,t,i,r,n,o,a,s,l,u,d){return l.enums.DataType,l.enums.PrimitiveType,l.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=n.mat4f32.create(),this._offsetVector=a.vec3f32.create(),this._extrudeMat=n.mat4f32.create(),this._scaleVec=a.vec3f32.create(),this._haloColor=s.vec4f32.create(),this._sdfColor=s.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1,dd:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,n,a,s,l,f,c,_,h,p,m,v){var g=this;if(!i("esri-vector-tiles-avoid-text")){this._initialized||this._initialize(e);var y=u.degToByte(s),x=c.getLayoutValue("text-rotation-alignment",n);2===x&&(x=1===c.getLayoutValue("symbol-placement",n)?0:1);var b=0===x,w=c.getLayoutValue("text-keep-upright",n)&&b,D=4===a,T=.8*3/m,P=c.hasDataDrivenTextSize?1:c.getLayoutValue("text-size",n),M=c.hasDataDrivenTextColor?[1,1,1,1]:c.getPaintValue("text-color",n),C=c.hasDataDrivenTextOpacity?1:c.getPaintValue("text-opacity",n),O=M[3]*C*v;this._sdfColor[0]=O*M[0],this._sdfColor[1]=O*M[1],this._sdfColor[2]=O*M[2],this._sdfColor[3]=O,this._glyphTextureSize||(this._glyphTextureSize=o.vec2f32.fromValues(_.width/4,_.height/4));var z=f.tileTransform.transform,A=c.getPaintValue("text-translate",n);if(0!==A[0]||0!==A[1]){r.mat4.copy(this._viewProjMat,f.tileTransform.transform);var V=A[0],R=A[1],I=0,S=0,U=f.coordRange/512,j=(1<<f.key.level)/Math.pow(2,n)*U;if(1===c.getPaintValue("text-translate-anchor",n)){var k=-u.C_DEG_TO_RAD*s,F=Math.sin(k),B=Math.cos(k);I=j*(V*B-R*F),S=j*(V*F+R*B)}else I=j*V,S=j*R;this._offsetVector[0]=I,this._offsetVector[1]=S,this._offsetVector[2]=0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),z=this._viewProjMat}b?r.mat4.copy(this._extrudeMat,h):r.mat4.copy(this._extrudeMat,p),this._scaleVec[0]=1/24,this._scaleVec[1]=1/24,this._scaleVec[2]=1,r.mat4.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);var E=c.hasDataDrivenText,L=this._getSDFVAO(e,f,E);if(L){e.bindVAO(L);var W=(D?1:0)<<1|(E?1:0),N=this._programOptions;N.id=D,N.dd=E;var H=this._programCache.getProgram(6,W,N);if(e.bindProgram(H),H.setUniformMatrix4fv("u_transformMatrix",z),H.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),H.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord),H.setUniform1f("u_depth",c.z+1/65536),H.setUniform2fv("u_mosaicSize",this._glyphTextureSize),H.setUniform1f("u_mapRotation",y),H.setUniform1f("u_keepUpright",w?1:0),H.setUniform1f("u_level",10*n),H.setUniform1f("u_fadeSpeed",10*l.fadeSpeed),H.setUniform1f("u_minfadeLevel",10*l.minfadeLevel),H.setUniform1f("u_maxfadeLevel",10*l.maxfadeLevel),H.setUniform1f("u_fadeChange",10*(n+l.fadeChange)),H.setUniform1i("u_texture",6),H.setUniform1f("u_size",P),H.setUniform1f("u_antialiasingWidth",T),D){var G=d.int32To4Bytes(t.layerID);H.setUniform4f("u_id",G[0],G[1],G[2],G[3])}t.glyphPerPageElementsMap.forEach(function(t,i){g._renderGlyphRange(e,t,i,c,_,H,n,C*v,3)}),e.bindVAO()}}},e.prototype._renderGlyphRange=function(e,t,i,r,n,o,a,s,l){n.bind(e,9729,i,6);var u=r.getPaintValue("text-halo-color",a),d=r.getPaintValue("text-halo-width",a);if(u[3]>0&&d>0){var f=u[3]*s;this._haloColor[0]=f*u[0],this._haloColor[1]=f*u[1],this._haloColor[2]=f*u[2],this._haloColor[3]=f;var c=r.getPaintValue("text-halo-blur",a)*l,_=d*l;o.setUniform4fv("u_color",this._haloColor),o.setUniform1f("u_halo",1),o.setUniform1f("u_edgeDistance",_),o.setUniform1f("u_edgeBlur",c),e.drawElements(4,t[1],5125,12*t[0])}this._sdfColor[3]>0&&(o.setUniform4fv("u_color",this._sdfColor),o.setUniform1f("u_halo",0),o.setUniform1f("u_edgeDistance",0),o.setUniform1f("u_edgeBlur",0),e.drawElements(4,t[1],5125,12*t[0]))},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getSDFVAO=function(e,t,i){if(i){if(t.textDDVertexArrayObject)return t.textDDVertexArrayObject;var r=t.textDDVertexBuffer,n=t.textIndexBuffer;return r&&n?(t.textDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(6),this._vertexAttributesDD,{geometry:r},n),t.textDDVertexArrayObject):null}if(t.textVertexArrayObject)return t.textVertexArrayObject;r=t.textVertexBuffer,n=t.textIndexBuffer;return r&&n?(t.textVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(6),this._vertexAttributes,{geometry:r},n),t.textVertexArrayObject):null},e}()}.apply(null,r))||(e.exports=n)},2495:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(167),i(38),i(409)],void 0===(n=function(e,t,i,r,n){return r.enums.CompareFunction,r.enums.DataType,r.enums.PixelFormat,r.enums.PixelType,r.enums.PrimitiveType,r.enums.TextureSamplingMode,r.enums.TextureType,r.enums.Usage,function(){function e(e){this._initialized=!1,this._color=i.vec4f32.fromValues(1,0,0,1),this._maxWidth=0,this._programOptions={id:!1,pattern:!1},this._programCache=e}return e.prototype.dispose=function(){this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null),this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)},e.prototype.render=function(e,t){this._initialized||this._initialize(e);var i=this._programCache.getProgram(0,0,this._programOptions);if(i){e.bindVAO(this._outlineVertexArrayObject),e.bindProgram(i),i.setUniformMatrix4fv("u_transformMatrix",t.tileTransform.transform),i.setUniform2fv("u_normalized_origin",t.tileTransform.displayCoord),i.setUniform1f("u_coord_range",t.coordRange),i.setUniform1f("u_depth",0),i.setUniform4fv("u_color",this._color),e.drawArrays(3,0,4),e.bindVAO(),t.triangleCount>1e5&&(e.setStencilFunction(514,t.stencilData.reference,t.stencilData.mask),e.setStencilTestEnabled(!0),e.bindVAO(this._quadVertexArrayObject),i.setUniform4f("u_color",.9,0,0,.35),e.drawArrays(5,0,4),e.bindVAO(),e.setStencilTestEnabled(!1));var r=this._getTexture(e,t);if(r){var n=this._programCache.getProgram(7,0,null);n&&(e.bindVAO(this._tileInfoVertexArrayObject),e.bindProgram(n),e.bindTexture(r,0),n.setUniformMatrix4fv("u_transformMatrix",t.tileTransform.transform),n.setUniform2fv("u_normalized_origin",t.tileTransform.displayCoord),n.setUniform1f("u_depth",0),n.setUniform1f("u_coord_ratio",t.coordRange/512),n.setUniform2f("u_delta",8,8),n.setUniform2f("u_dimensions",r.descriptor.width,r.descriptor.height),e.drawArrays(5,0,4),e.bindVAO())}}},e.prototype._initialize=function(e){if(this._initialized)return!0;var t={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},i=new Int8Array([0,0,1,0,1,1,0,1]),n=r.BufferObject.createVertex(e,35044,i),o=new r.VertexArrayObject(e,this._programCache.getProgramAttributes(0),t,{geometry:n}),a=new Int8Array([0,0,0,1,1,0,1,1]),s=r.BufferObject.createVertex(e,35044,a),l=new r.VertexArrayObject(e,this._programCache.getProgramAttributes(0),t,{geometry:s}),u=new Int8Array([0,0,1,0,0,1,1,1]),d=r.BufferObject.createVertex(e,35044,u),f=new r.VertexArrayObject(e,this._programCache.getProgramAttributes(7),t,{geometry:d});return this._outlineVertexArrayObject=o,this._quadVertexArrayObject=l,this._tileInfoVertexArrayObject=f,this._initialized=!0,!0},e.prototype._getTexture=function(e,t){if(t.texture)return t.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","512"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var i=t.key.id+", "+t.triangleCount,o=this._canvas.getContext("2d");o.font="24px sans-serif",o.textAlign="left",o.textBaseline="middle";var a=o.measureText(i),s=Math.pow(2,Math.ceil(n.log2(a.width+2)));s>this._maxWidth&&(this._maxWidth=s),o.clearRect(0,0,this._maxWidth,32),o.fillStyle="blue";var l,u=0,d=0;if(t.refKeys)for(var f=0,c=Object.keys(t.refKeys);f<c.length;f++){var _=c[f],h=t.refKeys[_].match(/\d+/);l=parseInt(h[0],10),isNaN(l)||(d++,t.key.level>l&&u++)}return u===d?o.fillStyle="red":u>0&&(o.fillStyle="purple"),o.fillText(i,0,16),t.texture=new r.Texture(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas),t.texture},e}()}.apply(null,r))||(e.exports=n)},2496:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(38),i(2497)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._cache=new Array(8);for(var e=0;e<8;e++)this._cache[e]={}}return e.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)},e.prototype.getProgram=function(e,t,i){var r=this._cache[e];if(!r[t]){var n=this._programRepo.getProgram(this._getProgramTemplate(e),i);r[t]=n}return r[t]},e.prototype.getProgramAttributes=function(e){switch(e){case 0:return r.background.attributes;case 5:return r.circle.attributes;case 1:return r.fill.attributes;case 4:return r.icon.attributes;case 3:return r.line.attributes;case 2:return r.outline.attributes;case 6:return r.text.attributes;case 7:return r.tileInfo.attributes}},e.prototype.initialize=function(e){this._programRepo||(this._programRepo=new i.ProgramCache(e))},e.prototype._getProgramTemplate=function(e){switch(e){case 0:return r.background;case 5:return r.circle;case 1:return r.fill;case 4:return r.icon;case 3:return r.line;case 2:return r.outline;case 6:return r.text;case 7:return r.tileInfo}},e}();t.default=n}.apply(null,r))||(e.exports=n)},2497:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(38),i(2498)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return i.glslifyDefineMap({ID:e.id,PATTERN:e.pattern})};t.background={name:"background",shaders:function(e){return{vertexShader:n(e)+r.resolveIncludes("background/background.vert"),fragmentShader:n(e)+r.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};var o=function(e){return i.glslifyDefineMap({ID:e.id})};t.circle={name:"circle",shaders:function(e){return{vertexShader:o(e)+r.resolveIncludes("circle/circle.vert"),fragmentShader:o(e)+r.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var a=function(e){return i.glslifyDefineMap({ID:e.id,DD:e.dd,PATTERN:e.pattern})};t.fill={name:"fill",shaders:function(e){return{vertexShader:a(e)+r.resolveIncludes("fill/fill.vert"),fragmentShader:a(e)+r.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};var s=function(e){return i.glslifyDefineMap({ID:e.id,DD:e.dd})};t.outline={name:"outline",shaders:function(e){return{vertexShader:s(e)+r.resolveIncludes("outline/outline.vert"),fragmentShader:s(e)+r.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};var l=function(e){return i.glslifyDefineMap({ID:e.id,DD:e.dd,SDF:e.sdf})};t.icon={name:"icon",shaders:function(e){return{vertexShader:l(e)+r.resolveIncludes("icon/icon.vert"),fragmentShader:l(e)+r.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};var u=function(e){return i.glslifyDefineMap({ID:e.id,DD:e.dd,PATTERN:e.pattern})};t.line={name:"line",shaders:function(e){return{vertexShader:u(e)+r.resolveIncludes("line/line.vert"),fragmentShader:u(e)+r.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};var d=function(e){return i.glslifyDefineMap({ID:e.id,DD:e.dd})};t.text={name:"text",shaders:function(e){return{vertexShader:d(e)+r.resolveIncludes("text/text.vert"),fragmentShader:d(e)+r.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}},t.tileInfo={name:"tileInfo",shaders:{vertexShader:r.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:r.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}}.apply(null,r))||(e.exports=n)},2498:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(38),i(2499)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new i.ShaderCompiler(function(e){var t=r;return e.split("/").forEach(function(e){t&&(t=t[e])}),t});t.resolveIncludes=function(e){return n.resolveIncludes(e)}}.apply(null,r))||(e.exports=n)},2499:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = u_opacity * color;\n#else\n  gl_FragColor = u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist = length(v_offset);\n  mediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision = 0.25;\nconst float blurPrecision = 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color = a_color * u_color;\n  v_stroke_color = a_stroke_color * u_stroke_color;\n  v_stroke_width = a_data[1] * sizePrecision * u_stroke_width;\n  v_radius = a_data[2] * u_radius;\n  v_blur = max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset = offset;\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos * 0.5, 0.0, 1.0) + u_extrudeMatrix * (v_radius + v_stroke_width) * vec4(offset, 0.0, 0.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = v_color[3] * color;\n#else\n  gl_FragColor = v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor = v_color;\n  float d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio = 0.248062016;\n  float size = max(v_size.x, v_size.y);\n  float dist = d * sofetEdgeRatio * size;\n  fillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize > 0.25) {\n    lowp vec4 outlinePixelColor = u_outlineColor;\n    const float outlineLimitRatio = (16.0 / 86.0);\n    float clampedOutlineSize = sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor = v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor = v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor = texture2D(u_texture, v_tex);\n  gl_FragColor = v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel = a_levelInfo[0];\n  mediump float a_angle         = a_levelInfo[1];\n  mediump float a_minLevel      = a_levelInfo[2];\n  mediump float a_maxLevel      = a_levelInfo[3];\n  mediump float delta_z = 0.0;\n  mediump float rotated = mod(a_angle + u_mapRotation, 256.0);\n  delta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  mediump float alpha = u_fadeSpeed != 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency = (u_fadeSpeed >= 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel < a_labelMinLevel)\n  {\n    v_transparency = 0.0;\n  }\n  if (u_minfadeLevel >= a_labelMinLevel)\n  {\n    v_transparency = 1.0;\n  }\n  delta_z += step(v_transparency, 0.0);\n  vec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\n  v_size = abs(offset);\n#ifdef SDF\n  offset = (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size = a_size * u_size;\n#else\n  mediump float icon_size = u_size;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * icon_size * vec4(offset, delta_z, 0.0);\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_tex = a_tex.xy / u_mosaicSize;\n  v_transparency *= v_color.w;\n}"},line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio = 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist = length(v_normal) * v_lineHalfWidth;\n  lowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX = mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY = 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord = mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color = texture2D(u_texture, texCoord);\n  gl_FragColor = alpha * v_color[3] * color;\n#else\n  lowp float dashPos =  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha = clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha = max(sign(-v_dasharray.y), dashAlpha);\n  alpha *= dashAlpha;\n  gl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal = a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth = a_width * u_width;\n#else\n  v_lineHalfWidth = u_width;\n#endif\n  v_lineHalfWidth += u_antialiasing;\n  v_lineHalfWidth *= 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray = u_dasharray * a_width;\n#else\n  v_dasharray = u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist = v_lineHalfWidth * a_offsetAndNormal.xy * scale;\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n  v_accumulatedDistance = a_accumulatedDistance.x;\n  v_blur = u_blur + u_antialiasing;\n  #ifdef DD\n    v_color = a_color * u_color;\n  #else\n    v_color = u_color;\n  #endif\n  #ifdef ID\n    v_id = u_id / 255.0;\n  #endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = abs(v_normal.y);\n  lowp float alpha = smoothstep(1.0, 0.0, dist);\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_normal = a_xnormal;\n  mediump vec4 dist = vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = texture2D(u_texture, v_tex).a;\n  mediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nvoid main()\n{\n  mediump float a_labelMinLevel = a_levelInfo[0];\n  mediump float a_angle        = a_levelInfo[1];\n  mediump float a_minLevel    = a_levelInfo[2];\n  mediump float a_maxLevel    = a_levelInfo[3];\n  mediump float delta_z = 0.0;\n  mediump float rotated = mod(a_angle + u_mapRotation, 256.0);\n  delta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  mediump float alpha = u_fadeSpeed != 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency = (u_fadeSpeed >= 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel < a_labelMinLevel)\n  {\n    v_transparency = 0.0;\n  }\n  if (u_minfadeLevel >= a_labelMinLevel)\n  {\n    v_transparency = 1.0;\n  }\n  delta_z += step(v_transparency, 0.0);\n  v_tex = a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo > 0.5)\n  {\n    v_color = u_color;\n  }\n  else\n  {\n    v_color = a_color * u_color;\n  }\n#else\n  v_color = u_color;\n#endif\n#ifdef DD\n  v_size = a_size * u_size;\n#else\n  v_size = u_size;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_edgeDistance = edgePos - u_edgeDistance / v_size;\n  v_edgeWidth = (u_antialiasingWidth + u_edgeBlur) / v_size;\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * v_size * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color = texture2D(u_texture, v_tex);\n  gl_FragColor = 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offests = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\n  v_tex = a_pos;\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}}.apply(null,r))||(e.exports=n)}}]);