(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1576,"esri/tasks/operations/query":1577,"esri/tasks/operations/pbfQueryUtils":1638,"esri/tasks/operations/urlUtils":1639,"esri/views/3d/layers/LayerView3D":1640,"esri/tasks/operations/pbfFeatureServiceParser":1642,"esri/tasks/operations/pbfDehydratedFeatureSet":1643,"esri/tasks/operations/pbfOptimizedFeatureSet":1644,"esri/views/3d/layers/support/layerViewUpdatingProperties":1645,"esri/views/3d/layers/support/projectExtentUtils":1664,"esri/layers/graphics/data/QueryEngineCapabilities":1680,"esri/views/3d/layers/support/attributeUtils":1681,"esri/views/3d/layers/graphics/QueryEngine":1688,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1692,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1743,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":1744,"esri/views/3d/layers/FeatureLikeLayerView3D":1829,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":1830,"esri/views/3d/layers/support/FeatureTileFetcher3D":2075,"esri/views/3d/layers/FeatureLayerView3D":2524,"esri/layers/graphics/controllers/FeatureTileController3D":2525,"esri/views/3d/layers/support/featureReference":2526,"esri/views/3d/layers/support/FeatureTile":2527,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":2528,"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":2529,"esri/views/3d/layers/support/featureTileQuery3D":2530,"esri/views/3d/support/EventedSet":2531})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[47,81],{1576:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(3),r(97),r(7),r(407),r(405),r(40),r(633),r(1638),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t=l.parsePBFFeatureQuery(e.buffer,e.options);if(e.options&&"dehydrated"===e.options.type){var r=t;if(t.spatialReference=r.spatialReference.toJSON(),r.fields)for(var i=0;i<r.fields.length;i++)r.fields[i]=r.fields[i].toJSON()}return n.resolve(t)},e}(),h=function(t){function p(){var r=t.call(this)||this;return r._thread=void 0,a.open(s.getAbsMid("./PBFWorker",e,c),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(p,t),p.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},p.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){if(t&&"dehydrated"===t.type){var r=e;if(r.spatialReference=o.fromJSON(r.spatialReference),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=u.fromJSON(r.fields[n]);for(var s=r.spatialReference,a=0,l=r.features;a<l.length;a++){var c=l[a];c.uid=i.generateUID(),c.geometry&&(c.geometry.spatialReference=s)}}return e}):n.resolve(l.parsePBFFeatureQuery(e,t)):n.resolve(null)},p}(p);t.PBFWorker=h,t.default=function(){return new p}}.apply(null,i))||(e.exports=n)},1577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(44),r(58),r(9),r(31),r(57),r(1635),r(1638),r(1576),r(1639),r(105)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p){function h(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=o.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var s=i.timeExtent,a=s.start,u=s.end;null==a&&null==u||(n.time=a===u?a:(null==a?"null":a)+","+(null==u?"null":u)),delete i.timeExtent}return n}function d(e,t,o,l,c){void 0===l&&(l={});var d="string"==typeof e?a.urlToObject(e):e,f=t.geometry?[t.geometry]:[];return l.responseType="pbf"===o?"array-buffer":"json",n.safeCast(u.normalizeCentralMeridian(f,null,l)).then(function(e){var n=e&&e[0];s.isSome(n)&&((t=t.clone()).geometry=n);var a=p.mapParameters(r({},d.query,{f:o},c,h(t,c)));return i(d.path+"/query",r({},l,{query:a}))})}Object.defineProperty(t,"__esModule",{value:!0});var f,y="Layer does not support extent calculation.";t.queryToQueryStringParameters=h,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return d(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==f&&(f=new c.PBFWorker),f).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(l.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(y);if(t.hasOwnProperty("count"))throw new Error(y);return e})}}.apply(null,i))||(e.exports=n)},1638:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1642)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,s=0,a=i.features;s<a.length;s++){var o=a[s];o.attributes&&(o.objectId=o.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var s=0;s<n.length;s++)r[i][s]=e(n[s])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},1640:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(25),r(0),r(408)],void 0===(n=function(e,t,r,i,n,s,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.LayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.destroy=function(){this.view=null},t.prototype.postscript=function(e){this.inherited(arguments),o.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){s.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=o.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([a.property()],t.prototype,"view",void 0),i([a.property()],t.prototype,"slicePlaneEnabled",void 0),i([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(e))}}.apply(null,i))||(e.exports=n)},1642:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(6),r(639),r(1643),r(1644)],void 0===(n=function(e,t,r,i,n,s,a){function o(e){return e>=E.length?null:E[e]}function u(e){return e>=C.length?null:C[e]}function l(e){return e>=O.length?null:O[e]}function c(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){for(var i=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),s=e.pos()+n,a=0;e.pos()<s;)t.addCoordinatePoint(i,e.getSInt64(),0,a++);break;case 1:case 2:default:e.skip()}return i}function h(e,t,r){for(var i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var s=e.getUInt32(),a=e.pos()+s,o=0;e.pos()<a;)t.addLength(i,e.getUInt32(),o++);break;case 3:for(var u=e.getUInt32(),l=(a=e.pos()+u,0),c=0;e.pos()<a;)t.addCoordinate(i,e.getSInt64(),c,l),++l===n&&(c++,l=0);break;case 1:default:e.skip()}return i}function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function f(e){for(var t={type:o(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=o(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t,r,i){for(var n=t.createFeature(r),s=0;e.next();)switch(e.tag()){case 1:var a=i[s++].name;n.attributes[a]=e.processMessage(d);break;case 2:n.geometry=e.processMessageWithArgs(h,t,r);break;case 4:n.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return n}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function m(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=e.processMessage(g);break;case 3:t.translate=e.processMessage(m);break;default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function F(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function x(e,t){var r=t.createFeatureResult();r.geometryType=c(t,0);for(var i=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(b);break;case 7:r.geometryType=c(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(F,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(v);break;case 9:var n=e.getBool();r.exceededTransferLimit=n;break;case 13:t.addField(r,e.processMessage(f));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,e.processMessageWithArgs(y,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function w(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(x,t);break;default:e.skip()}return r}function T(e){return e&&"dehydrated"===e.type?new s.Context(e):new a.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var _=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),E=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],C=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],O=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=T(t);try{for(var s=new n(new Uint8Array(e),new DataView(e)),a={};s.next();)switch(s.tag()){case 2:a.queryResult=s.processMessageWithArgs(w,i);break;default:s.skip()}return a}catch(e){var o=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return _.error(o),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},1643:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(97),r(24),r(40),r(103),r(633)],void 0===(n=function(e,t,r,i,n,s,a){function o(e,t,r,i){return t}function u(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return d(e,t+i,1)}}function l(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return d(e,t+i,1);case 2:return h(e,t,2)}}function c(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return d(e,t+i,1);case 2:return h(e,t,3)}}function p(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return d(e,t+i,1);case 2:case 3:return h(e,t,3)}}function h(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function d(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=o,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new s.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(a.fromJSON(t));var r=e.fields.map(function(e){return e.name});this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&(t.attributes[i]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new s.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var s=this.transformPathLikeValue(t,i),a=e[e.length-1];0===i&&a.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=s},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?p:t?l:r?c:u},e}();t.Context=f}.apply(null,i))||(e.exports=n)},1644:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(634),r(641),r(404)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=s}.apply(null,i))||(e.exports=n)},1645:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},1664:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(7),r(63),r(412)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,a=e.layer.fullExtent,o=a&&a.spatialReference;return o?o.equals(t)?i.resolve(a.clone()):n.canProject(o,t)?i.resolve(n.project(a,t)):e.view.state.isLocal?r.safeCast(s.projectGeometry(a,t,e.layer.portalItem).then(function(t){return!e.destroyed&&t?t:void 0}).catch(function(){return null})):i.resolve(null):i.resolve(null)}}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1681:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(s.toLowerCase()===r)return e[s]}return null}}.apply(null,i))||(e.exports=n)},1688:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(10),r(11),r(36),r(16),r(9),r(0),r(37),r(1679),r(1575),r(402)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d){Object.defineProperty(t,"__esModule",{value:!0});var f=p.default,y=function(e){function t(t){var r=e.call(this)||this;return r._dataQueryEngineInstance=null,r}return i(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new d({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForCount=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return s(this,void 0,void 0,function(){var r,i,s,a;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return r=n.sent(),i=r.count,s=r.extent,a=c.fromJSON(s),[2,{count:i,extent:a}]}})})},t.prototype.executeQueryForIds=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,function(){var r,i,s=this;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return r=n.sent(),(i=h.fromJSON(r)).features.forEach(function(e){e.layer=s.layer,e.sourceLayer=s.layer}),[2,i]}})})},t.prototype._ensureQueryJSON=function(e){return u.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,r=a.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),i=this.layer.fields.map(function(e){return e.toJSON()}),n=this.layerView.view.resourceController.scheduler,s=this.task,o=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,c=l.hasZ,p=l.hasM;return this._dataQueryEngineInstance=new f({hasZ:c,hasM:p,geometryType:r,fields:i,timeInfo:e,spatialReference:o,objectIdField:t,featureStore:u,scheduler:n,task:s}),this._dataQueryEngineInstance},r([l.property({constructOnly:!0})],t.prototype,"layerView",void 0),r([l.property({constructOnly:!0})],t.prototype,"task",void 0),r([l.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r([l.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r([l.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),r([l.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r([l.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(l.declared(o));t.QueryEngine=y,t.default=y}.apply(null,i))||(e.exports=n)},1692:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(22),r(25),r(0),r(56),r(656),r(145)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c){var p=-.3*u.earthRadius;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suspended=!1,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new s,t.layerView=null,t.updating=!0,t}return r(t,e),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new l.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",function(){return t.viewChange()}),r.state.watch("camera",function(){return t.viewChange()},!0),n.registerTask(c.Task.FRUSTUM_VISIBILITY,function(){return t.update()},function(){return t.updating}),i.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([a.init(i,["opacity","wireframe"],function(){return t.updateIsVisibleBelowSurface()}),a.init(r,"map.ground.navigationConstraint.type",function(){return t.updateIsVisibleBelowSurface()})])},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype._setDirty=function(){this.updating||this._set("updating",!0)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()},t.prototype.viewChange=function(){this._setDirty()},t.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.updateIsVisibleBelowSurface=function(){var e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.isOpaque()||i},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=p;else{var r=t.basemapTerrain.elevationBounds,i=r.min,n=r.max;e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},i([o.property({readOnly:!0})],t.prototype,"suspended",void 0),i([o.property({readOnly:!0})],t.prototype,"updating",void 0),i([o.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1743:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(97),r(16),r(58),r(24),r(22),r(25),r(0),r(63),r(653),r(402),r(413),r(1717),r(1718),r(1744),r(1692),r(1719),r(1721),r(84),r(1681),r(292)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,b,F,x,w,T,_,E){var C=function(e){function t(t){var r=e.call(this)||this;return r._handles=new c,r.highlights=new x,r.watchUpdatingTracking=new E.WatchUpdatingTracking,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new F:null,r=e.scaleVisibilityEnabled?new w:null,i=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new b.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new v:null;return{graphicsCore:new m({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:r,filterVisibility:i,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()}),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",function(){return e.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",function(t,r){f.diff(t,r)&&e.graphicsCore.elevationInfoChange()}),this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()}),this.watchUpdatingTracking.add(this.layer,"labelingInfo",function(t,r){f.diff(t,r)&&e.graphicsCore.updateLabelingInfo()})},t.prototype.setup=function(){return s(this,void 0,void 0,function(){var e,t,r,i,s=this;return n(this,function(n){switch(n.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,r=function(e,t,r){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,r,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(i=e.view.elevationProvider,this.elevationAlignment.setup(e,r,this.graphicsCore,i)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,u.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return n.sent(),this._handles.add([this.layer.watch("renderer",function(e){return s.graphicsCore.rendererChange(e)}),e.watch("fullOpacity",function(){return s.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(e.view.watch("clippingArea",function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,u.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,r){var i=this;if(e instanceof y){var n=this.highlights.acquireSet(t,r),s=n.set,o=n.handle;return this.owner.queryObjectIds(e).then(function(e){return i.highlights.setObjectIds(s,e)}),o}if("number"==typeof e)return this.highlight([e],t,r);if(e instanceof a)return this.highlight([e],t,r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof a){var u=e;if(!r||!u[0].attributes||null===_.attributeLookup(u[0].attributes,r)){var l=u.map(function(e){return e.uid}),c=this.highlights.acquireSet(t,null),p=c.set;o=c.handle;return this.highlights.setUids(p,l),o}e=u.map(function(e){return _.attributeLookup(e.attributes,r)})}if("number"==typeof e[0]){var h=e,d=this.highlights.acquireSet(t,r);p=d.set,o=d.handle;return this.highlights.setObjectIds(p,h),o}}return S},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(p.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(O),e.suspendResumeExtentMode){case"computed":e._handles.add(p.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),O);break;case"data":e._handles.add(p.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),O);break;default:l.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!d.canProject(e,r))return;e=d.project(e,r)}return T.enlargeExtent(e,t,g.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},i([h.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),i([h.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),i([h.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),i([h.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),i([h.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),i([h.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),i([h.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),i([h.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),i([h.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([h.property({readOnly:!0})],t.prototype,"labeling",void 0),i([h.property({readOnly:!0})],t.prototype,"highlights",void 0),i([h.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),i([h.property()],t.prototype,"suspendResumeExtentMode",void 0),i([h.property()],t.prototype,"dataExtent",void 0),i([h.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),i([h.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),i([h.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(h.declared(o)),O="suspendResumeExtentMode",S={remove:function(){},pause:function(){},resume:function(){}};return C}.apply(null,i))||(e.exports=n)},1744:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(22),r(6),r(9),r(25),r(0),r(1688),r(643),r(145)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h){Object.defineProperty(t,"__esModule",{value:!0});var d=a.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),f=function(e){function t(){var t=e.call(this)||this;return t.filter=null,t._dirty=!1,t._querying=!1,t._handles=new s,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new c.default({layerView:this._layerView,task:h.Task.FILTER_VISIBILITY});var i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(h.Task.FILTER_VISIBILITY,function(e){return r._update(e)},function(){return r._needsUpdate()})),this._handles.add(u.on(t.owner,"loadedGraphics","after-changes",function(e){return r._graphicsChanged(e)},function(){return r.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.filter=this.recomputeFilter(),this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var r=o.isSome(e)?e.clone():new p;return r.timeExtent=r.timeExtent?r.timeExtent.intersection(t):t,r},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){d.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.graphics3DGraphics.forEach(function(e){return t._queryResult.add(t._getFeatureId(e.graphic))}),t._querying=!1}),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(l.declared(n));t.Graphics3DFilterVisibility=f}.apply(null,i))||(e.exports=n)},1829:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(4),r(58),r(14),r(9),r(7),r(25),r(0),r(103),r(425),r(402),r(1743),r(1688),r(1664),r(145)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,b){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLikeLayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.asyncGraphicsUpdates=!1,t.suspendResumeExtentMode="computed",t.slicePlaneEnabled=!1,t.supportsDraping=!0,t.overlayUpdating=!1,t.fullExtentInLocalViewSpatialReference=null,t.suspendResumeExtent=null,t._controllerCreated=!1,t.clippingExtent=null,t.supportsHeightUnitConversion=!0,t.pendingController=null,t.queryEngine=null,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.layer.isTable?this.addResolvingPromise(c.reject(new u("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new g({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(t){e.graphics3d.graphicsCore.preferredUpdatePolicy=t?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(t){e.graphics3d.suspendResumeExtentMode=t}),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(o.safeCast(this.graphics3d.setup()).then(function(){return e.validateGeometryType()}).then(function(){return e.queryEngine=new m.default({layerView:e,task:b.Task.FEATURE_QUERY_ENGINE})}).then(function(){return v.toViewIfLocal(e)}).then(function(t){return e.fullExtentInLocalViewSpatialReference=t}).then(function(){return e.initializeController()})),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},Object.defineProperty(t.prototype,"drawingOrder",{set:function(e){this.graphics3d.graphicsCore.setDrawingOrder(e),this._set("drawingOrder",e)},enumerable:!0,configurable:!0}),t.prototype.getRenderingInfo=function(e,t){var r=f.getRenderingInfo(e,{renderer:t});if(r&&r.color){var i=r.color;i[0]=i[0]/255,i[1]=i[1]/255,i[2]=i[2]/255}return r},t.prototype.getRenderingInfoAsync=function(e,t,r){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,f.getRenderingInfoAsync(e,a({renderer:t},r))]})})},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach(function(i){i.uid===e&&(r=d.hydrateGraphic(i,t.layer))}),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.whenSymbolLayerSize=function(e,t){return this.graphics3d?o.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(e,t)):null},t.prototype.queryFeatures=function(e,t){return o.safeCast(this.queryEngine.executeQuery(this._ensureQuery(e),l.get(t,"signal")))},t.prototype.queryObjectIds=function(e,t){return o.safeCast(this.queryEngine.executeQueryForIds(this._ensureQuery(e),l.get(t,"signal")))},t.prototype.queryFeatureCount=function(e,t){return o.safeCast(this.queryEngine.executeQueryForCount(this._ensureQuery(e),l.get(t,"signal")))},t.prototype.queryExtent=function(e,t){return o.safeCast(this.queryEngine.executeQueryForExtent(this._ensureQuery(e),l.get(t,"signal")))},t.prototype._ensureQuery=function(e){return l.isNone(e)?this.createQuery():y.from(e)},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.features=this.loadedGraphics.length,e.updating=this.updating,e.elevationUpdating=this.graphics3d.elevationAlignment.updating,e.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended,e.visibilityScale=!this.graphics3d.scaleVisibility.suspended,e},t.prototype.canResume=function(){return!(!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed||!(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)},t.prototype.initializeController=function(){return s(this,void 0,void 0,function(){var e;return n(this,function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}})})},t.prototype.setControllerWhenInitialized=function(e){return s(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,p.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}})})},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){var e=this.layer;switch(e.geometryType){case"multipatch":case"multipoint":return c.reject(new u("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:e.geometryType}))}},i([h.property()],t.prototype,"loadedGraphics",void 0),i([h.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),i([h.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],t.prototype,"updating",void 0),i([h.property()],t.prototype,"controller",void 0),i([h.property()],t.prototype,"graphics3d",void 0),i([h.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),i([h.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),i([h.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),i([h.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),i([h.property({readOnly:!0,type:Boolean})],t.prototype,"supportsDraping",void 0),i([h.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),i([h.property()],t.prototype,"drawingOrder",null),i([h.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(h.declared(e))}}.apply(null,i))||(e.exports=n)},1830:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(71)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?i.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/i.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var r=0;r<e.length;++r)for(var i=e[r],n=0;n<i.length;++n){i[n][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var i=0;i<e.length;++i){var n=e[i].geometry;!r.isNone(n)&&n.hasZ&&(this._geometryIsPoint(n)?null!==n.z&&(n.z*=t):this._geometryIsPolyline(n)?this._vertexListsScaleZ(n.paths,t):this._geometryIsPolygon(n)&&this._vertexListsScaleZ(n.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,i))||(e.exports=n)},2075:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(4),r(11),r(10),r(16),r(58),r(22),r(6),r(9),r(133),r(7),r(52),r(25),r(0),r(33),r(103),r(654),r(402),r(2526),r(2527),r(145),r(678)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,b,F,x,w,T,_){function E(e){return"dummy-tile-full-extent"===e.id}Object.defineProperty(t,"__esModule",{value:!0});var C=x.SingleFeatureReference,O=x.MultiFeatureReference,S=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),R=function(e){function t(t){var r=e.call(this,t)||this;return r.useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r.handles=new l,r._dirty=!1,r.idToFeatureTile=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryFactor",{set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodFactor",{set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.restart())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.estimatedUnusedSize}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numVertices}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numFeatures}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))S.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.fetchQueue=this.createFetchQueue(),this.handles.add(y.on(this,"tileDescriptors","change",function(){return e.setDirty()},function(){return e.setDirty()})),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?O:C;var t=this.context.scheduler;p.isSome(t)&&this.handles.add(t.registerTask(T.Task.FEATURE_TILE_FETCHER,function(t){return e.update(t)},function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0})),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.forEachFeatureTile(function(t){e.cancelFetchTile(t),e.removeTile(t)}),this.idToFeatureTile.clear(),this.displayingFeatureReferences.clear(),this.fetchQueue.destroy(),this.fetchQueue=null,this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.restart=function(){var e=this;this.fetchQueue.clear(),p.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.forEachFeatureTile(function(t){e.cancelFetchTile(t),e.resetFetchTile(t)}),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())},t.prototype.getFeatureTileById=function(e){return this.idToFeatureTile.get(e)||null},t.prototype.forEachFeatureTile=function(e){this.idToFeatureTile.forEach(e)},t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:d.resolve(),count:0,controller:d.createAbortController()},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then(function(){return e.result.catch(function(e){if(d.isAbortError(e))throw e;return null}).then(function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),u.safeCast(t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then(function(){return e}))):e}).then(function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,p.isSome(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e})});return this.pendingEdits.edits=r,this.updated(),r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach(function(e){return r.add(e.objectId)}),this.forEachFeatureTile(function(e){if(e.features){var i=e.features.filter(function(e){return!r.has(v.getObjectId(e,t.objectIdField))});i.length!==e.features.length&&(e.setFeatures(i,0),t.invalidateCounts())}})}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,r){return s(this,void 0,void 0,function(){var i,n,s,o=this;return a(this,function(a){switch(a.label){case 0:return i=[],n=new Set,e.forEach(function(e){return i.push(e.objectId)}),t.forEach(function(e){i.push(e.objectId),n.add(e.objectId)}),0===i.length?[2]:(s=[],this.forEachFeatureTile(function(e){var t=u.safeCast(o.applyEditsAddUpdateTile(e,i,n,r));t&&s.push(t)}),[4,d.eachAlways(s)]);case 1:return a.sent(),[2]}})})},t.prototype.applyEditsAddUpdateTile=function(e,t,r,i){return s(this,void 0,void 0,function(){var n,s,o,u,l,c,p,h=this;return a(this,function(a){switch(a.label){case 0:return e.features?((n=this.createQuery(e)).resultType=void 0,n.cacheHint=!1,n.objectIds=t,[4,this.queryFeatures(n,i)]):[2];case 1:if(s=a.sent(),o=null,r.size>0&&((u=e.features.filter(function(e){return!r.has(v.getObjectId(e,h.objectIdField))})).length!==e.features.length&&(o=u)),s.features.length>0)for(o||(o=e.features.slice()),this.context.adjustVerticalScale(s.features),l=0,c=s.features;l<c.length;l++)p=c[l],o.push(p);return o&&(e.setFeatures(o,0),this.invalidateCounts()),[2]}})})},t.prototype.queryFeatures=function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:I})},t.prototype.createFetchQueue=function(){var e=this;return new _.QueueProcessor({concurrency:6,task:T.Task.FEATURE_TILE_FETCHER,scheduler:this.context.scheduler,peeker:function(t){return e.highestPriorityTile(t)},process:function(t,r){return e.fetchTile(t,r)}})},t.prototype.highestPriorityTile=function(e){return e.reduce(function(e,t){return e&&e.descriptor.loadPriority<=t.descriptor.loadPriority?e:t},null)},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&h()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();if(this.markTilesNotAlive(r),!e.run(function(){return t.addTiles(r,e)})||!e.run(function(){return t.filterExtentTiles(r,e)})||!e.run(function(){return t.removeTiles(r,e)})||e.done)return void this.setDirty();var i=this.sortTiles(r);e.run(function(){return t.displayTiles(i,e)})&&e.run(function(){return t.queueFetchTiles(i,e)})&&e.run(function(){return t.updateMemoryEstimates(i,e)})||this.setDirty(),this.updated()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach(function(i){var n=r.getFeatureTileById(i.id);n?n.alive=!0:t.done||(e.push(r.addTile(i)),t.madeProgress())}),t.hasProgressed)},t.prototype.filterExtentTiles=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this.clearTile(n),t.madeProgress()))}return t.hasProgressed},t.prototype.removeTiles=function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this.removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed},t.prototype.sortTiles=function(e){return e.sort(function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority}),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),n=function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.memoryFactor,r.objectIdField)&&r.setDirty(),r.showTile(e)},s=this,a=0,o=e;a<o.length;a++){if("break"===function(e){if(!t.run(function(){return n(e)}))return s.setDirty(),"break"}(o[a]))break}return t.hasProgressed},t.prototype.queueFetchTiles=function(e,t){for(var r=this,i=this,n=0,s=e;n<s.length;n++){var a=function(e){if(!t.run(function(){return r.queueFetchTile(e)}))return i.setDirty(),{value:!0}}(s[n]);if("object"==typeof a)return a.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var r=this;return e.some(function(e){return!t.run(function(){return e.updateMemoryEstimates()})&&(r.setDirty(),!0)}),t.hasProgressed},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.forEachFeatureTile(function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,V),i.intersection(e,D),m.equals(V,D)||r.hideTileFeatures(i))}),this.forEachFeatureTile(function(e){return r.showTile(e)}),this.updated())},t.prototype.updated=function(){var e=this,t=this._dirty||this.fetchQueue.length>0&&!this.paused||!!this.pendingEdits;if(this._set("updating",t),t){var r=0,i=0,n=0,s=0,a=0,o=0,u=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(t){if(++n,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=t.displayingFeatures?t.displayingFeatures.length*u:0;o+=r-l}t.needsFetching?++a:t.numFeatures>0&&(++s,i+=t.numFeatures)});var l=a+=this.fetchQueue?this.fetchQueue.length:0;i?r=i+(l=a*i/s):r=n,o=Math.min(this.maximumNumberOfFeatures-this.features.length,o),this._set("updatingTotal",r),this._set("updatingRemaining",l),this._set("expectedFeatureDiff",o)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||h()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.forEachFeatureTile(function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded}),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<Math.max(0,t-e.descriptor.lij[0]))},i=0,n=0,s=0,a=e;s<a.length;s++){var o=a[s],u=o.numFeatures;i+=u,n+=u*r(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.forEachFeatureTile(function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}}),this.setDirty())},t.prototype.addTile=function(e){var t=new w(e);return this.idToFeatureTile.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.forEachFeatureTile(function(i){if(i.displayingFeatures&&t.tilesAreRelated(e,i)){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,s=i.displayingFeatures;n<s.length;n++){var a=s[n];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(v.getObjectId(a,t.objectIdField));o.ref(r,o.feature),t.numDisplayingFeatureReferences++}}}),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.tilesAreRelated=function(e,t){if(e===t)return!1;var r=e.descriptor.lij,i=t.descriptor.lij;if(!r||!i)return!0;var n=r[0]<i[0],s=n?r:i,a=n?i:r,o=a[0]-s[0];if(0===o)return!1;var u=1<<o;return Math.floor(a[1]/u)===s[1]&&Math.floor(a[2]/u)===s[2]},t.prototype.removeTile=function(e){this.clearTile(e),this.idToFeatureTile.delete(e.id)},t.prototype.resetFetchTile=function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0},t.prototype.cancelFetchTile=function(e){e.fetchRequest&&(e.fetchRequest=null,e.fetchStatus=0,this.fetchQueue.abort(e))},t.prototype.fetchTile=function(e,t){return s(this,void 0,void 0,function(){var r,i,n,s,o,u,l,c,p,h,f,y;return a(this,function(a){switch(a.label){case 0:if(!this.needsNumFeatures(e))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),r=e,[4,this.fetchCount(e,t)];case 2:return r.numFeatures=a.sent(),this.updateRatio(this.getListOfTiles()),[3,4];case 3:return i=a.sent(),d.isAbortError(i)?[2,void 0]:[3,4];case 4:return n=this.maximumFeaturesForTile(e),s=this.getMaxRecordCount(e),o=Math.ceil(n/s),E(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=n&&o>F.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((u=this.createQuery(e)).maxRecordCountFactor=Math.ceil(n/s),e.isRefetching&&e.features&&e.features.length>0&&(l=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/s),u.maxRecordCountFactor=Math.max(l+1,u.maxRecordCountFactor)),[4,this.queryFeatures(u,t)]);case 5:return c=a.sent(),p=c.features,h=c.exceededTransferLimit,f=h?u.maxRecordCountFactor>=F.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=p.length<e.numFeatures||h,y=this._removeEmptyFeatures(p),this.context.adjustVerticalScale(p),e.setFeatures(p,y),this.invalidateCounts(),[2,f]}})})},t.prototype.fetchCount=function(e,t){return s(this,void 0,void 0,function(){return a(this,function(r){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]})})},t.prototype.fetchPagedTile=function(e,t){return s(this,void 0,void 0,function(){var r,i,n,s,o,u,l,c,p,h,d;return a(this,function(a){switch(a.label){case 0:r=0,i=0,s=0,o=this.maximumFeaturesForTile(e)-s,u=this.getMaxRecordCount(e),a.label=1;case 1:return l=this.createQuery(e),c=this.setPagingParameters(l,r,o,u),[4,this.queryFeatures(l,t)];case 2:return p=a.sent(),h=p.features,d=p.exceededTransferLimit,c&&(r+=l.num),s+=h.length,i+=this._removeEmptyFeatures(h),this.context.adjustVerticalScale(h),e.featuresMissing=r<e.numFeatures||d,n=n?n.concat(h):h,e.setFeatures(n,i),this.invalidateCounts(),this.setDirty(),o=this.maximumFeaturesForTile(e)-s,!c||!d||o<=0?[2,d?4:5]:[3,1];case 3:return[2]}})})},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=m.toExtent(r,i)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor},Object.defineProperty(t.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0}),t.prototype.setResolutionParams=function(e,t){if(this.supportsResolution){var r=this.getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new b.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];v.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&!e.hasPreciseFeatureCount&&!E(e)},t.prototype.getMaxRecordCount=function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this.useTileQuery(e)&&p.isSome(r)&&r>0&&this.context.capabilities.supportsResultType?r:p.isSome(i)&&i>0?i:P},t.prototype.useTileQuery=function(e){return(!E(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType},t.prototype.queueFetchTile=function(e){var t=this;if(!e.needsFetching)return!1;var r=p.isSome(this.context.memoryCache)&&this.context.memoryCache.pop(e.id);if(r)return e.loadCache(r),this.setDirty(),this.scheduleUpdated(),!0;e.fetchStatus=e.needsRefetching?3:2;var i=!1,n=!1,s=this.fetchQueue.push(e).then(function(t){e.fetchRequest=null,e.fetchStatus=t}).catch(function(r){e.fetchRequest===s&&(e.fetchRequest=null,e.fetchStatus=4),d.isAbortError(r)?i=!0:(e.setFeatures([],0),t.invalidateCounts(),e.featuresMissing=!1,t.context.logFetchError(S,r))}).then(function(){n=!0,i||t.setDirty(),t.scheduleUpdated()});return n||(e.fetchRequest=s),!0},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(f.schedule(function(){e.handles.remove("scheduleUpdated"),e.updated()}),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,s=this.changes.adds,a=Math.min(e.featureLimit,t.length);e.featureLimit=a;for(var o=0;o<a;++o){var u=t[o],l=v.getObjectId(u,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var p=c.ref(i,u);p.oldVersion!==p.newVersion&&(n.removes.push(p.oldVersion),n.adds.push(p.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(i,u)),s.push(u);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,a),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,n=e.displayingFeatures;i<n.length;i++){var s=n[i],a=v.getObjectId(s,this.objectIdField),o=this.displayingFeatureReferences.get(a);if(o){var u=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(a),r.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var s=Math.min(n+M,i);this.features.addMany(t.slice(n,s)),this.features.removeMany(r.slice(n,s)),n=s}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&p.isSome(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cacheItem,t)}e.setFeatures(null,0),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.idToFeatureTile.size),t=0;return this.forEachFeatureTile(function(r){return e[t++]=r}),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(e,t){return e+(t.features?t.features.length:0)},0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?e.numFeatures:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){e.fetchQueue.test.update(t),e.update(t)}}},enumerable:!0,configurable:!0}),i([g.property({constructOnly:!0})],t.prototype,"features",void 0),i([g.property()],t.prototype,"tileDescriptors",void 0),i([g.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),i([g.property({value:1})],t.prototype,"memoryFactor",null),i([g.property({value:1})],t.prototype,"lodFactor",null),i([g.property()],t.prototype,"useTileCount",void 0),i([g.property({readOnly:!0})],t.prototype,"updating",void 0),i([g.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),i([g.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),i([g.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),i([g.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),i([g.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),i([g.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),i([g.property({readOnly:!0})],t.prototype,"totalVertices",null),i([g.property({readOnly:!0})],t.prototype,"totalFeatures",null),i([g.property()],t.prototype,"filterExtent",null),i([g.property({constructOnly:!0})],t.prototype,"context",void 0),i([g.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(g.declared(o));t.FeatureTileFetcher3D=R,t.contextCapabilitiesFromLayer=function(e){var t=e.capabilities.query;return{supportsMultipleResolutions:function(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}};var P=2e3,V=m.create(),D=m.create(),I=6e5,M=200;t.default=R}.apply(null,i))||(e.exports=n)},2524:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(4),r(10),r(11),r(58),r(24),r(14),r(7),r(25),r(0),r(103),r(2525),r(1829),r(1640),r(2529),r(1645),r(2531),r(2073),r(1633),r(640)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,b,F,x,w){return function(e){function t(t){var r=e.call(this)||this;return r._controllerTotal=0,r._graphicsCoreTotal=0,r.suspendResumeExtentMode="data",r}return r(t,e),t.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)},Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=0,t=0;this.controller&&this.controller.updating&&(e+=this.controller.updatingRemaining,t=this.controller.updatingTotal);var r=0;this.graphics3d&&this.graphics3d.graphicsCore&&(e+=this.graphics3d.graphicsCore.updatingRemaining,r=this.graphics3d.graphicsCore.updatingTotal),0===t&&0===r?(this._controllerTotal=0,this._graphicsCoreTotal=0):(this._controllerTotal=Math.max(t,this._controllerTotal),this._graphicsCoreTotal=Math.max(r,this._graphicsCoreTotal));var i=this._controllerTotal+this._graphicsCoreTotal;return i?(i-e)/i*100:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case"snapshot":return this.controller.serviceDataCount>5e3;case"tiles":return!0;default:u.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:t.supportsZ)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM},enumerable:!0,configurable:!0}),t.prototype.fetchPopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var e;return s(this,function(r){return(e=this.validateFetchPopupFeatures(t))?[2,c.reject(e)]:[2,this.fetchClientPopupFeatures(t)]})})},t.prototype.setVisibility=function(e,t){this.graphics3d.graphicsCore.setObjectIdVisibility(e,t)},t.prototype.createQuery=function(){return this.inherited(arguments)},t.prototype.queryFeatures=function(e,t){var r=this,i=arguments,n=function(){return r.inherited(i)};return"mesh"===this.layer.geometryType?o.safeCast(this._queryFeaturesMesh(this._ensureQuery(e),n)):o.safeCast(n())},t.prototype.createController=function(){return a(this,void 0,void 0,function(){var e,t=this;return s(this,function(r){return this.fetcherContext=new m.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM}),e=new f({layerView:this,context:this.fetcherContext,graphics:new b.EventedSet,extent:this.clippingExtent}),this.updatingHandles.add(e,"serviceDataExtent",function(e){t.graphics3d&&(t.graphics3d.dataExtent=e)},2),this.handles.add(p.init(this,"suspended",function(t){t?e.suspend():e.resume()},!0)),this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",function(){return t.updateDisplayFeatureLimit(e)},2),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return t.updateDisplayFeatureLimit()})),[2,e]})})},t.prototype.doRefresh=function(e){return a(this,void 0,void 0,function(){return s(this,function(e){return!this.suspended&&this.controller&&this.controller.refresh(),[2]})})},t.prototype.getStats=function(){var e=this.inherited(arguments);if(this.controller&&e.features){var t=this.controller.debug;e.features+="/"+t.storedFeatures+"/"+t.totalFeatures,e.totalVertices=t.totalVertices}var r=this.controller&&this.controller.displayFeatureLimit,i=r&&r.maximumSymbolComplexity;e.numTiles=this.controller?this.controller.tileDescriptors.length:0,e.partial=this.maximumNumberOfFeaturesExceeded,e.mode=this.controller?this.controller.mode:"n/a",e.symbolComplexity=i?"f:"+i.primitivesPerFeature+",v:"+i.primitivesPerCoordinate:"n/a";var n=this.graphics3d&&this.graphics3d.graphicsCore,s=n?n.unprocessedMemoryEstimate:0,a=this.controller?this.controller.expectedFeatureDiff*n.usedMemoryPerGraphic:0,o=function(e){return""+(e/1024/1024).toFixed(1)};return e.memory="u:"+o(this.getUsedMemory())+", pc:"+o(s)+", pf:"+o(a)+" MB",e},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)},t.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride},t.prototype.updateDisplayFeatureLimit=function(e){if(void 0===e&&(e=this.controller),e&&this.graphics3d&&this.graphics3d.graphicsCore){var t=this.graphics3d.graphicsCore.displayFeatureLimit,r=this.view.resourceController.memoryController.memoryFactor;if(1===r)e.displayFeatureLimit=t;else{var i=Math.ceil(t.maximumNumberOfFeatures*r),s=Math.ceil(t.maximumTotalNumberOfFeatures*r),a=Math.ceil(t.minimumTotalNumberOfFeatures*r);e.displayFeatureLimit=n({},t,{maximumNumberOfFeatures:i,maximumTotalNumberOfFeatures:s,minimumTotalNumberOfFeatures:a})}}},t.prototype._queryFeaturesMesh=function(e,t){return a(this,void 0,void 0,function(){var r,i,n,a,o,u,l,c;return s(this,function(s){switch(s.label){case 0:return[4,this._validateQueryFeaturesMesh(e)];case 1:return s.sent(),[4,t()];case 2:if(r=s.sent(),e&&e.outStatistics)return[2,r];for(i=this.layer.objectIdField,n=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,a=[],o=0,u=r.features;o<u.length;o++)(l=u[o]).geometry?(c=n.get(l.attributes[i]))&&(l.geometry=d.hydrateGeometry(c.graphic.geometry),a.push(l)):a.push(l);return r.features=a,[2,r]}})})},t.prototype._validateQueryFeaturesMesh=function(e){return a(this,void 0,void 0,function(){var t,r,i,n;return s(this,function(s){if(!e)return[2];for(t=function(e){throw new l("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+e+"'")},r=0,i=["quantizationParameters","geometryPrecision","maxAllowableOffset"];r<i.length;r++)n=i[r],null!=e[n]&&t(n);return"returnM"in e&&e.returnM&&t("returnM"),"returnCentroid"in e&&e.returnCentroid&&t("returnCentroid"),e.outSpatialReference&&!e.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference"),[2]})})},i([h.property()],t.prototype,"layer",void 0),i([h.property()],t.prototype,"controller",void 0),i([h.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],t.prototype,"updatingPercentageValue",null),i([h.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],t.prototype,"maximumNumberOfFeatures",void 0),i([h.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([h.property(v.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([h.property({readOnly:!0,dependsOn:["controller.mode"]})],t.prototype,"asyncGraphicsUpdates",null),i([h.property({readOnly:!0})],t.prototype,"hasZ",null),i([h.property({readOnly:!0})],t.prototype,"hasM",null),i([h.property()],t.prototype,"suspendResumeExtentMode",void 0),i([h.subclass("esri.views.3d.layers.FeatureLayerView3D")],t)}(h.declared(w.RefreshableLayerView(F.FeatureLayerView(y.FeatureLikeLayerView3D(g.LayerView3D(x))))))}.apply(null,i))||(e.exports=n)},2525:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(4),r(10),r(11),r(16),r(58),r(29),r(24),r(14),r(22),r(15),r(6),r(9),r(225),r(7),r(25),r(0),r(228),r(412),r(661),r(2075),r(2528),r(76),r(292)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,b,F,x,w,T,_,E,C){var O=f.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),S=function(e){function t(t){var r=e.call(this)||this;return r.type="feature-tile-3d",r.watchUpdatingTracking=new C.WatchUpdatingTracking,r.serviceDataExtent=null,r.serviceDataCount=n.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new h,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=m.createAbortController(),r}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else O.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===n.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,i=r&&r.featureTiles,s=i&&i.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&s){var a=this.approximateExtentSizeAtScale(t.minScale,s);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>n.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new l([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new l},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}),this.watchUpdatingTracking.add(this,"mode",function(){return e.modeChanged()},2);var t=m.resolve().then(function(){return e.verifyCapabilities()}).then(function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())}).then(function(){return e.initializeTileFetcher()});this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new p("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.refresh=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,r=v.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then(function(){var r=e,i=r.layerView,n=r.tileDescriptors,s=i.layer;e.tileFetcher=new T.FeatureTileFetcher3D({context:e.context,filterExtent:e.filteredDataExtent,tileDescriptors:n,features:e.graphics}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var a=e.layerView.view.resourceController;a&&(e.handles.add(a.memoryController.events.on("quality-changed",function(t){e.tileFetcher.memoryFactor=t})),e.tileFetcher.memoryFactor=a.memoryController.memoryFactor);var o="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;o&&e.handles.add(v.init(e.layerView.view,"qualitySettings.graphics3D."+o,function(t){e.tileFetcher.lodFactor=t||1}));e.watchUpdatingTracking.add(s,"definitionExpression",function(){return e.definitionExpressionChanged()}),e.watchUpdatingTracking.add(i,"availableFields",function(t,r){return e.attributesChanged(r,t)}),e.handles.add([s.on("apply-edits",function(t){return e.applyEdits(t)}),e.watch("filteredDataExtent",function(t){return e.tileFetcher.filterExtent=t},!0),e.watch("tileDescriptors",function(t){return e.tileFetcher.tileDescriptors=t},!0),v.init(e,"maximumNumberOfFeatures",function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t},!0),v.init(e,"serviceDataCount",function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures},!0),v.init(E,"FEATURE_TILE_FETCH_SHOW_TILES",function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new _.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)})]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})}).catch(function(){})},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:O.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refresh()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then(function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))})},t.prototype.attributesChanged=function(e,t){if(!e||-1===e.indexOf("*"))if(e&&t){for(var r=new Set,i=0,n=e;i<n.length;i++){var s=n[i];r.add(s)}for(var a=0,o=t;a<o.length;a++){s=o[a];if(!r.has(s))return void this.refresh()}}else this.refresh()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new w({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":case"stream":return F.isHostedAgolService(e.url);case"csv":case"geojson":return!0;default:return void c.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),m.isAbortError(t)||this._set("serviceDataExtent",d.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})},t.prototype.tryUpdateServiceDataExtent=function(e){return a(this,void 0,void 0,function(){var t,r,i,a,o,u,l,c,p,h,f;return s(this,function(s){switch(s.label){case 0:return t=this.layerView,r=t.layer,i=r.capabilities.query.supportsExtent,a=d.clone(t.fullExtentInLocalViewSpatialReference),o=r.fullExtent,u=this.fullExtentIsAccurate(),l=this.serviceDataCount,i&&l<=n.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!a||!u)?(c=this.createDataInfoQuery(),[4,r.queryExtent(c,{timeout:n.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return p=s.sent(),this._set("serviceDataExtent",p.extent),[3,6];case 2:return a?(this._set("serviceDataExtent",a),[3,6]):[3,3];case 3:return o?(h="portalItem"in r?r.portalItem:null,[4,x.projectGeometry(o,t.view.spatialReference,h,e)]):[3,5];case 4:return f=s.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),s.label=6;case 6:return[2]}})})},t.prototype.updateServiceDataCount=function(e){return a(this,void 0,void 0,function(){var t,r,i;return s(this,function(s){switch(s.label){case 0:return t=this.layerView.layer,[4,u.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:n.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))];case 1:if(!0===(r=s.sent()).ok)this._set("serviceDataCount",r.value);else{if(m.isAbortError(r.error))throw r.error;i=n.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",i)}return[2]}})})},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,s=this._get("vertexLimitInfo");return y.isNone(s)||s.maximumTotalNumberOfPrimitives!==r||s.primitivesPerCoordinate!==i||s.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return c.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return a(this,void 0,void 0,function(){var r,i,a,o,l,c,p,h,d,f,g,v,b,F;return s(this,function(s){switch(s.label){case 0:return r=y.isSome(this.vertexLimitInfo)&&this.vertexLimitInfo.primitivesPerFeature<=0,i=this.minimumNumberOfVerticesForGeometry>1,a=this.layerView.layer,o=this.supportsExceedsLimitQuery,y.isNone(this.vertexLimitInfo)||!r&&!i?(this._set("vertexLimitExceeded",!1),[2]):(l=this.vertexLimitInfo,c=l.primitivesPerFeature,p=l.primitivesPerCoordinate,h=l.maximumTotalNumberOfPrimitives,0!==c&&y.isSome(e)?[4,e]:[3,2]);case 1:s.sent(),s.label=2;case 2:return d=this.serviceDataCount,g=d!==n.constants.NO_SERVICE_DATA_COUNT,f=g?Math.ceil((h-d*c)/(p||1)):Math.ceil(h/(p||1)),i&&(f=Math.min(f,R)),g&&this.minimumNumberOfVerticesForGeometry*d>f?(this._set("vertexLimitExceeded",!0),[2]):(o||this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>f),[4,u.result(a.queryFeatures(this.createVertexLimitExceededQuery(f),{timeout:n.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]);case 3:if(!1===(v=s.sent()).ok){if(m.isAbortError(v.error))throw v.error;return this._set("vertexLimitExceeded",!1),[2]}return b=v.value,(F=b.features[0])&&F.attributes?this._set("vertexLimitExceeded",!!F.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}})})},t.prototype.fetchServiceDataInfo=function(){return a(this,void 0,void 0,function(){var e,t,r,i,n,a=this;return s(this,function(s){return this.cancelFetchServiceDataInfo(),e=m.createAbortController(),t=e.signal,r=this.updateServiceDataCount(t),i=m.eachAlways([r,this.updateVertexLimitExceeded(r,t)]),n=i.then(function(){return a.updateServiceDataExtent(t)}).catch(function(e){m.isAbortError(e)||O.error("#fetchServiceDataInfo()",e)}).then(function(){n===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null,a.fetchDataInfoAbortController=null),e=null}),e&&(this.fetchDataInfoPromise=n),this.fetchDataInfoAbortController=e,[2,i.catch(function(){})]})})},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),i([b.property({readOnly:!0})],t.prototype,"type",void 0),i([b.property({constructOnly:!0})],t.prototype,"graphics",void 0),i([b.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([b.property({constructOnly:!0})],t.prototype,"context",void 0),i([b.property()],t.prototype,"extent",null),i([b.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),i([b.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),i([b.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),i([b.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),i([b.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),i([b.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),i([b.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([b.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),i([b.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),i([b.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),i([b.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),i([b.property()],t.prototype,"displayFeatureLimit",void 0),i([b.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i([b.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),i([b.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),i([b.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),i([b.property()],t.prototype,"tileFetcher",void 0),i([b.property()],t.prototype,"fetchDataInfoPromise",void 0),i([b.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),n=i([b.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(b.declared(g.EsriPromiseMixin(o))),R=5e6;return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(S||(S={})),S.constants.reset(),S}.apply(null,i))||(e.exports=n)},2526:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(103)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.markedTile=null,this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;s.oldVersion=i,this.feature&&(t.uid=this.feature.uid);for(var n=0,a=this.versions;n<a.length;n++){var o=a[n];if(o.resolution===e){o.refCount++;var u=this.highestResolutionVersion===o&&!r.equals(t,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=t),s.newVersion=u?t:i,s}}var l={feature:t,resolution:e,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||e<this.highestResolutionVersion.resolution?(s.newVersion=t,this.highestResolutionVersion=l):s.newVersion=i,s},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,s.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),s.oldVersion=r.feature)),s.newVersion=this.feature,s}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var n=function(){function e(e,t){this._feature=t,this.refCount=1,this.markedTile=null}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){return++this.refCount,s.oldVersion=this._feature,this.feature&&(t.uid=this.feature.uid),r.equals(this._feature,t)||(this._feature=t),s.newVersion=this._feature,s},e.prototype.unref=function(e){return s.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(s.newVersion=null,s):(s.newVersion=this._feature,s)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var s={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=n)},2527:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(43),r(33),r(103)],void 0===(n=function(e,t,r,i,n){var s=function(){function e(t){this.descriptor=t,this.fetchRequest=null,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=e.UNKNOWN_COUNT,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t){this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce(function(e,t){return e+n.numVertices(t.geometry)},0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=n.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=n.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(i.fromExtent(e,a),i.intersects(this.descriptor.extent,a))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(i.fromExtent(e,t),this.descriptor.extent&&i.intersection(t,this.descriptor.extent,t)):i.set(t,this.descriptor.extent),t):(i.set(t,i.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort(function(t,r){return n.getObjectId(t,e)-n.getObjectId(r,e)}),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t,r){if(e<=0)return!1;var i=!1;if(this._features){this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,i=!0)),!this._shuffled&&e<1&&this._shuffle(r);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))}else this.featureLimit=0;return i},Object.defineProperty(e.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0}),e.prototype.loadCache=function(e){this.fetchRequest=null,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},e}();(s||(s={})).UNKNOWN_COUNT=-1;var a=i.create();return s}.apply(null,i))||(e.exports=n)},2528:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(97),r(91),r(231),r(294),r(295),r(190),r(238)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map(function(e){return new a(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))}),this.loadingSymbols=[new a(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,n=[];e.forEach(function(e,r){var s=i.tileFetcher.getFeatureTileById(r);s&&t.filter(s)||(i.view.graphics.removeMany(e),n.push(r))}),n.forEach(function(t){return e.delete(t)}),this.tileFetcher.forEachFeatureTile(function(n){if(t.filter(n)&&!e.has(n.id)){var a=n.descriptor.lij,u=a[0],l=a[1],c=a[2];i.tilingScheme.ensureMaxLod(u);var p=i.tilingScheme.getExtentGeometry(u,l,c),h=[new r({geometry:p,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:p.center,symbol:new s({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,h),i.view.graphics.addMany(h)}})},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,i))||(e.exports=n)},2529:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(1830),r(2075),r(2530)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.memoryCache=null,this._capabilities=null;var t=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=t.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM,this.verticalScale=new i({sourceSpatialReference:t.spatialReference,destSpatialReference:this.layerView.view.spatialReference}),this.query=s.createFeatureTileQuery3D(t);var r=this.layerView.view.resourceController;"hasService"in t&&t.hasService&&r&&(this.memoryCache=r.memoryController.getMemCache(t.uid))}return e.prototype.destroy=function(){r.isSome(this.memoryCache)&&this.memoryCache.destroy()},e.prototype.createQuery=function(){var e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e},Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scheduler",{get:function(){var e=this.layerView.view.resourceController;return e?e.scheduler:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileMaxRecordCount",{get:function(){var e=this.layerView.layer;return"tileMaxRecordCount"in e?e.tileMaxRecordCount:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxRecordCount",{get:function(){var e=this.layerView.layer;return"maxRecordCount"in e?e.maxRecordCount:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capabilities",{get:function(){return r.isSome(this._capabilities)?this._capabilities:(this._capabilities=n.contextCapabilitiesFromLayer(this.layerView.layer),this._capabilities)},enumerable:!0,configurable:!0}),e.prototype.logFetchError=function(e,t){e.error("#fetchTile()",this.layerView.layer,t&&t.message?t.message:t)},e.prototype.adjustVerticalScale=function(e){return this.verticalScale.adjust(e)},e}();t.FeatureTileFetcher3DLayerViewContext=a}.apply(null,i))||(e.exports=n)},2530:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(0),r(103),r(1577)],void 0===(n=function(e,t,r,i,n,s,a,o){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"queryFeaturesDehydrated",{get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){var i={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(t,r){return o.executeQueryPBF(e.layer.parsedUrl,t,i,r).then(function(e){return e.data})}}return function(t,r){return o.executeQuery(e.layer.parsedUrl,t,r).then(function(e){return a.fromFeatureSetJSON(e.data)})}},enumerable:!0,configurable:!0}),t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},i([s.property({constructOnly:!0})],t.prototype,"layer",void 0),i([s.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],t.prototype,"queryFeaturesDehydrated",null),i([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(s.declared(n)),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryFeaturesDehydrated=function(e,t){var r=this;return this.source.queryFeaturesJSON(e,t).then(a.fromFeatureSetJSON,function(i){if(i&&"query-features-json:unsupported"===i.name)return r.source.queryFeatures(e,t);throw i})},t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},i([s.property({constructOnly:!0})],t.prototype,"layer",void 0),i([s.aliasOf("layer.source")],t.prototype,"source",void 0),i([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],t)}(s.declared(n));t.createFeatureTileQuery3D=function(e){switch(e.source.type){case"feature-layer":return new u({layer:e});case"memory":case"csv":case"geojson":return new l({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}}.apply(null,i))||(e.exports=n)},2531:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(3),r(49),r(79)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new Set,t}return r(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._set.add(i)}this.emit("after-changes",{type:1}),this.emit("change",{added:e,removed:[]})}},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this._set.delete(n)&&t.push(n)}t.length>0&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:t}))},t.prototype.toArray=function(){return n.valuesOfSet(this._set)},t.prototype.find=function(e){var t;return n.everySet(this._set,function(r){return!e(r)||(t=r,!1)}),t},t.prototype.forEach=function(e){this._set.forEach(function(t){return e(t)})},t}(i);t.EventedSet=s}.apply(null,i))||(e.exports=n)}}]);