(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/LayerView":1633,"esri/views/3d/layers/LayerView3D":1640,"esri/views/3d/layers/support/layerViewUpdatingProperties":1645,"esri/views/layers/support/popupUtils":1657,"esri/layers/graphics/data/QueryEngineCapabilities":1680,"esri/views/3d/layers/support/attributeUtils":1681,"esri/views/3d/webgl-engine/lib/HighlightSet":1720,"esri/layers/graphics/controllers/I3SOnDemandController":1750,"esri/views/3d/layers/i3s/I3SFrameTask":1751,"esri/views/3d/layers/i3s/I3SIndex":1752,"esri/views/3d/layers/i3s/I3SLodHandling":1753,"esri/views/3d/layers/i3s/I3SNodeLoader":1754,"esri/views/3d/layers/i3s/I3SMaterialUtil":1755,"esri/views/3d/layers/i3s/I3SStreamDataController":1756,"esri/views/3d/layers/i3s/I3SViewportQueries":1757,"esri/views/3d/webgl-engine/materials/component/Parameters":1758,"esri/views/3d/webgl-engine/materials/component/VertexBufferLayout":1759,"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":1760,"esri/views/3d/layers/support/fieldProperties":1761,"esri/views/3d/layers/support/PopupSceneLayerView":1762,"esri/views/3d/layers/I3SMeshView3D":1780,"esri/views/3d/layers/i3s/Highlights":1837,"esri/views/3d/layers/i3s/I3SElevationProvider":1838,"esri/views/3d/layers/i3s/IDBCache":1839,"esri/views/3d/webgl-engine/materials/component/index":1840,"esri/views/3d/webgl-engine/materials/component/ComponentMaterial":1841,"esri/views/3d/webgl-engine/materials/component/ComponentGLMaterial":1842,"esri/views/3d/webgl-engine/materials/internal/TextureBinding":1843,"esri/views/3d/webgl-engine/materials/renderers/PreinterleavedRenderer":1844,"esri/views/3d/layers/SceneLayerView3D":2552,"esri/views/3d/layers/i3s/I3SQueryEngine":2553,"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":2554,"esri/views/3d/layers/i3s/I3SQueryFeatureStore":2555})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[45,19],{1633:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(49),r(282),r(284),r(6),r(225),r(7),r(0)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),u.reject(t)}})},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([c.property()],t.prototype,"layer",void 0),i([c.property()],t.prototype,"parent",void 0),i([c.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([c.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),i([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(a.HandleOwnerMixin(s.IdentifiableMixin(d.EsriPromiseMixin(o.EventedMixin(n))))))}.apply(null,i))||(e.exports=n)},1640:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(25),r(0),r(408)],void 0===(n=function(e,t,r,i,n,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.destroy=function(){this.view=null},t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([a.property()],t.prototype,"view",void 0),i([a.property()],t.prototype,"slicePlaneEnabled",void 0),i([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(e))}}.apply(null,i))||(e.exports=n)},1645:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},1657:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(11),r(229),r(9),r(117)],void 0===(n=function(e,t,r,i,n,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),i(this,void 0,void 0,function(){var i,s,l,d,u,c,h,p,f,g,y;return r(this,function(r){switch(r.label){case 0:return o.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return i=r.sent(),s=t.lastEditInfoEnabled,l=e.objectIdField,d=e.typeIdField,n.includes(i,"*")?[2,["*"]]:(c=a.fixFields,h=[e.fields],f=(p=i).concat,g=[[d]],(y=s)?[4,a.getFeatureEditFields(e)]:[3,3]);case 2:y=r.sent(),r.label=3;case 3:return(u=c.apply(void 0,h.concat([f.apply(p,g.concat([y||null]))])))&&l&&a.hasField(e.fields,l)&&-1===u.indexOf(l)&&u.push(l),[2,u]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:o.isSome(t)&&t.defaultPopupTemplateEnabled&&o.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1681:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var o=n[i];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,i))||(e.exports=n)},1720:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,i))||(e.exports=n)},1750:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(43),r(58),r(22),r(18),r(6),r(75),r(225),r(7),r(25),r(0),r(8),r(5),r(45),r(33),r(103),r(1687),r(1751),r(1752),r(1753),r(1754),r(1756),r(1641),r(1757),r(41),r(651)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h,p,f,g,y,m,v,_,b,x,w,S,C,I,D,P,O,M){function N(e,t){return e.length===t.length&&e.every(function(e){return E(t,e.name)>=0})}function E(e,t){for(var r=t.toLowerCase(),i=0;i<e.length;i++)if(e[i].name.toLowerCase()===r)return i;return-1}function F(e){return null!=e&&null!=e.loadedAttributes&&null!=e.attributeData}var T=d.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),R=function(e){function t(t){var r=e.call(this,t)||this;return r.screenSizeFactor=0,r.featureTarget=5e4,r.fixedFeatureTarget=!1,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.scaleVisibilityEnabled=!0,r.uncompressedTextureDownsamplingEnabled=!1,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._invisibleDirty=!1,r._newLoadingNodes=new u({deallocator:null}),r._loadedNodeScales=new Map,r._abortController=h.createAbortController(),r._downloadingNodes=new Set,r._loadingNodeRevisions=new Map,r._nextLoadingNodeRevision=0,r._updatingNodes=new Set,r._progressMaxNumNodes=1,r._poi=y.vec3f64.create(),r._requiredAttributes=[],r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableIDBCache=!1,r.disableMemCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new s,r._idleQueue=new b.PromiseQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataController",{get:function(){var e=this.layerView.view.resourceController.createStreamDataRequester(1);return new I.default(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return D.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return D.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._index&&this._index.rootNode;return!e||(this._updateViewData(),this._index.isNodeVisible(e.index))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._lodHandling=new S(this.layerView);var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this.disableIDBCache=l("disable-feature:idb-cache"),"fields"in t&&(this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo);var r=h.all([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var r=e.layerView.view;e._setClippingArea(r.clippingArea),e._centerOnSurface=r.pointsOfInterest.centerOnSurfaceFrequent;var i=e.layerView.view.resourceController;e._handles.add([e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}),i.memoryController.events.on("quality-changed",function(){return e._setCameraDirty()}),p.init(e.layerView,"suspended",function(t){var r=t?function(){return e._updateViewData()}:function(){return e._updateIdleState(!0)},n=t?function(){}:function(){return e._updateIdleState(!1)};e._idleStateCallbacks?(t&&e.cancelNodeLoading(),e.restartNodeLoading(),e._idleStateCallbacks.idleBegin=r,e._idleStateCallbacks.idleEnd=n):e._idleStateCallbacks=i.scheduler.registerIdleStateCallbacks(r,n)}),x.addTask(e.layerView.view.resourceController.scheduler,{update:function(t,r){return e._frame(t,r)},needsUpdate:function(){return e.updating}}),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch(["featureTarget","fixedFeatureTarget"],function(){e._setCameraDirty(),e._stableFeatureLOD=!1}),r.state.watch("camera",function(){return e._setCameraDirty()}),e.layer.watch("elevationInfo",function(){return e._elevationInfoChanged()}),e.layer.watch(["minScale","maxScale"],function(){return e._scaleBoundsChanged()}),e.layerView.watch("lodFactor",function(){return e._setCameraDirty()}),e.layerView.watch("availableFields?",function(){return e._requiredFieldsChange()})]),e._updateScaleHandles(),e._viewportQueries=new P(e.crsIndex,r.renderCoordsHelper,r.state.camera,e._clippingArea,r.elevationProvider,e.layer,{progressiveLoadFactor:e._getProgressiveLoadFactor(e.layer),screenspaceErrorBias:e.lod,angleDependentLoD:e.lod<.5}),e._index=new w.I3SIndex(t,e.streamDataController,e._viewportQueries,T,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t,"leaf")},function(t){return e._needsUpdate(t)},function(){return!e.streamDataController.busy})}});this._tmpPoint=_.makeDehydratedPoint(0,0,0,this.crsIndex),this.addResolvingPromise(r),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._abortController.abort(),this._abortController=null,this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null),this._handles.destroy(),this._nodeLoader=null,L.prune()},t.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var e=this._attributeStorageInfo,t=this._fields,r=this.layer.objectIdField;return this.layerView.availableFields.map(function(r){var i=E(e,r),n=E(t,r);return i>=0&&n>=0?{index:i,name:t[n].name,field:t[n],attributeStorageInfo:e[i]}:null}).filter(function(e){return null!=e&&e.name!==r})},t.prototype._requiredFieldsChange=function(){N(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()},t.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._setClippingArea=function(e){var t=m.create();O.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=V.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))},t.prototype._calculatePointOfInterest=function(e){var t=this._centerOnSurface.renderLocation,r=y.vec3f64.create();g.vec3.subtract(r,t,this.camPos);var i=this.layerView.view.renderCoordsHelper,n=y.vec3f64.create();i.worldUpAtPosition(t,n);var o=g.vec3.angle(n,r)-.5*Math.PI;return g.vec3.lerp(e,this.camPos,t,Math.max(0,Math.min(1,o/(.5*Math.PI)))),e},t.prototype.updateClippingArea=function(e){this._setClippingArea(e),this._viewportQueries&&this._index&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache()),this._setCameraDirty()},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.notifyChange("rootNodeVisible"),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()},t.prototype.updateElevationChanged=function(e,t){if(null!=this._index){null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new u({deallocator:null}));var r=this._elevationUpdateNodes;r.clear();var i=this._index.rootNode;null!=i&&D.findIntersectingNodes(e,t,i,this.crsIndex,this._index,function(e){return r.push(e.index)});for(var n=0;n<r.length;n++){var o=r.data[n];this._index.invalidateBoundingVolumeCache(o),o===i.index&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()}},t.prototype.getParentIndex=function(e){return this._index.getParentIndex(e)},t.prototype._elevationInfoChanged=function(){this._index.updateElevationInfo(this.layer.elevationInfo),this._setCameraDirty()},t.prototype._updateScaleHandles=function(){var e=this;this._handles.remove("scale-bounds"),this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(t){return e._scaleUpdateHandler(t)}),"scale-bounds")},t.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear(),this._updateScaleHandles(),this._setCameraDirty()},t.prototype._scaleUpdateHandler=function(e){this._updateScaleInBoundingRect(e.scale,e.extent,e.spatialReference),this._setCameraDirty()},t.prototype._updateScaleInBoundingRect=function(e,t,r){var i=this;null!=this._index.rootNode&&O.boundingRectToBoundingRect(t,r,A,this.crsIndex)&&this._loadedNodeScales.forEach(function(t,r){var n=i._index.getNode(r);v.containsPoint(A,n.mbs)&&i._loadedNodeScales.set(r,e)})},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this.cancelNodeLoading(),this._evaluateUpdating()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodeRevisions.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodeRevisions.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},Object.defineProperty(t.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"areScaleBoundsActive",{get:function(){var e=M.extractSafeScaleBounds(this.layer),t=e.minScale,r=e.maxScale;return this.scaleVisibilityEnabled&&(t>0||r>0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexDepth",{get:function(){return this._index?this._index.maxLevel:0},enumerable:!0,configurable:!0}),t.prototype._frame=function(e,t){return this.layerView.suspended?(this._updateViewData(),this._evaluateUpdating(),-1/0):this.layerView.visible?(this._processLogError(e,t),this._index.getPriority()):-1/0},t.prototype._processLogError=function(e,t){try{this._process(e,t)}catch(e){this._errorCount<50?T.error("Error during processing: "+e):50===this._errorCount&&T.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&this._startNodeLoading(),null!=this._nodeLoader&&null!=this._index){for(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(e)&&(this._invisibleDirty=!1),this.isIntegratedMesh&&(e.enabled=!1),e.run(function(){return r._processIndex(t,e)}),this._updateFeatureLOD(),e.run(function(){return r._processCache(e,t)}),this.isIntegratedMesh&&(e.enabled=!0),e.run(function(){return r._processNodes(e,t)});!e.done&&this._idleQueue.process();)e.madeProgress();e.run(function(){return r._prefetchIndex(t)}),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingNodes.size,e.run(function(){return r._lodHandling.lodGlobalHandling(e)}),this._evaluateUpdating()}},t.prototype._processIndex=function(e,t){if(this._index.dirty){this._newLoadingNodes.clear(),this._index.update(o.keysOfMap(this._loadingNodeRevisions),t),!this.disableMemCache&&this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData&&(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length));var r=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||r===this._get("leafsReached")||this._set("leafsReached",r)}return this._index.load()},t.prototype._prefetchIndex=function(e){return!(this._loadingNodeRevisions.size>0||this._index.updates.add.length>0)&&this._index.prefetch()},t.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var e=!this._index.isLoading(),t=this.featureTarget*this.baseLOD,r=this._index.getFeatureEstimate();if(r.estimate=r.estimate||t/2,this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(e&&r.estimate<t){if(r.leafsReached||this._featureLOD>=1e4||this._stableFeatureLOD)return;var i=Math.min(10,Math.max(t/r.estimate,1.001));this._featureLOD*=i;var n=this.lod,o=this._index.checkFeatureTarget(t,n);o!==n&&(this._featureLOD=o/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(r.estimate>1.2*t||e&&r.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(r.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestUpdate()}},t.prototype._processCache=function(e,t){for(;this._newLoadingNodes.length>0&&!e.done;)for(var r=this._newLoadingNodes.pop(),i=this._index.getParent(r);i&&!this.layerView.isNodeLoaded(i.index)&&this._isNodeInScaleBounds(i);i=this._index.getParent(i.index))if(this._enableFromGPUCache(i,"hole")){e.madeProgress();break}return e.hasProgressed},t.prototype._processNodes=function(e,t){var r=(this._isIdle?100:2)-this._loadingNodeRevisions.size,i=this._index.updates;for(i.cancel.forEach(this._cancelNode,this),i.cancel=[];i.update.length>0&&!e.done;){var n=this._index.getNode(i.update.pop());this._updateLoadedNode(n),e.madeProgress()}for(;i.add.length>0&&!e.done&&r>0;){if(--r,2!==(n=this._index.getNode(i.add.back())).cacheState&&!this._hasNodeLoadToken(t))break;i.add.pop(),this._loadNode(n),e.madeProgress()}return e.hasProgressed},t.prototype._cancelAllNodes=function(){this._loadingNodeRevisions.clear(),this._downloadingNodes.clear(),this._updatingNodes.clear(),this._abortController.abort(),this._abortController=new AbortController},t.prototype._cancelNode=function(e){this._loadingNodeRevisions.delete(e),this._downloadingNodes.delete(e)},t.prototype._hasNodeLoadToken=function(e){return!(!this._isIdle&&e.numNodesLoading+this._loadingNodeRevisions.size>=2||this.streamDataController.busy)},t.prototype._evaluateUpdating=function(){var e=!1,t=0;if(this.layerView.suspended)t=(e=this._cameraDirty)?100:0;else{var r=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodeRevisions.size;e=!!(r>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===r&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(r,this._progressMaxNumNodes),t=100*r/this._progressMaxNumNodes}e!==this.updating&&this._set("updating",e),t!==this.updatingPercentage&&this._set("updatingPercentage",t)},t.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var e=this.layerView.view,t=e.state.camera;this.camPos=y.vec3f64.clone(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/(t.perScreenPixelRatio/2),this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.setPointOfInterest(this._poi),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.invalidateVisibilityCache(),this._index.progressiveLoadPenalty=V.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate(),this._stableFeatureLOD=!1,this._invisibleDirty=!0,this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}},t.prototype._getProgressiveLoadFactor=function(e){return this.layerView.view.resourceController.memoryController.memoryFactor<1?1:this.layerView.progressiveLoadFactor},Object.defineProperty(t.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseLOD",{get:function(){var e=this.layerView.lodFactor,t=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(e>0?e:1)*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;var e=this.layerView.view.resourceController.memoryController;return(Math.min(e.memoryFactor,.5)-e.minQuality)/(.5-e.minQuality)},enumerable:!0,configurable:!0}),t.prototype.isGeometryVisible=function(e){return this._index.isGeometryVisible(e.index)},t.prototype.updateVisibility=function(e){return this._index.invalidateVisibilityCache(e)},t.prototype._shouldLoadNode=function(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e)||!this._isNodeInScaleBounds(e))&&(!e.obb||this._index.isGeometryVisible(e.index))},t.prototype._shouldDropNode=function(e){var t=this.lodDropFactor;return!(t>=1||!this._lodHandling.childrenEmpty(e))&&Math.abs(this._viewportQueries.calcCameraDistanceToCenter(e))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*t},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataController){this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var t=C.TextureFormat.Normal;this.layerView.useCompressedTextures?t=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=C.TextureFormat.Downsampled);var r={textureFormat:t,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid};this._nodeLoader=new C(this.layer,this.streamDataController,T,this._defaultGeometrySchema,this._requiredAttributes,r);var i=this.layerView.view.renderSpatialReference,n=this.crsIndex.equals(i)||this.crsIndex.isWGS84&&i.equals(O.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!n,this._index.requestUpdate(),this._lodHandling.startNodeLoading(function(t){return e._index.isNodeVisible(t)},function(t){return e._index.isGeometryVisible(t)},function(t){return e._isNodeInScaleBounds(t)},function(t){return e._index.nodeTraversalState(t)},function(t,r){return e._removeNodes(t,r)},this._index,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())},t.prototype._removeInvisibleNodes=function(e){var t=this;L.clear(),this.layerView.getLoadedNodeIndices(L);var r=0===this._viewportQueries.maxDistance,i=r?function(){return!1}:function(e){return t._shouldDropNode(e)};return L.filterInPlace(function(e){var r=t._index.getNode(e);return!t._index.isGeometryVisible(e)||i(r)||!t._isNodeInScaleBounds(r)}),L.length>0&&this._lodHandling.setLodGlobalDirty(),this._removeNodes(L,e),!(r&&this.lodDropFactor<1||0!==L.length&&(L.clear(),1))},t.prototype._removeNodes=function(e,t){e.length>0&&this._index.requestUpdate();var r=e.length;if(this.layerView.removeNodeData(e,t),this._loadedNodeScales.size>0)for(var i=e.length;i<r;i++){var n=e.data[i];this._loadedNodeScales.delete(n)}},t.prototype._needsUpdate=function(e){if(!e.resources.hasFeatureData||this._updatingNodes.has(e.index))return!1;var t=this.layerView.getLoadedAttributes(e.index);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=N(this.layerView.getLoadedAttributes(e.index),this._requiredAttributes)?h.resolve(this.layerView.getAttributeData(e.index)):this._nodeLoader.loadAttributes(e,this._requiredAttributes,this._abortController.signal);this._updatingNodes.add(e.index),r.then(function(r){return t.schedule(e.index).then(function(){return t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:r})})}).catch(function(r){h.isAbortError(r)||t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){t._updatingNodes.delete(e.index),t._evaluateUpdating()}),this._evaluateUpdating()},t.prototype._loadNode=function(e){var t=this,r=this._nextLoadingNodeRevision++;this._loadingNodeRevisions.set(e.index,r),this._evaluateUpdating(),this._loadAndAddNode(e).catch(function(e){return e}).then(function(){t._loadingNodeRevisions.get(e.index)===r&&t._loadingNodeRevisions.delete(e.index),t._evaluateUpdating()})},t.prototype._loadAndAddNode=function(e){var t=this;return 1===e.cacheState?this._loadUncached(e):this._loadCached(e).then(function(r){r||(e.cacheState=1,t._index.updates.add.push(e.index))}).catch(function(t){h.isAbortError(t)||(e.cacheState=1)})},t.prototype._enableFromGPUCache=function(e,t){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var r=this._loadCachedGPUData(e);return!!r&&(this.layerView.addCachedGPUData(e,r,t),this._nodeAdded(e),!0)},t.prototype._loadCachedGPUData=function(e){var t=this.layerView.loadCachedGPUData(e);return t&&F(t.attributeInfo)&&N(t.attributeInfo.loadedAttributes,this._requiredAttributes)?t:null},t.prototype._nodeAdded=function(e){this._index.requestUpdate(),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()},t.prototype._loadCached=function(e){var t=this;if(this._enableFromGPUCache(e,"leaf"))return h.resolve(!0);var r=this.layerView;return!this.disableIDBCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.index).then(function(){return r.loadCachedNodeData(e,t._abortController.signal,function(r,i){return t._nodeLoader.loadTextures(e,r,i)})}).then(function(i){if(null==i)return!1;var n=t._requiredAttributes;return F(i)&&N(i.loadedAttributes,n)?t.reschedule(e.index).then(function(){return r.addCachedNodeData(e,i,i)}).then(function(){return t._nodeAdded(e),!0}):t.reschedule(e.index).then(function(){return t._nodeLoader.loadAttributes(e,n,t._abortController.signal)}).then(function(r){return t.reschedule(e.index,{loadedAttributes:n,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,i,t)}).then(function(){return t._nodeAdded(e),!0})}):h.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.index),a.safeCast(this._nodeLoader.loadNodeData(e,this._abortController.signal)).then(function(r){return t._downloadingNodes.delete(e.index),t.schedule(e.index,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._nodeAdded(e),e.cacheState=2}).catch(function(r){h.isAbortError(r)||(T.error("Failed to load node '"+e.id+"': "+r),e.failed=!0,t._index.requestUpdate())})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._evaluateUpdating(),e&&this._index&&this._index.resetFailedNodes())},t.prototype._getScale=function(e){if(this._loadedNodeScales.has(e.index))return this._loadedNodeScales.get(e.index);var t=e.mbs;this._tmpPoint.x=t[0],this._tmpPoint.y=t[1],this._tmpPoint.z=t[2];var r=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);return this.layerView.isNodeLoaded(e.index)&&this._loadedNodeScales.set(e.index,r),r},t.prototype._isNodeInScaleBounds=function(e){if(!this.areScaleBoundsActive)return!0;var t=this._getScale(e),r=M.extractSafeScaleBounds(this.layer),i=r.minScale,n=r.maxScale;return M.scaleBoundsPredicate(t,i,n)},t.prototype.updateStats=function(e){e.index=this._index?this._index.size:0,this.isGraphics3D&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),this._index&&this._index.updateStats(e)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{set disableIDBCache(t){e.disableIDBCache=t},set ignoreServiceOBB(t){e._index.ignoreServiceOBB=t}}},enumerable:!0,configurable:!0}),i([f.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),i([f.property({readOnly:!0})],t.prototype,"isGraphics3D",null),i([f.property({readOnly:!0})],t.prototype,"streamDataController",null),i([f.property({readOnly:!0})],t.prototype,"crsVertex",null),i([f.property({readOnly:!0})],t.prototype,"crsIndex",null),i([f.property()],t.prototype,"camPos",void 0),i([f.property()],t.prototype,"screenSizeFactor",void 0),i([f.property()],t.prototype,"featureTarget",void 0),i([f.property()],t.prototype,"fixedFeatureTarget",void 0),i([f.property()],t.prototype,"layerView",void 0),i([f.property()],t.prototype,"layer",void 0),i([f.property({readOnly:!0})],t.prototype,"updating",void 0),i([f.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),i([f.property({readOnly:!0})],t.prototype,"leafsReached",void 0),i([f.property({constructOnly:!0})],t.prototype,"scaleVisibilityEnabled",void 0),i([f.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),i([f.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),i([f.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(f.declared(c.EsriPromiseMixin(n))),L=new u({deallocator:null}),V={factorIM:.2,factor3dObject:.05,distancePenalty:10},A=v.create();return R}.apply(null,i))||(e.exports=n)},1751:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(43),r(145)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=this;this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=e.registerTask(i.Task.I3S_CONTROLLER,function(e){return t.update(e)},function(){return t.needsUpdate()})}return e.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)},e.prototype.needsUpdate=function(){for(var e=0,t=this.callbacks;e<t.length;e++)if(t[e].needsUpdate())return!0;return!1},e.prototype.update=function(e){this.sort();for(var t=this.callbacks,r={numIndexLoading:0,numNodesLoading:0},i=0;i<t.length&&!e.done;++i)t[i].priority=t[i].update(e,r),this.runIndex=i},e.prototype.sort=function(){for(var e=this.callbacks,t=e.length,r=this.runIndex;r>0;r--){for(var i=e[r-1],n=r;n<e.length&&i.priority<=e[n].priority&&(n!==t||i.priority<e[n].priority);)e[n-1]=e[n],n++;e[n-1]=i,t=n-1}this.runIndex=0},e.prototype.add=function(e){this.sort(),e.priority=1/0,this.callbacks.unshift(e)},e.prototype.remove=function(e){r.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()},e}(),o=new Map;t.addTask=function(e,t){var r=o.get(e);return null==r&&(r=new n(e),o.set(e,r)),r.add(t),{remove:function(){if(null!=r){if(r.remove(t),r.callbacks.length>0)return void(r=null);o.delete(e),r.destroy(),r=null}}}}}.apply(null,i))||(e.exports=n)},1752:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(9),r(75),r(7),r(8),r(35),r(1641),r(1655)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d){function u(e){e.node?(e.node.renderMbs[3]=-1,e.node.renderObb.halfSize[0]=-1):e.ref&&(e.ref.renderMbs[3]=-1,e.ref.renderObb.halfSize[0]=-1)}function c(e){return l.addWraparound(e,-2)}function h(e){return l.addWraparound(e,2)}function p(e,t){return 0===t?0:e/t|0}function f(e,t){return 0===t?e:e%t}function g(e){if(e)for(var t=0;t<e.length;t++)for(var r=0,i=b;r<i.length;r++){var n=i[r];if(n[0]===e[t].metricType)return{lodMetric:n[1],maxError:e[t].maxError}}return{lodMetric:0,maxError:0}}function y(e){return Math.sqrt(e*(4/Math.PI))}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,r,i,o,a,s,l,d){this.streamDataController=t,this.viewportQueries=r,this.logger=i,this._isLoaded=o,this._isSelected=a,this._enable=s,this._needsUpdate=l,this._canRequest=d,this._dirty=!0,this.nodePages=[],this.nodeCount=0,this.nodesPerPage=0,this.rootIndex=0,this.lodMetric=0,this.lodConversion=function(e){return e},this._loading=new Set,this._failedNodes=new Set,this._failedPages=new Set,this._indexMissing=1,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._visibilityCacheGeneration=h(0),this._maxLevel=1,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new n({deallocator:null}),this._prefetch=new n({deallocator:null}),this._updates=new _,this.ignoreServiceOBB=!1,this.progressiveLoadPenalty=0,this.layerUrl=e.parsedUrl.path,this.rootId=e.rootNode&&e.rootNode.split("/").pop(),e.serviceUpdateTimeStamp&&e.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=""+e.serviceUpdateTimeStamp.lastUpdate),this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1,e.nodePages?this.initNodePages(e.nodePages):this.initNodeDocuments(this.rootId)}return e.prototype.initNodePages=function(e){switch(this.nodesPerPage=e.nodesPerPage,this.rootIndex=e.rootIndex,e.lodSelectionMetricType){case"maxScreenThreshold":this.lodMetric=1;break;case"maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=y}},e.prototype.initNodeDocuments=function(e){this.nodesPerPage=0,this.rootIndex=0,this.nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode({id:e,mbs:null},-1)},e.prototype.loadPage=function(e){var t=this;this._loading.add(e);var r=this.layerUrl+"/nodepages/"+e;return this.streamDataController.request(r,"json").then(function(r){t._loading.delete(e),t.addPage(e,r)}).catch(function(r){return t._loading.delete(e),o.isAbortError(r)?o.reject(r):(t._failedPages.add(e),0===t.nodePages.length&&t.initNodeDocuments(t.rootId),o.reject(r))})},e.prototype.addPage=function(e,t){for(var r=this,i=this.nodePages.length;i<e;i++)this.nodePages[i]=null;var n=[],o=[],l=t.nodes.map(function(t,i){var l=n.length,u=t.children?t.children.length:0;o.push(-1);for(var h=0;h<u;h++)n.push(t.children[h]);var p=""+t.index,f=d.clone(t.obb),g=s.vec4f64.fromArray([f.center[0],f.center[1],f.center[2],a.vec3.length(f.halfSize)]),y=t.mesh&&t.mesh.attribute,m=t.mesh&&t.mesh.geometry,v=t.mesh&&t.mesh.material,_={hasSharedResource:!1,hasFeatureData:!!m,attributes:y&&null!=y.resource?""+y.resource:null,geometry:m&&null!=m.resource?""+m.resource:null,texture:v&&null!=v.resource&&v.texelCountHint>0?""+v.resource:null,geometryDefinition:m?m.definition:-1,materialDefinition:v?v.definition:-1},b={id:p,index:e*r.nodesPerPage+i,childCount:u,failed:!1,cacheState:0,obb:f,mbs:g,level:0,resources:_,lodMetric:r.lodMetric,maxError:r.lodConversion(t.lodThreshold),renderMbs:s.vec4f64.fromArray([0,0,0,-1]),renderObb:d.create([0,0,0],[-1,-1,-1],[0,0,0,1]),numFeatures:m?m.featureCount:null,vertexCount:m?m.vertexCount:null,version:r.lastUpdate};return{childOffset:l,childCount:u,visibilityCache:c(r._visibilityCacheGeneration),ref:null,node:b}});this.nodePages[e]={nodes:l,children:n,parents:o},this.nodeCount+=l.length,this.updateParentsAndLevel()},e.prototype.updateParentsAndLevel=function(){var e=this,t=[],r=function(r,n,o){var a=e.getPage(r);if(i.isSome(a)){var s=f(r,e.nodesPerPage);a.parents[s]=n;var l=a.nodes[s].node;l&&(l.level=o,t.push(r))}};for(r(this.rootIndex,-1,0);t.length;)for(var n=t.pop(),o=this.getNode(n),a=0;a<o.childCount;a++){r(this.getChildIndex(o,a),n,o.level+1)}},e.prototype.getPage=function(e){return this.nodePages[p(e,this.nodesPerPage)]},e.prototype.getNodeInternal=function(e){var t=this.getPage(e);return i.isNone(t)?null:t.nodes[f(e,this.nodesPerPage)]},e.prototype.addNode=function(e,t){null!=e.children&&this.populateChildren(t,e.children);var r=this.getParent(t),n=r?r.level+1:1;this._maxLevel=Math.max(this._maxLevel,n);var o=g(e.lodSelection),a=o.lodMetric,l=o.maxError,u=i.expect(this.getNodeInternal(t));return u.node={id:e.id,index:t,mbs:s.vec4f64.fromArray(e.mbs),obb:e.obb&&d.clone(e.obb),childCount:u.childCount,level:n,resources:e.resources,version:e.version,lodMetric:a,maxError:l,memory:null,numFeatures:e.numFeatures,failed:!1,cacheState:0},null==u.ref.mbs&&(u.ref.mbs=e.mbs),u.node.renderMbs=u.ref.renderMbs,u.node.renderObb=u.ref.renderObb,u.node},e.prototype.makeRefNode=function(e,t){var r=this.nodePages[0],i=r.nodes.length;return r.nodes.push({childOffset:0,childCount:0,node:null,ref:e,visibilityCache:c(this._visibilityCacheGeneration)}),this.nodeCount++,r.parents.push(t),e.renderMbs=s.vec4f64.fromArray([0,0,0,-1]),e.renderObb=d.create([0,0,0],[-1,-1,-1],[0,0,0,1]),i},e.prototype.populateChildren=function(e,t){var r=i.expect(this.getNodeInternal(e)),n=i.expect(this.getPage(e));r.childOffset=n.children.length,r.childCount=t.length;for(var o=0;o<t.length;o++){var a=this.makeRefNode(t[o],e);n.children.push(a)}},e.prototype.getNode=function(e){var t=this.getNodeInternal(e);return i.isSome(t)&&t.node},e.prototype.getIndexById=function(e){var t;return this.forAllNodes(function(r,i){(r.node?r.node.id:r.ref.id)===e&&(t=i)}),t},e.prototype.getNodeById=function(e){var t=this.getIndexById(e),r=null!=t?this.getNodeInternal(t):null;return i.isSome(r)?r.node:null},e.prototype.getChildIndex=function(e,t){var r=this.getPage(e.index);if(i.isNone(r))return-1;var n=r.nodes[f(e.index,this.nodesPerPage)];return r.children[n.childOffset+t]},e.prototype.getParentIndex=function(e){var t=this.getPage(e);return i.isSome(t)?t.parents[f(e,this.nodesPerPage)]:-1},e.prototype.getParent=function(e){return(e=this.getParentIndex(e))>=0?this.getNode(e):null},Object.defineProperty(e.prototype,"rootNode",{get:function(){var e=this.getNodeInternal(this.rootIndex);return i.isSome(e)?e.node:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0}),e.prototype.invalidateVisibilityCache=function(e){if(null!=e){var t=this.getNodeInternal(e);i.isSome(t)&&(t.visibilityCache=c(this._visibilityCacheGeneration))}else this._visibilityCacheGeneration=h(this._visibilityCacheGeneration)},e.prototype.isNodeVisible=function(e){var t=this.getNodeInternal(e);if(i.isNone(t)||t.ref&&!t.ref.mbs)return!0;if(!function(e,t){return(-2&e)===t}(t.visibilityCache,this._visibilityCacheGeneration)){var r=this.viewportQueries.isNodeVisible(t.ref||t.node);return t.visibilityCache=function(e,t){return t+(e?1:0)}(r,this._visibilityCacheGeneration),r}return function(e){return 1==(1&e)}(t.visibilityCache)},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;var t=this.getNodeInternal(e);return!!i.isNone(t)||!(t.node&&t.ref&&!t.ref.obb)||this.viewportQueries.isGeometryVisible(t.node)},Object.defineProperty(e.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._updates.add.prune(),this._updates.update.prune()},e.prototype.requestUpdate=function(){this._dirty=!0,this._indexMissing=1,++this._version},e.prototype.update=function(e,t){var r=this;if(this._dirty){this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e,this._missing),v.clear();var n=!0,o=new x,a=new x;this.traverseVisible(function(s,l){if(!l){var d=r.entryPriority(s),u=p(s,r.nodesPerPage);return v.set(u,Math.max(d,v.get(u)||0)),r._loading.has(u)||r._failedPages.has(u)||r._missing.push(u),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,d))}var c=l.node;if(r._updateNodeFeatureEstimate(c,a),!c){var h=r.entryPriority(s);return r._loading.has(s)||r._failedNodes.has(s)||(r._missing.push(s),v.set(s,h)),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,h))}var f=i.expect(r.getPage(s));if(0===r._missing.length&&0===r.nodesPerPage)for(var g=0;g<l.childCount;g++){var y=f.children[l.childOffset+g],m=r.getNodeInternal(y);!i.isSome(m)||m.node||r._loading.has(y)||r._failedNodes.has(y)||(v.set(y,r.entryPriority(y)),r._prefetch.push(y))}if(!c.failed&&c.resources.hasFeatureData)if(r._isLoaded(s)){if(o.known+=c.memory,++o.knownNodes,r._isSelected(c)?l.childCount>0&&(n=!1):(o.unremoved+=c.memory,n=!1),r._needsUpdate(c)){var _=r.entryPriority(s);v.set(s,_),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,_),r._updates.update.push(s)}}else if(c.memory&&(o.known+=c.memory,++o.knownNodes),r._isSelected(c)){if(l.childCount>0&&(n=!1),c.memory?(o.missing+=c.memory,o.known+=c.memory,++o.knownNodes):++o.missingNodes,e.indexOf(c.index)>=0)return r._maxProcessingPrio=Math.max(r._maxProcessingPrio,r.entryPriority(s)),void(r._updates.cancel=r._updates.cancel.filter(function(e){return e!==c.index}));if(!t.done&&r._enable(c))return void t.madeProgress();var b=r.entryPriority(s);v.set(s,b),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,b),r._updates.add.push(s)}}),this._unloadedMemoryEstimate=o.missing-o.unremoved,o.knownNodes>3&&o.missingNodes>0&&(this._unloadedMemoryEstimate+=o.known/o.knownNodes*o.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(a),this._featureEstimate.leafsReached=n,this._missing.sort(function(e,t){return e-t}),this._missing.filterInPlace(function(e,t){return t<1||r._missing.data[t-1]!==e}),this._missing.sort(function(e,t){return v.get(e)-v.get(t)}),this._missing.length>0?(this._maxUnloadedPrio=v.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(e,t){return v.get(e)-v.get(t)}),this._updates.add.filterInPlace(function(e){return v.get(e)>=r._maxUnloadedPrio}).sort(function(e,t){return v.get(e)-v.get(t)}),this._updates.update.sort(function(e,t){return v.get(e)-v.get(t)}),this._indexMissing=this._loading.size+this._missing.length,this._dirty=this._indexMissing>0,v.clear()}},e.prototype.checkFeatureTarget=function(e,t){for(var r=this.viewportQueries.updateScreenSpaceErrorBias(t),i=t,n=t,o=r,a=10;a--;){var s=new x;if(this._updateFeatureEstimate(i,s),this._computeFeatureEstimate(s)<=e){if(i>=t||s.missingNodes>0||0===a)break;o=i,i=.5*(i+n)}else n=i,i=.5*(i+o)}return++this._version,this.viewportQueries.updateScreenSpaceErrorBias(r),Math.min(t,i)},e.prototype._updateFeatureEstimate=function(e,t){var r=this;++this._version,this.viewportQueries.updateScreenSpaceErrorBias(e),this.traverseVisible(function(e,i){return r._updateNodeFeatureEstimate(i&&i.node,t)})},e.prototype._updateNodeFeatureEstimate=function(e,t){if(e&&!e.failed&&null!=e.numFeatures)return this._isLoaded(e.index)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype._computeFeatureEstimate=function(e){var t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)},e.prototype.load=function(){return this._load(this._missing)},e.prototype.prefetch=function(){return this._load(this._prefetch)},e.prototype._load=function(e){if(0===e.length||!this._canRequest())return!1;for(;e.length>0&&this._canRequest();)0===this.nodesPerPage?this._loadNode(e.pop()):this.loadPage(e.pop());return!0},e.prototype.isLoading=function(){return this._indexMissing>0},e.prototype.getIndexLoading=function(){return this._loading.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.index];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),i=this.viewportQueries.hasLOD(e),n=!0;if(i){var o=this.getParentIndex(e.index);if(o>=0){var a=this._nodeTraversalState[o];n=a&&r>a.lodLevel}else n=r>0}else n=0===e.childCount;return t?(t.lodLevel=r,t.isChosen=n,t.version=this._version,t):(this._nodeTraversalState[e.index]={nodeHasLOD:i,lodLevel:r,isChosen:n,version:this._version},this._nodeTraversalState[e.index])},e.prototype._loadNode=function(e){var t=this;this._loading.add(e);var r=i.expect(this.getNodeInternal(e)).ref.id,n=this.layerUrl+"/nodes/"+r,a=function(){t._loading.delete(e),0===t._missing.length&&0===t._loading.size&&t.requestUpdate()};this.streamDataController.request(n,"json").then(function(i){var n=t._validateNode(r,i);if(null!=n){n.obb&&t.invalidateVisibilityCache(e);var o=t.addNode(n,e);t.nodeTraversalState(o),a()}else a()},function(r){o.isAbortError(r)||(t.logger.error("Error loading node: "+n),t._failedNodes.add(e)),a()})},e.prototype._validateNode=function(e,t){var r=this;if(null==t||"object"!=typeof t||t.id!==e)return this.logger.error('Invalid node. Wrong type or wrong id "'+e+'"'),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+e+'"'),null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+e+'"'),null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some(function(e,t){return e.href!=="./attributes/f_"+t+"/0"})||this.logger.warn('Invalid attribute data on node "'+e+'"'),t.featureData&&t.featureData.length>1&&this.logger.warn("Node "+e+" has "+t.featureData.length+" bundles. Only the first bundle will be loaded.");var i=t.hasOwnProperty("obb")&&!this.ignoreServiceOBB?t.obb:null,n=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null,o=Array.isArray(t.children)?t.children.map(function(t){if(null==t)return null;var i=function(t){return r.logger.error("Invalid node reference on node "+e+": "+t)};if("number"==typeof t.id)i("id "+t.id+" is a number instead of a string.");else if("string"!=typeof t.id||!Array.isArray(t.mbs))return i("Missing or invalid id."),null;if(!Array.isArray(t.mbs))return i("Invalid bounding volume on reference "+t.id+"."),null;t.href&&t.href!=="../"+t.id&&r.logger.error('Invalid node href on node "'+e+'"');var n=t.hasOwnProperty("obb")&&!r.ignoreServiceOBB?t.obb:null;return{id:""+t.id,mbs:t.mbs,obb:n}}).filter(function(e){return null!=e}):null;return{id:e,mbs:t.mbs,obb:i,children:o,resources:{hasFeatureData:t.featureData&&t.featureData.length>0,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?e:null,texture:t.textureData&&t.textureData.length>0?e:null,geometry:null!=t.geometryData?e:null},version:"string"==typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:n}},e.prototype.resetFailedNodes=function(){this._failedNodes.clear(),this._failedPages.clear(),this.forAllNodes(function(e){e.node&&(e.node.failed=!1)})},e.prototype.entryPriority=function(e){var t=this.getNodeInternal(e),r=this.getParentIndex(e);if(i.isNone(t)||r<0&&null==t.node)return r<0?1/0:this.entryPriority(r);var n=0;if(t.node&&r>=0){var o=this._nodeTraversalState[r];null!=o&&(n=o.lodLevel)}for(var a=this.progressiveLoadPenalty,s=e;s>=0;s=this.getParentIndex(s))if(this._isLoaded(s)){a=0;break}var l=this.viewportQueries.distToPOI(t.ref||t.node);return-l-n*(l+this.progressiveLoadPenalty)+a},e.prototype.traverseVisible=function(e){var t=this.getNodeInternal(this.rootIndex);i.isSome(t)?this._traverse(this.rootIndex,t,e):e(this.rootIndex,null)},e.prototype._traverse=function(e,t,r){if(t.node&&0===t.childCount)this.isGeometryVisible(e)&&r(e,t);else if(this.isNodeVisible(e)&&(r(e,t),null!=t.node)){var n=this.nodeTraversalState(t.node);if(!n.nodeHasLOD||n.lodLevel!==this._maxLodLevel)for(var o=i.expect(this.getPage(e)),a=0;a<t.childCount;a++){var s=o.children[t.childOffset+a],l=this.getNodeInternal(s);i.isSome(l)?this._traverse(s,l,r):r(s,null)}}},e.prototype.traverse=function(e,t){t(e)&&this.traverseChildren(e,t)},e.prototype.traverseChildren=function(e,t){var r=e.index,n=this.getNodeInternal(r);i.isSome(n)&&this._traverseChildren(r,n,t)},e.prototype._traverseChildren=function(e,t,r){var n=this.getPage(e);if(!i.isNone(n))for(var o=0;o<t.childCount;++o){var a=n.children[t.childOffset+o],s=this.getNodeInternal(a);i.isSome(s)&&s.node&&r(s.node)&&this._traverseChildren(a,s,r)}},e.prototype.updateStats=function(e){if(this._updates.add.length>0&&(e.nodes+=" + "+this._updates.add.length),(this._indexMissing||this._prefetch.length>0)&&(e.index+=" + "+this._indexMissing||!1),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)},e.prototype.updateElevationInfo=function(e){this.forAllNodes(u),this.viewportQueries.updateElevationInfo(e)},e.prototype.invalidateBoundingVolumeCache=function(e){var t=this.getNodeInternal(e);i.isSome(t)&&u(t)},e.prototype.forAllNodes=function(e){for(var t=0;t<this.nodePages.length;t++){var r=this.nodePages[t];if(r)for(var i=t*this.nodesPerPage,n=0;n<r.nodes.length;n++)e(r.nodes[n],i+n)}},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{addNode:function(t,r){return e.addNode(t,r)}}},enumerable:!0,configurable:!0}),e}();t.I3SIndex=m;var v=new Map,_=function(){function e(){this.update=new n({deallocator:null}),this.add=new n({deallocator:null}),this.cancel=[]}return e.prototype.reset=function(e,t){this.add.clear(),this.update.clear(),this.cancel=e,this.missing=t},e}(),b=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];t.selectErrorMetric=g;var x=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}()}.apply(null,i))||(e.exports=n)},1753:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(75)],void 0===(n=function(e,t,r){var i=function(){function e(e){this.layerView=e,this._lodGlobalDirty=!1}return e.prototype.startNodeLoading=function(e,t,r,i,n,o,a){this._maxLodLevel=a.maxLodLevel,this._index=o,this._nodeTraversalState=i,this._isNodeVisible=e,this._isGeometryVisible=t,this._isNodeInScaleBounds=r,this._removeNodes=n},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!this.isChosenMaxLOD(t)||!!t.isChosen&&this._childrenRequireLoading(e)},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(e){if(!this.requiresLODGlobalHandling)return!1;var t=this.layerView.view.resourceController.memoryController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));n.clear(),this._lodGlobalHandlingRecursion(this._index.rootNode,r);var i=n.length;this._removeNodes(n,e);var o=n.length<i;return 0===n.length&&(this._lodGlobalDirty=!1),n.clear(),o},e.prototype._lodGlobalHandlingRecursion=function(e,t){if(null==e)return!1;var r=this._nodeTraversalState(e),i=this.isChosenMaxLOD(r),o=this.layerView.isNodeLoaded(e.index);if(o&&null!=this.layerView.updateNodeStatus&&this.layerView.updateNodeStatus(e.index,i?"leaf":"hole"),i&&o)return this._removeChildrenRecursive(e),!0;var a=!1;if(e.childCount>0){a=!0;for(var s=0;s<e.childCount;s++){var l=this._index.getChildIndex(e,s),d=this._index.getNode(l);d?this._isGeometryVisible(l)&&!this._lodGlobalHandlingRecursion(d,t)&&this._isNodeInScaleBounds(d)&&(a=!1):this._isNodeVisible(l)&&(a=!1)}}o&&!i&&(a||n.length<t)&&(n.push(e.index),o=!1);var u=!e.resources.hasFeatureData;return a||o||u},e.prototype._removeChildrenRecursive=function(e){this._index.traverseChildren(e,function(e){return n.push(e.index),!0})},e.prototype.childrenEmpty=function(e){var t=this,r=!0;return this._index.traverseChildren(e,function(e){return!(!r||!t._isNodeVisible(e.index)||t.layerView.isNodeLoaded(e.index)&&(r=!1,1))}),r},e.prototype._childrenRequireLoading=function(e){var t=this,r=!1,i=!0;return this._index.traverseChildren(e,function(e){if(!i||!t._isNodeVisible(e.index))return!1;var n=t._nodeTraversalState(e);return t.isChosenMaxLOD(n)&&t._isGeometryVisible(e.index)&&(r=!0),!t.layerView.isNodeLoaded(e.index)||(i=!1,!1)}),i&&r},e.prototype.isChosenMaxLOD=function(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)},e}(),n=new r({deallocator:null});return i}.apply(null,i))||(e.exports=n)},1754:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(11),r(18),r(15),r(7),r(31),r(1735),r(1678),r(1755),r(1641)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c){function h(e,t){if(!e||!t||!t.materialDefinitions)return e;var r=Object.keys(t.materialDefinitions)[0];return!t.materialDefinitions[r].params.vertexRegions&&e.vertexAttributes.region&&delete(e=o.clone(e)).vertexAttributes.region,e}function p(e,t){var r={bufferDefinition:null,bufferIndex:0};if(null==e||t.resources.geometryDefinition<0)return r;var i=t.resources.geometryDefinition>=0?e[t.resources.geometryDefinition].geometryBuffers:null;if(null==i)return r;for(var o=0;o<i.length;o++)if(null==i[o].compressedAttributes)r.bufferIndex=o,r.bufferDefinition=i[o];else if("draco"===i[o].compressedAttributes.encoding&&l.isSupported()&&!n("disable-feature:i3s-draco"))return r.bufferIndex=o,r.bufferDefinition=i[o],r;return r}function f(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];y[n]&&(t[y[n]]={valueType:null})}return{header:null,byteOffset:0,byteCount:0,vertexAttributes:t}}var g=function(){function e(e,t,r,i,n,o){if(this.streamDataController=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=n,this.options=o,this.layerUrl=e.parsedUrl.path,this.geometryDefinitions=e.geometryDefinitions,e.materialDefinitions){var a=e.textureSetDefinitions;this.materialAndTextures=e.materialDefinitions.map(function(e){return u.getMaterialAndTextures(a,e)})}}return e.prototype.load=function(e,t,r){return this.streamDataController.request(e,t,{signal:r})},e.prototype.loadAttribute=function(e,t,r){var i=this.layerUrl+"/nodes/"+e.resources.attributes+"/attributes/"+t.key+"/0";return this.load(i,"binary",r).then(function(e){return d.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var i=this;return a.eachAlways(t.map(function(t){return i.loadAttribute(e,t.attributeStorageInfo,r)})).then(function(r){for(var n={},o=0;o<t.length;++o)r[o].value?n[t[o].name]=r[o].value:a.isAbortError(r[o].error)||i.logger.error("Failed to load attributeData for '"+t[o].name+"' on node '"+e.id+"'");return n})},e.prototype.loadNodeData=function(e,t){return i(this,void 0,void 0,function(){var i,n,o,s,l,c,g,y,m,v,_,b,x,w,S,C,I,D,P,O,M;return r(this,function(r){switch(r.label){case 0:return i=null!=this.requiredAttributes&&e.resources.attributes?this.loadAttributes(e,this.requiredAttributes,t):a.resolve({}),n=p(this.geometryDefinitions,e),o=n.bufferDefinition,s=n.bufferIndex,l=e.resources.geometry?this.loadGeometry(e,s,t):null,e.resources.hasSharedResource?[4,this.loadShared(e,t)]:[3,2];case 1:return g=r.sent(),[3,3];case 2:g=null,r.label=3;case 3:return c=g,y=this.materialAndTextures&&e.resources.materialDefinition>=0?this.materialAndTextures[e.resources.materialDefinition]:null!=c?u.getMaterialAndTexturesFromShared(c):null,m=y&&y.material,v=y&&y.textures,this.options.loadFeatureData?[4,this.loadFeatureData(e,t)]:[3,5];case 4:return b=r.sent(),[3,6];case 5:b=null,r.label=6;case 6:return _=b,x=this.options.loadFeatureData?this.collectGeometries(_):this.meshPyramidGeometryData(e,m),w=null!=v&&v.length>0?this.loadTextures(e,v,t):null,S=null,C=null,l?[4,l]:[3,8];case 7:S=r.sent(),I=h(this.defaultGeometrySchema,c),D=!(!o||!o.compressedAttributes||"draco"!==o.compressedAttributes.encoding),C=D?f(o.compressedAttributes.attributes):o?d.createGeometryIndexFromDefinition(o,e.vertexCount,e.numFeatures):d.createGeometryIndexFromSchema(S,I),r.label=8;case 8:return[4,w];case 9:return P=r.sent(),[4,i];case 10:return O=r.sent(),M=O?{attributeData:O,loadedAttributes:this.requiredAttributes}:null,[2,{allGeometryData:x,attributeDataInfo:M,geometryBuffer:S,geometryIndex:C,requiredTextures:v,textureData:P}]}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var i=0,n=Object.keys(r);i<n.length;i++)for(var o=0,a=r[n[i]].images;o<a.length;o++){var l=a[o];Array.isArray(l.href)?l.hrefConcat=l.href.map(function(e){return s.makeAbsolute(e,t)}):l.hrefConcat=s.makeAbsolute(l.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var i=t[r];if(Array.isArray(i.encoding))for(var n=0;n<i.encoding.length;n++){var o;"data:"===(o=i.encoding[n]).substring(0,5)&&(i.encoding[n]=o.substring(5))}else"data:"===(o=i.encoding).substring(0,5)&&(i.encoding=o.substring(5))}},e.prototype.loadShared=function(t,r){var i=this.layerUrl+"/nodes/"+t.resources.geometry+"/shared";return this.load(i,"json",r).then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,i),t})},e.prototype.loadTexture=function(e,t,r,i,n,o){return n===c.DDS_ENCODING_STRING?this.load(e,"binary",o).then(function(e){return{id:t,usage:r,data:e,encoding:n}}):this.load(e,"image",o).then(function(e){var o=e;if(i&&e.width*e.height>=4096){var a=Math.ceil(e.width/2),s=Math.ceil(e.height/2),l=document.createElement("canvas");l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),o=l}return{id:t,usage:r,data:o,encoding:n}})},e.prototype.loadTextures=function(t,r,i){var n=this,o=this.options.textureFormat===e.TextureFormat.Compressed,s=this.options.textureFormat===e.TextureFormat.Downsampled,l=this.options.textureUsageMask;return a.all(r.map(function(e){if(0==(e.usage&l))return null;var r=c.selectEncoding(e.encodings,o);if(null==r)return n.logger.error("No known encoding for texture found on node "+t.id),a.reject();var d=t.resources.texture||t.id,u=n.layerUrl+"/nodes/"+d+"/textures/"+r.name;return n.loadTexture(u,e.id,e.usage,s,r.encoding,i)}))},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:t}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e){for(var t=new Array,r=0,i=e.featureData;r<i.length;r++){var n=i[r],o=n.geometries;if(null!=o)for(var a=0,s=o;a<s.length;a++){var l=s[a];t.push({featureIds:[n.id],featureDataPosition:n.position,geometries:[l]})}else null!=n.position&&t.push({featureIds:[n.id],featureDataPosition:n.position,geometries:null})}return t},e.prototype.loadFeatureData=function(e,t){var r=this.layerUrl+"/nodes/"+e.id+"/features/0";return this.load(r,"json",t)},e.prototype.loadGeometry=function(e,t,r){var i=this.layerUrl+"/nodes/"+e.resources.geometry+"/geometries/"+t;return this.load(i,"binary",r)},e}(),y={position:"position",normal:"normal",uv0:"uv0",uv1:"uv1",color:"color","uv-region":"region"};return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(g||(g={})),g}.apply(null,i))||(e.exports=n)},1755:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(9),r(50)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getMaterialAndTextures=function(e,t){var r=new Map,a=function(e,t){if(i.isNone(e))return-1;if(r.has(e.id)){var n=r.get(e.id);return n.usage|=t,n.id}var o=r.size;return r.set(e.id,{id:o,usage:t}),o},s=t.pbrMetallicRoughness,l=s&&s.baseColorFactor,d=t.emissiveFactor,u=null==t.normalTexture&&null==t.emissiveTexture&&null==t.occlusionTexture&&(!s||null==s.metallicRoughnessTexture&&1===s.roughnessFactor&&(1===s.metallicFactor||0===s.metallicFactor)),c=u?n.defaultPBRMaterialParameters.metallicFactor:s?s.metallicFactor:1,h=u?n.defaultPBRMaterialParameters.roughnessFactor:s?s.roughnessFactor:1,p={baseColorFactor:l?[l[0],l[1],l[2],l[3]]:[1,1,1,1],baseColorTextureId:a(s&&s.baseColorTexture,1),metallicRoughnessTextureId:a(s&&s.metallicRoughnessTexture,2),metallicFactor:c,roughnessFactor:h},f={alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,cullFace:t.cullFace,normalTextureId:a(t.normalTexture,4),emissiveTextureId:a(t.emissiveTexture,16),occlusionTextureId:a(t.occlusionTexture,8),emissiveFactor:d?[d[0],d[1],d[2]]:[0,0,0],metallicRoughness:p,wrapTextures:!1,isSchematic:u},g=[];return r.forEach(function(t,r){var n=t.usage,a=i.isSome(e)&&e[r]&&e[r].formats,s=a?a.map(function(e){var t=e.name,r=e.format;return{name:t,encoding:o[r]}}):[];g.push({id:r,usage:n,encodings:s})}),{material:f,textures:g}};var o={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};t.getMaterialAndTexturesFromShared=function(e){var t=e&&e.materialDefinitions?Object.keys(e.materialDefinitions)[0]:null,i=e&&e.textureDefinitions?Object.keys(e.textureDefinitions)[0]:null,n=t&&e.materialDefinitions[t],o=i&&e.textureDefinitions[i],s=a();if(null!=n){var l=n.params;l.diffuse&&(s.metallicRoughness.baseColorFactor=[l.diffuse[0],l.diffuse[1],l.diffuse[2],1]),null!=l.doubleSided&&(s.doubleSided=l.doubleSided,s.cullFace=l.doubleSided?"none":"back"),"none"!==l.cullFace&&"front"!==l.cullFace&&"back"!==l.cullFace||(s.cullFace=l.cullFace),l.transparency&&(s.metallicRoughness.baseColorFactor[3]=r.clamp(1-l.transparency,0,1)),(l.useVertexColorAlpha||s.metallicRoughness.baseColorFactor[3]<1)&&(s.alphaMode="blend")}var d=[];if(null!=o){!o.wrap||"repeat"!==o.wrap[0]&&"repeat"!==o.wrap[1]||(s.wrapTextures=!0),"rgba"===o.channels&&(s.alphaMode="blend");var u=o.images.length-1,c=o.images[u],h=function(e){return e&&e.split("/").pop()},p=Array.isArray(o.encoding)?o.encoding.map(function(e,t){return{name:h(c.href[t]),encoding:e}}):[{name:h(c.href),encoding:o.encoding}];d.push({id:0,usage:1,encodings:p}),s.metallicRoughness.baseColorTextureId=0}return{material:s,textures:d}};var a=function(){return{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:"none",normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0}}}.apply(null,i))||(e.exports=n)},1756:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(7)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.requester=e,this.activeRequests=new Set}return Object.defineProperty(e.prototype,"busy",{get:function(){return this.requester.busy},enumerable:!0,configurable:!0}),e.prototype.request=function(e,t,n){var o=this,a=i.createAbortController();i.onAbortOrThrow(n,function(){return a.abort()}),n=r({},n,{signal:a.signal});var s=this.requester.request(e,t,n),l={response:s,abortController:a};return this.activeRequests.add(l),i.always(s,function(){return o.activeRequests.delete(l)}),s},e.prototype.cancelAll=function(){this.activeRequests.forEach(function(e){return e.abortController.abort()}),this.activeRequests.clear()},e}();t.I3SStreamDataController=n,t.default=n}.apply(null,i))||(e.exports=n)},1757:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8),r(5),r(60),r(35),r(103),r(424),r(192),r(93),r(1641),r(30),r(1655),r(41)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h,p){return function(){function e(e,t,r,n,o,s,l){void 0===l&&(l={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=n,this.elevationProvider=o,this.options=l,this.fp=c.frustum.create(),this._poi=i.vec3f64.create(),this.minDistance=1/0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=i.vec3f64.create(),this._tmp2=i.vec3f64.create(),this._tmp3=i.vec3f64.create(),this._tmp0=i.vec3f64.create(),this.screenspaceErrorBias=l.screenspaceErrorBias||1,this.progressiveLoadFactor=l.progressiveLoadFactor||1,this.updateCamera(r),this.engineSR=this._renderCoordsHelper.spatialReference,this.updateElevationInfo(s.elevationInfo),this.tmpPoint=a.makeDehydratedPoint(0,0,0,e)}return e.prototype.updateElevationInfo=function(e){null!=e?(this._elevationContext=new s,this._elevationContext.featureExpressionInfoContext=l.createContext(l.extractExpressionInfo(e,!1)),this._elevationContext.mixinApi(e)):this._elevationContext=null},e.prototype.updateCamera=function(e){c.frustum.fromMatrix(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/(e.perScreenPixelRatio/2),this._camPos=e.eye,this.minDistance=1/0,this.maxDistance=0},e.prototype.setPointOfInterest=function(e){r.vec3.copy(this._poi,e)},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.updateExtent=function(e){this.extent=e},e.prototype.getRenderMbs=function(e){var t=e.renderMbs;return t||(t=o.vec4f64.fromValues(e.mbs[0],e.mbs[1],e.mbs[2],-1),e.renderMbs=t),t[3]<0&&(n.vec4.copy(t,e.mbs),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=d.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),p.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.getRenderObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)&&e.renderObb){var t=e.renderObb;if(t.halfSize[0]<0){var r=0;this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],r=d.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)-e.obb.center[2]),u.transformObb(e.obb,this.indexSR,t,this.engineSR,r)}return t}},e.prototype.isNodeVisible=function(e){var t=this.getRenderMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.obb){var r=this.getRenderObb(e);return h.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isGeometryVisible=function(e){var t=this.getRenderObb(e);return!t||h.isVisible(t,this.fp)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==u.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){return c.frustum.intersectsSphere(this.fp.planes,c.sphere.wrap(e[3],e))},e.prototype.screenSpaceDiameterMbs=function(e,t){var i=this.getRenderMbs(e),n=Math.sqrt(r.vec3.squaredDistance(i,this._camPos)),o=n-i[3];return this._updateMinMaxDistance(n),o<0?.5*Number.MAX_VALUE:t/o*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){return this.calcCameraDistanceToCenter(e)-this.getRenderMbs(e)[3]},e.prototype.calcCameraDistanceToCenter=function(e){var t=this.getRenderMbs(e),i=r.vec3.distance(t,this._camPos);return this._updateMinMaxDistance(i),i},e.prototype.calcAngleDependentLoD=function(e){var t=this.getRenderMbs(e),i=t[3],n=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/r.vec3.length(t)+i)/r.vec3.distance(t,this._camPos);return Math.min(1,n)},e.prototype.hasLOD=function(e){return 0!==e.lodMetric},e.prototype.getDistancePlanarMode=function(e,t){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=r*r+i*i,a=t[3];if(o<=a*a)return Math.abs(n);var s=Math.sqrt(o)-a;return Math.sqrt(n*n+s*s)},e.prototype.getDistanceGlobeMode=function(e,t){var i=r.vec3.length(t),n=r.vec3.length(e)-i;r.vec3.scale(this._tmp0,e,r.vec3.dot(e,t)/r.vec3.squaredLength(e));var o=r.vec3.squaredDistance(t,this._tmp0),a=t[3];if(o<=a*a)return Math.abs(n);var s=r.vec3.scale(this._tmp0,t,1/i),l=i,d=a*a/2/l,u=r.vec3.scale(this._tmp1,s,l-d),c=e,h=r.vec3.subtract(this._tmp2,c,u),p=r.vec3.subtract(this._tmp2,h,r.vec3.scale(this._tmp3,s,r.vec3.dot(s,h))),f=r.vec3.add(this._tmp2,u,r.vec3.scale(this._tmp2,p,a/r.vec3.length(p))),g=r.vec3.distance(c,f);if(n>=2e5){var y=r.vec3.subtract(this._tmp1,c,f),m=r.vec3.dot(y,s)/r.vec3.length(y);m<.08&&(m=1e-4),g/=m}return g},e.prototype.getDistance=function(e,t){return this.engineSR===p.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t):this.getDistancePlanarMode(e,t)},e.prototype._updateMinMaxDistance=function(e){e>0?(this.minDistance=Math.min(this.minDistance,e),this.maxDistance=Math.max(this.maxDistance,e)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-e))},e.prototype.getLodLevel=function(e){if(0===e.lodMetric||!e.resources.hasFeatureData)return 0;if(0===e.childCount)return this.maxLodLevel;if(this.progressiveLoadFactor<1){var t=this.progressiveLoadFactor*this.screenspaceErrorBias,r=this.screenspaceErrorBias;return this.evaluateLODmetric(e,t)?this.evaluateLODmetric(e,r)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t){switch(e.lodMetric){case 2:var r=this.getRenderMbs(e),i=this.getDistance(this._camPos,r),n=2*i/this._screenSizeFactor,o=i+r[3];return this._updateMinMaxDistance(o),e.maxError*t<=n;case 1:var a=this.screenSpaceDiameterMbs(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(a*=this.calcAngleDependentLoD(e)),a<e.maxError;case 3:return this.screenSpaceDiameterMbs(e,e.maxError)*t<10;case 4:return this.calcCameraDistance(e)>e.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.getRenderMbs(e);return r.vec3.distance(t,this._poi)-t[3]},e.prototype.distCameraToPOI=function(){return r.vec3.distance(this._camPos,this._poi)},e}()}.apply(null,i))||(e.exports=n)},1758:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isUniformComponentData=function(e){return!("textureBuffer"in e)},t.fillDefaults=function(e){return r({baseColor:i,baseColorOpacity:1,baseColorTexture:null,doubleSidedShading:!1,normals:"screen-space",cullFace:"back",componentData:n,useVertexTransparencyDiscards:!1,receiveSSAO:!0,forceTransparency:null,slicePlaneEnabled:!1,polygonOffsetEnabled:!1,writeStencil:!1,readStencil:!1,layerOpacity:1,usePBR:!1,normalTexture:null,emissiveTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveFactor:[0,0,0],metallicFactor:0,roughnessFactor:1,reflectanceFactor:.5},e)};var i=[1,1,1],n={externalColor:[1,1,1,1],externalColorMixMode:"multiply",castShadows:!0}}.apply(null,i))||(e.exports=n)},1759:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(78)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createVertexBufferLayout=function(e){var t=r.newLayout().vec3f("position");return"compressed"===e.normals?t.vec2i16("normalCompressed",{glNormalized:!0}):"default"===e.normals&&t.vec3f("normal"),e.textureCoordinates&&t.vec2f("uv0"),e.textureCoordinateRegions&&t.vec4u16("region",{glNormalized:!0}),e.colors&&t.vec4u8("color"),e.componentData&&t.u16("componentIndex"),t.alignTo(4)}}.apply(null,i))||(e.exports=n)},1760:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0),r(635),r(1641)],void 0===(n=function(e,t,r,i,n,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=n.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");t.DefinitionExpressionSceneLayerView=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._definitionExpressionErrors=0,t._maxDefinitionExpressionErrors=20,t.logError=function(e){t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&l.error("Error while evaluating definitionExpression: "+e),++t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&l.error("Further errors are ignored")},t}return r(t,e),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(!this.layer||!this.layer.definitionExpression)return null;try{var e=a.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!e.isStandardized)return l.error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return s.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(l.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return l.error("Failed to parse definitionExpression: "+e),null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0}),t.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}},t.prototype._addDefinitionExpressionToQuery=function(e){if(!this.parsedDefinitionExpression)return e;var t=this.layer.definitionExpression,r=e.clone();return r.where?r.where="("+t+") AND ("+r.where+")":r.where=t,r},i([o.property()],t.prototype,"layer",void 0),i([o.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],t.prototype,"parsedDefinitionExpression",null),i([o.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),i([o.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}(o.declared(e))}}.apply(null,i))||(e.exports=n)},1761:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var e=this,t=e.layer,i=e.layer.fields,n=e.requiredFields;return t.outFields?r.fixFields(i,r.unpackFieldNames(i,t.outFields).concat(n)):r.fixFields(i,n)}}}}}.apply(null,i))||(e.exports=n)},1762:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(14),r(79),r(9),r(7),r(0),r(117),r(1657)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h){Object.defineProperty(t,"__esModule",{value:!0}),t.PopupSceneLayerView=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validateFetchPopupFeatures=function(e){var t=this.layer;return t.popupEnabled?h.getFetchPopupTemplate(t,e)?void 0:new a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.prepareFetchPopupFeatures=function(e){return o(this,void 0,void 0,function(){return n(this,function(e){return[2]})})},t.prototype.fetchPopupFeatures=function(e,t){return o(this,void 0,void 0,function(){var e,r,i,o,a,u,p,f,g,y,m;return n(this,function(n){switch(n.label){case 0:return(e=this._validateFetchPopupFeatures(t))?[2,d.reject(e)]:(r=l.isSome(t)?t.clientGraphics:null)&&0!==r.length?(i=[],o=[],u=c.unpackFieldNames,p=[this.layer.fields],[4,h.getRequiredFields(this.layer,h.getFetchPopupTemplate(this.layer,t))]):[2,d.resolve([])];case 1:return a=u.apply(void 0,p.concat([n.sent()])),[4,this.prepareFetchPopupFeatures(a)];case 2:for(n.sent(),f=new Set,g=0,y=r;g<y.length;g++)m=y[g],c.populateMissingFields(a,m,f)?o.push(m):i.push(m);return 0===o.length?[2,d.resolve(i)]:[2,this.whenGraphicAttributes(o,s.valuesOfSet(f)).catch(function(){return o}).then(function(e){return i.concat(e)})]}})})},i([u.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(u.declared(e))}}.apply(null,i))||(e.exports=n)},1780:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(2),r(1),r(10),r(11),r(23),r(97),r(58),r(29),r(18),r(79),r(6),r(13),r(9),r(7),r(407),r(52),r(121),r(71),r(25),r(405),r(0),r(19),r(8),r(5),r(45),r(1750),r(655),r(233),r(150),r(418),r(1598),r(84),r(1837),r(1838),r(1814),r(1641),r(1839),r(1681),r(438),r(1645),r(677),r(76),r(1655),r(41),r(107),r(86),r(420),r(124),r(669),r(148),r(20),r(681),r(1840),r.dj.m(e),r(105)],void 0===(n=function(e,t,i,n,o,a,s,l,d,u,c,h,p,f,g,y,m,v,_,b,x,w,S,C,I,D,P,O,M,N,E,F,T,R,L,V,A,j,G,B,U,q,k,H,Q,z,W,J,K,Y,X,Z,$,ee,te,re,ie){function ne(e){var t=e.metallicRoughness;return t&&t.baseColorTextureId>=0||t&&t.metallicRoughnessTextureId>=0||e.normalTextureId>=0||e.emissiveTextureId>=0||e.occlusionTextureId>=0}function oe(e){return y.isSome(e)&&b.isArrayBuffer(e.data)}function ae(e,t){for(var r=1024,i=0,n=e;i<n.length;i++){var o=n[i];r+=o.interleavedVertexData.byteLength+(o.indices?o.indices.byteLength:0),r+=o.positionData.data.byteLength+o.positionData.indices.byteLength}if(y.isSome(t))for(var a=0,s=t;a<s.length;a++){var l=s[a];y.isSome(l)&&b.isArrayBuffer(l.data)&&(r+=l.data.byteLength)}return r}function se(e,t){return t.byteSize>ce?(le.warn("Node is too big to store in IndexedDB cache: "+e.id+" ("+t.byteSize+" bytes)"),!1):t.byteSize>0}Object.defineProperty(t,"__esModule",{value:!0});var le=f.getLogger("esri.views.3d.layers.SceneLayerView3D"),de=[1,1,1,1],ue=function(){return function(){}}(),ce=104857600;t.I3SMeshView3D=function(t){return function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e._layerUid="",e._highlights=new V(e),e._elevationProvider=null,e._worker=new R,e._workerThread=null,e._nodeId2Meta=new Map,e._addTasks=new Map,e._rendererVersion=0,e._rendererFields=null,e._colorVariable=null,e._opacityVariable=null,e._symbolInfos=new Map,e._idbCache=new B.IDBCache("esri-scenelayer-cache","geometries"),e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.slicePlaneEnabled=!1,e._layerUrl="",e._cacheKeySuffix=null,e._tmpAttributeOnlyGraphic=new d(null,null,{}),e}return n(l,t),Object.defineProperty(l.prototype,"updatingMeshView3D",{get:function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rendererTextureUsage",{get:function(){return G.rendererNeedsTextures(this._currentRenderer)?31:12},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"elevationOffset",{get:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){var t=x.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=T.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"useCompressedTextures",{get:function(){var e=this.layer.version,t=!h("trident")||e.major>1||1===e.major&&e.minor>3;return this.view._stage.renderView.has("s3tc")&&t},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),l.prototype.initialize=function(){var t=this;if(S.open(v.getAbsMid("./SceneLayerWorker",e,ie)).then(function(e){t.destroyed?e.close():t._workerThread=e}),G.checkSceneLayerValid(this.layer),G.checkSceneLayerCompatibleWithView(this.layer,this.view),this._layerUid=this.layer.uid,this._layerUrl=this.layer.parsedUrl.path,this._controller=new M({layerView:this}),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var i=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(i&&i.faceRange&&i.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color),this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView()),this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(e){return t._deleteNodeStageData(e)}),this._addThisLayerToStage(),this._elevationProvider=new A({layerView:this,stageLayer:this._stageLayer}),this.updatingHandles.add(this,"view.clippingArea",function(){return t._clippingAreaChanged()},2),this.updatingHandles.add(this,"fullOpacity",function(e){return t._opacityChange(e)}),this.updatingHandles.add(this,"slicePlaneEnabled",function(e){return t._slicePlaneEnabledChange(e)}),this.updatingHandles.add(this,"elevationOffset",function(e,r){return t._reloadAll(r)}),this.updatingHandles.add(this,"filter",function(){return t._filterChange()},2),this.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(e){return t._enablePhysicalBasedRendering(e)});var n=function(){t._reloadAll(),t._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",n),this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",n),this.updatingHandles.add(this,"suspended",function(e){return t._suspendedChange(e)},2),this.handles.add(w.init(Q,"I3S_TREE_SHOW_TILES",function(e){if(e&&!t._treeDebugger){var i=t._controller.crsIndex;new Promise(function(e,t){r.e(34).then(function(){var t=[r(1847)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(e){var r=e.I3STreeDebugger;!t._treeDebugger&&Q.I3S_TREE_SHOW_TILES&&(t._treeDebugger=new r({lv:t,view:t.view,nodeSR:i}))})}else e||!t._treeDebugger||Q.I3S_TREE_SHOW_TILES||(t._treeDebugger.destroy(),t._treeDebugger=null)})),this._cacheKeySuffix=G.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference),this._idbCache.init().catch(function(e){return le.warn("Failed to initialize IndexedDB cache: "+e)}),this._componentColorManager=this._hasSymbolColors?new te.BufferManager(this._stage.renderView.renderingContext):null},l.prototype.destroy=function(){this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._removeAllNodeDataFromStage(),this._memCache.destroy(),this._memCache=null,this._removeThisLayerFromStage(),this._stage=null,this._idbCache&&(this._idbCache.destroy(),this._idbCache=null),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),null!=this._controller&&(this._controller.destroy(),this._controller=null),this._highlights.destroy(),this._nodeId2Meta=null,this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},l.prototype.memEstimateTextureAdded=function(e){var t=e.getEstimatedTexMemRequired();return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t},l.prototype.memEstimateTextureRemoved=function(e){var t=e.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t},l.prototype.memEstimateGeometryAdded=function(e){var t=e.estimateGpuMemoryUsage();return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t},l.prototype.memEstimateGeometryRemoved=function(e){var t=e.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t},l.prototype.isNodeLoaded=function(e){return this._nodeId2Meta.has(e)},l.prototype.getUsedMemory=function(){var e=0;return this._nodeId2Meta.forEach(function(t){return e+=t.node.memory}),e},l.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0},l.prototype.ignoresMemoryFactor=function(){return!1},l.prototype._suspendedChange=function(e){e?(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._elevationContext,this._elevationProvider)},l.prototype.getStats=function(){var e={index:0,nodes:this._nodeId2Meta.size.toString(),"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};return this._controller&&(this._cachingEnabled()&&(e.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e},l.prototype._addThisLayerToStage=function(){var e=""+this.layer.uid,t=new Y(e,{},e);this._stageLayer=t,this._stage.add(0,t),this._stage.addToViewContent([t.id])},l.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var e=this._stage;this._removeAllNodeDataFromStage(),ee.verify(0===this._nodeId2Meta.size),e.remove(0,this._stageLayer.id),this._stageLayer=void 0,this.gpuMemoryEstimate=0}},l.prototype.getLoadedAttributes=function(e){var t=this._nodeId2Meta.get(e);if(t&&t.attributeInfo)return t.attributeInfo.loadedAttributes},l.prototype.getAttributeData=function(e){var t=this._nodeId2Meta.get(e);if(t&&t.attributeInfo)return t.attributeInfo.attributeData},l.prototype.setAttributeData=function(e,t){var r=this._nodeId2Meta.get(e);r&&(r.attributeInfo=t,r.cachedRendererVersion=this._getInvalidRendererVersion(),r.filteredIds=null,this._updateEngineObject(r))},l.prototype.getLoadedNodeIds=function(){var e=[];return this._nodeId2Meta.forEach(function(t){return e.push(t.node.id)}),e.sort()},l.prototype.getLoadedNodes=function(){var e=new Array;return this._nodeId2Meta.forEach(function(t){return e.push(t.node)}),e},l.prototype.getLoadedNodeIndices=function(e){this._nodeId2Meta.forEach(function(t,r){return e.push(r)})},l.prototype._calcEngineMaterialTransparencyParams=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),this._isIntegratedMesh)return{baseColorOpacity:1,layerOpacity:1,forceTransparency:!1};var i=this.fullOpacity,n=g.clamp(e.metallicRoughness.baseColorFactor[3],0,1);return{baseColorOpacity:n,layerOpacity:i,forceTransparency:n<1||i<1||!t&&"blend"===e.alphaMode||r}},l.prototype._getMaterialParameters=function(e,t,r){var n=e.metallicRoughness.baseColorFactor,o=this._isIntegratedMesh,a=this._calcEngineMaterialTransparencyParams(e),s=this.rendererTextureUsage,l=function(e){return 0!=(e&s)?function(e,t,r){if(y.isNone(e))return null;for(var i=0;i<e.length;i++){var n=e[i];if(y.isSome(n)&&0!=(n.usage&r))return t[i].id}return null}(t,r,e):null};return i({usePBR:!o&&(!e.isSchematic||this.view.qualitySettings.physicallyBasedRenderingEnabled),baseColor:[n[0],n[1],n[2]],metallicFactor:e.metallicRoughness.metallicFactor,roughnessFactor:e.metallicRoughness.roughnessFactor,emissiveFactor:e.emissiveFactor,reflectanceFactor:e.isSchematic?.2:.5,baseColorTexture:l(1),metallicRoughnessTexture:l(2),normalTexture:l(4),emissiveTexture:l(16),occlusionTexture:l(8),doubleSidedShading:e.doubleSided,cullFace:e.cullFace,writeStencil:o,receiveSSAO:!o,normals:o?"ground":"vertex"},a)},l.prototype._getGeometryParameters=function(e){return{textureCoordinates:e.hasTexture,textureCoordinateRegions:e.hasTexture&&e.hasRegions,colors:this._hasVertexColors,componentData:this._hasSymbolColors,normals:this._isIntegratedMesh?"none":e.hasNormals?"compressed":"screen-space"}},l.prototype._createTexture=function(e,t,r,i){if(y.isNone(r)||null==r.data)return null;var n,o=r.data,a=r.encoding,s=t.wrapTextures,l=1&r.usage?"opaque"===t.alphaMode?3:4:3,d=!0;if(a===G.DDS_ENCODING_STRING)n=$.DDS_ENCODING;else{var u=o;d=g.isPowerOfTwo(u.width)&&g.isPowerOfTwo(u.height)}var c=i,h=(c?this._enableAtlasMipMaps:this._enableMipMaps)&&d,p=c||!s,f=c&&h&&this._disableAtlasAnisotropy,m={mipmap:h,wrap:p?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:f,encoding:n,noUnpackFlip:!0,components:l},v=new $(o,e.id+"/"+r.id,m);return this._stage.add(4,v),e.memory+=this.memEstimateTextureAdded(v),v},l.prototype._getVertexBufferLayout=function(e,t){var r={hasTexture:ne(e.params.material),hasNormals:null!=t.vertexAttributes.normal,hasRegions:null!=t.vertexAttributes.region};return J.glLayout(re.ComponentMaterial.vertexBufferLayout(this._getGeometryParameters(r)))},l.prototype._createEngineMaterial=function(e,t,r,i){var n=this,o=t.params.material,a=i.some(function(e){return"region"===e.name}),s=y.isSome(r)?r.map(function(t){return n._createTexture(e,o,t,a)}):[],l=i.some(function(e){return"normalCompressed"===e.name}),d=ne(o),u=this._getMaterialParameters(o,r,s),c=this._getGeometryParameters({hasTexture:d,hasRegions:a,hasNormals:l}),h=re.ComponentMaterial.create(u,c,""+e.id);return h.metadata={material:o,textures:s,isSchematic:o.isSchematic},h},l.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},l.prototype._findGraphicNodeAndIndex=function(e){var t=U.attributeLookup(e.attributes,this._getObjectIdField()),r=null;return p.everyMap(this._nodeId2Meta,function(e,i){var n=e.featureIds.indexOf(t);return-1===n||(r={node:e.node,index:n},!1)}),r},l.prototype._getGraphicIndices=function(e,t){var r=this._nodeId2Meta.get(e.index);if(!r)return[];for(var i=[],n=this._getObjectIdField(),o=0,a=t;o<a.length;o++){var s=a[o],l=U.attributeLookup(s.attributes,n),d=r.featureIds.indexOf(l);-1!==d&&i.push(d)}return i},l.prototype.whenGraphicBounds=function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return m.reject();var r=this._nodeId2Meta.get(t.node.index).engineObject,i=this._boundingBoxCornerPoints(t.index,r,new Float64Array(24));if(W.bufferToBuffer(i,this.view.renderSpatialReference,0,i,this.view.spatialReference,0,8)){var n=O.empty();return O.expandWithBuffer(n,i,0,8),m.resolve({boundingBox:n,screenSpaceObjects:[]})}},l.prototype.whenGraphicAttributes=function(e,t){var r=this;return G.whenGraphicAttributes(this.layer,e,this._getObjectIdField(),t,function(e){for(var t=new Map,i=[],n=0,o=e;n<o.length;n++){var a=o[n],s=r._findGraphicNodeAndIndex(a),l=t.get(s.node);l||(l={node:s.node,indices:[],graphics:[]},i.push(l)),l.indices.push(s.index),l.graphics.push(a)}return i},{ignoreUnavailableFields:!0,populateObjectId:!0})},l.prototype.getGraphicFromStageObject=function(e,t){if(this._isIntegratedMesh)return null;var r=this._getMetadata(e),i=e.getComponentFromTriangleNr(0,t);return null!=i&&null!=r.featureIds&&i<r.featureIds.length?this._createGraphic(i,r):null},l.prototype.hasStageObject=function(e){var t=e.getMetadata(),r=this._nodeId2Meta.get(t.nodeIndex);return r&&r.engineObject===e},l.prototype._getMetadata=function(e){var t=e.getMetadata();return this._nodeId2Meta.get(t.nodeIndex)},l.prototype._getCacheKey=function(e){return this._layerUrl+"/v6/"+e.id+this._cacheKeySuffix},l.prototype._getMemCacheKey=function(e,t){return void 0===t&&(t=this.elevationOffset),e+"#"+t},l.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},l.prototype.loadCachedGPUData=function(e){return this._memCache.pop(this._getMemCacheKey(e.index))},l.prototype.loadMissingTextures=function(e,t,r,i){var n=this,o=e.filter(function(e,r){if(0==(e.usage&n.rendererTextureUsage))return!1;if(y.isNone(t))return!0;var i=G.selectEncoding(e.encodings,n.useCompressedTextures),o=t[r];return!!(y.isNone(o)||null==o.data||i&&o.encoding!==i.encoding)});return 0===o.length?m.resolve(!1):r(o,i).then(function(r){for(var i=0,n=0;n<e.length;n++)i<r.length&&r[i].id===e[n].id&&(t[n]=r[i],i++);return!0})},l.prototype.loadCachedNodeData=function(e,t,r){var i=this;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(e),t).then(function(n){return null==n?null:n.nodeVersion!==e.version?(i._idbCache.remove(i._getCacheKey(e)),null):(e.obb||(e.obb=z.clone(n.nodeObb),i._controller.updateVisibility(e.index)),i.loadMissingTextures(n.requiredTextures,n.textureData,r,t).then(function(r){return r&&i._idbCache.initialized&&y.isSome(n.textureData)&&(n.byteSize=ae(n.transformedGeometries,n.textureData),n.textureData.every(oe)&&se(e,n)&&i._idbCache.put(i._getCacheKey(e),n).catch(function(t){return le.warn("Failed to update node with textures in IndexedDB cache: "+e.id+": "+t)})),m.throwIfAborted(t),n}))}):m.resolve(null)},l.prototype.addNodeData=function(e,t){var r=this;return 0===t.allGeometryData.length||0===t.allGeometryData[0].geometries.length?m.resolve():(1!==t.allGeometryData.length&&console.warn("Node with",t.allGeometryData.length,"geometries is unsupported"),this._addData(e,t.attributeDataInfo,function(){return r._transformNode(e,t).then(function(t){return r._controller.reschedule(e.index,t)}).then(function(n){e.obb||(e.obb=n.obb,r._controller.updateVisibility(e.index)),t.allGeometryData[0].componentOffsets=n.componentOffsets,n.featureIds&&(t.allGeometryData[0].featureIds=Array.prototype.slice.call(n.featureIds));var o={geometryData:t.allGeometryData[0],transformedGeometries:n.transformedGeometries,requiredTextures:t.requiredTextures,textureData:t.textureData,nodeVersion:e.version,nodeObb:e.obb,byteSize:r._cachingEnabled()?ae(n.transformedGeometries,t.textureData):0};if(se(e,o)&&r._idbCache.initialized){var a=y.isSome(o.textureData)?o.textureData.map(function(e){return oe(e)?e:null}):null;r._idbCache.put(r._getCacheKey(e),i({},o,{textureData:a})).catch(function(t){return le.warn("Failed to store node in IndexedDB cache: "+e.id+": "+t)})}return r._addCachedNodeData(e,o)})}))},l.prototype._transformNode=function(e,t){for(var r=this,i=t.allGeometryData[0].geometries,n=new Array(i.length),o=0;o<i.length;++o)n[o]=this._getVertexBufferLayout(i[o],t.geometryIndex);var a={geometryBuffer:t.geometryBuffer,geometryData:t.allGeometryData[0],geometryIndex:t.geometryIndex,layouts:n,mbs:e.mbs,obb:e.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",a,{transferList:[t.geometryBuffer]}):R.ensureDracoDecoder(a).then(function(){return r._controller.reschedule(e.index,a).then(function(e){return r._worker.transform(e)})})},l.prototype.addCachedGPUData=function(e,t,r){if(this._controller.isGeometryVisible(e)){this._nodeId2Meta.set(e.index,t),this.updateNodeStatus(e.index,r),t.engineObject.setHidden(t.engineObject.geometryRecords[0],!1);for(var i=0,n=t.engineObject.geometryRecords;i<n.length;i++){var o=n[i].material;o.updateParameters({slicePlaneEnabled:this.slicePlaneEnabled,usePBR:!this._isIntegratedMesh&&(!o.metadata.isSchematic||this.view.qualitySettings.physicallyBasedRenderingEnabled)})}this._updateEngineObject(t),this._highlights.objectCreated(t.engineObject),this._treeDebugger&&this._treeDebugger.update()}else{var a=this._controller.indexDepth-e.level;this._memCache.put(this._getMemCacheKey(e.index),t,e.memory,a)}},l.prototype.addCachedNodeData=function(e,t,r){var i=this;return this._addData(e,r,function(){return i._addCachedNodeData(e,t)})},l.prototype._addCachedNodeData=function(e,t){var r=this;if(this.suspended||!this._controller.isGeometryVisible(e))return m.resolve();var i=t.geometryData,n=t.transformedGeometries,o=y.isSome(t.textureData)?t.textureData.filter(function(e){return y.isSome(e)&&0!=(e.usage&r.rendererTextureUsage)}):null,a=new Map;a.set(1,{}),a.set(2,{}),a.set(3,{});var s=0,l=!1;e.memory=0;var d=i.componentOffsets,u=i.geometries,c=i.featureIds,h=null,p=null;if(this._hasSymbolColors){h=this._componentColorManager.getBuffer(c.length),p=new Uint16Array(c.length);for(var f=0;f<c.length;f++)p[f]=h.acquireIndex()}for(var g,v=e.id+"|"+c[0],_=new Array,b=new Array,x=new Array,w=new Array,S=this.view,C=0,D=u;C<D.length;C++){var P=D[C],O=n[s++],M=this._createEngineMaterial(e,P,o,O.layout);g=O.corMatrices.globalTrafo,l=l||O.hasColors;var N=new Z(new Float32Array(O.interleavedVertexData),O.layout,O.positionData,d||Z.DefaultOffsets,O.indices||Z.DefaultIndices);this._hasSymbolColors&&this._setComponentIndices(N,p);var E=null!=P.transformation?I.mat4f64.clone(P.transformation):he,F=_.length,T=new K(N,v+(F>0?"_"+F:"")),R=S.renderSpatialReference;_.push(T),x.push(E),w.push(M);var L=j.createOrigin(e.mbs,this.elevationOffset,this._controller.crsIndex,R);b.push(L),e.memory+=this.memEstimateGeometryAdded(T.data),a.get(3)[M.id]=M,a.get(2)[T.id]=T}var V={nodeIndex:e.index,layerUid:this._layerUid},A=new X({idHint:e.id,geometries:_,materials:w,transformations:x,origins:b,castShadow:!0,metadata:V});A.objectTransformation=g,a.get(1)[A.id]=A;var G=this._addTasks.get(e.index),B=new ue;B.node=e,B.engineObject=A,B.featureIds=c,B.componentColorBuffer=h,B.componentIndices=p,B.cachedRendererVersion=this._getInvalidRendererVersion(),B.cachedSymbolInfos=[],B.attributeInfo=G.attributeInfo,!this._hasTextures&&t.requiredTextures.some(function(e){return 0!=(19&e.usage)})&&(this._hasTextures=!0),this._hasColors||(this._hasColors=l),this._hasData=!0,this.notifyChange("hasTexturesOrVertexColors");var U=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(B).then(function(){var t=r._stageLayer,i=r._stage,n=a.get(1);for(var o in n)n.hasOwnProperty(o)&&t.addObject(n[o]);if(a.forEach(function(e,t){for(var r in e)e.hasOwnProperty(r)&&null==i.getContent(t,r)&&i.add(t,e[r])}),r._nodeId2Meta.has(e.index)&&(le.warn("Removing duplicated node"),r._deleteNodeStageData(r._nodeId2Meta.get(e.index))),r._nodeId2Meta.set(e.index,B),r.suspended)r._removeNodeStageData(e.index,r.elevationOffset);else{B.attributeInfo=G.attributeInfo,B.cachedRendererVersion===r._rendererVersion&&U===r.slicePlaneEnabled||r._addOrUpdateEdgeRendering(B),r._setObjectSymbology(B),r._applyFiltersToNode(B)&&r._updateEdgeRendering(B),r.visibleGeometryChanged(A),r._highlights.objectCreated(A);for(var s=0,l=B.engineObject.geometryRecords;s<l.length;s++)l[s].material.updateParameters({slicePlaneEnabled:r.slicePlaneEnabled});r._markParentsAsHole(e.index),r._treeDebugger&&r._treeDebugger.update()}})},l.prototype._addData=function(e,t,r){var n=this,o=this._addTasks.get(e.index);return o?o.attributeInfo=t:(o=i({},m.createResolver(),{attributeInfo:t}),this._addTasks.set(e.index,o),r().then(o.resolve,o.reject).then(function(){return n._addTasks.delete(e.index)}).catch(function(t){throw n._addTasks.delete(e.index),t})),o.promise},l.prototype._markParentsAsHole=function(e){if(this._isIntegratedMesh)for(var t=this._controller,r=t.getParentIndex(e);r;r=t.getParentIndex(r))this.updateNodeStatus(r,"hole")},l.prototype._clippingAreaChanged=function(){var e=O.create();W.extentToBoundingBox(this.view.clippingArea,e,this.view.renderSpatialReference)?this._clippingArea=e:this._clippingArea=null,this._filterChange(),this._controller&&this._controller.updateClippingArea(this.view.clippingArea)},l.prototype._filterChange=function(){this._applyFilters(!1)},l.prototype._applyFilters=function(e){var t=this;this._filters=this.getFilters(),e?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(e){t._applyFiltersToNode(e)&&(t._addOrUpdateEdgeRendering(e),t.visibleGeometryChanged(e.engineObject))})},l.prototype.getFilters=function(){var e=this,t=[];return this._clippingArea&&t.push(function(t,r){return e._boundingboxFilter(t,r,e._clippingArea)}),t},l.prototype.addSqlFilter=function(e,t,r,i){var n=this;t&&r&&e.push(function(e,o){return n._sqlFilter(e,o,t,r,i)})},l.prototype._sqlFilter=function(e,t,r,i,n){var o={},a=this._createLayerGraphic(o),s=this.layer.objectIdField,l=t.featureIds,d=t.attributeInfo.attributeData;i.every(function(e){return null!=d[e]||e===s})&&G.filterInPlace(e,l,function(e){o[s]=l[e];for(var t=0,u=i;t<u.length;t++){var c=u[t];c!==s&&(o[c]=G.getCachedAttributeValue(d[c],e))}try{return r.testFeature(a)}catch(e){return n(e),!1}})},l.prototype._boundingboxNodeTest=function(e,t){return W.mbsToMbs(e.node.mbs,this._controller.crsIndex,ve,this.view.renderSpatialReference),G.intersectBoundingBoxWithMbs(t,ve)},l.prototype._boundingboxFeatureTest=function(e,t,r){var i=e.engineObject.geometryRecords[0].geometry;return O.intersects(r,i.getComponentAABB(t,ge))},l.prototype._boundingboxFilter=function(e,t,r){var i=this,n=this._boundingboxNodeTest(t,r);if(3!==n){if(0===n)return void(e.length=0);if(t.engineObject.geometryRecords[0].geometry.componentCount===t.featureIds.length){var o=G.getClipAABB(r,t.engineObject);G.filterInPlace(e,t.featureIds,function(e){return i._boundingboxFeatureTest(t,e,o)})}}},l.prototype._addOrUpdateEdgeRendering=function(e,t){if(void 0===t&&(t=!0),!this._edgeView)return m.resolve();var r=e.engineObject,i=this._edgeView.hasObject(r),n=this._extractObjectEdgeMaterials(e),o=n.hasEdges,a=n.perFeatureEdgeMaterials,s={slicePlaneEnabled:this.slicePlaneEnabled};if(o){var l=!r.isHidden(r.geometryRecords[0]);if(i)this._edgeView.updateAllComponentMaterials(r,a,s,t),this._edgeView.updateObjectVisibility(r,l);else if(l)return u.safeCast(this._edgeView.addObject(r,a,s,!1))}else i&&this._edgeView.removeObject(r);return m.resolve()},l.prototype._removeEdgeRendering=function(e){this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._edgeView.removeObject(e.engineObject)},l.prototype._applyFiltersToNode=function(e){var t=e.engineObject,r=t.areAllComponentsVisible();if(t.unhideAllComponents(),0===this._filters.length)return!r;var i=e.featureIds;null!=e.filteredIds&&e.appliedFilters===this._filters||(e.filteredIds=this._computeFilteredIds(e),e.appliedFilters=this._filters);var n=e.filteredIds;if(n===i)return!r;for(var o=t.geometryRecords[0],a=0,s=0;s<i.length;s++){var l=i[s];a>=n.length||n[a]!==l?t.setComponentVisibility(o,s,!1):a++}return!0},l.prototype._computeFilteredIds=function(e){for(var t=e.featureIds.slice(),r=0,i=this._filters;r<i.length;r++)(0,i[r])(t,e);return t.length===e.featureIds.length?e.featureIds:t},l.prototype._removeAllNodeDataFromStage=function(e){var t=this;void 0===e&&(e=this.elevationOffset),this._nodeId2Meta.forEach(function(r,i){return t._removeNodeStageData(i,e)})},l.prototype.removeNodeData=function(e,t){for(var r=this.elevationOffset;e.length>0&&!t.done;){var i=e.pop();this._removeNodeStageData(i,r),t.madeProgress()}},l.prototype._removeNodeStageData=function(e,t){var r=this._nodeId2Meta.get(e);if(r){var i=r.engineObject;i.setHidden(i.geometryRecords[0],!0),this.visibleGeometryChanged(i),this._removeEdgeRendering(r),this._nodeId2Meta.delete(e),this._highlights.objectDeleted(i);var n=this._controller.indexDepth-r.node.level+1;this._memCache.put(this._getMemCacheKey(e,t),r,r.node.memory,n),this._treeDebugger&&this._treeDebugger.update()}},l.prototype._deleteNodeStageData=function(e){var t=this._stage,r=this._stageLayer,i=e.engineObject;this._edgeView&&this._edgeView.removeObject(i),r.removeObject(i);for(var n=0,o=i.geometryRecords;n<o.length;n++){var a=o[n];this.memEstimateGeometryRemoved(a.geometry.data),t.remove(2,a.geometry.id),this._removeMaterial(a.material,t)}if(e.componentIndices){for(var s=0;s<e.componentIndices.length;s++)e.componentColorBuffer.releaseIndex(e.componentIndices[s]);this._componentColorManager.garbageCollect()}t.remove(1,i.id)},l.prototype._removeMaterial=function(e,t){t.remove(3,e.id);for(var r=0,i=e.metadata.textures;r<i.length;r++){var n=i[r];n&&(this.memEstimateTextureRemoved(n),t.remove(4,n.id))}},l.prototype.updateNodeStatus=function(e,t){var r=this._nodeId2Meta.get(e);if(r)for(var i="hole"===t,n=0,o=r.engineObject.geometryRecords;n<o.length;n++){o[n].material.updateParameters({polygonOffsetEnabled:i})}},l.prototype._getInvalidRendererVersion=function(){return G.addWraparound(this._rendererVersion,-1)},l.prototype._rendererChange=function(e){return s(this,void 0,void 0,function(){var t,r,i,n,o,s,l,d;return a(this,function(a){switch(a.label){case 0:return this._currentRenderer=e,this.notifyChange("rendererTextureUsage"),this._rendererVersion=G.addWraparound(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,e?(t=this,r=G.findFieldsCaseInsensitive,[4,e.getRequiredFields(this.layer.fields)]):[3,2];case 1:t._rendererFields=r.apply(void 0,[a.sent(),this.layer.fields]),a.label=2;case 2:if(e&&"visualVariables"in e&&e.visualVariables)for(i=0,n=e.visualVariables;i<n.length;i++)"color"===(o=n[i]).type?this._colorVariable=o:"opacity"===o.type?this._opacityVariable=o:le.warn("Unsupported visual variable type for 3D Object Scene Services: "+o.type);if(e)for(s=0,l=e.getSymbols();s<l.length;s++)"mesh-3d"!==(d=l[s]).type&&le.error("Symbols of type '"+d.type+"' are not supported for 3D Object Scene Services.");return this._controller&&this._controller.requestUpdate(),[2]}})})},l.prototype._getSymbolInfos=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolInfos},l.prototype._getSymbolColors=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolColors},l.prototype._updateCachedRendererData=function(e){if(e.cachedRendererVersion=this._rendererVersion,this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r={},i=this._tmpAttributeOnlyGraphic;i.attributes=r;var n=this._currentRenderer,o=e.attributeInfo.attributeData,a=null!=e.featureIds?this.layer.objectIdField:null,s=null!=o?this._rendererFields:null;null==e.cachedSymbolColors&&(e.cachedSymbolColors=new Uint8Array(4*e.featureIds.length));for(var l=e.cachedSymbolColors,d=!0,u=0;u<t;u++){if(null!=a&&(r[a]=e.featureIds[u]),null!=s)for(var c=0,h=s;c<h.length;c++){var p=h[c];o[p]&&(r[p]=G.getCachedAttributeValue(o[p],u))}var f=n&&n.getSymbol(i,{arcadeUtils:E}),g=null;f instanceof F&&(this._symbolInfos.has(f.id)||this._symbolInfos.set(f.id,G.getSymbolInfo(f)),g=this._symbolInfos.get(f.id)),e.cachedSymbolInfos[u]=g;var y=null,m=null,v=!0,_=!0;if(n&&"visualVariables"in n){if(this._colorVariable){var b=N.getColor(this._colorVariable,i,{color:me});b&&((y=ye)[0]=b.r/255,y[1]=b.g/255,y[2]=b.b/255,this._opacityVariable||null===b.a||(m=b.a))}this._opacityVariable&&(m=N.getOpacity(this._opacityVariable,i))}if(g&&g.material){var x=g.material;y=null==y||null==m?L.overrideColor(y,m,x.color,x.alpha,de,ye):L.overrideColor(y,m,null,null,de,ye),H.encodeSymbolColor(y,x.colorMixMode,l,4*u),v=g.castShadows}else H.encodeSymbolColor(null,null,l,4*u),v=!0;if(u>0&&d){for(var w=4*(u-1);w<4*u;w++)l[w]!==l[w+4]&&(d=!1);v!==_&&(d=!1)}_=v}e.uniformSymbolColor=d}},l.prototype._extractObjectEdgeMaterials=function(e){var t=e.engineObject,r=e.featureIds?e.featureIds.length:1,i=new Array(r),n=q.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),o={opacity:this.fullOpacity,objectTransparency:2};if(e.engineObject.geometryRecords.length>0){var a=e.engineObject.geometryRecords[0].material;o.objectTransparency=a.isVisible()?a.hasTransparency?1:2:0}for(var s=!1,l=null,d=null,u=this._getSymbolInfos(e),c=0;c<r;c++){var h=u[c];t.getComponentVisibility(t.geometryRecords[0],c)&&h?(d!==h&&(d=h,(l=q.createMaterialFromEdges(h.edges,o))&&(s=!0)),i[c]=y.isSome(l)?l:n):i[c]=n}return{hasEdges:s,perFeatureEdgeMaterials:i}},l.prototype._setObjectSymbology=function(e){if(this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r=this._getSymbolColors(e);if(e.uniformSymbolColor){var i=H.decodeSymbolColor(r,0),n=i.color,o=i.colorMixMode,a=!0;e.cachedSymbolInfos[0]&&(a=e.cachedSymbolInfos[0].castShadows);for(var s=0,l=e.engineObject.geometryRecords;s<l.length;s++){(w=l[s].material).updateParameters({componentData:{castShadows:a,externalColor:n,externalColorMixMode:o}})}var d=n[3]<1,u=!d&&"replace"===o;this._updateObjectOpacity(e.engineObject,u,d)}else{for(var c=e.componentColorBuffer.textureBuffer,h=!0,p=!0,f=!0,g=0;g<t;g++){var y=4*g,m=e.componentIndices[g],v=1;e.cachedSymbolInfos[g]&&(v=!0===e.cachedSymbolInfos[g].castShadows?1:0),c.setData(m,0,r[y],r[y+1],254&r[y+2]|v,r[y+3]);var _=H.isOpaqueSymbolColor(r,y);h=h&&_,p=p&&!_;o=H.decodeSymbolColorMixMode(r,y);f=f&&2===o}for(var b=0,x=e.engineObject.geometryRecords;b<x.length;b++){var w,S="blend"!==(w=x[b].material).metadata.material.alphaMode,C=!h&&!p&&S;w.updateParameters({componentData:{textureBuffer:c},useVertexTransparencyDiscards:C})}var I=h&&f;this._updateObjectOpacity(e.engineObject,I,!h),this._stage.renderView.setNeedsRender()}this._updateEdgeRendering(e)}},l.prototype._setComponentIndices=function(e,t){for(var r=e.getAttribute(ee.VertexAttrConstants.COMPONENTINDEX),i=r.data,n=r.offsetIdx,o=r.strideIdx,a=e.getIndices(ee.VertexAttrConstants.COMPONENTINDEX),s=0;s<t.length;s++)for(var l=e.componentOffsets[s],d=e.componentOffsets[s+1],u=l;u<d;u++){i[n+a[u]*o]=t[s]}},l.prototype._reloadAll=function(e){void 0===e&&(e=this.elevationOffset),this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()},l.prototype._opacityChange=function(e){var t=this;this._nodeId2Meta.forEach(function(e){t._updateObjectOpacity(e.engineObject),t._updateEdgeRendering(e)})},l.prototype._updateObjectOpacity=function(e,t,r){for(var i=0,n=e.geometryRecords;i<n.length;i++){var o=n[i].material,a=o.metadata;void 0!==t&&(a.allSymbolsOpaqueReplace=t),void 0!==r&&(a.someSymbolsTransparent=r);var s=this._calcEngineMaterialTransparencyParams(a.material,a.allSymbolsOpaqueReplace,a.someSymbolsTransparent);o.updateParameters(s)}},l.prototype._updateEngineObject=function(e){this._setObjectSymbology(e),this._applyFiltersToNode(e),this._addOrUpdateEdgeRendering(e),this.visibleGeometryChanged(e.engineObject)},l.prototype._slicePlaneEnabledChange=function(e){var t=this,r={slicePlaneEnabled:e};this._stageLayer.isSliceable=e,this._nodeId2Meta.forEach(function(e){for(var i=0,n=e.engineObject.geometryRecords;i<n.length;i++)n[i].material.updateParameters(r);t._updateEdgeRendering(e,!1)})},l.prototype._enablePhysicalBasedRendering=function(e){var t=this,r={usePBR:!0};this._nodeId2Meta.forEach(function(e){for(var i=0,n=e.engineObject.geometryRecords;i<n.length;i++){var o=n[i].material;r.usePBR=!t._isIntegratedMesh&&(!o.metadata.isSchematic||t.view.qualitySettings.physicallyBasedRenderingEnabled),o.updateParameters(r)}})},l.prototype._updateEdgeRendering=function(e,t){void 0===t&&(t=!0),this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._addOrUpdateEdgeRendering(e,t)},l.prototype._forAllFeatures=function(e,t,r){var i=this;void 0===r&&(r=0),p.everyMap(this._nodeId2Meta,function(n,o){if(y.isSome(t))switch(t(n)){case 0:return!1;case 2:return!0}return 0!==i._forAllFeaturesOfNode(n,e,r)})},l.prototype._forAllFeaturesOfNode=function(e,t,r){void 0===r&&(r=0);var i=e.featureIds,n=e.engineObject.geometryRecords[0],o=2===r&&this._clippingArea?G.getClipAABB(this._clippingArea,e.engineObject):null,a=o?this._boundingboxNodeTest(e,this._clippingArea):3;if(0===a)return 1;for(var s=0;s<i.length;s++)if(e.engineObject.getComponentVisibility(n,s)||1===r||2===r&&(3===a||this._boundingboxFeatureTest(e,s,o))){var l=t(i[s],s,e,n);switch(l){case 0:return l}}return 1},l.prototype._createGraphic=function(e,t){var r={};null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]);var i=t.attributeInfo.attributeData;if(null!=i)for(var n=0,o=Object.keys(i);n<o.length;n++){var a=o[n];r[a]=G.getCachedAttributeValue(i[a],e)}return this._createLayerGraphic(r)},l.prototype._boundingBoxCornerPoints=function(e,t,r){for(var i=t.geometries[0].getComponentAABB(e,fe),n=0;n<8;++n)pe[0]=1&n?i[0]:i[3],pe[1]=2&n?i[1]:i[4],pe[2]=4&n?i[2]:i[5],D.vec3.transformMat4(pe,pe,t.objectTransformation),r[3*n]=pe[0],r[3*n+1]=pe[1],r[3*n+2]=pe[2];return r},l.prototype.highlight=function(e,t){var r=this;void 0===t&&(t={});var i=this._highlights;if("number"==typeof e?e=[e]:e instanceof d?e=[e]:e instanceof c&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof d){var n=e.map(function(e){return U.attributeLookup(e.attributes,r._getObjectIdField())}),o=i.acquireSet(t),a=o.set,s=o.handle;return i.setFeatureIds(a,n),s}if("number"==typeof e[0]){n=e;var l=i.acquireSet(t);a=l.set,s=l.handle;return i.setFeatureIds(a,n),s}}return _e},l.prototype.visibleGeometryChanged=function(e){var t=this;e?this._elevationProvider.objectChanged(e):this._elevationProvider.layerChanged(),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=_.schedule(function(){t.emit("visible-geometry-changed"),t._visibleGeometryChangedSchedulerHandle=null}))},l.prototype.test=function(){var e=this;return{controller:this._controller,get visibleObjectIds(){var t=[];return e._forAllFeatures(function(e,r,i,n){return i.engineObject.isHidden(n)||i.engineObject.areAllComponentsHidden()||!i.engineObject.getComponentVisibility(n,r)||t.push(e),1}),t.sort(function(e,t){return e-t}),t},get numNodes(){return e._nodeId2Meta.size}}},o([C.property()],l.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),o([C.property()],l.prototype,"view",void 0),o([C.property()],l.prototype,"layer",void 0),o([C.property()],l.prototype,"_controller",void 0),o([C.property({dependsOn:["updatingMeshView3D"]})],l.prototype,"updating",void 0),o([C.property({dependsOn:["_controller.updating","_visibleGeometryChangedSchedulerHandle"]})],l.prototype,"updatingMeshView3D",null),o([C.property({dependsOn:["_controller.rootNodeVisible"]})],l.prototype,"suspended",void 0),o([C.property(k.updatingPercentage)],l.prototype,"updatingPercentage",void 0),o([C.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],l.prototype,"updatingPercentageValue",void 0),o([C.property({readOnly:!0})],l.prototype,"hasTexturesOrVertexColors",null),o([C.property({readOnly:!0})],l.prototype,"rendererTextureUsage",null),o([C.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],l.prototype,"elevationOffset",null),o([C.property({type:Boolean})],l.prototype,"slicePlaneEnabled",void 0),o([C.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],l.prototype,"uncompressedTextureDownsamplingEnabled",null),o([C.property({dependsOn:["layer.version"]})],l.prototype,"useCompressedTextures",null),o([C.subclass("esri.views.3d.layers.I3SMeshView3D")],l)}(C.declared(t))};var he=I.mat4f64.create(),pe=P.vec3f64.create(),fe=O.create(),ge=O.create(),ye=[0,0,0,0],me=new l([0,0,0,0]),ve=[0,0,0,0],_e={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,i))||(e.exports=n)},1837:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1720)],void 0===(n=function(e,t,r){var i=function(){return function(e){this.highlightSet=new r,this.ids=new Set,this.paused=!1,this.options=e}}();return function(){function e(e){this.highlights=[],this.layerView=e}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.acquireSet=function(e){var t=this,r=new i(e);return this.highlights.push(r),{set:r,handle:{remove:function(){return t.releaseSet(r)},pause:function(){r.highlightSet.removeAll(),r.paused=!0},resume:function(){r.paused=!1,t.initializeSet(r)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setFeatureIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.initializeSet=function(e){this.layerView._forAllFeatures(function(t,r,i,n){if(e.ids.has(t)){var o=i.engineObject.setComponentHighlight(n,r,e.options);e.highlightSet.addObject(i.engineObject,o)}return 1},null,1)},e.prototype.objectCreated=function(e){var t=this;this.highlights.forEach(function(r){r.paused||t.layerView._forAllFeaturesOfNode(t.layerView._getMetadata(e),function(t,i,n,o){if(r.ids.has(t)){var a=e.setComponentHighlight(o,i,r.options);r.highlightSet.addObject(e,a)}return 1},1)})},e.prototype.objectDeleted=function(e){this.highlights.forEach(function(t){t.highlightSet.removeObject(e)})},e.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,i))||(e.exports=n)},1838:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(49),r(6),r(0),r(8),r(5),r(33),r(103),r(191)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h){var p=u.empty(),f={spatialReference:null,extent:p,context:"scene"},g=d.vec3f64.create(),y=d.vec3f64.create(),m=d.vec3f64.create(),v=a.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.initialize=function(){var e=this.layerView.view;this.view=e,this.renderCoordsHelper=e.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.intersector=new h(e.viewingMode);var t=this.layerView.layer.fullExtent;this.zmin=t.zmin,this.zmax=t.zmax},t.prototype.getElevation=function(e){if(c.isPoint(e)){if(!this.renderCoordsHelper.toRenderCoords(e,g))return v.error("could not project point for elevation alignment"),null}else if(!this.renderCoordsHelper.toRenderCoords(e,this.spatialReference,g))return v.error("could not project point for elevation alignment"),null;var t=this.layerView.elevationOffset,r=this.zmin+t,i=this.zmax+t;return l.vec3.copy(y,g),l.vec3.copy(m,g),this.renderCoordsHelper.setAltitude(i,y),this.renderCoordsHelper.setAltitude(r,m),this.intersector.intersect(this.intersectLayers,y,m,null,null,1,!1),this.intersector.results.min.getIntersectionPoint(g)?this.renderCoordsHelper.getAltitude(g):null},t.prototype.layerChanged=function(){this.spatialReference&&(f.extent=this.computeLayerExtent(this.intersectLayers[0]),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.objectChanged=function(e){this.spatialReference&&(f.extent=this.computeObjectExtent(e),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.computeObjectExtent=function(e){return u.empty(p),this.expandExtent(e,p),p},t.prototype.computeLayerExtent=function(e){u.empty(p);for(var t=0,r=e.getObjects();t<r.length;t++){var i=r[t];this.expandExtent(i,p)}return p},t.prototype.expandExtent=function(e,t){for(var r=e.getBBMin(!0),i=e.getBBMax(!0),n=0;n<8;++n)g[0]=1&n?r[0]:i[0],g[1]=2&n?r[1]:i[1],g[2]=4&n?r[2]:i[2],l.vec3.transformMat4(g,g,e.objectTransformation),this.renderCoordsHelper.fromRenderCoords(g,g,this.spatialReference),u.expand(t,g);return t},i([s.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([s.property({constructOnly:!0})],t.prototype,"stageLayer",void 0),i([s.property()],t.prototype,"view",void 0),i([s.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],t.prototype,"spatialReference",void 0),i([s.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],t)}(s.declared(o.EventedMixin(n)))}.apply(null,i))||(e.exports=n)},1839:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(7)],void 0===(n=function(e,t,r,i){function n(e){return i.create(function(t,r){e.oncomplete=function(){return t()},e.onerror=function(){return r(e.error)},e.onabort=function(){return r(e.error)}})}function o(e){return i.create(function(t,r){"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return r(e.error)})})}Object.defineProperty(t,"__esModule",{value:!0});var a=14,s=function(){function e(e,t,r){void 0===r&&(r=a),this._version=r,this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t}return e.prototype.init=function(){var e=this;return i.resolve().then(function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(r){var i=t.result,n=t.transaction,o=i.objectStoreNames.contains(e._storeName)?n.objectStore(e._storeName):i.createObjectStore(e._storeName),a=i.objectStoreNames.contains("last_access")?n.objectStore("last_access"):i.createObjectStore("last_access");a.indexNames.contains("date")||a.createIndex("date","date",{unique:!1}),a.indexNames.contains("byteSize")||a.createIndex("byteSize","byteSize",{unique:!1}),r.oldVersion<e._version&&(o.clear(),a.clear())},o(t)}).then(function(t){e._destroyed?t.close():e._db=t})},e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0},Object.defineProperty(e.prototype,"initialized",{get:function(){return null!=this._db},enumerable:!0,configurable:!0}),e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype.put=function(e,t){var n=this;return null==this._db?i.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:i.resolve()).then(function(){return n._put(e,t)}).catch(function(r){if(r&&"QuotaExceededError"===r.name)return null==n._quotaReductionPromise&&(n._quotaReductionPromise=n._getCacheSize().then(function(e){return n._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*n.quotaReductionFactor))}),n._quotaReductionPromise.then(function(){return n._quotaReductionPromise=null},function(){return n._quotaReductionPromise=null})),n._quotaReductionPromise.then(function(){return n._put(e,t)});throw r}).then(function(){--n._gcCounter<0&&null!=n._db&&(n._gcCounter=n.gcFrequency,n._getCacheSize().then(function(e){return n._removeLeastRecentlyAccessed(e-n.maxByteSize)}))})},e.prototype.get=function(e,t){var r=this;if(null==this._db)return i.resolve(null);var n=null;return i.resolve().then(function(){var a=r._db.transaction(r._storeName,"readonly");return n=i.onAbort(t,function(){a.abort()}),o(a.objectStore(r._storeName).get(e))}).then(function(t){if(null==t)++r._miss;else if(r._db){++r._hit,r._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:t.byteSize},e)}return n&&n.remove(),t}).catch(function(e){return++r._miss,i.throwIfAborted(t),n&&n.remove(),null})},e.prototype.remove=function(e){var t=this;return null==this._db?i.resolve():i.resolve().then(function(){var r=t._db.transaction([t._storeName,"last_access"],"readwrite"),a=r.objectStore(t._storeName),s=r.objectStore("last_access"),l=a.delete(e),d=s.delete(e);return i.all([o(l),o(d),n(r)])})},e.prototype._put=function(e,t){var r=this._db.transaction([this._storeName,"last_access"],"readwrite"),a=r.objectStore(this._storeName),s=r.objectStore("last_access"),l=a.put(t,e),d=s.put({date:Date.now(),byteSize:t.byteSize},e);return i.all([o(l),o(d),n(r)])},e.prototype._removeLeastRecentlyAccessed=function(e){if(!(e<=0)){var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=t.objectStore(this._storeName),i=t.objectStore("last_access"),o=0,a=i.index("date").openCursor(null,"next");return a.onsuccess=function(t){var n=a.result;null!=n&&(null!=n.value.byteSize&&(o+=n.value.byteSize),r.delete(n.primaryKey),i.delete(n.primaryKey),o<e&&n.continue())},n(t)}},e.prototype._getCacheSize=function(){var e=this._db.transaction("last_access"),t=0,r=e.objectStore("last_access").index("byteSize").openKeyCursor();return r.onsuccess=function(e){var i=r.result;if(i){var n=i.key;null!=n&&(t+=n),i.continue()}},n(e).then(function(){return t})},e}();t.IDBCache=s,t.whenTransaction=n,t.whenRequest=o}.apply(null,i))||(e.exports=n)},1840:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1841),r(1759)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e,t,i){return new r.ComponentMaterial(e,t,i)},e.vertexBufferLayout=i.createVertexBufferLayout}(t.ComponentMaterial||(t.ComponentMaterial={}))}.apply(null,i))||(e.exports=n)},1841:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(3),r(4),r(9),r(134),r(1842),r(1758),r(1759),r(50),r(1844)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r,i){var n=e.call(this,i)||this;return n.supportsEdges=!0,n._parameters=s.fillDefaults(t),n._geometryParameters=r,n}return r(t,e),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryParameters",{get:function(){return this._geometryParameters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTransparency",{get:function(){var e=this._parameters.forceTransparency;if(n.isSome(e))return e;if(this._parameters.baseColorOpacity<1||this._parameters.layerOpacity<1)return!0;var t=this._parameters.componentData;return!s.isUniformComponentData(t)||"replace"!==t.externalColorMixMode||t.externalColor[3]<1},enumerable:!0,configurable:!0}),t.prototype.isVisibleInPass=function(e){if(3!==e)return!0;var t=this._parameters.componentData;return!s.isUniformComponentData(t)||t.castShadows},t.prototype.isVisible=function(){var t=this.parameters;if(!e.prototype.isVisible.call(this))return!1;if(0===t.layerOpacity)return!1;var r=t.componentData;return!s.isUniformComponentData(r)||("replace"===r.externalColorMixMode?r.externalColor[3]>0:t.baseColorOpacity>0)},t.prototype.updateParameters=function(e){var t=!1;for(var r in e){var i=this._parameters[r],n=e[r];i!==n&&(t=!0,this._parameters[r]=n)}t&&this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,n,o,a){d.intersectTriangleGeometry(e,t,i,n,o,a)},t.prototype.getGLMaterials=function(){return{color:a.GLMaterialColor,depthShadowMap:a.GLMaterialDepthShadowMap,normal:a.GLMaterialNormal,depth:a.GLMaterialDepth,highlight:a.GLMaterialHighlight}},t.prototype.createRenderer=function(e,t){return new u(e,t,this)},t.prototype.createBufferWriter=function(){throw Error("Not supported")},t.prototype.createBufferLayout=function(){return l.createVertexBufferLayout(this.geometryParameters)},t}(o.Material);t.ComponentMaterial=c}.apply(null,i))||(e.exports=n)},1842:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(3),r(1),r(236),r(673),r(152),r(1758),r(50),r(50),r(1843),r(676),r(46)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h,p){function f(e){if(function(e){return"none"!==e.parameters.cullFace}(e))return{face:"front"===e.parameters.cullFace?1028:1029,mode:2305}}Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(t){var r=e.call(this,t)||this;r.discardTransparentVertices=!1,r.material=t.material,r.passName=t.passName;var i=r.material.parameters;return r._baseColorTexture=new c.TextureBinding(t.textureRep,i.baseColorTexture,{textureUniform:"tex",textureUnit:a.DefaultTextureUnits.DIFFUSE}),r._metallicRoughnessTexture=new c.TextureBinding(t.textureRep,i.metallicRoughnessTexture,{textureUniform:"texMetallicRoughness",textureUnit:a.DefaultTextureUnits.METALLIC_ROUGHNESS}),r._normalTexture=new c.TextureBinding(t.textureRep,i.normalTexture,{textureUniform:"texNormal",textureUnit:a.DefaultTextureUnits.NORMAL}),r._emissiveTexture=new c.TextureBinding(t.textureRep,i.emissiveTexture,{textureUniform:"texEmission",textureUnit:a.DefaultTextureUnits.EMISSION}),r._occlusionTexture=new c.TextureBinding(t.textureRep,i.occlusionTexture,{textureUniform:"texOcclusion",textureUnit:a.DefaultTextureUnits.OCCLUSION}),r.createPrograms(),r.selectPipeline(),r}return i(t,e),Object.defineProperty(t.prototype,"requiresVertexTransparencyDiscards",{get:function(){var e=this.material.parameters.componentData;return!l.isUniformComponentData(e)&&"color"===this.passName&&this.material.hasTransparency&&this.material.parameters.useVertexTransparencyDiscards},enumerable:!0,configurable:!0}),t.prototype.createPrograms=function(){var e=this;this.programs=d.BindParametersMap.create(this.material.parameters,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.material.parameters,r=this.material.geometryParameters,i="screen-space"===t.normals||"screen-space"===r.normals||"none"===r.normals?"screenDerivative":"compressed"===r.normals?"compressed":"default";return"color"===this.passName?this.programRep.getProgram(h.colorPass,{textureAtlas:!!r.textureCoordinateRegions,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,doubleSided:t.doubleSidedShading,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!l.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,usePBR:t.usePBR,roughnessMetallnessTexture:!!t.metallicRoughnessTexture,emissionTexture:!!t.emissiveTexture,normalTexture:!!t.normalTexture,occlusionTexture:!!t.occlusionTexture,vertexTransparencyDiscardEnabled:this.requiresVertexTransparencyDiscards}):"depth"===this.passName||"depthShadowMap"===this.passName?this.programRep.getProgram(h.depthPass,{textureAtlas:!!r.textureCoordinateRegions,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!l.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",shadowMap:"depthShadowMap"===this.passName,slice:t.slicePlaneEnabled}):"normal"===this.passName?this.programRep.getProgram(h.normalPass,{textureAtlas:!!r.textureCoordinateRegions,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!l.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled}):"highlight"===this.passName?this.programRep.getProgram(h.highlightPass,{textureAtlas:!!r.textureCoordinateRegions,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!l.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled}):void 0},t.prototype.selectPipeline=function(){var e=this.material.parameters;"color"===this.passName?this.pipelineState=p.makePipelineState({blending:function(e){if(e.hasTransparency)return p.separateBlendingParams(770,1,771,771)}(this.material),culling:f(this.material),polygonOffset:e.polygonOffsetEnabled&&S,stencilTest:e.writeStencil&&{function:{func:e.readStencil?517:519,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7681}},stencilWrite:e.writeStencil&&{mask:255},depthTest:{func:513},depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams}):this.pipelineState=p.makePipelineState({culling:f(this.material),polygonOffset:e.polygonOffsetEnabled&&S,depthTest:{func:513},depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return this.requiresVertexTransparencyDiscards?(this.discardTransparentVertices=5===e,7===e||5===e):this.material.hasTransparency?7===e:e===(this.material.parameters.readStencil?3:this.material.parameters.writeStencil?2:5)},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return d.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){var e=this.material.parameters;this._baseColorTexture.update(e.baseColorTexture),this.createPrograms(),this.selectPipeline()},t.prototype.bind=function(e,t){var r=this.material.parameters,i=this.material.geometryParameters,n=this.program=d.BindParametersMap.lookup(this.programs,t);e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform3fv("ambient",r.baseColor),n.setUniform3fv("diffuse",r.baseColor),n.setUniform3fv("specular",w),r.usePBR&&(n.setUniform1f("metalnessFactor",r.metallicFactor),n.setUniform1f("roughnessFactor",r.roughnessFactor),n.setUniform3fv("emissionFactor",r.emissiveFactor),n.setUniform1f("reflectanceFactor",r.reflectanceFactor)),n.setUniform1f("opacity",r.baseColorOpacity),n.setUniform1f("layerOpacity",r.layerOpacity),this.requiresVertexTransparencyDiscards&&n.setUniform1f("discardTransparentVertices",this.discardTransparentVertices?1:0),l.isUniformComponentData(r.componentData)?(n.setUniform4fv("externalColor",r.componentData.externalColor),n.setUniform1i("colorMixMode",u.colorMixModes[r.componentData.externalColorMixMode])):(n.setUniform4fv("externalColor",x),n.setUniform1i("colorMixMode",u.colorMixModes.multiply),i.componentData&&(r.componentData.textureBuffer.updateTexture(),r.componentData.textureBuffer.bind(n,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:a.DefaultTextureUnits.COMPONENT_COLOR}))),this._baseColorTexture.bind(e,n),n.setUniform1f("textureAlphaCutoff",.1),this._metallicRoughnessTexture.bind(e,n),this._normalTexture.bind(e,n),this._emissiveTexture.bind(e,n),this._occlusionTexture.bind(e,n),i.textureCoordinateRegions&&(this._baseColorTexture.isValid()?this._baseColorTexture.bindSize("atlasSize",n):this._metallicRoughnessTexture.isValid()?this._metallicRoughnessTexture.bindSize("atlasSize",n):this._normalTexture.isValid()?this._normalTexture.bindSize("atlasSize",n):this._emissiveTexture.isValid()?this._emissiveTexture.bindSize("atlasSize",n):this._occlusionTexture.isValid()&&this._occlusionTexture.bindSize("atlasSize",n)),"depth"!==this.passName&&"depthShadowMap"!==this.passName||n.setUniform2fv("nearFar",t.nearFar),"highlight"===this.passName&&u.bindHighlightRendering(e,t,n)},t.prototype.bindView=function(e,t){var r=this.material.parameters,i=this.program=d.BindParametersMap.lookup(this.programs,t),n=t.origin;u.bindView(n,t.view,i),u.bindCamPos(n,t.viewInvTransp,i),r.slicePlaneEnabled&&u.bindSlicePlane(n,t.slicePlane,i),"color"===this.passName&&t.shadowMappingEnabled&&t.shadowMap.bindView(i,n),"normal"===this.passName&&i.setUniformMatrix4fv("viewNormal",t.viewInvTransp)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},n([o.autoDispose()],t.prototype,"_baseColorTexture",void 0),n([o.autoDispose()],t.prototype,"_metallicRoughnessTexture",void 0),n([o.autoDispose()],t.prototype,"_normalTexture",void 0),n([o.autoDispose()],t.prototype,"_emissiveTexture",void 0),n([o.autoDispose()],t.prototype,"_occlusionTexture",void 0),t}(s),y=function(e){function t(t){return e.call(this,r({passName:"color"},t))||this}return i(t,e),t}(g);t.GLMaterialColor=y;var m=function(e){function t(t){return e.call(this,r({passName:"depth"},t))||this}return i(t,e),t}(g);t.GLMaterialDepth=m;var v=function(e){function t(t){return e.call(this,r({passName:"depthShadowMap"},t))||this}return i(t,e),t}(g);t.GLMaterialDepthShadowMap=v;var _=function(e){function t(t){return e.call(this,r({passName:"normal"},t))||this}return i(t,e),t}(g);t.GLMaterialNormal=_;var b=function(e){function t(t){return e.call(this,r({passName:"highlight"},t))||this}return i(t,e),t}(g);t.GLMaterialHighlight=b;var x=[1,1,1,1],w=[0,0,0],S={factor:2,units:2}}.apply(null,i))||(e.exports=n)},1843:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i){var n=this;this._textureRep=e,this._textureId=t,this._options=i,this._textureRef=r.applySome(this._textureId,function(e){return n._textureRep.acquire(e,!!n._options.initTransparent)})}return e.prototype.dispose=function(){var e=this;this._textureRef=r.applySome(this._textureId,function(t){e._textureRep.release(t)})},e.prototype.bind=function(e,t){r.isSome(this._textureRef)&&(t.setUniform1i(this._options.textureUniform,this._options.textureUnit),e.bindTexture(this._textureRef.getGLTexture(),this._options.textureUnit))},e.prototype.bindSize=function(e,t){if(r.isSome(this._textureRef)){var i=this._textureRef.getGLTexture();t.setUniform2f(e,i.descriptor.width,i.descriptor.height)}},e.prototype.update=function(e){var t=this;e!==this._textureId&&(r.applySome(this._textureId,function(e){t._textureRep.release(e)}),this._textureRef=r.applySome(e,function(e){return t._textureRep.acquire(e,!!t._options.initTransparent)}))},e.prototype.isValid=function(){return r.isSome(this._textureRef)},e}();t.TextureBinding=i}.apply(null,i))||(e.exports=n)},1844:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(21),r(19),r(107),r(61),r(20),r(433),r(434),r(73),r(53),r(77)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c){var h=function(){function e(e,t,r){this._material=r,this.type="PreinterleavedRenderer",this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._materialRep=t,this._glMaterials=l.acquireMaterials(this._material,this._materialRep)}return e.prototype.dispose=function(){l.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.hasWater=function(){return!1},e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var u=this,h=this._rctx,f=this._dataByOrigin;e.forEach(function(e){var t=e.data;if(t.preinterleaved)if(null!=t.vertexData){var g=e.origin.id,y=e.origin.vec3,m=e.uniqueName,v=f.get(g);v||(v={origin:y,highlightCount:0,dataByGeometry:new Map},f.set(g,v)),a.setMatrixTranslation3(p,-y[0],-y[1],-y[2]);var _=i.mat4f64.create();r.mat4.multiply(_,p,e.transformation);var b=l.generateRenderGeometryVisibleIndexRanges(e),x=l.generateRenderGeometryHighlightRanges(e);x&&(v.highlightCount=null);var w=t.indexCount,S=t.id,C=new s(e.name,0,w,b,x,_,e.instanceParameters,e.idx,S),I=t.indexData?d.createIndex(h,35044,t.indexData):null,D=u._material.createBufferLayout(),P=new c(h,o.Default3D,{geometry:n.glLayout(D)},{geometry:d.createVertex(h,35044)},I);P.vertexBuffers.geometry.setData(t.vertexData),t.indexData=null,t.vertexData=null,v.dataByGeometry.set(m,{instance:C,vao:P})}else a.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else a.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}),t.forEach(function(e){var t=e.origin.id,r=e.uniqueName,i=f.get(t);i.dataByGeometry.get(r).vao.dispose(),i.dataByGeometry.delete(r),0===i.dataByGeometry.size&&f.delete(t)})},e.prototype.updateGeometries=function(e){var t=this;e.forEach(function(e){var r=e.updateType,i=e.renderGeometry,n=i.origin.id,o=i.uniqueName,a=t._dataByOrigin.get(n),s=a&&a.dataByGeometry.get(o).instance;s&&(1&r&&(s.displayedIndexRange=l.generateRenderGeometryVisibleIndexRanges(i)),17&r&&(s.highlightedIndexRanges=l.generateRenderGeometryHighlightRanges(i),a.highlightCount=null),2&r&&console.error("Updating Preinterleaved geometry not supported"),4&r&&l.calculateTransformRelToOrigin(i,s.transformation,s.transformationNormal))})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var r=0;t.dataByGeometry.forEach(function(e){e.instance.highlightedIndexRanges&&++r}),t.highlightCount=r}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,r,i){var n=this,o=this._rctx,a=this._glMaterials.get(t.pass),s=4===t.pass;if(!a||null!=e&&!a.beginSlot(e)||s&&0===this._highlightCount)return!1;a.bind(o,r);var l=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(r.origin=e.origin,a.bindView(o,r),s?e.dataByGeometry.forEach(function(e){l=n.renderInstanceHighlight(a,e,i)||l}):e.dataByGeometry.forEach(function(e){l=n.renderInstance(a,e,i)||l}))}),a.release(o,r),o.bindVAO(null),l},e.prototype.renderInstance=function(e,t,r){var i=t.instance,n=t.vao,o=i.displayedIndexRange;if(o&&0===o.length)return!1;var a=this._rctx,s=e.getProgram(),d=e.getDrawMode();u.assertCompatibleVertexAttributeLocations(n,s),a.bindVAO(n),e.bindInstance(a,i);var c=n.indexBuffer&&n.indexBuffer.indexType;if(o)c?l.drawElementsFaceRange(a,o,i.from,d,c,r):l.drawArraysFaceRange(a,o,i.from,d,r);else{var h=i.to-i.from;c?l.drawElements(a,d,c,i.from,h,r):l.drawArrays(a,d,i.from,h,r)}return!0},e.prototype.renderInstanceHighlight=function(e,t,r){var i=t.instance,n=t.vao,o=i.highlightedIndexRanges;if(!o)return!1;var a=this._rctx,s=e.getProgram(),d=e.getDrawMode();u.assertCompatibleVertexAttributeLocations(n,s),a.bindVAO(n),e.bindInstance(a,i);for(var c=n.indexBuffer&&n.indexBuffer.indexType,h=!1,p=0;p<o.length;p++){var f=o[p],g=f.range?f.range[0]+i.from:i.from,y=f.range?f.range[1]-f.range[0]+1:i.to-i.from;c?l.drawElements(a,d,c,g,y,r):l.drawArrays(a,d,g,y,r),h=!0}return h},e}(),p=i.mat4f64.create();return h}.apply(null,i))||(e.exports=n)},2552:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(2),r(1),r(10),r(11),r(36),r(97),r(43),r(58),r(79),r(6),r(9),r(71),r(0),r(635),r(1713),r(45),r(63),r(117),r(402),r(1780),r(1640),r(2008),r(2553),r(2554),r(2555),r(1641),r(1760),r(1761),r(1645),r(1762),r(41),r(1633),r(643),r(145)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h,p,f,g,y,m,v,_,b,x,w,S,C,I,D,P,O,M,N,E,F,T,R,L,V){var A=h.getLogger("esri.views.3d.layers.SceneLayerView3D"),j=N.defineFieldProperties(),G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._queryEngine=null,t.lodFactor=1,t.progressiveLoadFactor=1,t._elevationContext="scene",t._isIntegratedMesh=!1,t._asyncModuleLoading=0,t._projectionEngineLoaded=!1,t}return i(t,e),Object.defineProperty(t.prototype,"filter",{set:function(e){if(p.isNone(e))this._set("filter",null);else{var t=["contains","intersects","disjoint"];e.timeExtent?(A.warn("Filters with a timeExtent are not supported for mesh scene layers"),this._set("filter",null)):e.spatialRelationship&&-1===t.indexOf(e.spatialRelationship)?(A.warn("Filters with spatialRelationship other than "+t.join(", ")+" are not supported for mesh scene layers"),this._set("filter",null)):this._set("filter",e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedFilterWhereClause",{get:function(){var e=p.isSome(this.filter)?this.filter.where:null;if(!e)return null;try{return y.WhereClause.create(e,this.layer.fieldsIndex)}catch(e){A.error("Failed to parse filter where clause: "+e)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedFilterGeometry",{get:function(){var e=this;if(p.isNone(this.filter))return null;var t=this.filter,r=t.geometry,i=t.distance,n=t.units;if(!i)return r;if(!this._geometryEngine)return null;var o=n||f.getUnitString(r.spatialReference);if(r.spatialReference.isWGS84)return this._geometryEngine.geodesicBuffer(r,i,o);if(_.canProject(r,s.SpatialReference.WGS84))return _.project(this._geometryEngine.geodesicBuffer(_.project(r,s.SpatialReference.WGS84),i,o),r.spatialReference);if(!m.isSupported())return A.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(m.load()).then(function(){e._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var a=null;try{a=m.project(r,s.SpatialReference.WGS84)}catch(e){}if(a)try{a=m.project(this._geometryEngine.geodesicBuffer(a,i,o),r.spatialReference)}catch(e){a=null}return a||A.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+r.spatialReference.wkid+") to WGS84."),a},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){for(var e=this,t=0,r=["layer.renderer","definitionExpressionFields","filter"];t<r.length;t++){var i=r[t];this.updatingHandles.add(this,i,function(){return e._updateRequiredFields()})}this._updateRequiredFields(),this.updatingHandles.add(this.layer,"rangeInfos",function(t){return e._rangeInfosChanged(t)},2),this.updatingHandles.add(this.layer,"renderer",function(t){return e._rendererChange(t)},2);for(var n=0,o=["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"];n<o.length;n++){i=o[n];this.updatingHandles.add(this,i,function(){return e._filterChange()})}},t.prototype.destroy=function(){},t.prototype._updateRequiredFields=function(){return a(this,void 0,void 0,function(){var e,t,r,i,n,a,s,l;return o(this,function(o){switch(o.label){case 0:return t=(e=this).layer,r=e.layer,i=r.fields,n=r.renderer,a=e.definitionExpressionFields,s=e.filter,l=new Set,n?[4,n.collectRequiredFields(l,i)]:[3,2];case 1:o.sent(),o.label=2;case 2:return p.isSome(s)?[4,b.collectFilterFields(l,t,s)]:[3,4];case 3:o.sent(),o.label=4;case 4:return b.collectFields(l,i,a),this._set("requiredFields",c.valuesOfSet(l).sort()),[2]}})})},t.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&A.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return p.isSome(this.filter)?this.filter.createQuery(e):new x(e)},t.prototype.queryExtent=function(e){return u.safeCast(this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e)))},t.prototype.queryFeatureCount=function(e){return u.safeCast(this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e)))},t.prototype.queryFeatures=function(e){return u.safeCast(this._ensureQueryEngine().executeQuery(this._ensureQuery(e)))},t.prototype.queryObjectIds=function(e){return u.safeCast(this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e)))},t.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},t.prototype._createQueryEngine=function(){var e=this,t=this._createGetFeatureExtent();return new I.default({layerView:this,task:V.Task.FEATURE_QUERY_ENGINE,spatialIndex:new P.default({featureAdapter:new D.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:t}),forAllFeatures:function(t,r){return e._forAllFeatures(function(e,r,i){return t({id:e,index:r,meta:i})},r,2)},getFeatureExtent:t,sourceSpatialReference:O.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})},t.prototype._createGetFeatureExtent=function(){var e=this,t=new Float64Array(24),r=this.view.renderSpatialReference,i=this.view.spatialReference;return function(n){if(!n.meta.featureExtents){var o=new Float64Array(6*n.meta.featureIds.length);n.meta.featureExtents=o;for(var a=0;a<o.length;a+=6)o[a]=Number.POSITIVE_INFINITY}var s=n.meta.featureExtents,l=new Float64Array(s.buffer,6*n.index*Float64Array.BYTES_PER_ELEMENT,6);return l[0]===Number.POSITIVE_INFINITY?(e._boundingBoxCornerPoints(n.index,n.meta.engineObject,t),T.bufferToBuffer(t,r,0,t,i,0,8)?v.expandWithBuffer(v.NEGATIVE_INFINITY,t,0,8,l):v.set(l,v.ZERO)):l}},t.prototype.highlight=function(e,t){void 0===t&&(t={});var r=this._highlights;if(e instanceof x){var i=r.acquireSet(t),n=i.set,o=i.handle;return this.queryObjectIds(e).then(function(e){return r.setFeatureIds(n,e)}),o}return this.inherited(arguments)},t.prototype._createLayerGraphic=function(e){var t=new l(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t},t.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},t.prototype.isUpdating=function(){return this.updatingMeshView3D||this._asyncModuleLoading>0},t.prototype.getFilters=function(){var e=this,t=this.inherited(arguments);if(this.layer.objectIdFilter){var r=new Float64Array(this.layer.objectIdFilter.ids),i="include"===this.layer.objectIdFilter.method;r.sort(),t.push(function(t){return e._objectIdFilter(r,i,t)})}if(this.addSqlFilter(t,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError),p.isSome(this.filter)){if(p.isSome(this.parsedFilterGeometry)){var n=this.parsedFilterGeometry;t.push(function(t,r){return e._maskFilter(t,r,n)})}if(this.filter.objectIds){var o=new Float64Array(this.filter.objectIds);o.sort(),t.push(function(t){return e._objectIdFilter(o,!0,t)})}}return p.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(t,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError),t},t.prototype._maskFilter=function(e,t,r){if(!p.isNone(this.filter)){var i=r,n=i.spatialReference||this.view.spatialReference;T.mbsToMbs(t.node.mbs,this._controller.crsIndex,B,n);var o=this.filter.spatialRelationship,a=C.acquireMaskFilterContext(o,this.view,i,t.engineObject),s=C.intersectMaskWithMbs(a,B);switch(C.getIntersectRelation(a,s)){case 1:return void(e.length=0);case 0:return}t.engineObject.geometryRecords[0].geometry.componentCount===t.featureIds.length&&O.filterInPlace(e,t.featureIds,function(e){return C.filterMask(e,a)})}},t.prototype._filterChange=function(){var e=this;p.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(C.loadGeometryEngine()).then(function(t){e.destroyed||(e._set("_geometryEngine",t),e._applyFilters(!0))}):this.inherited(arguments)},t.prototype._loadAsyncModule=function(e){var t=this;this._set("_asyncModuleLoading",this._asyncModuleLoading+1);var r=function(){return t._set("_asyncModuleLoading",t._asyncModuleLoading-1)};return e.then(function(e){return r(),e},function(e){throw r(),e})},t.prototype._objectIdFilter=function(e,t,r){for(var i=0,n=0;i<r.length;)d.binaryIndexOf(e,r[i])>=0===t&&(r[n]=r[i],n++),i++;r.length=n},t.prototype._ensureQuery=function(e){return this._addDefinitionExpressionToQuery(p.isNone(e)?this.createQuery():x.from(e))},n([g.property()],t.prototype,"layer",void 0),n([g.property({dependsOn:["updatingMeshView3D","_asyncModuleLoading"]})],t.prototype,"updating",void 0),n([g.property({dependsOn:["_controller.rootNodeVisible"]})],t.prototype,"suspended",void 0),n([g.property(E.updatingPercentage)],t.prototype,"updatingPercentage",void 0),n([g.property({type:L})],t.prototype,"filter",null),n([g.property({readOnly:!0,dependsOn:["filter.where"]})],t.prototype,"parsedFilterWhereClause",null),n([g.property({readOnly:!0,dependsOn:["filter.geometry","filter.distance","filter.units","_geometryEngine","_projectionEngineLoaded"]})],t.prototype,"parsedFilterGeometry",null),n([g.property(j.requiredFields)],t.prototype,"requiredFields",void 0),n([g.property(j.availableFields)],t.prototype,"availableFields",void 0),n([g.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],t.prototype,"lodFactor",void 0),n([g.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],t.prototype,"updatingPercentageValue",void 0),n([g.property({readOnly:!0})],t.prototype,"_asyncModuleLoading",void 0),n([g.property({readOnly:!0})],t.prototype,"_geometryEngine",void 0),n([g.property({readOnly:!0})],t.prototype,"_projectionEngineLoaded",void 0),n([g.subclass("esri.views.3d.layers.SceneLayerView3D")],t)}(g.declared(w.I3SMeshView3D(M.DefinitionExpressionSceneLayerView(F.PopupSceneLayerView(S.LayerView3D(R)))))),B=[0,0,0,0];return G}.apply(null,i))||(e.exports=n)},2553:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(10),r(11),r(16),r(14),r(22),r(9),r(0),r(37),r(1679),r(1575),r(402)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u,c,h,p,f){Object.defineProperty(t,"__esModule",{value:!0});var g=h.default,y=function(e){function t(t){var r=e.call(this)||this;return r._dataQueryEngineInstance=null,r._handles=new l,r}return i(t,e),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new f({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return e.spatialIndex.events.emit("changed")}))},t.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null),this._handles&&(this._handles.destroy(),this._handles=null),this._set("layerView",null)},t.prototype.executeQueryForCount=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return r=n.sent(),i=r.count,o=r.extent,a=c.fromJSON(o),[2,{count:i,extent:a}]}})})},t.prototype.executeQueryForIds=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a=this;return n(this,function(n){switch(n.label){case 0:if((r=this._ensureQueryJSON(e)).returnGeometry)throw new s("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(r.returnCentroid)throw new s("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");return[4,this.dataQueryEngine.executeQuery(r,t)];case 1:return i=n.sent(),(o=p.fromJSON(i)).features.forEach(function(e){e.geometry=null,e.layer=a.layer,e.sourceLayer=a.layer}),[2,o]}})})},t.prototype._ensureQueryJSON=function(e){if(d.isNone(e))return this.defaultQueryJSON;var t=e.toJSON();return t.outSpatialReference||(e.outSpatialReference=this.spatialReference),t},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e=this.layer.objectIdField||"OBJECTID",t=this.layer.fields.map(function(e){return e.toJSON()}),r=this.layerView.view.resourceController.scheduler,i=this.spatialReference.toJSON(),n=this.task,o=this.spatialIndex;return this._dataQueryEngineInstance=new g({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:t,timeInfo:null,spatialReference:i,objectIdField:e,featureStore:o,scheduler:r,task:n}),this._dataQueryEngineInstance},r([u.property({constructOnly:!0})],t.prototype,"layerView",void 0),r([u.property({constructOnly:!0})],t.prototype,"task",void 0),r([u.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),r([u.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r([u.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r([u.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r([u.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],t)}(u.declared(a));t.I3SQueryEngine=y,t.default=y}.apply(null,i))||(e.exports=n)},2554:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(45),r(1663),r(404),r(1641)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.objectIdField=e.objectIdField,this.getFeatureExtent=e.getFeatureExtent}return e.prototype.getObjectId=function(e){return e.id},e.prototype.getAttributes=function(e){var t=e.meta,r=e.index,i={};this.objectIdField&&(i[this.objectIdField]=e.id);var n=t.attributeInfo.attributeData;if(null!=n)for(var a=0,s=Object.keys(n);a<s.length;a++){var l=s[a];i[l]=o.getCachedAttributeValue(n[l],r)}return i},e.prototype.getAttribute=function(e,t){if(t===this.objectIdField)return e.id;var r=e.meta,i=e.index,n=r.attributeInfo.attributeData;return null==n?null:o.getCachedAttributeValue(n[t],i)},e.prototype.getGeometry=function(e){if(e.geometry)return e.geometry;var t=this.getFeatureExtent(e,s),r=t[0],i=t[1],o=t[2],a=t[3],l=t[4];return new n.default([5],[r,i,o,a,i,o,a,l,o,r,l,o,r,i,o])},e.prototype.getCentroid=function(e,t){if(e.geometry)return i.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM);var r=this.getFeatureExtent(e,s),o=r[0],a=r[1],l=r[2],d=r[3],u=r[4],c=r[5];return new n.default([0],[(o+d)/2,(a+u)/2,(l+c)/2])},e.prototype.cloneWithGeometry=function(e,t){return{id:e.id,index:e.index,meta:e.meta,geometry:t}},e}();t.I3SQueryFeatureAdapter=a;var s=r.create()}.apply(null,i))||(e.exports=n)},2555:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(16),r(49),r(0),r(35),r(45),r(33),r(41)],void 0===(n=function(e,t,r,i,n,o,a,s,l,d,u){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t){var r=e.call(this)||this;return r.events=new o,r}return r(t,e),t.prototype.destroy=function(){},t.prototype.forEach=function(e){this.forAllFeatures(function(t){return e(t),1})},t.prototype.forEachBounds=function(e,t,r){for(var i=this.getFeatureExtent,n=0,o=e;n<o.length;n++)t(i(o[n],r))},t.prototype.forEachInBounds=function(e,t){var r=this;this.forAllFeatures(function(i){var n=r.getFeatureExtent(i,p);return d.intersects(e,l.toRect(n,f))&&t(i),1},function(t){if(u.mbsToMbs(t.node.mbs,r.sourceSpatialReference,h,r.viewSpatialReference),h[0]>=e[0]&&h[2]<=e[2]&&h[1]>=e[1]&&h[3]<=e[3])return 1;var i=Math.max(e[0],Math.min(h[0],e[2])),n=Math.max(e[1],Math.min(h[1],e[3])),o=h[0]-i,a=h[1]-n;return o*o+a*a<=h[3]*h[3]?1:2})},i([a.property({constructOnly:!0})],t.prototype,"featureAdapter",void 0),i([a.property({constructOnly:!0})],t.prototype,"forAllFeatures",void 0),i([a.property({constructOnly:!0})],t.prototype,"getFeatureExtent",void 0),i([a.property({constructOnly:!0})],t.prototype,"sourceSpatialReference",void 0),i([a.property({constructOnly:!0})],t.prototype,"viewSpatialReference",void 0),i([a.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],t)}(a.declared(n));t.I3SQueryFeatureStore=c;var h=s.vec4f64.create(),p=l.create(),f=d.create();t.default=c}.apply(null,i))||(e.exports=n)}}]);