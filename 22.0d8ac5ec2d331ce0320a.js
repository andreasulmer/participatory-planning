(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/support/ClipArea":1634,"esri/views/2d/layers/LayerView2D":1647,"esri/views/layers/support/ClipRect":1648,"esri/views/layers/support/Geometry":1649,"esri/views/layers/support/Path":1650,"esri/renderers/support/clickToleranceUtils":1656,"esri/views/2d/layers/support/popupUtils2D":1741,"esri/views/2d/layers/FeatureLayerView2D":2071,"esri/views/2d/layers/features/support/rendererUtils":2072,"esri/views/2d/layers/features/tileRenderers":2518,"esri/views/2d/layers/support/FeatureLayerProxy":2519,"esri/views/2d/layers/support/util":2520})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1634:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(12),r(0)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),r([o.subclass("esri.views.layers.support.ClipArea")],t)}(o.declared(n.JSONSupport))}.apply(null,i))||(e.exports=n)},1647:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(29),r(146),r(25),r(0),r(1634),r(1648),r(1649),r(1650)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c){Object.defineProperty(t,"__esModule",{value:!0});var h=n.ofType({key:"type",base:u,typeMap:{rect:l,path:c,geometry:p}});t.LayerView2D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=new h,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.when(function(){e.requestUpdate()},function(){});var t=function(){return e.notifyChange("rendering")};this.handles.add([s.init(this,"suspended",function(t){e.container&&(e.container.visible=!t),e.view&&!t&&e.updateRequested&&e.view.requestLayerViewUpdate(e)},!0),s.init(this,"fullOpacity",function(t){e.container&&(e.container.opacity=t)},!0),s.on(this,"container","post-render",t),s.on(this,"container","will-render",t)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,r=this.layer,i=r.minScale,n=r.maxScale;if(null!=i&&null!=n){var o=!i,s=!n;!o&&e<=i&&(o=!0),!s&&e>=n&&(s=!0),t=o&&s}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e&&(e=this.isVisibleAtScale(this.view.scale)),e},i([a.property({type:h,set:function(e){var t=o.referenceSetter(e,this._get("clips"),h);this._set("clips",t)}})],t.prototype,"clips",void 0),i([a.property()],t.prototype,"moving",void 0),i([a.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),i([a.property()],t.prototype,"attached",void 0),i([a.property()],t.prototype,"container",void 0),i([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),i([a.property({readOnly:!0})],t.prototype,"updateParameters",void 0),i([a.property()],t.prototype,"updateRequested",void 0),i([a.property({dependsOn:["updateRequested","attached","suspended"]})],t.prototype,"updating",null),i([a.property()],t.prototype,"view",void 0),i([a.subclass("esri.views.2d.layers.LayerView2D")],t)}(a.declared(e))}}.apply(null,i))||(e.exports=n)},1648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(0),r(1634)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="rect",t.left=null,t.right=null,t.top=null,t.bottom=null,t}var o;return i(t,e),o=t,t.prototype.clone=function(){return new o({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0),r([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0),r([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0),r([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0),r([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],t.prototype,"version",null),o=r([n.subclass("esri.views.layers.support.ClipRect")],t)}(n.declared(o))}.apply(null,i))||(e.exports=n)},1649:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(36),r(0),r(72),r(57),r(1634)],void 0===(n=function(e,t,r,i,n,o,s,a,u){var l={base:s,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="geometry",t.geometry=null,t}var n;return i(t,e),n=t,Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({geometry:this.geometry.clone()})},r([o.property({types:l,json:{read:a.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r([o.property({readOnly:!0,dependsOn:["geometry"]})],t.prototype,"version",null),n=r([o.subclass("esri.views.layers.support.Geometry")],t)}(o.declared(u))}.apply(null,i))||(e.exports=n)},1650:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(0),r(1634)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="path",t.path=[],t}return i(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r([n.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0),r([n.property({readOnly:!0,dependsOn:["path"]})],t.prototype,"version",null),r([n.subclass("esri.views.layers.support.Path")],t)}(n.declared(o))}.apply(null,i))||(e.exports=n)},1656:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):t&&t.yoffset?Math.max(e,Math.abs(t.yoffset)):e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;var r=t.filter(function(e){return"size"===e.type}).map(function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2}),n=0,o=r.length;if(0===o)return e;for(var s=0;s<o;s++)n+=r[s];var a=Math.floor(n/o);return Math.max(a,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){if(!e)return 6;var t="visualVariables"in e?n(6,e.visualVariables):6;if("simple"===e.type)return r(t,e.symbol);if("unique-value"===e.type){var i=t;return e.uniqueValueInfos.forEach(function(e){i=r(i,e.symbol)}),i}if("class-breaks"===e.type){var o=t;return e.classBreakInfos.forEach(function(e){o=r(o,e.symbol)}),o}return e.type,t}}.apply(null,i))||(e.exports=n)},1741:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(3),r(1),r(37)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=function(e,t,r){var i=r.get("state.resolution"),o=t*("number"==typeof i?i:1),s=e.clone().offset(-o,-o),a=e.clone().offset(o,o),u=r.spatialReference;return new n({xmin:Math.min(s.x,a.x),ymin:Math.min(s.y,a.y),xmax:Math.max(s.x,a.x),ymax:Math.max(s.y,a.y),spatialReference:u})}}.apply(null,i))||(e.exports=n)},2071:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(144),r(4),r(10),r(11),r(36),r(97),r(43),r(58),r(29),r(14),r(18),r(79),r(6),r(9),r(7),r(25),r(0),r(1656),r(1575),r(402),r(184),r(1647),r(2518),r(2072),r(2519),r(1741),r(2520),r(658),r(2073),r(1633),r(640),r(643),r(2074)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,h,d,y,f,v,g,_,b,m,w,R,x,S,O,F,P,C,I,q,j,M,V,U,T,E){var H=v.getLogger("esri.views.2d.layers.FeatureLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pipelineIsUpdating=!0,t._updatingPipelineConfig=!1,t._visibilityOverrides=new Set,t._effect=null,t._highlightIds=new Map,t.container=new S.Container,t.filter=null,t._onRenderingConfigChange=_.debounce(c.safeCastFunction(function(){return a(t,void 0,void 0,function(){var e,t,r,i,n,o,a,u,l,p,c,h,d;return s(this,function(s){switch(s.label){case 0:return this._hasRequiredSupport(this.layer)?(this._set("_updatingPipelineConfig",!0),[4,this._updateRequiredFields()]):[2];case 1:return s.sent(),e=this.availableFields.join("."),t=this._createLayerFilterHash(),r=this._createTileRendererHash(),i=this._createFeatureDataHash(),n=this._createMeshHash(),this._lockAttributeTextureUpload(),r===this._tileRendererHash?[3,10]:[4,this._initTileRenderer()];case 2:return s.sent(),function(e){return e&&"openPorts"in e}(this.layer.source)?[4,this._createMemoryServiceOptions(this.layer.source)]:[3,4];case 3:return a=s.sent(),[3,5];case 4:a=this._createServiceOptions(),s.label=5;case 5:return o=a,[4,this._proxy.startup(this.view.featuresTilingScheme,this._createConfiguration(),o)];case 6:return s.sent(),this.hasHighlight()?[4,this._proxy.setHighlight(f.keysOfMap(this._highlightIds))]:[3,8];case 7:s.sent(),s.label=8;case 8:return[4,this._onceTilesUpdated()];case 9:return s.sent(),[3,14];case 10:return u=e!==this._clientDataHash,l=t!==this._layerFilterHash,p=i!==this._featureDataHash||u,c=n!==this._meshHash,h=this._createConfiguration(),u||l||p||c?(d={invalidateFeatureData:p,invalidateMesh:c,layerFilterChanged:l},this._set("_pipelineIsUpdating",!0),[4,this._proxy.update(h,d)]):[3,12];case 11:s.sent(),s.label=12;case 12:return l?[4,this._onceTilesUpdated()]:[3,14];case 13:s.sent(),s.label=14;case 14:return this._clientDataHash=e,this._layerFilterHash=t,this._tileRendererHash=r,this._meshHash=n,this._featureDataHash=i,this.effects.forEach(function(e){return g.isSome(e)&&g.isSome(e.filter)&&e.filter.enable()}),this.tileRenderer.invalidateLabels(),this.tileRenderer.onConfigUpdate(),this._unlockAttributeTextureUpload(),this._forceAttributeTextureUpload(),this.requestUpdate(),[2]}})})})),t._updateHighlight=_.debounce(function(){return a(t,void 0,void 0,function(){return s(this,function(e){return[2,this._proxy.setHighlight(f.keysOfMap(this._highlightIds))]})})}),t}return r(t,e),t.prototype.destroy=function(){this._proxy.destroy()},t.prototype.initialize=function(){var e=this;this.addResolvingPromise(c.safeCast(this._initProxy())),this.handles.add([this.clips.on("change",function(){return e.tileRenderer&&e.tileRenderer.onConfigUpdate()})])},t.prototype._initProxy=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){if(this.layer.isTable)throw new d("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});return this._proxy&&this._proxy.destroy(),e=this._createClientOptions(),this._set("_proxy",new C.default({client:e})),[2,this._proxy.when()]})})},Object.defineProperty(t.prototype,"labelsVisible",{get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effect",{get:function(){return g.unwrapOr(this._effect,null)},set:function(e){var t=this._effect;g.isSome(t)&&g.isSome(t.filter)&&t.filter.enabled&&g.isSome(e)&&g.isSome(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effects",{get:function(){return this.effect&&[this.effect]||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numFeatures",{get:function(){var e=0;return this.attached&&this._tileStrategy.tiles.forEach(function(t){e+=t.iconDisplayRecords?t.iconDisplayRecords.length:0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingConfigHash",{get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=t.definitionExpression,i=t.renderer,n=t.labelingInfo,o="historicMoment"in this.layer?this.layer.historicMoment:null,s=this.timeExtent,a="filter"in this.layer&&this.layer.filter&&""+JSON.stringify(this.layer.filter.geometry)+this.layer.filter.where,u=JSON.stringify(this.clips);return JSON.stringify({filterHash:g.isSome(this.filter)&&this.filter.toJSON(),effectHash:g.isSome(this.effect)&&this.effect.toJSON(),streamFilter:a,definitionExpression:r,historicMoment:o,availableFields:e,renderer:i,labelingInfo:n,timeExtent:s,clipsHash:u})},enumerable:!0,configurable:!0}),t.prototype.highlight=function(e){var t,r=this;return e instanceof l?t=[e.getAttribute(this.layer.objectIdField||"__esri_stream_id__")]:"number"==typeof e?t=[e]:h.isCollection(e)?t=e.map(function(e){return e&&e.getAttribute(r.layer.objectIdField)}).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]?e:e.map(function(e){return e&&e.getAttribute(r.layer.objectIdField)})),t&&t.length?(t=t.filter(function(e){return null!=e}),this._addHighlight(t),{remove:function(){return r._removeHighlight(t)},pause:function(){return r._removeHighlight(t)},resume:function(){return r._addHighlight(t)}}):{remove:function(){},pause:function(){},resume:function(){}}},t.prototype.hasHighlight=function(){return!!this._highlightIds.size},t.prototype.hitTest=function(e,t){return c.safeCast(this._hitTest(e,t))},t.prototype.queryFeatures=function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then(function(e){var t=R.fromJSON(e);return t.features.forEach(function(e){e.layer=r.layer,e.sourceLayer=r.layer}),t})},t.prototype.queryFeaturesJSON=function(e,t){return c.safeCast(this._proxy.queryFeatures(this._cleanUpQuery(e),t))},t.prototype.queryObjectIds=function(e,t){return c.safeCast(this._proxy.queryObjectIds(this._cleanUpQuery(e),t))},t.prototype.queryFeatureCount=function(e,t){return c.safeCast(this._proxy.queryFeatureCount(this._cleanUpQuery(e),t))},t.prototype.queryExtent=function(e,t){return c.safeCast(this._proxy.queryExtent(this._cleanUpQuery(e),t).then(function(e){return{count:e.count,extent:u.Extent.fromJSON(e.extent)}}))},t.prototype.setVisibility=function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._renderingConfigHashChanged()},t.prototype.update=function(e){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(e)||this.requestUpdate(),this._proxy.setViewState(e.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))},t.prototype.attach=function(){var e=this;this.view.timeline.record(this.layer.title+" (FeatureLayer) Attach"),this._tileStrategy=new j({cachePolicy:"purge",acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add([b.watch(this,"layer.processing?.version",function(t){return e._proxy.redraw()}),this.layer.on("edits",function(t){return e._proxy.onEdits(t)}),b.init(this,"renderingConfigHash",function(){return e._renderingConfigHashChanged()},!0)],"attach")},t.prototype.detach=function(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.fetchPopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var r,i,n;return s(this,function(o){return(r=this.validateFetchPopupFeatures(t))?[2,_.reject(r)]:g.isSome(t)&&0===t.clientGraphics.length?[2,_.resolve([])]:(i=this.fetchClientPopupFeatures(t),e?(n=this._fetchServicePopupFeatures(e,t),[2,_.eachAlwaysValues([i,n]).then(p.flatten)]):[2,i])})})},t.prototype._fetchServicePopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var r,i,n,o,a,u,l,p,c,h;return s(this,function(s){switch(s.label){case 0:return[4,this.createPopupQuery(t)];case 1:if(r=s.sent(),i=this.layer,n=i.renderer,o=w.calculateTolerance(n),r.geometry=this.createFetchPopupFeaturesQueryGeometry(e,o),a=new Set,u=i.objectIdField,l=g.isSome(t)?t.clientGraphics:null)for(p=0,c=l;p<c.length;p++)h=c[p],a.add(h.attributes[u]);return[2,i.queryFeatures(r).then(function(e){return e.features.filter(function(e){return!a.has(e.attributes[u])})})]}})})},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return I.createQueryGeometry(e,t,this.view)},t.prototype.doRefresh=function(e){return a(this,void 0,void 0,function(){return s(this,function(e){return this._proxy.refresh(),[2]})})},t.prototype.isUpdating=function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating)},t.prototype._createClientOptions=function(){var e=this;return{executeProcessing:function(t){if(!("processing"in e.layer&&e.layer.processing))return t.featureSet;var r=e.layer.processing;return r.process(t.featureSet,r.options)||_.reject(new d("FeatureLayer","invalid processing.process() method, returns nothing"))},setUpdating:function(t){e._set("_pipelineIsUpdating",t)}}},t.prototype._createServiceOptions=function(){var e=this.layer,t=e.capabilities,r=e.objectIdField,i=e.fields.map(function(e){return e.toJSON()}),n=e.fullExtent&&e.fullExtent.toJSON(),o=q.toJSONGeometryType(e.geometryType),s=e.timeInfo&&e.timeInfo.toJSON()||null;return{type:"on-demand",maxRecordCount:"maxRecordCount"in this.layer&&this.layer.maxRecordCount,tileMaxRecordCount:"tileMaxRecordCount"in this.layer&&this.layer.tileMaxRecordCount,capabilities:t,fields:i,fullExtent:n,geometryType:o,objectIdField:r,source:"dynamicDataSource"in e?e.dynamicDataSource?e.parsedUrl:e.url+"/"+e.layerId:e.parsedUrl,timeInfo:s}},t.prototype._createMemoryServiceOptions=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return[4,e.openPorts()];case 1:return t=r.sent(),[2,o({},this._createServiceOptions(),{type:"memory",source:t})]}})})},t.prototype._cleanUpQuery=function(e){var t=x.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t},t.prototype._acquireTile=function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",function(){t.requestUpdate()}),r},t.prototype._releaseTile=function(e){this.tileRenderer.releaseTile(e)},t.prototype._initTileRenderer=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,F.createOrReuseTileRenderer(this.tileRenderer,this.layer.renderer,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer})];case 1:return e=t.sent(),this.tileRenderer?(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null,[4,this._initProxy()]):[3,3];case 2:t.sent(),t.label=3;case 3:return this._proxy.tileRenderer=e,this._set("tileRenderer",e),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(),[2,this.tileRenderer]}})})},t.prototype._createLayerFilterHash=function(){return this.layer.definitionExpression+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime())+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion)},t.prototype._createTileRendererHash=function(){return("heatmap"===this.layer.renderer.type?"heatmap":"symbol")+"."+("dot-density"===this.layer.renderer.type)},t.prototype._createFeatureDataHash=function(){var e=this.layer.renderer.getAttributeHash(),t=JSON.stringify(this.filter),r=g.isSome(this.effect)&&JSON.stringify(this.effect.filter),i=JSON.stringify(this.timeExtent),n="";return this._visibilityOverrides.forEach(function(e){return n+=e}),e+"."+t+"."+r+"."+i+"."+n},t.prototype._createMeshHash=function(){var e=this.layer.renderer,t=S.getVVFlags("visualVariables"in e&&e.visualVariables||[]),r=this.layer.labelingInfo&&this.layer.labelingInfo.map(function(e){return JSON.stringify(e)}).join("/");return e.getMeshHash()+"."+t+"."+r},t.prototype._injectOverrides=function(e){var t=this.filter&&this.filter.timeExtent,r=this.timeExtent&&t?this.timeExtent.intersection(t):this.timeExtent||t;if(!this._visibilityOverrides.size&&!r)return e;var i=g.isSome(this.filter)&&this.filter.clone()||new T;return i.hiddenIds=this._visibilityOverrides,i.timeExtent=r,i},t.prototype._createConfiguration=function(){var e=P.simplifyVVRenderer(this.layer.renderer),t=this.layer.labelingInfo,r=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime(),i=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion,n=new Array(S.definitions.MAX_FILTERS),o=this._injectOverrides(this.filter);return n[0]=g.isSome(o)&&o.toJSON()||null,n[1]=g.isSome(this.effect)&&this.effect.filter&&this.effect.filter.toJSON()||null,{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,labelingInfo:t&&t.map(function(e){return e.toJSON()}),renderer:e.toJSON(),gdbVersion:i,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:n,processing:"processing"in this.layer&&this.layer.processing&&this.layer.processing.toWorker()}},t.prototype._hasRequiredSupport=function(e){return!("dot-density"===e.renderer.type&&!y("esri-webgl-texture-float")&&(H.error(new d("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))},t.prototype._onceTilesUpdated=function(){return this.requestUpdate(),b.whenFalseOnce(this,"_pipelineIsUpdating",!0)},t.prototype._lockAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.lockAttributeTextureUpload()},t.prototype._unlockAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.unlockAttributeTextureUpload()},t.prototype._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()},t.prototype._renderingConfigHashChanged=function(){var e=this;this.view.timeline.begin(this.layer.title+" (FeatureLayer) Initial Pipeline Config");var t=this._onRenderingConfigChange();this._updatingPromise=t;var r=function(){t===e._updatingPromise&&e._set("_updatingPipelineConfig",!1),e.view.timeline.end(e.layer.title+" (FeatureLayer) Initial Pipeline Config")};t.then(r).catch(function(e){_.isAbortError(e)||H.error(e),r()})},t.prototype._addHighlight=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(this._highlightIds.has(i)){var n=this._highlightIds.get(i);this._highlightIds.set(i,n+1)}else this._highlightIds.set(i,1)}this._updateHighlight().catch(function(e){_.isAbortError(e)||H.error(e)})},t.prototype._removeHighlight=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(this._highlightIds.has(i)){var n=this._highlightIds.get(i)-1;0===n?this._highlightIds.delete(i):this._highlightIds.set(i,n)}}this._updateHighlight().catch(function(e){_.isAbortError(e)||H.error(e)})},t.prototype._hitTest=function(e,t){return a(this,void 0,void 0,function(){var r,i,n,o;return s(this,function(s){switch(s.label){case 0:return this.suspended||!this.tileRenderer?[2,null]:[4,this.tileRenderer.hitTest(e,t)];case 1:return 0!==(r=s.sent()).length?[3,3]:[4,_.after(1)];case 2:return s.sent(),[2,null];case 3:return[4,this._proxy.getObjectId(r[0])];case 4:return i=s.sent(),[4,this._proxy.queryFeatures(new x({objectIds:[i],outSpatialReference:this.view.spatialReference,returnGeometry:!0}))];case 5:return(n=s.sent()).features[0]?((o=l.fromJSON(n.features[0])).layer=this.layer,o.sourceLayer=this.layer,g.isSome(o.geometry)&&(o.geometry.spatialReference=this.view.spatialReference),[2,o]):[2,null]}})})},i([m.property()],t.prototype,"_proxy",void 0),i([m.property()],t.prototype,"_pipelineIsUpdating",void 0),i([m.property()],t.prototype,"_updatingPipelineConfig",void 0),i([m.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],t.prototype,"labelsVisible",null),i([m.property({type:T})],t.prototype,"filter",void 0),i([m.property({type:E})],t.prototype,"effect",null),i([m.property({readOnly:!0,dependsOn:["effect"]})],t.prototype,"effects",null),i([m.property()],t.prototype,"numFeatures",null),i([m.property({dependsOn:["layer.renderer","availableFields","layer.definitionExpression","layer.filter?","layer.historicMoment?","layer.labelingInfo","filter","effect","timeExtent","clips"]})],t.prototype,"renderingConfigHash",null),i([m.property()],t.prototype,"tileRenderer",void 0),i([m.property({dependsOn:["layer.renderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_updatingRequiredFieldsPromise","_proxy","_proxy.isReady?"]})],t.prototype,"updating",void 0),i([m.subclass("esri.views.2d.layers.FeatureLayerView2D")],t)}(m.declared(M.FeatureLayerView(U.RefreshableLayerView(O.LayerView2D(V)))))}.apply(null,i))||(e.exports=n)},2072:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(6),r(17),r(184)],void 0===(n=function(e,t,r,i,n){function o(e){return e.stops=function(e,t){return t.length<=u?t:(l.warn("Found "+t.length+" Visual Variable stops, but MapView only supports "+u+". Displayed stops will be simplified."),t.length>2*u?function(e,t){for(var r=t[0],n=t.slice(1),o=n.pop(),u=n[0].value,l=n[n.length-1].value,p=(l-u)/a,c=[],h=u;h<l;h+=p){for(var d=0;h>=n[d].value;)d++;var y=n[d],f=t[d-1],v=h-f.value,g=y.value===f.value?1:v/(y.value-f.value);if("color"===e){var _=n[d],b=t[d-1],m=_.color.clone();m.r=s(b.color.r,m.r,g),m.g=s(b.color.g,m.g,g),m.b=s(b.color.b,m.b,g),m.a=s(b.color.a,m.a,g),c.push({value:h,color:m,label:_.label})}else if("size"===e){var w=n[d],R=t[d-1],x=i.toPt(w.size),S=i.toPt(R.size),O=s(S,x,g);c.push({value:h,size:O,label:w.label})}else{var F=n[d],P=t[d-1],C=s(P.opacity,F.opacity,g);c.push({value:h,opacity:C,label:F.label})}}return[r].concat(c,[o])}(e,t):function(e){for(var t=e[0],r=e.slice(1),i=r.pop();r.length>a;){for(var n=0,o=0,s=1;s<r.length;s++){var u=r[s-1],l=r[s],p=Math.abs(l.value-u.value);p>o&&(o=p,n=s)}r.splice(n,1)}return[t].concat(r,[i])}(t))}(e.type,e.stops),e}function s(e,t,r){return(1-r)*e+r*t}Object.defineProperty(t,"__esModule",{value:!0});var a=n.definitions.WEBGL_MAX_INNER_STOPS,u=n.definitions.WEBGL_MAX_STOPS,l=r.getLogger("esri.renderers.visualVariables.support.utils");t.simplifyVVRenderer=function(e){if(!("visualVariables"in e&&e.visualVariables&&e.visualVariables.length))return e;var t=e.clone(),r=t.visualVariables.map(function(e){return function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?o(e):e});return t.visualVariables=r,t}}.apply(null,i))||(e.exports=n)},2518:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(313),r(7)],void 0===(n=function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createOrReuseTileRenderer=function(e,t,o){if(!t)return n.resolve(null);switch(t.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return n.create(function(e){i(function(){return r.e(82).then(function(){var t=[r(2581)];e.apply(null,t)}.bind(this)).catch(r.oe)})}).then(function(e){return e.default}).then(function(e){return new e(o)});case"heatmap":return n.create(function(e){i(function(){return r.e(87).then(function(){var t=[r(2583)];e.apply(null,t)}.bind(this)).catch(r.oe)})}).then(function(e){return e.default}).then(function(e){return new e(o)})}return n.resolve(null)}}.apply(null,i))||(e.exports=n)},2519:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(4),r(10),r(11),r(225),r(7),r(407),r(405),r(0),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,h){Object.defineProperty(t,"__esModule",{value:!0});var d=function(t){function n(e){var r=t.call(this,e)||this;return r._startupResolver=u.createResolver(),r.isReady=!1,r}return r(n,t),n.prototype.initialize=function(){this._controller=u.createAbortController(),this.addResolvingPromise(this._startWorker(this._controller.signal))},n.prototype.destroy=function(){this._connection.close(),this._controller.abort()},Object.defineProperty(n.prototype,"tileRenderer",{set:function(e){this.client.tileRenderer=e},enumerable:!0,configurable:!0}),n.prototype.startup=function(e,t,r){return s(this,void 0,void 0,function(){var i,n,s,a;return o(this,function(o){switch(o.label){case 0:return i=this._controller.signal,n=function(e){return Array.isArray(e)}(r.source)?{transferList:r.source,signal:i}:void 0,s=e.tileInfo.toJSON(),a={service:r,config:t,tileInfo:s},[4,this._connection.invoke("startup",a,n)];case 1:return o.sent(),this._startupResolver.resolve(),this._set("isReady",!0),[2]}})})},n.prototype.update=function(e,t){return s(this,void 0,void 0,function(){var r;return o(this,function(i){switch(i.label){case 0:return r={config:e,options:t},[4,this._startupResolver.promise];case 1:return i.sent(),[2,this._connection.invoke("update",r)]}})})},n.prototype.setHighlight=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._startupResolver.promise];case 1:return t.sent(),[2,this._connection.invoke("controller.setHighlight",e)]}})})},n.prototype.refresh=function(){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this._startupResolver.promise];case 1:return e.sent(),[2,this._connection.invoke("controller.refresh")]}})})},n.prototype.redraw=function(){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this._startupResolver.promise];case 1:return e.sent(),[2,this._connection.invoke("controller.redraw")]}})})},n.prototype.setViewState=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._startupResolver.promise];case 1:return t.sent(),[2,this._connection.invoke("setViewState",e.toJSON())]}})})},n.prototype.queryFeatures=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this._startupResolver.promise];case 1:return r.sent(),[2,this._connection.invoke("controller.queryFeatures",e.toJSON(),t)]}})})},n.prototype.queryObjectIds=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this._startupResolver.promise];case 1:return r.sent(),[2,this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)]}})})},n.prototype.queryFeatureCount=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this._startupResolver.promise];case 1:return r.sent(),[2,this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)]}})})},n.prototype.queryExtent=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){return[2,this._connection.invoke("controller.queryExtent",e.toJSON(),t)]})})},n.prototype.queryLatestObservations=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this._startupResolver.promise];case 1:return r.sent(),[2,this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)]}})})},n.prototype.getObjectId=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._startupResolver.promise];case 1:return t.sent(),[2,this._connection.invoke("controller.getObjectId",e)]}})})},n.prototype.getLocalId=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._startupResolver.promise];case 1:return t.sent(),[2,this._connection.invoke("controller.getLocalId",e)]}})})},n.prototype.mapValidLocalIds=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._startupResolver.promise];case 1:return t.sent(),[2,this._connection.invoke("controller.mapValidLocalIds",e)]}})})},n.prototype.onEdits=function(e){return s(this,void 0,void 0,function(){var t,r,i;return o(this,function(n){switch(n.label){case 0:return[4,this._startupResolver.promise];case 1:return n.sent(),t=e.addedFeatures,r=e.deletedFeatures,i=e.updatedFeatures,[2,this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:r,updatedFeatures:i})]}})})},n.prototype.enableEvent=function(e,t){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this._startupResolver.promise];case 1:return r.sent(),[2,this._connection.invoke("controller.enableEvent",{name:e,value:t})]}})})},n.prototype._startWorker=function(t){return s(this,void 0,void 0,function(){var r,i;return o(this,function(n){switch(n.label){case 0:return r=l.getAbsMid("../features/Pipeline",e,h),[4,p.open(r,{client:this.client,strategy:"dedicated",signal:t})];case 1:return i=n.sent(),this._connection=i,[2]}})})},i([c.property()],n.prototype,"isReady",void 0),i([c.property()],n.prototype,"client",void 0),i([c.property()],n.prototype,"tileRenderer",null),i([c.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],n)}(c.declared(a.EsriPromise));t.default=d}.apply(null,i))||(e.exports=n)},2520:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(27)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});t.toJSONGeometryType=function(e){return i.toJSON(e)}}.apply(null,i))||(e.exports=n)}}]);