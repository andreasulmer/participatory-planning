(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1675,"esri/layers/graphics/data/QueryEngineCapabilities":1680,"esri/layers/graphics/data/FeatureStore":1695,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1714,"esri/views/2d/layers/graphics/graphicsUtils":1716,"esri/views/2d/layers/features/support/AttributeStore":1792,"esri/views/2d/layers/features/controllers/BaseController":1832,"esri/views/2d/layers/features/support/pixelBuffering":2535})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1675:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1663),r(634),r(404)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(11),r(3),r(14),r(49),r(18),r(6),r(9),r(1674),r(45),r(33),r(227),r(1675)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,c,p,f,d,h){Object.defineProperty(t,"__esModule",{value:!0});var y=[],m=u.getLogger("esri.layers.graphics.data.FeatureStore"),v={minX:0,minY:0,maxX:0,maxY:0},g=function(){function e(e,t,r){this._geometryInfo=e,this._onFeatureAdd=t,this._onFeatureRemove=r,this._featuresById=new Map,this._boundsByFeature=new Map,this._featuresByBounds=new Map,this._index=c(9,s("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this.events=new o,this.featureAdapter=h.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=f.create(f.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e,y),this._index.load(y),this._emitChanged(),y.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i,y)}this._index.load(y),this._emitChanged(),y.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);if(!t)return null;var r=this._boundsByFeature.get(t);return r&&(this._index.remove(r),this._featuresByBounds.delete(r)),this._boundsByFeature.delete(t),this._featuresById.delete(e),this._emitChanged(),t},e.prototype.removeIf=function(e,t){var r=this;this._featuresById.forEach(function(i,n){t(i)&&(r._remove(i),e.push(i))}),this._emitChanged()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);if(n){var a=this._boundsByFeature.get(n);a&&(this._index.remove(a),this._featuresByBounds.delete(a)),this._boundsByFeature.delete(n)}this._featuresById.delete(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var a=n[i],o=this._boundsByFeature.get(a);o&&t(p.fromRect(r,o))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var r=0,i=function(e,t){return v.minX=t[0],v.minY=t[1],v.maxX=t[2],v.maxY=t[3],e.search(v)}(this._index,e);r<i.length;r++){var n=i[r];t(this._featuresByBounds.get(n))}},e.prototype.transferById=function(e,t){var r=this._featuresById.get(t);r&&(this._remove(r),e.add(r),this._emitChanged())},e.prototype.transferByIds=function(e,t){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i],o=this._featuresById.get(a);o&&(this._remove(o),r.push(o))}e.addMany(r),this._emitChanged()},e.prototype.transferIdRange=function(e,t,r){for(var i=[],n=t;n<r;n++){var a=this._featuresById.get(n);a&&(this._remove(a),i.push(a))}e.addMany(i),this._emitChanged()},e.prototype.transferIf=function(e,t){var r=this,i=[];this._featuresById.forEach(function(e,n){t(e)&&(r._remove(e),i.push(e))}),e.addMany(i),this._emitChanged()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,i){t._remove(e),r.push(e)}),e.addMany(r),this._emitChanged()},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void m.error(new a("featurestore:invalid-feature","feature id is missing",{feature:e}));var i,n=this._featuresById.get(r);if(n?(i=this._boundsByFeature.get(n),e.localId=n.localId,i&&(this._index.remove(i),this._boundsByFeature.delete(n),this._featuresByBounds.delete(i))):l.isSome(this._onFeatureAdd)&&this._onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);i=d.getBoundsOptimizedGeometry(i||f.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,i),this._featuresByBounds.set(i,e),this._featuresById.set(r,e),t.push(i)}},e.prototype._remove=function(e){var t;e&&(l.isSome(this._onFeatureRemove)&&this._onFeatureRemove(e),(t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=g}.apply(null,i))||(e.exports=n)},1714:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(17),r(184),r(235)],void 0===(n=function(e,t,r,i,n){function a(e){return{value:e.value,size:r.toPt(e.size)}}function o(e){return e.map(function(e){return a(e)})}function s(e){if("string"==typeof e||"number"==typeof e)return r.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:o(t.stops)}}function u(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(i.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,n=0;n<8;++n){var a=r[Math.min(n,r.length-1)];t.values[n]=a.value,t.opacities[n]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var o=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=o}return t}Object.defineProperty(t,"__esModule",{value:!0});var l=i.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=a,t.normalizeSizeStops=o,t.normalizeSizeElement=s,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach(function(e){var r=e.type;e.field&&(t[r]=e.field)}),t},t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,a=t?{}:null;if(!t)return{vvFields:t,vvRanges:a};for(var c=0,p=e;c<p.length;c++){var f=p[c],d=f.type;if(f.field&&(t[d]=f.field),"size"===d){a.size||(a.size={});var h=f;switch(i.getTypeOfSizeVisualVariable(h)){case l.SIZE_MINMAX_VALUE:a.size.minMaxValue={minDataValue:h.minDataValue,maxDataValue:h.maxDataValue,minSize:s(h.minSize),maxSize:s(h.maxSize)};break;case l.SIZE_SCALE_STOPS:a.size.scaleStops={stops:o(h.stops)};break;case l.SIZE_FIELD_STOPS:for(var y=[],m=[],v=o(h.stops),g=v.length,_=0;_<6;_++){var b=v[Math.min(_,g-1)];y.push(b.value),m.push(r.pt2px(b.size))}a.size.fieldStops={values:y,sizes:m};break;case l.SIZE_UNIT_VALUE:a.size.unitValue={unit:h.valueUnit,valueRepresentation:h.valueRepresentation}}}else if("color"===d){var x=n.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});for(a.color=x.color,_=0;_<32;_+=4)i.color.premultiplyAlpha(a.color.colors,_,!0)}else if("opacity"===d)a.opacity=u(f);else if("rotation"===d){var I=f;a.rotation={type:I.rotationType}}}return{vvFields:t,vvRanges:a}}}.apply(null,i))||(e.exports=n)},1716:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(17),r(109),r(153),r(28),r(85),r(40),r(33),r(645),r(298),r(57),r(1635),r(90),r(90),r(184)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,c,p,f,d,h,y,m){function v(e,t,r,a,s){var u,l,c=i.pt2px(r.xoffset),p=i.pt2px(r.yoffset),f=B*r.angle,d=B*s;switch(r.type){case"simple-marker":var h=r;u=l=i.pt2px(h.size);break;case"picture-marker":var y=r;u=i.pt2px(y.width),l=i.pt2px(y.height)}var m=n.mat2d.identity(A);n.mat2d.translate(m,m,o.vec2.set(O,e,t)),n.mat2d.rotate(m,m,d-f),n.mat2d.scale(m,m,o.vec2.set(O,a,-a)),n.mat2d.translate(m,m,o.vec2.set(O,c,-p));var v=[0,0];o.vec2.transformMat2d(v,o.vec2.set(O,-.5*u,-.5*l),m);var g=[0,0];o.vec2.transformMat2d(g,o.vec2.set(O,-.5*u,.5*l),m);var _=[0,0];o.vec2.transformMat2d(_,o.vec2.set(O,.5*u,-.5*l),m);var b=[0,0];return o.vec2.transformMat2d(b,o.vec2.set(O,.5*u,.5*l),m),{rings:[[v,_,b,g,v]]}}function g(e,t,r,a,s){var u=m.CIMSymbolHelper.getEnvelope(r.data);if(!u)return null;var l=i.pt2px(u.width),c=i.pt2px(u.height),p=i.pt2px(u.x),f=i.pt2px(u.y),d=0*B,h=B*s,y=n.mat2d.identity(A);n.mat2d.translate(y,y,o.vec2.set(O,e,t)),n.mat2d.rotate(y,y,h-d),n.mat2d.scale(y,y,o.vec2.set(O,a,a));var v=[0,0];o.vec2.transformMat2d(v,o.vec2.set(O,p,f+c),y);var g=[0,0];o.vec2.transformMat2d(g,o.vec2.set(O,p,f),y);var _=[0,0];o.vec2.transformMat2d(_,o.vec2.set(O,p+l,f+c),y);var b=[0,0];return o.vec2.transformMat2d(b,o.vec2.set(O,p+l,f),y),{rings:[[v,_,b,g,v]]}}function _(e,t,r,a,s,u){var l=m.alignmentUtils.getYAnchorDirection(r.verticalAlignment||"baseline"),c="baseline"===(r.verticalAlignment||"baseline"),p=i.pt2px(r.xoffset),f=i.pt2px(r.yoffset),d=i.pt2px(r.font.size)/24,h=4*d,y=c?25*d:a[1]+(1+l)*a[3]*.5,v=B*r.angle,g=B*u,_=n.mat2d.identity(A);n.mat2d.translate(_,_,o.vec2.set(O,e,t)),n.mat2d.rotate(_,_,g-v),n.mat2d.scale(_,_,o.vec2.set(O,s,-s)),n.mat2d.translate(_,_,o.vec2.set(O,p,-f)),n.mat2d.translate(_,_,o.vec2.set(O,-h,-h-y));var b=[0,0];o.vec2.transformMat2d(b,o.vec2.set(O,a[0],a[1]),_);var x=[0,0];o.vec2.transformMat2d(x,o.vec2.set(O,a[0],a[1]+a[3]),_);var I=[0,0];o.vec2.transformMat2d(I,o.vec2.set(O,a[0]+a[2],a[1]),_);var M=[0,0];return o.vec2.transformMat2d(M,o.vec2.set(O,a[0]+a[2],a[1]+a[3]),_),{rings:[[b,I,M,x,b]]}}function b(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=m.bidiText(t.text),a=n[0],o=n[1],s=m.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=m.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=r.glyphMosaicItems,c=new m.TextShapingNew([l],m.definitions.TEXT_MAX_WIDTH,m.definitions.TEXT_LINE_HEIGHT,m.definitions.TEXT_SPACING,[0,.5*-E],.5*(1-u),0,s).getShaping(a,o),p=m.fontUtils.getFontDecorationTop(t.font.decoration);isNaN(p)||m.TextShapingNew.addDecoration(c,p);var f=m.TextShapingNew.getBox(c),d=i.pt2px(t.font.size)/L;return e[0]=d*f.x,e[1]=d*f.y,e[2]=d*f.width,e[3]=d*f.height,e}function x(e,t,r,i,n,a,o){var s;switch(i.type){case"simple-marker":case"picture-marker":s=v(t,r,i,a,0);break;case"text":s=_(t,r,i,n,a,0);break;case"cim":s=g(t,r,i,a,0)}for(var u,l,c=0,p=0;p<s.rings[0].length-1;p++)u=(t-(l=s.rings[0][p])[0])*(t-l[0])+(r-l[1])*(r-l[1]),c=Math.max(c,u);c=Math.sqrt(c);var f=d.normalizeMapX(t-c,o),h=d.normalizeMapX(t+c,o);if(f>h){var m=y.getInfo(o);if(m){var b=m.valid;f=b[0],h=b[1]}}return e[0]=f,e[1]=r-c,e[2]=h,e[3]=r+c,e}function I(e,t){return Math.ceil((e-t)/(2*t))}function M(e,t){var r,i=t.valid,n=i[0],a=i[1],o=2*a,s=0;return e>a?(e-=(r=Math.ceil(Math.abs(e-a)/o))*o,s=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/o))*o,s=-r),{x:e,frameId:s}}function S(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,a=t.ymax;return w(e,r,i)&&w(e,r,a)&&w(e,n,a)&&w(e,n,i)}function w(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function T(e,t,r){var i;if(Array.isArray(e)){if((i=e[0])>t){var n=I(i,t);e[0]=i+n*(-2*t)}else if(i<r){n=I(i,r);e[0]=i+n*(-2*r)}}else if((i=e.x)>t){n=I(i,t);e.x+=n*(-2*t)}else if(i<r){n=I(i,r);e.x+=n*(-2*r)}return e}Object.defineProperty(t,"__esModule",{value:!0});var B=Math.PI/180,F=m.definitions.TEXT_MAX_WIDTH,E=m.definitions.TEXT_LINE_HEIGHT,z=m.definitions.TEXT_SPACING,A=a.mat2df32.create(),O=s.vec2f32.create(),k=l.create();t.getBounds=function(e,t,r,i,n,a,o,s){if(!i||!r)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var u=i;if(!f.isPoint(u)){c.getBoundsXY(e,u);var l=t[0];0===l&&(l=function(e,t){var r=0;switch(e.type){case"simple-fill":case"picture-fill":var i=e.outline;if(!i)return 0;r=i.width;break;case"simple-line":r=e.width;break;case"simple-marker":r=e.size;break;case"picture-marker":r=Math.max(e.width,e.height);break;case"text":var n=[0,0,0,0];b(n,e,t),r=Math.max(n[0],n[1]);break;case"cim":var a=m.CIMSymbolHelper.getEnvelope(e.data);r=Math.sqrt(a.width*a.width+a.height*a.height)}return r}(r,n),t[0]=l);var p=a*l/2;return e[0]-=p,e[1]-=p,e[2]+=p,e[3]+=p,e}var d=u.x,h=u.y;return"text"===r.type&&0===t[2]&&0===t[3]&&b(t,r,n),x(e,d,h,r,t,a,s),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.expect(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var P=s.vec2f32.create(),C=s.vec2f32.create(),D=s.vec2f32.create(),R=s.vec2f32.create(),V=s.vec2f32.create(),j=s.vec2f32.create(),N=s.vec2f32.create();t.isPointOnPolyline=function(e,t,r,i){o.vec2.set(D,t,r);for(var n,a,s,u,l,c,p,f,d,h=e.paths,y=1/0,m=0;m<h.length;m++){var v=h[m];if(!(v.length<2))for(var g=1;g<v.length;g++)n=v[g-1][0],s=v[g-1][1],a=v[g][0],u=v[g][1],l=Math.min(n,a)-i,c=Math.min(s,u)-i,p=Math.max(n,a)+i,f=Math.max(s,u)+i,t<l||t>p||r<c||r>f||(o.vec2.set(P,n,s),o.vec2.set(C,a,u),o.vec2.subtract(R,C,P),o.vec2.subtract(V,P,D),o.vec2.scale(j,R,o.vec2.dot(R,V)/o.vec2.dot(R,R)),o.vec2.subtract(N,V,j),y>(d=o.vec2.dot(N,N))&&(y=d))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=v,t.getCIMMarkerBounds=g,t.getTextSymbolBounds=_,t.normalizeCentralMeridian=function(e){var t,r,i,n,a,o,s,u,l=null;if(!e)return null;t=e.spatialReference,r=h.getInfo(t),i=t.isWebMercator,n=U[o=i?102100:4326].maxX,a=U[o].minX,s=U[o].plus180Line,u=U[o].minus180Line;var d,y=e.toJSON();if(!r)return y;if("mesh"===e.type)d=y;else if(f.isPoint(y))d=T(y,n,a);else if(f.isMultipoint(y))y.points=y.points.map(function(e){return T(e,n,a)}),d=y;else if(f.isExtent(y))d=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,a=e.ymax,o=e.xmax-e.xmin,s=e.xmin,u=e.xmax,l=t.valid,c=l[0],p=l[1],f=(r=M(e.xmin,t)).x,d=r.frameId,h=(r=M(e.xmax,t)).x,y=r.frameId,m=f===h&&o>0;if(o>2*p){var v={xmin:s<u?f:h,ymin:n,xmax:p,ymax:a},g={xmin:c,ymin:n,xmax:s<u?h:f,ymax:a},_={xmin:0,ymin:n,xmax:p,ymax:a},b={xmin:c,ymin:n,xmax:0,ymax:a},x=[],I=[];S(v,_)&&x.push(d),S(v,b)&&I.push(d),S(g,_)&&x.push(y),S(g,b)&&I.push(y);for(var w=d+1;w<y;w++)x.push(w),I.push(w);i.push({extent:v,frameIds:[d]},{extent:g,frameIds:[y]},{extent:_,frameIds:x},{extent:b,frameIds:I})}else f>h||m?i.push({extent:{xmin:f,ymin:n,xmax:p,ymax:a},frameIds:[d]},{extent:{xmin:c,ymin:n,xmax:h,ymax:a},frameIds:[y]}):i.push({extent:{xmin:f,ymin:n,xmax:h,ymax:a},frameIds:[d]});return i}(e,t).map(function(e){return e.extent});return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map(function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]})}}(y,r);else if(f.isPolygon(y)||f.isPolyline(y)){var m=k;c.getBoundsXY(m,y);var v={xmin:m[0],ymin:m[1],xmax:m[2],ymax:m[3]},g=I(v.xmin,a)*(2*n),_=0===g?y:function(e,t){for(var r=0,i=function(e){return f.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,a=i[r];n<a.length;n++){var o=a[n];o[0]+=t}return e}(y,g);v.xmin+=g,v.xmax+=g,p.extentIntersectsPolyline(v,s)&&v.xmax!==n?l=_:p.extentIntersectsPolyline(v,u)&&v.xmin!==a?l=_:d=_}else d=e.clone();return null!==l?(new G).cut(l,n):d};var L=24;t.getTextSymbolSize=b,t.getTextSymbolEstimatedSize=function(e,t,r){var n=m.bidiText(t.text),a=n[0],o=n[1],s=m.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=m.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=new m.TextShapingNew([],F,E,z,[0,.5*-E],.5*(1-u),0,s).getEstimatedShaping(a,o,r),c=m.TextShapingNew.getBox(l),p=i.pt2px(t.font.size)/L;return e[0]=p*c.x,e[1]=p*c.y,e[2]=p*c.width,e[3]=p*c.height,e};var U={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}},G=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,a=0;a<i;a++){var o=r[a];if(o&&o.length>=this.minPts){for(var s=[],u=0,l=o;u<l.length;u++){var c=l[u];s.push([c[0]+n,c[1]])}r.push(s)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},1792:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(11),r(14),r(18),r(6),r(13),r(9),r(7),r(638),r(131),r(38),r(184),r(426),r(42),r(1714),r(105)],void 0===(n=function(e,t,i,n,a,o,s,u,l,c,p,f,d,h,y,m,v){Object.defineProperty(t,"__esModule",{value:!0});var g=(d.enums.PixelType,s.getLogger("esri.views.layers.2d.features.support.AttributeStore")),_=h.debug.createDebugLogger(h.debug.DEBUG_ATTR_UPDATES,g),b=function(e,t){return function(r,i,n){var a;try{a=t(r,i,n)}catch(e){a=NaN}return(null===a||isNaN(a)||a===1/0)&&e||a}},x={sharedArrayBuffer:o("esri-shared-array-buffer"),oesTextureFloat:o("esri-webgl-texture-float"),maxTextureSize:o("esri-webgl-max-texture-size"),atomics:o("esri-atomics")},I=function(){function e(e,t,r,i){this.texelSize=4;var n=i.pixelType,a=i.layout,o=i.textureOnly;this.textureOnly=o||!1,this.pixelType=n,this._ctype=t,this.layout=a,this._resetRange(),this._shared=e,o||(this.data=this._initData(n,r,e,t))}return Object.defineProperty(e.prototype,"buffer",{get:function(){return l.andThen(this.data,function(e){return e.buffer})},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){return l.expect(this.data)[e*this.texelSize+t]},e.prototype.setData=function(e,t,r,i){void 0===i&&(i=!0);var n=1<<t;0!=(this.layout&n)?(this.data[e*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,e),this.dirtyEnd=Math.max(this.dirtyEnd,e)):g.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.lock=function(){o("esri-2d-debug")&&5121===this.pixelType?g.error("AttributeStore-Bad-Type","Tried to lock non integer array type with float array"):this._shared&&x.atomics&&Atomics.store(this.data,0,1)},e.prototype.unlock=function(){o("esri-2d-debug")&&5121===this.pixelType?g.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array"):this._shared&&x.atomics&&Atomics.store(this.data,0,0)},e.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=l.expect(this.data);t.set(r),this.data=t}},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,a=this.layout,o=l.expect(this.data);return o.slice?{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:n,layout:a}:i?{start:e,end:t,data:new(h.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:a}:{start:e,end:t,data:null,pixelType:n,layout:a}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,a=h.Utils.getPixelArrayCtor(e),o=new a(new n(t*t*4*a.BYTES_PER_ELEMENT)),s=0;s<o.length;s+=4)o[s+1]=255;return o},e.prototype._resetRange=function(){this.dirtyStart=4294967295,this.dirtyEnd=0},e}(),M=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(h.definitions.MAX_FILTERS),this._freeList=[],this._abortController=c.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=x.oesTextureFloat?5126:5121;_("Creating AttributeStore "+(x.sharedArrayBuffer?"with":"without")+" shared memory"),o("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&g.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(function(e){return null})}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.createLocalId=function(e){if(!this._idMap.has(e)){var t=this._getFreeId();this._idMap.set(e,-1===t?0:t),this._localToObjectId.set(t,e)}return this._idMap.get(e)},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);this._idMap.delete(e),this._localToObjectId.delete(t),this._freeList.push(t)},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.setHighlight=function(e){return n(this,void 0,void 0,function(){var t,r,n,a,o,s,u,l=this;return i(this,function(i){switch(i.label){case 0:for(t=1,this._getBlock(0).lock(),this._idsToHighlight.forEach(function(e){var r=l.getLocalId(e);if(r){var i=l._getBlock(0).getData(r,0);l._getBlock(0).setData(r,0,i&~t)}}),this._idsToHighlight.clear(),r=0,n=e;r<n.length;r++)a=n[r],this._idsToHighlight.add(a);for(o=0;o<e.length;o++)null!=(s=this.getLocalId(e[o]))&&(u=this._getBlock(0).getData(s,0),this._getBlock(0).setData(s,0,u|t));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return i.sent(),[2]}})})},e.prototype.addHighlight=function(e){return n(this,void 0,void 0,function(){return i(this,function(e){return[2]})})},e.prototype.removeHighlight=function(e){return n(this,void 0,void 0,function(){return i(this,function(e){return[2]})})},e.prototype.updateFilters=function(e){return n(this,void 0,void 0,function(){var t,r,n,a,o,s,u=this;return i(this,function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,a=t.filters,o=t.definitionExpression,s=a.map(function(t,i){return u._updateFilter(e,t,i,r,o,n)}),[4,c.all(s)];case 1:return i.sent(),[2]}})})},e.prototype.setAttributeBindings=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:g.error(new a("attribute-store","Found invalid renderer type: "+e))}return[2]})})},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.setAttributeData=function(e,t,r,i){var n=this,a=e;this._getBlock(0).setData(a,0,this._getFilterFlags(t));var o=this._attributeComputeMap,s=x.oesTextureFloat?1:2;o.forEach(function(e,o){var l=o*s%4,c=Math.floor(o*s/4),p=n._getBlock(c+m.ATTRIBUTE_DATA_VV),f=e(t,{$view:i},r);if(x.oesTextureFloat)p.setData(a,l,f);else if(f===h.definitions.NAN_MAGIC_NUMBER)p.setData(a,l,255),p.setData(a,l+1,255);else{var d=u.clamp(Math.round(f),-32767,32766)+32768,y=255&d,v=(65280&d)>>8;p.setData(a,l,y),p.setData(a,l+1,v)}})},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=c.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map(function(e){return l.isSome(e)?e.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var r=e._client.update(t,e._signal).then(function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then(function(){return t.resolve()})}});return e._client.render(),r}),this._currUpdate},e.prototype._createResources=function(){var e=this;if(l.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(m.ATTRIBUTE_DATA_ANIMATION),_("Initializing AttributeStore");var t={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:l.mapMany(this._blocks,function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}})},r=this._client.initialize(t,this._signal);return this._createResourcesPromise=r,r.then(function(){return l.isNone(e._createResourcesPromise)?e._createResources():void 0}),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(l.isSome(t))return t;_("Initializing AttributeBlock at index "+e);var r=x.sharedArrayBuffer,i=this._client.type,n=new I(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<x.maxTextureSize){var e=this._size<<=1;return _("Expanding block size to",e,this._blocks),l.forEachSome(this._blocks,function(t){return t.expand(e)}),this._createResourcesPromise=null,this._size=e,0}return g.error(new a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,t,r,a,o,s){return n(this,void 0,void 0,function(){var n,u,c,p,f,d,h,y=this;return i(this,function(i){switch(i.label){case 0:return n=this._filters[r],(l.isSome(n)&&n.hash)===JSON.stringify(t)?[2]:(u=1<<r+1,l.isNone(t)?(this._filters[r]=null,this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|u)}),[2]):[4,e.queryObjectIds(t)]);case 1:return c=i.sent(),t.hiddenIds&&t.hiddenIds.length&&(c=c.filter(function(e){return-1===t.hiddenIds.indexOf(e)})),p=c.map(function(e){return y._idMap.get(e)}),[4,this._getFilter(r,a)];case 2:for(i.sent().update(t,o,s),this._getBlock(0).lock(),this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t&~u)}),f=0;f<p.length;f++)null!=(d=p[f])&&(h=this._getBlock(0).getData(d,0),this._getBlock(0).setData(d,0,h|u));return this._getBlock(0).unlock(),[2]}})})},e.prototype._getFilter=function(e,t){return n(this,void 0,void 0,function(){var n,a,o;return i(this,function(i){switch(i.label){case 0:return n=this._filters[e],l.isSome(n)?[2,n]:[4,new Promise(function(e,t){Promise.all([r.e(0),r.e(65)]).then(function(){var t=[r(2029)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})];case 1:return a=i.sent().default,o=new a({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new p(t.fields)}),this._filters[e]=o,[2,o]}})})},e.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this._filters.length;r++){var i=this._filters[r];t|=(l.isNone(i)||i.check(e)?1:0)<<r}var n=this.getFeatureId(e.localId);return t<<1|(this._idsToHighlight.has(n)?1:0)},e.prototype._bindVVEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r=this;return i(this,function(a){switch(a.label){case 0:return this._attributeComputeMap.clear(),l.isSome(e)?[4,c.all(e.map(function(e){return n(r,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return r=h.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),l.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}})})}))]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})},e.prototype._bindDDEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r,n,a,o=this;return i(this,function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>h.definitions.DOT_DENSITY_MAX_FIELDS&&g.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+h.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,c.all(e.map(function(e){return o._createNormalizedFunction(e,t)}))];case 1:for(r=i.sent().map(function(e){return b(0,e)}),n=0;n<h.definitions.DOT_DENSITY_MAX_FIELDS;n++)(a=n<e.length&&r[n])?this._attributeComputeMap.set(n,a):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}})})},e.prototype._createGetValueFunction=function(e,t){return n(this,void 0,void 0,function(){var r,n,a,o,s,u,l;return i(this,function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=h.getTypeOfSizeVisualVariable(e))===h.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===h.enums.WGLVVFlag.SIZE_UNIT_VALUE,a=n&&function(t){return v.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},o=b,s=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,a)]);case 1:return[2,o.apply(void 0,s.concat([i.sent()]))];case 2:return u=b,l=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}})})},e.prototype._createNormalizedFunction=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,s;return i(this,function(i){switch(i.label){case 0:return(n=e.field)?"string"==typeof n?(o=e.normalizationField)?[2,function(e){if(e.attributes[n]&&e.attributes[o]){var t=e.attributes[n]/e.attributes[o];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[n])}:function(e){return e.attributes[n]}]:(g.error(new a("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof n)),[2,function(e){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,f.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return s=i.sent(),[2,y.callWithOptimizedFeature.bind(null,s)];case 2:return g.error("Unable to create a normalized function for visual variable: "+e),[2,function(e){}]}})})},e}();t.default=M}.apply(null,i))||(e.exports=n)},1832:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(10),r(11),r(2),r(4),r(14),r(282),r(18),r(6),r(9),r(7),r(0),r(1704),r(1695),r(1679),r(1767),r(638),r(411),r(654),r(402),r(184),r(1792),r(2535)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,c,p,f,d,h,y,m,v,g,_,b,x,I,M,S){Object.defineProperty(t,"__esModule",{value:!0});var w=c.getLogger("esri.views.2d.layers.features.controllers.BaseController");t.needsGeometry=function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return w.error(new s("mapview-invalid-type",e+" is not supported")),!1}};var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._processingInMainThread=!1,t._availableFields=[],t._pixelBuffer=0,t.config=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(I.definitions.MAX_FILTERS),t}return a(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.startup=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,f.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}})})},t.prototype.destroy=function(){this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new g(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some(function(e){return i(e.symbol)});case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some(function(e){return i(e.symbol)});default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=null;if("heatmap"!==this.renderer.type){var t=this.renderer.visualVariables;t&&t.some(function(t){if("size"===t.type&&t.field&&!t.normalizationField)return e=[t.field+" DESC"],!0})}return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,orderByFields:e,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?_.fromJSON(this.config.renderer):(w.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return v.fromWorker(this.config.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter(function(t){return-1===e._availableFields.indexOf(t)});return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map(function(e){return t.attributeStore.getLocalId(e)}).filter(function(e){return null!=e})},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return n(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,S.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}})})},t.prototype.setHighlight=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){return[2,this.attributeStore.setHighlight(e)]})})},t.prototype.validateConfig=function(e,t){for(var r=0,i=e.filters;r<i.length;r++){var n=i[r];if(p.isSome(n)&&n.where)try{h.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new s("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore=new M.default(o({type:"remote"},"heatmap"===this.renderer.type?{initialize:function(e,t){return f.resolve()},update:function(e,t){return f.resolve()},render:function(){return f.resolve()}}:{initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}}))},t.prototype._createQueryEngine=function(e){void 0===e&&(e=this._createFeatureStore());var t=this.queryInfo,r=t.definitionExpression,i=t.gdbVersion,n=t.historicMoment;return new m.default({definitionExpression:r,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:i,historicMoment:null!=n&&new Date(n),featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore(!1)),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(e){void 0===e&&(e=!0);var t={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};if(e){var r=this.onFeatureAdd.bind(this),i=this.onFeatureRemove.bind(this);return new y.default(t,r,i)}return new y.default(t)},t.prototype._createDefaultQuery=function(e){var t=this,r=new x;r.outSpatialReference=this.spatialReference;var i=e.outFields,n=e.orderByFields,a=this.config,o=a.gdbVersion,s=a.historicMoment,u=a.definitionExpression;return this.processing&&(i=i&&i.filter(function(e){return!t.processing.getField(e)}),n=n&&n.filter(function(e){return!t.processing.getField(e)})),i=i.length/this.service.fields.length>=.75?["*"]:i,r.gdbVersion=o,r.historicMoment=null!=s?new Date(s):null,r.outFields=i,r.where=u||"1=1",r.returnGeometry=e.returnGeometry,r.returnCentroid=e.returnCentroid,r.orderByFields=n,r.start=e.resultOffset,r.num=e.num,r},t.prototype._createQuery=function(e,t,r,i,n,a){var o=this.service.geometryType,s=this._createDefaultQuery(i);return s.maxRecordCountFactor=n,s.returnExceededLimitFeatures=a,s.resultType="tile",s.geometry=e,this.service.capabilities.query.supportsQuantization?(s.quantizationParameters=new b.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===o&&(s.maxAllowableOffset=r)):"esriGeometryPolyline"!==o&&"esriGeometryPolygon"!==o||(s.maxAllowableOffset=r),s},t.prototype._applyProcessing=function(e,t){var r=this.processing;if(!r)return f.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e},t);try{var i=r.process(e,r.options);return i?"then"in i?i:f.resolve(i):f.reject(new s("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(r){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e},t)}},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return p.isSome(e)&&!!e.geometry})},r([d.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([d.property()],t.prototype,"config",void 0),r([d.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([d.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([d.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([d.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([d.property()],t.prototype,"processor",void 0),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"processing",null),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([d.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([d.property({constructOnly:!0})],t.prototype,"service",void 0),r([d.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([d.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([d.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([d.property()],t.prototype,"filters",void 0),r([d.property({readOnly:!0})],t.prototype,"viewState",void 0),r([d.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([d.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(d.declared(u.HandleOwner));t.default=T}.apply(null,i))||(e.exports=n)},2535:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(11),r(7),r(17),r(184),r(1716)],void 0===(n=function(e,t,r,i,n,a,o,s){function u(e,t){return null==e?t:e}function l(e,t){return i(this,void 0,void 0,function(){var i,n,a,c,f,d,g,_,b,x,I;return r(this,function(r){switch(r.label){case 0:return"simple-marker"===e.type?(i=Math.max(u(e.size,12),t),[2,p(e)+i*h]):"picture-marker"===e.type?(n=Math.max(u(e.height,12),t),a=u(e.width,12)*(n/u(e.height,12)),c=a/2,f=n/2,[2,p(e)+Math.sqrt(c*c+f*f)]):"text"===e.type?(s.getTextSymbolEstimatedSize(y,e,o.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),d=y[2]*(u(e.horizontalAlignment,"top")in m?1:.5),g=y[3]*(u(e.horizontalAlignment,"center")in v?1:.5),_=function(e,t){return null==e.font?t:u(e.font.size,t)}(e,9),b=Math.max(_,t)/_,[2,p(e)+Math.sqrt(d*d+g*g)*b]):"simple-line"===e.type?[2,Math.max(u(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(function(e,t){return null==e.outline?t:u(e.outline.width,t)}(e,.75),t)/2]:"cim"===e.type?(x=o.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(x.width*x.width+x.height*x.height)]:[2,0]:"web-style"!==e.type?[3,2]:(I=l,[4,e.fetchCIMSymbol()]);case 1:return[2,I.apply(void 0,[r.sent(),t])];case 2:return[2,void 0]}})})}function c(e,t){return i(this,void 0,void 0,function(){var i,n,a,o,s;return r(this,function(r){switch(r.label){case 0:return function(e){return e.type in d}(e)?(n=(i=Math).min,o=(a=Math).max,s=[5],[4,l(e,t)]):[2,0];case 1:return[2,n.apply(i,[o.apply(a,s.concat([r.sent()])),75])]}})})}function p(e){var t=u(e.xoffset,0),r=u(e.yoffset,0);return Math.sqrt(t*t+r*r)}function f(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var d={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},h=.707;t.computePxBuffer=function(e,t){return i(this,void 0,void 0,function(){var i,o,s,u,l,p,d;return r(this,function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(i=e.getSymbols(),o=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(f,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(f,0):"real-world-size"===r.transformationType?30:void 0}(e),s=[],u=0,l=i;u<l.length;u++)p=l[u],s.push(c(p,o));return[4,n.all(s)];case 1:return d=r.sent(),[2,a.pt2px(d.reduce(f,0))]}})})};var y=[0,0,0,0],m={left:1,right:1},v={top:1,bottom:1,baseline:1}}.apply(null,i))||(e.exports=n)}}]);