(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/VectorTileLayerView2D":1626,"esri/views/layers/support/ClipArea":1634,"esri/views/2d/layers/LayerView2D":1647,"esri/views/layers/support/ClipRect":1648,"esri/views/layers/support/Geometry":1649,"esri/views/layers/support/Path":1650,"esri/views/2d/engine/vectorTiles/VectorTileContainer":2486,"esri/views/2d/tiling/TileInfoViewPOT":2500})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{1626:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(10),i(11),i(97),i(58),i(14),i(22),i(18),i(6),i(7),i(0),i(2023),i(2486),i(307),i(1647),i(2500),i(165),i(657),i(658),i(1633)],void 0===(n=function(e,t,i,r,n,o,s,a,l,p,u,c,d,h,y,f,v,_,g,m,w,b,T){var S=c.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fetchQueue=null,t._parseQueue=null,t._isTileHandlerPromiseFulfilled=!1,t._handles=new p,t._invalidateStyle=!1,t.container=new f,t}return i(t,e),t.prototype.initialize=function(){var e=this,t=this.layer.tileInfo;(t&&t.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new g(this.layer.tileInfo,this.layer.fullExtent),this._tileHandler=new y(this.layer,window.devicePixelRatio||1,!0,this.container),this.handles.add(this.watch("layer.currentStyleInfo",function(t){e._start()}))):this.addResolvingPromise(d.reject(new l("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))},t.prototype.destroy=function(){this._stop(),this.container.dispose(),this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)},t.prototype.hitTest=function(e,t){var i=this;return this.suspended||!this._tileHandlerPromise?d.resolve(null):a.safeCast(this._tileHandlerPromise).then(function(){return i.container.hitTest(e,t).then(function(e){var t=i._tileHandler.getStyleRepository().layers;if(null===e||e<0||e>=t.length)return null;var r=t[e],n=new s({attributes:{layerId:e,layerName:r.id}});return n.layer=i.layer,n.sourceLayer=i.layer,n})})},t.prototype.update=function(e){var t=this;this.notifyChange("updating");var i=this._tileHandlerPromise;i&&i.then(function(){if(e.pixelRatio!==t._tileHandler.devicePixelRatio)return t._start(),void(t._tileHandler.devicePixelRatio=e.pixelRatio);t._invalidateStyle?(t._issueStyleInvalidation(e),t._invalidateStyle=!1):(t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.state=e.state,t._parseQueue.state=e.state,t._tileStrategy.update(e),t._parseQueue.resume(),t._fetchQueue.resume());for(var i=0,r=t.container.children;i<r.length;i++){var n=r[i];t._tileHandler.updateTile(n,e)}})},t.prototype.attach=function(){var e=this;this._start(),this._handles.add(this.layer.on("paint-change",function(t){return e.container.requestRender()})),this._handles.add(this.layer.on("layout-change",function(t){e._invalidateStyle=!0,e.requestUpdate()}))},t.prototype.detach=function(){this._stop(),this._handles.removeAll()},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.canResume=function(){var e=this.inherited(arguments),t=this.layer;if(e&&t.currentStyleInfo){var i=this.view.scale,r=t.currentStyleInfo;if(r&&r.layerDefinition){var n=r.layerDefinition;n.minScale&&n.minScale<i&&(e=!1),n.maxScale&&n.maxScale>i&&(e=!1)}}return e},t.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating},t.prototype.acquireTile=function(e){var t=this,i=new m(e.level,e.row,e.col,e.world),r=this.updateParameters.state.rotation,n=this._tileHandler.getStyleRepository(),o=v.pool.acquire(i,this.layer.tileInfo,n,r);return a.safeCast(this._tileHandlerPromise).then(function(){t.notifyChange("updating"),t._fetchQueue.push(o.key).then(function(e){return t._parseQueue.push(e)}).then(function(e){o.once("attach",function(){return t.requestUpdate()}),e?o.setData(e.tileData,e.client,e.refKeys):o.setData(null,null),t.container.addChild(o),t.notifyChange("updating")}).catch(function(e){t.notifyChange("updating"),d.isAbortError(e)||S.error(e)})}),o},t.prototype.releaseTile=function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this._tileHandler.abortTileUpdate(t),this.container.removeChild(e),this.requestUpdate(),e.once("detach",function(){return v.pool.release(e)}),this.notifyChange("updating")},t.prototype._start=function(){var e=this;if(this._stop(),this.layer.currentStyleInfo&&this.attached){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then(function(){e._tileStrategy=new b({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:e._tileInfoView,cacheSize:40,buffer:u("esri-vector-tiles-buffer")?192:0}),e._fetchQueue=new w({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new w({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.container.initialize(e._tileHandler.spriteMosaic,e._tileHandler.glyphMosaic,e.layer.tileInfo,e._tileInfoView),e.container.setStyleRepository(e._tileHandler.getStyleRepository()),e.requestUpdate(),e._isTileHandlerPromiseFulfilled=!0});this._tileHandlerAbortController=t,this._tileHandlerPromise=i}},t.prototype._stop=function(){if(this._tileHandlerAbortController){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerPromiseFulfilled=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this.container.removeAllChildren(),v.pool.prune()}},t.prototype._getTileData=function(e,t){return o(this,void 0,void 0,function(){var i;return n(this,function(r){switch(r.label){case 0:return[4,this._tileHandler.fetchTileData(e,t)];case 1:return i=r.sent(),this.notifyChange("updating"),[2,{key:e,data:i}]}})})},t.prototype._parseTileData=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(i){return[2,this._tileHandler.parseTileData(e,this.updateParameters.state.rotation,t)]})})},t.prototype._issueStyleInvalidation=function(e){var t=this;this.notifyChange("updating"),this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){t.container.setStyleRepository(t._tileHandler.getStyleRepository()),t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.clear(),t._parseQueue.clear(),t._parseQueue.resume(),t._fetchQueue.resume(),t.notifyChange("updating"),t.requestUpdate()})},r([h.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],t.prototype,"suspended",void 0),r([h.subclass("esri.views.2d.layers.VectorTileLayerView2D")],t)}(h.declared(_.LayerView2D(T)))}.apply(null,r))||(e.exports=n)},1634:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(2),i(12),i(0)],void 0===(n=function(e,t,i,r,n,o){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([o.subclass("esri.views.layers.support.ClipArea")],t)}(o.declared(n.JSONSupport))}.apply(null,r))||(e.exports=n)},1647:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(29),i(146),i(25),i(0),i(1634),i(1648),i(1649),i(1650)],void 0===(n=function(e,t,i,r,n,o,s,a,l,p,u,c){Object.defineProperty(t,"__esModule",{value:!0});var d=n.ofType({key:"type",base:l,typeMap:{rect:p,path:c,geometry:u}});t.LayerView2D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=new d,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}return i(t,e),t.prototype.initialize=function(){var e=this;this.when(function(){e.requestUpdate()},function(){});var t=function(){return e.notifyChange("rendering")};this.handles.add([s.init(this,"suspended",function(t){e.container&&(e.container.visible=!t),e.view&&!t&&e.updateRequested&&e.view.requestLayerViewUpdate(e)},!0),s.init(this,"fullOpacity",function(t){e.container&&(e.container.opacity=t)},!0),s.on(this,"container","post-render",t),s.on(this,"container","will-render",t)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){var o=!r,s=!n;!o&&e<=r&&(o=!0),!s&&e>=n&&(s=!0),t=o&&s}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e&&(e=this.isVisibleAtScale(this.view.scale)),e},r([a.property({type:d,set:function(e){var t=o.referenceSetter(e,this._get("clips"),d);this._set("clips",t)}})],t.prototype,"clips",void 0),r([a.property()],t.prototype,"moving",void 0),r([a.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),r([a.property()],t.prototype,"attached",void 0),r([a.property()],t.prototype,"container",void 0),r([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r([a.property({readOnly:!0})],t.prototype,"updateParameters",void 0),r([a.property()],t.prototype,"updateRequested",void 0),r([a.property({dependsOn:["updateRequested","attached","suspended"]})],t.prototype,"updating",null),r([a.property()],t.prototype,"view",void 0),r([a.subclass("esri.views.2d.layers.LayerView2D")],t)}(a.declared(e))}}.apply(null,r))||(e.exports=n)},1648:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(2),i(0),i(1634)],void 0===(n=function(e,t,i,r,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="rect",t.left=null,t.right=null,t.top=null,t.bottom=null,t}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0),i([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],t.prototype,"version",null),o=i([n.subclass("esri.views.layers.support.ClipRect")],t)}(n.declared(o))}.apply(null,r))||(e.exports=n)},1649:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(2),i(36),i(0),i(72),i(57),i(1634)],void 0===(n=function(e,t,i,r,n,o,s,a,l){var p={base:s,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="geometry",t.geometry=null,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({geometry:this.geometry.clone()})},i([o.property({types:p,json:{read:a.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i([o.property({readOnly:!0,dependsOn:["geometry"]})],t.prototype,"version",null),n=i([o.subclass("esri.views.layers.support.Geometry")],t)}(o.declared(l))}.apply(null,r))||(e.exports=n)},1650:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(2),i(0),i(1634)],void 0===(n=function(e,t,i,r,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="path",t.path=[],t}return r(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0),i([n.property({readOnly:!0,dependsOn:["path"]})],t.prototype,"version",null),i([n.subclass("esri.views.layers.support.Path")],t)}(n.declared(o))}.apply(null,r))||(e.exports=n)},2486:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(3),i(18),i(7),i(52),i(21),i(290),i(85),i(288),i(38),i(184),i(667),i(409),i(2025),i(427)],void 0===(n=function(e,t,i,r,n,o,s,a,l,p,u,c,d,h,y,f){var v=c.enums.WGLDrawPhase;return u.enums.BlendFactor,u.enums.CompareFunction,u.enums.StencilOperation,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tileCoordinateScale=p.vec3f32.create(),t._orientationVec=p.vec3f32.fromValues(0,0,1),t._displayScale=p.vec3f32.create(),t._defaultTransform=a.mat4f32.create(),t._displayWidth=0,t._displayHeight=0,t._backgroundTile={tileTransform:{transform:a.mat4f32.create(),displayCoord:l.vec2f32.create()},coords:[0,0],key:d.TileKey.pool.acquire(),coordRange:4096},t._pointToCallbacks=new Map,t}return i(t,e),t.prototype.initialize=function(e,t,i,r){var n=this;this._spriteMosaicPromise=e,this._spriteMosaicPromise.then(function(i){n._spriteMosaicPromise===e&&(n._renderer=new y(i,t))}),this._tileInfoView=r,this._tileInfo=i},t.prototype.dispose=function(){this._renderer&&this._renderer.dispose(),d.TileKey.pool.release(this._backgroundTile.key),e.prototype.dispose.call(this)},t.prototype.hitTest=function(e,t){var i=this,r=[e,t];return n.create(function(e,t){i._pointToCallbacks.set(r,{resolve:e,reject:t}),i.requestRender()},function(){i._pointToCallbacks.has(r)&&i._pointToCallbacks.delete(r)})},t.prototype.renderChildren=function(t){var i=this;if(0!==this.children.length&&this._tileInfoView&&t&&t.state&&(t.drawPhase===v.MAP||t.drawPhase===v.HITTEST)){if(!this._renderer)return void this.requestRender();if(r("esri-vector-tiles-debug"))for(var n=0,s=this.children;n<s.length;n++){(g=s[n]).triangleCount=0}var a=t.state,l=this.stage.context,p=this._renderer;p.initializeProgramCache(this.stage.context),p.setGlobalOpacity(l,t,this.opacity);var u=t;u.displayLevel=this._tileInfoView.scaleToLevel(a.scale),u.requiredLevel=this._tileInfoView.getSmallestInfoForScale(a.scale).level,u.renderer=this._renderer;var c=t.drawPhase===v.HITTEST?4:0;l.setDepthWriteEnabled(!1),l.setStencilTestEnabled(!1),this._renderBackgroundBuckets(u,this._styleRepository.backgroundBucketIds,c),l.setDepthWriteEnabled(!0),l.setStencilWriteMask(255),l.setClearDepth(1),l.setClearStencil(0),l.clear(l.gl.DEPTH_BUFFER_BIT|l.gl.STENCIL_BUFFER_BIT),l.setDepthWriteEnabled(!1),this.sortChildren(function(e,t){return function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col}(e,t)});for(var d=this.children.length,h=1;h<=d;h++){var y=this.children[h-1];y.attached&&y.visible&&(y.stencilData.reference=h,y.stencilData.mask=255)}if(this._updateTilesTransform(u.state,u.requiredLevel,this.children),l.setDepthWriteEnabled(!0),this._renderer.setStateParams(u.state,u.pixelRatio,u.displayLevel),this._renderer.drawClippingMasks(l,this.children),l.setStencilWriteMask(0),l.setBlendFunctionSeparate(1,771,1,771),l.setStencilOp(7680,7680,7681),l.setDepthFunction(515),l.setBlendingEnabled(!1),l.setStencilTestEnabled(!0),l.setDepthTestEnabled(!0),l.setDepthWriteEnabled(!0),u.drawphase=1,e.prototype.renderChildren.call(this,u),l.setDepthWriteEnabled(!1),l.setBlendingEnabled(!0),u.drawphase=2,e.prototype.renderChildren.call(this,u),u.drawphase=3,e.prototype.renderChildren.call(this,u),l.setStencilTestEnabled(!1),l.setDepthTestEnabled(!1),p.applyGlobalOpacity(l,t,this.opacity),r("esri-vector-tiles-debug"))for(var f=0,_=this.children;f<_.length;f++){var g;(g=_[f]).attached&&g.visible&&this._renderer.renderTileInfo(l,g)}this._pointToCallbacks.size>0&&(this._pointToCallbacks.forEach(function(e,t){var r=i._hitTest(u,t[0],t[1]);o.schedule(function(){e.resolve(r)})}),this._pointToCallbacks.clear()),this._renderer.needsRedraw()&&this.requestRender()}},t.prototype.removeAllChildren=function(){for(var t=0;t<this.children.length;t++)this.children[t].dispose();e.prototype.removeAllChildren.call(this)},t.prototype.setStyleRepository=function(e){this._styleRepository=e},t.prototype._hitTest=function(e,t,i){var r=this._tileInfoView.getSmallestInfoForScale(e.state.scale).level,n=[0,0];e.state.toMap(n,[t,i]);var o=e.state.clone(),s=o.viewpoint.clone(),a=s.targetGeometry;a.x=n[0],a.y=n[1],s.targetGeometry=a,o.viewpoint=s,o.size=[3,3],this._renderer.setStateParams(o,e.pixelRatio,e.displayLevel);var l={context:this.stage.context,drawPhase:0,pixelRatio:e.pixelRatio,stationary:e.stationary,globalOpacity:e.globalOpacity,displayLevel:e.displayLevel,requiredLevel:e.requiredLevel,renderer:e.renderer,layerOpacity:e.layerOpacity,state:o,drawphase:4},p=this._renderer.hitTest(l,t,i,this.children,r,3,this._updateTilesTransform.bind(this));return p&&0!==p.length?p[0]:null},t.prototype._updateTilesTransform=function(e,t,i){var r=1/e.size[0],n=1/e.size[1],o=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lodAt(t).resolution,e.resolution,e.rotation,this._tileInfo.size[1],4096,e.size[0],e.size[1],this._defaultTransform);for(var s=0,a=i;s<a.length;s++){var l=a[s];e.toScreen(o,l.coords),o[1]=e.size[1]-o[1],l.tileTransform.displayCoord[0]=2*o[0]*r-1,l.tileTransform.displayCoord[1]=2*o[1]*n-1,l.key.level===t&&4096===l.coordRange?l.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lodAt(l.key.level).resolution,e.resolution,e.rotation,this._tileInfo.size[1],l.coordRange,e.size[0],e.size[1],l.tileTransform.transform)}},t.prototype._calculateRelativeViewProjMat=function(e,t,i,r,n,o,a,l){var p=.125;512!==r&&4096!==n&&(p=r/n);var u=p*(e/t);this._tileCoordinateScale.set([u,u,1]),o===this._displayWidth&&a===this._displayHeight||(this._displayScale.set([2/o,-2/a,1]),this._displayWidth=o,this._displayHeight=a),s.mat4.identity(l),s.mat4.scale(l,l,this._tileCoordinateScale),s.mat4.rotate(l,l,-i*h.C_DEG_TO_RAD,this._orientationVec),s.mat4.scale(l,l,this._displayScale),s.mat4.transpose(l,l)},t.prototype._renderBackgroundBuckets=function(e,t,i){if(t&&0!==t.length){var r=e.state,n=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),o=r.resolution,s=r.rotation,a=r.size,l=n.spans,p=n.lodInfo,u=p.level,c=this._tileInfo,d=this.stage.context,h=e.displayLevel,y=this._backgroundTile;this._calculateRelativeViewProjMat(c.lodAt(u).resolution,o,s,c.size[1],y.coordRange,a[0],a[1],y.tileTransform.transform);for(var v,_=[0,0],g=1/r.size[0],m=1/r.size[1],w=0,b=l;w<b.length;w++)for(var T=b[w],S=T.row,C=T.colFrom,R=T.colTo,I=C;I<=R;I++){var P=y.key;P.set(u,S,p.normalizeCol(I),p.getWorldForColumn(I)),this._tileInfoView.getTileCoords(y.coords,P),r.toScreen(_,y.coords),_[1]=r.size[1]-_[1],y.tileTransform.displayCoord[0]=2*_[0]*g-1,y.tileTransform.displayCoord[1]=2*_[1]*m-1;for(var k=0,q=t;k<q.length;k++){var H=q[k];void 0!==(v=this._styleRepository.layers[H]).minzoom&&v.minzoom>h+1e-6||void 0!==v.maxzoom&&v.maxzoom<=h-1e-6||this._renderer.renderBackGroundLayer(d,v,H,y,e.requiredLevel,i,1)}}f.pool.release(n)}},t}(c.Container)}.apply(null,r))||(e.exports=n)},2500:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(3),i(1),i(164),i(646),i(165)],void 0===(n=function(e,t,i,r,n,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fullCacheLodInfos=null,t._levelByScale={},t}return i(t,e),t.prototype.getTileParentId=function(e){var t=s.pool.acquire(e),i=0===t.level?null:s.getId(t.level-1,t.row>>1,t.col>>1,t.world);return s.pool.release(t),i},t.prototype.getTileCoverage=function(t,i,r){var n=e.prototype.getTileCoverage.call(this,t,i,r);if(!n)return n;var o=1<<n.lodInfo.level;return n.spans=n.spans.filter(function(e){return e.row>=0&&e.row<o}),n},t.prototype.scaleToLevel=function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;for(var i=void 0,r=void 0,n=0;n<t.length-1;n++)if(e>(r=t[n+1]).scale)return(i=t[n]).level+(i.scale-e)/(i.scale-r.scale);return t[t.length-1].level},t.prototype._initializeFullCacheLODs=function(e){var t;if(0===e[0].level)t=e.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}});else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=n.create({size:i,spatialReference:r}).lods.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}})}for(var o=0;o<t.length;o++)this._levelByScale[t[o].scale]=t[o].level;this._fullCacheLodInfos=t},t}(o)}.apply(null,r))||(e.exports=n)}}]);