(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/libs/quickselect/quickselect":1662,"esri/core/libs/rbush/rbush":1674,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1675,"esri/layers/graphics/data/QueryEngineCapabilities":1680,"esri/layers/graphics/data/FeatureStore":1695,"esri/layers/graphics/sources/support/clientSideDefaults":1817,"esri/layers/graphics/sources/support/MemorySourceWorker":2532,"esri/layers/graphics/sources/support/sourceUtils":2533})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{1662:function(e,t,i){var r;void 0===(r=function(){"use strict";function e(i,r,n,s,a){for(;s>n;){if(s-n>600){var o=s-n+1,u=r-n+1,l=Math.log(o),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(o-d)/o)*(u-o/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-u*d/o+h)),Math.min(s,Math.floor(r+(o-u)*d/o+h)),a)}var c=i[r],f=n,p=s;for(t(i,n,r),a(i[s],c)>0&&t(i,n,s);f<p;){for(t(i,f,p),f++,p--;a(i[f],c)<0;)f++;for(;a(i[p],c)>0;)p--}0===a(i[n],c)?t(i,n,p):t(i,++p,s),p<=r&&(n=p+1),r<=p&&(s=p-1)}}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}return function(t,r,n,s,a){e(t,r,n||0,s||t.length-1,a||i)}}.apply(null,[]))||(e.exports=r)},1674:function(e,t,i){var r,n;r=[i(1662)],void 0===(n=function(e){"use strict";function t(e,i){if(!(this instanceof t))return new t(e,i);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this.toBBox=i:this._initFormat(i)),this.clear()}function i(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function r(e,t){n(e,0,e.children.length,t,e)}function n(e,t,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,o=t;o<i;o++)a=e.children[o],s(n,e.leaf?r(a):a);return n}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function a(e,t){return e.minX-t.minX}function o(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function l(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function h(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,s-r)}function c(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,i,r,n,s){for(var a,o=[i,r];o.length;)(r=o.pop())-(i=o.pop())<=n||(a=i+Math.ceil((r-i)/n/2)*n,e(t,a,i,r,s),o.push(i,a,a,r))}return t.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],r=this.toBBox;if(!f(e,t))return i;for(var n,s,a,o,u=[];t;){for(n=0,s=t.children.length;n<s;n++)a=t.children[n],f(e,o=t.leaf?r(a):a)&&(t.leaf?i.push(a):c(e,o)?this._all(a,i):u.push(a));t=u.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!f(e,t))return!1;for(var r,n,s,a,o=[];t;){for(r=0,n=t.children.length;r<n;r++)if(s=t.children[r],f(e,a=t.leaf?i(s):s)){if(t.leaf||c(e,a))return!0;o.push(s)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=p([]),this},remove:function(e,t){if(!e)return this;for(var r,n,s,a,o=this.data,u=this.toBBox(e),l=[],d=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],r=d.pop(),a=!0),o.leaf&&-1!==(s=i(e,o.children,t)))return o.children.splice(s,1),l.push(o),this._condense(l),this;a||o.leaf||!c(o,u)?n?(r++,o=n.children[r],a=!1):o=null:(l.push(o),d.push(r),r=0,n=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:a,compareMinY:o,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,n){var s,a=i-t+1,o=this._maxEntries;if(a<=o)return r(s=p(e.slice(t,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,n-1))),(s=p([])).leaf=!1,s.height=n;var u,l,d,h,c=Math.ceil(a/o),f=c*Math.ceil(Math.sqrt(o));for(m(e,t,i,f,this.compareMinX),u=t;u<=i;u+=f)for(m(e,u,d=Math.min(u+f-1,i),c,this.compareMinY),l=u;l<=d;l+=c)h=Math.min(l+c-1,d),s.children.push(this._build(e,l,h,n-1));return r(s,this.toBBox),s},_chooseSubtree:function(e,t,i,r){for(var n,s,a,o,l,h,c,f;r.push(t),!t.leaf&&r.length-1!==i;){for(c=f=1/0,n=0,s=t.children.length;n<s;n++)l=u(a=t.children[n]),(h=d(e,a)-l)<f?(f=h,c=l<c?l:c,o=a):h===f&&l<c&&(c=l,o=a);t=o||t.children[0]}return t},_insert:function(e,t,i){var r=this.toBBox,n=i?e:r(e),a=[],o=this._chooseSubtree(n,this.data,t,a);for(o.children.push(e),s(o,n);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(n,a,t)},_split:function(e,t){var i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var a=this._chooseSplitIndex(i,s,n),o=p(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,r(i,this.toBBox),r(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var r,s,a,o,l,d,c,f;for(d=c=1/0,r=t;r<=i-t;r++)o=h(s=n(e,0,r,this.toBBox),a=n(e,r,i,this.toBBox)),l=u(s)+u(a),o<d?(d=o,f=r,c=l<c?l:c):o===d&&l<c&&(c=l,f=r);return f},_chooseSplitAxis:function(e,t,i){var r=e.leaf?this.compareMinX:a,n=e.leaf?this.compareMinY:o;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},_allDistMargin:function(e,t,i,r){e.children.sort(r);var a,o,u=this.toBBox,d=n(e,0,t,u),h=n(e,i-t,i,u),c=l(d)+l(h);for(a=t;a<i-t;a++)o=e.children[a],s(d,e.leaf?u(o):o),c+=l(d);for(a=i-t-1;a>=t;a--)o=e.children[a],s(h,e.leaf?u(o):o),c+=l(h);return c},_adjustParentBBoxes:function(e,t,i){for(var r=i;r>=0;r--)s(t[r],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():r(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},t}.apply(null,r))||(e.exports=n)},1675:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1663),i(634),i(404)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new r.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=i.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,r))||(e.exports=n)},1680:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,r))||(e.exports=n)},1695:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(10),i(11),i(3),i(14),i(49),i(18),i(6),i(9),i(1674),i(45),i(33),i(227),i(1675)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,d,h,c,f,p){Object.defineProperty(t,"__esModule",{value:!0});var m=[],y=u.getLogger("esri.layers.graphics.data.FeatureStore"),g={minX:0,minY:0,maxX:0,maxY:0},_=function(){function e(e,t,i){this._geometryInfo=e,this._onFeatureAdd=t,this._onFeatureRemove=i,this._featuresById=new Map,this._boundsByFeature=new Map,this._featuresByBounds=new Map,this._index=d(9,o("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this.events=new a,this.featureAdapter=p.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=c.create(c.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e,m),this._index.load(m),this._emitChanged(),m.length=0},e.prototype.addMany=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._add(r,m)}this._index.load(m),this._emitChanged(),m.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);if(!t)return null;var i=this._boundsByFeature.get(t);return i&&(this._index.remove(i),this._featuresByBounds.delete(i)),this._boundsByFeature.delete(t),this._featuresById.delete(e),this._emitChanged(),t},e.prototype.removeIf=function(e,t){var i=this;this._featuresById.forEach(function(r,n){t(r)&&(i._remove(r),e.push(r))}),this._emitChanged()},e.prototype.removeManyById=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],n=this._featuresById.get(r);if(n){var s=this._boundsByFeature.get(n);s&&(this._index.remove(s),this._featuresByBounds.delete(s)),this._boundsByFeature.delete(n)}this._featuresById.delete(r)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,i){for(var r=0,n=e;r<n.length;r++){var s=n[r],a=this._boundsByFeature.get(s);a&&t(h.fromRect(i,a))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var i=0,r=function(e,t){return g.minX=t[0],g.minY=t[1],g.maxX=t[2],g.maxY=t[3],e.search(g)}(this._index,e);i<r.length;i++){var n=r[i];t(this._featuresByBounds.get(n))}},e.prototype.transferById=function(e,t){var i=this._featuresById.get(t);i&&(this._remove(i),e.add(i),this._emitChanged())},e.prototype.transferByIds=function(e,t){for(var i=[],r=0,n=t;r<n.length;r++){var s=n[r],a=this._featuresById.get(s);a&&(this._remove(a),i.push(a))}e.addMany(i),this._emitChanged()},e.prototype.transferIdRange=function(e,t,i){for(var r=[],n=t;n<i;n++){var s=this._featuresById.get(n);s&&(this._remove(s),r.push(s))}e.addMany(r),this._emitChanged()},e.prototype.transferIf=function(e,t){var i=this,r=[];this._featuresById.forEach(function(e,n){t(e)&&(i._remove(e),r.push(e))}),e.addMany(r),this._emitChanged()},e.prototype.transferAll=function(e){var t=this,i=[];this._featuresById.forEach(function(e,r){t._remove(e),i.push(e)}),e.addMany(i),this._emitChanged()},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e,t){if(e){var i=e.objectId;if(null==i)return void y.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}));var r,n=this._featuresById.get(i);if(n?(r=this._boundsByFeature.get(n),e.localId=n.localId,r&&(this._index.remove(r),this._boundsByFeature.delete(n),this._featuresByBounds.delete(r))):l.isSome(this._onFeatureAdd)&&this._onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsByFeature.set(e,null),void this._featuresById.set(i,e);r=f.getBoundsOptimizedGeometry(r||c.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,r),this._featuresByBounds.set(r,e),this._featuresById.set(i,e),t.push(r)}},e.prototype._remove=function(e){var t;e&&(l.isSome(this._onFeatureRemove)&&this._onFeatureRemove(e),(t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=_}.apply(null,r))||(e.exports=n)},1817:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(18),i(15),i(659)],void 0===(n=function(e,t,i,r,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.defaultPointSymbolJSON:"esriGeometryPolyline"===e?s.defaultPolylineSymbolJSON:s.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(r("csp-restrictions"))return function(){var r;return i(((r={})[t]=null,r),e)};try{var n="this."+t+" = null;";for(var s in e)n+="this."+s+" = "+JSON.stringify(e[s])+";";var a=new Function(n);return function(){return new a}}catch(r){return function(){var r;return i(((r={})[t]=null,r),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:"New Feature",description:"",prototype:{attributes:n.clone(e)}}]}}.apply(null,r))||(e.exports=n)},2532:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(10),i(11),i(4),i(14),i(7),i(118),i(57),i(90),i(227),i(1695),i(1669),i(1679),i(1817),i(2533),i(638),i(448),i(117)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,d,h,c,f,p,m,y,g,_){function v(e){return u.isPoint(e)?null!=e.z:!!e.hasZ}function b(e){return u.isPoint(e)?null!=e.m:!!e.hasM}function x(e,t,i){if(e.geometry&&"rings"in e.geometry&&e.geometry.rings&&e.geometry.rings.length>0){var r=e.geometry.rings[0];o.isClockwise(r,t,i)||o.closeRingsAndFixWinding(e.geometry)}}Object.defineProperty(t,"__esModule",{value:!0});var F=l.WGS84,I={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:l.WGS84},B={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}},M=function(){function e(){this._queryEngine=null,this._nextObjectId=null}return e.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null},e.prototype.load=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){var t,r,a,o,u,l,d,m,v,b,x,M,E,j,w,R,S,T,O,Y,X,q,D,P,A;return i(this,function(i){switch(i.label){case 0:if(t=[],r=e.features,a=this._inferLayerProperties(r,e.fields),o=e.fields||[],u=null!=e.hasM?e.hasM:a.hasM,l=null!=e.hasZ?e.hasZ:a.hasZ,d=!e.spatialReference&&!a.spatialReference,m=d?F:e.spatialReference||a.spatialReference,v=d?I:null,b=e.geometryType||a.geometryType,x=e.objectIdField||a.objectIdField,M=e.timeInfo,d&&t.push({name:"feature-layer:spatial-reference-not-found",message:"Spatial reference not provided or found in features. Defaults to WGS84"}),!b)throw new s("feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");if(!x)throw new s("feature-layer:missing-property","objectIdField not set and couldn't be found in the provided fields");for(a.objectIdField&&x!==a.objectIdField&&(t.push({name:"feature-layer:duplicated-oid-field",message:'Provided objectIdField "'+x+'" doesn\'t match the field name "'+a.objectIdField+'", found in the provided fields'}),x=a.objectIdField),x&&!a.objectIdField&&(E=null,o.some(function(e){return e.name===x&&(E=e,!0)})?(E.type="esriFieldTypeOID",E.editable=!1,E.nullable=!1):o.unshift({alias:x,name:x,type:"esriFieldTypeOID",editable:!1,nullable:!1})),j=0,w=o;j<w.length;j++){if(null==(O=w[j]).name&&(O.name=O.alias),null==O.alias&&(O.alias=O.name),!O.name)throw new s("feature-layer:invalid-field-name","field name is missing",{field:O});if(O.name===x&&(O.type="esriFieldTypeOID"),-1===g.kebabDict.jsonValues.indexOf(O.type))throw new s("feature-layer:invalid-field-type",'invalid type for field "'+O.name+'"',{field:O})}for(R={},this._requiredFields=[],S=0,T=o;S<T.length;S++)"esriFieldTypeOID"!==(O=T[S]).type&&"esriFieldTypeGlobalID"!==O.type&&(O.editable=null==O.editable||!!O.editable,O.nullable=null==O.nullable||!!O.nullable,Y=_.getFieldDefaultValue(O),O.nullable||void 0!==Y?R[O.name]=Y:this._requiredFields.push(O));return this._fieldsIndex=new y(o),this._createDefaultAttributes=p.createDefaultAttributesFunction(R,x),M&&(M.startTimeField&&((X=this._fieldsIndex.get(M.startTimeField))?(M.startTimeField=X.name,X.type="esriFieldTypeDate"):M.startTimeField=null),M.endTimeField&&((q=this._fieldsIndex.get(M.endTimeField))?(M.endTimeField=q.name,q.type="esriFieldTypeDate"):M.endTimeField=null),M.trackIdField&&((D=this._fieldsIndex.get(M.trackIdField))?M.trackIdField=D.name:(M.trackIdField=null,t.push({name:"feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:M}}))),M.startTimeField||M.endTimeField||(t.push({name:"feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing or invalid",details:{timeInfo:M}}),M=null)),P={warnings:t,featureErrors:[],layerDefinition:n({},B,{drawingInfo:p.createDrawingInfo(b),templates:p.createDefaultTemplate(R),extent:v,geometryType:b,objectIdField:x,fields:o,hasZ:!!l,hasM:!!u,timeInfo:M}),assignedObjectIds:{}},this._queryEngine=new f.default({fields:o,geometryType:b,hasM:u,hasZ:l,objectIdField:x,spatialReference:m,featureStore:new h.default({geometryType:b,hasM:u,hasZ:l}),timeInfo:M}),r&&r.length?(A=r.reduce(function(e,t){var i=t.attributes&&t.attributes[x];return null==i||isNaN(i)||!isFinite(i)?e:Math.max(e,i)},0),this._nextObjectId=1+A,[4,c.checkProjectionSupport(r,m)]):(this._nextObjectId=1,[2,P]);case 1:return i.sent(),[2,this._loadInitialFeatures(P,r)]}})})},e.prototype.applyEdits=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(i){switch(i.label){case 0:return t=this._queryEngine.spatialReference,[4,a.all([c.checkProjectionSupport(e.adds,t),c.checkProjectionSupport(e.updates,t)])];case 1:return i.sent(),[2,this._applyEdits(e)]}})})},e.prototype.queryFeatures=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQuery(e,t.signal)]})})},e.prototype.queryFeatureCount=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForCount(e,t.signal)]})})},e.prototype.queryObjectIds=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForIds(e,t.signal)]})})},e.prototype.queryExtent=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForExtent(e,t.signal)]})})},e.prototype._inferLayerProperties=function(e,t){for(var i=void 0,r=void 0,n=null,s=null,a=null,o=0,l=e;o<l.length;o++){var d=l[o].geometry;if(d&&(n||(n=u.getJsonType(d)),s||(s=d.spatialReference),null==i&&(i=v(d)),null==r&&(r=b(d)),n&&s&&null!=i&&null!=r))break}if(t&&t.length){var h=null;t.some(function(e){var t="esriFieldTypeOID"===e.type,i=!e.type&&e.name&&"objectid"===e.name.toLowerCase();return h=e,t||i})&&(a=h.name)}return{geometryType:n,spatialReference:s,objectIdField:a,hasM:r,hasZ:i}},e.prototype._loadInitialFeatures=function(e,t){for(var i=this._queryEngine,r=i.geometryType,n=i.hasM,s=i.hasZ,a=i.objectIdField,o=i.spatialReference,l=i.featureStore,h=[],f=0,p=t;f<p.length;f++){var y=p[f];if(null!=y.uid&&(e.assignedObjectIds[y.uid]=-1),y.geometry&&r!==u.getJsonType(y.geometry))e.featureErrors.push(m.createFeatureEditErrorResult("Incorrect geometry type."));else{var g=this._createDefaultAttributes(),_=m.mixAttributes(this._fieldsIndex,this._requiredFields,g,y.attributes,!0,e.warnings);_?e.featureErrors.push(_):(this._assignObjectId(g,y.attributes,!0),y.attributes=g,null!=y.uid&&(e.assignedObjectIds[y.uid]=y.attributes[a]),y.geometry&&(x(y,n,s),y.geometry=c.project(y.geometry,y.geometry.spatialReference,o)),h.push(y))}}if(l.addMany(d.convertFromFeatures([],h,r,s,n,a)),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){var v=this._queryEngine.timeExtent,b=v.start,F=v.end;e.layerDefinition.timeInfo.timeExtent=[b,F]}return e},e.prototype._applyEdits=function(e){var t=e.adds,i=e.updates,r=e.deletes,n={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(n,t),i&&i.length&&this._applyUpdateEdits(n,i),r&&r.length){for(var s=0,a=r;s<a.length;s++){var o=a[s];n.deleteResults.push(m.createFeatureEditSuccessResult(o))}this._queryEngine.featureStore.removeManyById(r)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:n}},e.prototype._applyAddEdits=function(e,t){for(var i=e.addResults,r=this._queryEngine,n=r.geometryType,s=r.hasM,a=r.hasZ,o=r.objectIdField,l=r.spatialReference,h=r.featureStore,f=[],p=0,y=t;p<y.length;p++){var g=y[p];if(x(g,s,a),g.geometry&&n!==u.getJsonType(g.geometry))i.push(m.createFeatureEditErrorResult("Incorrect geometry type."));else{var _=this._createDefaultAttributes(),v=m.mixAttributes(this._fieldsIndex,this._requiredFields,_,g.attributes);if(v)i.push(v);else{if(this._assignObjectId(_,g.attributes),g.attributes=_,null!=g.uid){var b=g.attributes[o];e.uidToObjectId[g.uid]=b}g.geometry&&(g.geometry=c.project(g.geometry,g.geometry.spatialReference,l)),f.push(g),i.push(m.createFeatureEditSuccessResult(g.attributes[o]))}}}h.addMany(d.convertFromFeatures([],f,n,a,s,o))},e.prototype._applyUpdateEdits=function(e,t){for(var i=e.updateResults,r=this._queryEngine,n=r.geometryType,s=r.hasM,a=r.hasZ,o=r.objectIdField,l=r.spatialReference,h=r.featureStore,f=0,p=t;f<p.length;f++){var y=p[f],g=y.attributes,_=y.geometry,v=g&&g[o];if(null!=v)if(h.has(v)){var b=d.convertToFeature(h.getFeature(v),n,a,s);if(_){if(n!==u.getJsonType(_)){i.push(m.createFeatureEditErrorResult("Incorrect geometry type."));continue}b.geometry=c.project(_,_.spatialReference,l),x(b,s,a)}if(g){var F=m.mixAttributes(this._fieldsIndex,this._requiredFields,b.attributes,g);if(F){i.push(F);continue}}h.add(d.convertFromFeature(b,n,a,s,o)),i.push(m.createFeatureEditSuccessResult(v))}else i.push(m.createFeatureEditErrorResult("Feature with object id "+v+" missing"));else i.push(m.createFeatureEditErrorResult("Identifier field "+o+" missing"))}},e.prototype._assignObjectId=function(e,t,i){void 0===i&&(i=!1);var r=this._queryEngine.objectIdField;i&&t&&isFinite(t[r])?e[r]=t[r]:e[r]=this._nextObjectId++},e}();t.default=M}.apply(null,r))||(e.exports=n)},2533:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(117)],void 0===(n=function(e,t,i){function r(e){return new a(e)}function n(e,t){var r=t;return"string"==typeof t&&i.isNumericField(e)?r=parseFloat(t):null!=t&&i.isStringField(e)&&"string"!=typeof t&&(r=String(t)),i.sanitizeNullFieldValue(r)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return function(){this.code=null,this.description=null}}();t.createFeatureEditError=function(e){return new s};var a=function(){return function(e){this.error=new s,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}();t.createFeatureEditErrorResult=r;var o=function(){return function(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}();t.createFeatureEditSuccessResult=function(e){return new o(e)};var u=new Set;t.mixAttributes=function(e,t,s,a,o,l){for(var d in void 0===o&&(o=!1),u.clear(),a){var h=e.get(d);if(h){var c=a[d],f=n(h,c);if(f!==c&&l&&l.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:h,originalValue:c,sanitizedValue:f}}),u.add(h.name),h&&(o||h.editable)){var p=i.validateFieldValue(h,f);if(p)return r(i.validationErrorToString(p,h,f));s[h.name]=f}}}for(var m=0,y=t;m<y.length;m++){var g=y[m];if(!u.has(g.name))return r('missing required field "'+g.name+'"')}return null}}.apply(null,r))||(e.exports=n)}}]);