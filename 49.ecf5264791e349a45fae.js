(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/support/FeatureSet":1575,"esri/views/3d/layers/PointCloudWorker":1597,"esri/views/layers/LayerView":1633,"esri/geometry/support/normalizeUtils":1635,"esri/tasks/geometry/cut":1636,"esri/tasks/geometry/simplify":1637,"esri/views/3d/layers/LayerView3D":1640,"esri/views/3d/layers/support/layerViewUpdatingProperties":1645,"esri/tasks/support/AttachmentQuery":1651,"esri/tasks/support/RelationshipQuery":1652,"esri/views/layers/support/popupUtils":1657,"esri/layers/support/PromiseQueue":1687,"esri/views/3d/layers/support/PopupSceneLayerView":1762,"esri/views/3d/layers/i3s/PointCloudRendererUtil":1769,"esri/views/3d/layers/PointCloudLayerView3D":2569,"esri/views/3d/layers/i3s/LoDUtil":2570,"esri/views/3d/layers/i3s/PagedNodeIndex":2571,"esri/views/3d/layers/i3s/PointGraphic":2572,"esri/views/3d/layers/i3s/PointRenderer":2573,"esri/views/3d/layers/i3s/PointHighlights":2574,"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":2575})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49,77,110],{1575:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(2),r(36),r(97),r(27),r(12),r(9),r(0),r(40),r(57),r(633)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h){var c=new a.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"}),f=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return n(t,e),t.prototype.readFeatures=function(e,t){for(var r=d.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=o.fromJSON(a),u=a.geometry&&a.geometry.spatialReference;l.isSome(s.geometry)&&!u&&(s.geometry.spatialReference=r),n.push(s)}return n},t.prototype.writeGeometryType=function(e,t,r,n){if(e)c.write(e,t,r,n);else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s&&l.isSome(s.geometry))return void c.write(s.geometry.type,t,r,n)}}},t.prototype.writeSpatialReference=function(e,t,r,n){if(e)t.spatialReference=e.toJSON();else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];s&&l.isSome(s.geometry)&&s.geometry.spatialReference&&(t.spatialReference=s.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],n=t[1],i=e.translate,o=i[0],a=i[1],s=this.features,u=this._getQuantizationFunction(this.geometryType,function(e){return Math.round((e-o)/r)},function(e){return Math.round((a-e)/n)}),d=0,p=s.length;d<p;d++)u(l.expect(s[d].geometry))||(s.splice(d,1),d--,p--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this,t=e.geometryType,r=e.features,n=e.transform;if(!n)return this;for(var i=n.translate,o=i[0],a=i[1],s=n.scale,u=s[0],d=s[1],p=this._getHydrationFunction(t,function(e){return e*u+o},function(e){return a-e*d}),h=0,c=r;h<c.length;h++){var f=c[h].geometry;l.isSome(f)&&p(f)}return this},t.prototype._quantizePoints=function(e,t,r){for(var n,i,o=[],a=0,s=e.length;a<s;a++){var l=e[a];if(a>0){var u=t(l[0]),d=r(l[1]);u===n&&d===i||(o.push([u-n,d-i]),n=u,i=d)}else n=t(l[0]),i=r(l[1]),o.push([n,i])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=p.isPolygon(e)?e.rings:e.paths,o=[],a=0,s=i.length;a<s;a++){var l=i[a],u=n._quantizePoints(l,t,r);u&&o.push(u)}return o.length>0?(p.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var i;return(i=n._quantizePoints(e.points,t,r)).length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:null},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,i,o=p.isPolygon(e)?e.rings:e.paths,a=0,s=o.length;a<s;a++)for(var l=o[a],u=0,d=l.length;u<d;u++){var h=l[u];u>0?(n+=h[0],i+=h[1]):(n=h[0],i=h[1]),h[0]=t(n),h[1]=r(i)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,i,o=e.points,a=0,s=o.length;a<s;a++){var l=o[a];a>0?(n+=l[0],i+=l[1]):(n=l[0],i=l[1]),l[0]=t(n),l[1]=r(i)}}:void 0},r([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r([u.property({type:[o],json:{write:!0}})],t.prototype,"features",void 0),r([u.reader("features")],t.prototype,"readFeatures",null),r([u.property({type:[h],json:{write:!0}})],t.prototype,"fields",void 0),r([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:c.read}}})],t.prototype,"geometryType",void 0),r([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r([u.property({types:i.geometryTypes,json:{read:p.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r([u.property({type:d,json:{write:!0}})],t.prototype,"spatialReference",void 0),r([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r([u.subclass("esri.tasks.support.FeatureSet")],t)}(u.declared(s.JSONSupport));return f.prototype.toJSON.isDefaultToJSON=!0,f||(f={}),f}.apply(null,n))||(e.exports=i)},1597:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(3),r(9),r(7),r(407),r(121),r(405),r(414),r(1703),r(8),r(288),r(40),r(1769),r(41),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g){Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(){}return e.prototype._process=function(e){var t=this._transform(e),r=[t.points.buffer,t.rgb.buffer];n.isSome(t.pointIdFilterMap)&&r.push(t.pointIdFilterMap.buffer);for(var o=0,s=t.attributes;o<s.length;o++){var l=s[o];"buffer"in l.values&&a.isArrayBuffer(l.values.buffer)&&l.values.buffer!==t.rgb.buffer&&r.push(l.values.buffer)}return i.resolve({result:t,transferList:r})},e.prototype._transform=function(e){var t=c.readGeometry(e.schema,e.geometryBuffer),r=t.length/3,i=null,o=[],a=c.getAttributeValues(e.primaryAttributeData,t,r);n.isSome(e.primaryAttributeData)&&a&&o.push({attributeInfo:e.primaryAttributeData.attributeInfo,values:a});var s=c.getAttributeValues(e.modulationAttributeData,t,r);n.isSome(e.modulationAttributeData)&&s&&o.push({attributeInfo:e.modulationAttributeData.attributeInfo,values:s});var l=c.evaluateRenderer(e.rendererInfo,a,s,r);if(e.filterInfo&&e.filterInfo.length>0&&n.isSome(e.filterAttributesData)){var u=e.filterAttributesData.map(function(e){var n=c.getAttributeValues(e,t,r),i={attributeInfo:e.attributeInfo,values:n};return o.push(i),i});i=new Uint32Array(r),r=c.filterInPlace(t,l,i,e.filterInfo,u)}for(var d=0,p=e.userAttributesData;d<p.length;d++){var f=p[d],g=c.getAttributeValues(f,t,r);o.push({attributeInfo:f.attributeInfo,values:g})}3*r<l.length&&(l=new Uint8Array(l.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(t,r,e.elevationOffset);var y=this._transformCoordinates(t,r,e.obb,h.fromJSON(e.inSR),h.fromJSON(e.outSR));return{obb:e.obb,points:y,rgb:l,attributes:o,pointIdFilterMap:i}},e.prototype._transformCoordinates=function(e,t,r,n,i){if(!f.bufferToBuffer(e,n,0,e,i,0,t))throw Error("Can't reproject");var o=p.vec3f32.fromValues(r.center[0],r.center[1],r.center[2]),a=p.vec3f32.create(),s=p.vec3f32.create();l.quat.conjugate(v,r.quaternion);for(var u=new Float32Array(3*t),h=0;h<t;h++)a[0]=e[3*h]-o[0],a[1]=e[3*h+1]-o[1],a[2]=e[3*h+2]-o[2],d.vec3.transformQuat(s,a,v),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(s[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(s[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(s[2])),u[3*h]=a[0],u[3*h+1]=a[1],u[3*h+2]=a[2];return u},e.prototype._applyElevationOffsetInPlace=function(e,t,r){if(0!==r)for(var n=0;n<t;n++)e[3*n+2]+=r},e}(),v=u.quatf32.create(),m=function(t){function n(){var r=t.call(this)||this;return r._thread=void 0,s.open(o.getAbsMid("./PointCloudWorker",e,g)).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(n,t),n.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},n.prototype.transform=function(e,t,r){return this._thread?this._thread.invoke("_process",e,{transferList:t,signal:r}):i.resolve(this._transform(e))},n}(y);t.PointCloudWorker=m,t.default=function(){return new y}}.apply(null,n))||(e.exports=i)},1633:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(16),r(49),r(282),r(284),r(6),r(225),r(7),r(0)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),d.reject(t)}})},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([p.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([p.property()],t.prototype,"layer",void 0),n([p.property()],t.prototype,"parent",void 0),n([p.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([p.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),n([p.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([p.subclass("esri.views.layers.LayerView")],t)}(p.declared(a.HandleOwnerMixin(s.IdentifiableMixin(u.EsriPromiseMixin(o.EventedMixin(i))))))}.apply(null,n))||(e.exports=i)},1635:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(11),r(98),r(14),r(6),r(9),r(7),r(91),r(104),r(40),r(90),r(63),r(1636),r(1637)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g){function y(e){return"polygon"===e.type}function v(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function _(e){return y(e)?e.rings:e.paths}function b(e,t){return Math.ceil((e-t)/(2*t))}function S(e,t){for(var r=0,n=_(e);r<n.length;r++)for(var i=0,o=n[r];i<o.length;i++){o[i][0]+=t}return e}function P(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++){for(var o=e[i],a=null,s=0;s<o.length;s++)a=o[s],t.push(a),0===s?n=r=a[0]:(r=Math.min(r,a[0]),n=Math.max(n,a[0]));a&&t.push([(r+n)/2,0])}return t}function w(e,t){if(!(e instanceof d||e instanceof u)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw R.error(r),new o(r)}for(var n=[],i=0,a=_(e);i<a.length;i++){var s=a[i],l=[];n.push(l),l.push([s[0][0],s[0][1]]);for(var p=0;p<s.length-1;p++){var h=s[p][0],c=s[p][1],f=s[p+1][0],g=s[p+1][1],v=Math.sqrt((f-h)*(f-h)+(g-c)*(g-c)),m=(g-c)/v,b=(f-h)/v,S=v/t;if(S>1){for(var P=1;P<=S-1;P++){var w=P*t,x=b*w+h,I=m*w+c;l.push([x,I])}var N=(v+Math.floor(S-1)*t)/2,O=b*N+h,A=m*N+c;l.push([O,A])}l.push([f,g])}}return y(e)?new u({rings:n,spatialReference:e.spatialReference}):new d({paths:n,spatialReference:e.spatialReference})}function x(e,t,r){if(t){var n=w(e,1e6);e=c.webMercatorToGeographic(n,!0)}return r&&(e=S(e,r)),e}function I(e,t,r){var n;if(Array.isArray(e)){if((n=e[0])>t){var i=b(n,t);e[0]=n+i*(-2*t)}else if(n<r){i=b(n,r);e[0]=n+i*(-2*r)}}else if((n=e.x)>t){i=b(n,t);e=e.clone().offset(i*(-2*t),0)}else if(n<r){i=b(n,r);e=e.clone().offset(i*(-2*r),0)}return e}function N(e,t){for(var r=-1,n=0;n<t.cutIndexes.length;n++)!function(n){for(var i=t.cutIndexes[n],o=t.geometries[n],a=_(o),s=0;s<a.length;s++)!function(e){var t=a[e];t.some(function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var a=t[i][0];n=a>n?a:n}for(var s=-360*b(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var u=o.getPoint(e,l);o.setPoint(e,l,u.clone().offset(s,0))}return!0})}(s);if(i===r){if(v(e))for(var l=0,u=_(o);l<u.length;l++){var d=u[l];e[i]=e[i].addRing(d)}else if(m(e))for(var p=0,h=_(o);p<h.length;p++){var c=h[p];e[i]=e[i].addPath(c)}}else r=i,e[i]=o}(n);return e}Object.defineProperty(t,"__esModule",{value:!0});var R=a.getLogger("esri.geometry.support.normalizeUtils"),O={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new d({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator}),minus180Line:new d({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new d({paths:[[[180,-180],[180,180]]],spatialReference:p.WGS84}),minus180Line:new d({paths:[[[-180,-180],[-180,180]]],spatialReference:p.WGS84})}};t.straightLineDensify=w,t.normalizeCentralMeridian=function e(t,o,a){return n(this,void 0,void 0,function(){var n,p,y,v,m,_,P,w,R,A,M,z,C,F,j,V,k,E,L,T,H,U,D,W,B,G,Q,q,J,X,Y,Z,K,$,ee,te,re;return r(this,function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],o)];for(n=o?o.url:i.geometryServiceUrl,A=0,M=[],z=[],C=0,F=t;C<F.length;C++)j=F[C],s.isNone(j)?z.push(j):(p||(p=j.spatialReference,y=h.getInfo(p),v=p.isWebMercator,m=O[P=v?102100:4326].maxX,_=O[P].minX,w=O[P].plus180Line,R=O[P].minus180Line),y?"mesh"===j.type?z.push(j):"point"===j.type?z.push(I(j.clone(),m,_)):"multipoint"===j.type?((V=j.clone()).points=V.points.map(function(e){return I(e,m,_)}),z.push(V)):"extent"===j.type?(E=j.clone(),k=E._normalize(!1,!1,y),z.push(k.rings?new u(k):k)):j.extent?(E=j.extent,L=b(E.xmin,_),H=0==(T=L*(2*m))?j.clone():S(j.clone(),T),E.offset(T,0),E.intersects(w)&&E.xmax!==m?(A=E.xmax>A?E.xmax:A,H=x(H,v),M.push(H),z.push("cut")):E.intersects(R)&&E.xmin!==_?(A=E.xmax*(2*m)>A?E.xmax*(2*m):A,H=x(H,v,360),M.push(H),z.push("cut")):z.push(H)):z.push(j.clone()):z.push(j));for(U=b(A,m),D=-90,W=U,B=new d;U>0;)G=360*U-180,B.addPath([[G,D],[G,-1*D]]),D*=-1,U--;return M.length>0&&W>0?[4,f.cut(n,M,B,a)]:[3,3];case 1:for(Q=r.sent(),q=N(M,Q),J=[],X=[],ee=0;ee<z.length;ee++)"cut"!==(te=z[ee])?X.push(te):(re=q.shift(),Y=t[ee],s.isSome(Y)&&"polygon"===Y.type&&Y.rings&&Y.rings.length>1&&re.rings.length>=Y.rings.length?(J.push(re),X.push("simplify")):X.push(v?c.geographicToWebMercator(re):re));return J.length?[4,g.simplify(n,J,a)]:[2,X];case 2:for(Z=r.sent(),K=[],ee=0;ee<X.length;ee++)"simplify"!==(te=X[ee])?K.push(te):K.push(v?c.geographicToWebMercator(Z.shift()):Z.shift());return[2,K];case 3:for($=[],ee=0;ee<z.length;ee++)"cut"!==(te=z[ee])?$.push(te):(re=M.shift(),$.push(!0===v?c.geographicToWebMercator(re):re));return[2,l.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&h.getInfo(e.spatialReference);if(!n)return r;var i,o=n.valid,a=o[0],s=o[1],l=2*s,u=r.width,d=r.xmin,p=r.xmax;if(d=(t=[p,d])[0],p=t[1],"extent"===e.type||0===u||u<=s||u>l||d<a||p>s)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;i=P(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;i=P(e.paths);break;case"multipoint":i=e.points}for(var c=r.clone(),f=0;f<i.length;f++){var g=i[f][0];g<0?(g+=s,p=Math.max(g,p)):(g-=s,d=Math.min(g,d))}return c.xmin=d,c.xmax=p,c.width<u?(c.xmin-=s,c.xmax-=s,c):r},t.normalizeMapX=function(e,t){var r=h.getInfo(t);if(r){var n=r.valid,i=n[0],o=n[1],a=o-i;if(e<i)for(;e<i;)e+=a;if(e>o)for(;e>o;)e-=a}return e}}.apply(null,n))||(e.exports=i)},1636:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(11),r(10),r(36),r(44),r(31),r(57)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,u,d){return n(this,void 0,void 0,function(){var n,p,h,c,f,g,y;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?s.urlToObject(e):e,p=t[0].spatialReference,h=r({},d,{query:r({},n.query,{f:"json",sr:JSON.stringify(p),target:JSON.stringify({geometryType:l.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(u)})}),[4,a(n.path+"/cut",h)];case 1:return c=i.sent(),f=c.data,g=f.cutIndexes,y=f.geometries,[2,{cutIndexes:g,geometries:(void 0===y?[]:y).map(function(e){return o.fromJSON(e).set(p)})}]}})})}}.apply(null,n))||(e.exports=i)},1637:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(11),r(10),r(44),r(31),r(57)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,l){return n(this,void 0,void 0,function(){var n,u,d,p;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?a.urlToObject(e):e,u=t[0].spatialReference,d=s.getJsonType(t[0]),p=r({},l,{query:r({},n.query,{f:"json",sr:u.wkid?u.wkid:JSON.stringify(u),geometries:JSON.stringify(function(e){return{geometryType:s.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}(t))})}),[4,o(n.path+"/simplify",p)];case 1:return[2,function(e,t,r){var n=s.getGeometryType(t);return e.map(function(e){var t=n.fromJSON(e);return t.spatialReference=r,t})}(i.sent().data,d,u)]}})})}}.apply(null,n))||(e.exports=i)},1640:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(7),r(25),r(0),r(408)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.destroy=function(){this.view=null},t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.property()],t.prototype,"slicePlaneEnabled",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(e))}}.apply(null,n))||(e.exports=i)},1645:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1651:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(12),r(15),r(0),r(26)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentTypes=null,r.globalIds=null,r.num=null,r.objectIds=null,r.returnMetadata=!1,r.size=null,r.start=null,r.where=null,r}var i;return r(t,e),i=t,t.prototype.writeStart=function(e,t,r){t.resultOffset=this.start,t.resultRecordCount=this.num||10},t.prototype.clone=function(){return new i(o.clone({attachmentTypes:this.attachmentTypes,where:this.where,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))},n([a.property({type:[String],json:{write:!0}})],t.prototype,"attachmentTypes",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"globalIds",void 0),n([a.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([a.property({type:Boolean,json:{default:!1,write:!0}})],t.prototype,"returnMetadata",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"size",void 0),n([a.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([a.writer("start"),a.writer("num")],t.prototype,"writeStart",null),n([a.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),i=n([a.subclass("esri.tasks.support.AttachmentQuery")],t)}(a.declared(i.JSONSupport));return l.from=s.default(l),l}.apply(null,n))||(e.exports=i)},1652:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(36),r(12),r(15),r(0),r(26)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.geometryPrecision=void 0,r.historicMoment=null,r.maxAllowableOffset=void 0,r.objectIds=null,r.outFields=null,r.outSpatialReference=null,r.relationshipId=void 0,r.returnGeometry=!1,r.source=null,r.where=null,r}var o;return r(t,e),o=t,t.prototype._writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.clone=function(){return new o(a.clone({gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source,where:this.where}))},n([s.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([s.property({type:Date})],t.prototype,"historicMoment",void 0),n([s.writer("historicMoment")],t.prototype,"_writeHistoricMoment",null),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([s.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([s.property({type:i.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([s.property({json:{write:!0}})],t.prototype,"relationshipId",void 0),n([s.property({json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([s.property({json:{write:!0}})],t.prototype,"source",void 0),n([s.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),o=n([s.subclass("esri.tasks.support.RelationshipQuery")],t)}(s.declared(o.JSONSupport));return u.from=l.default(u),u}.apply(null,n))||(e.exports=i)},1657:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(11),r(229),r(9),r(117)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),n(this,void 0,void 0,function(){var n,s,l,u,d,p,h,c,f,g,y;return r(this,function(r){switch(r.label){case 0:return o.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return n=r.sent(),s=t.lastEditInfoEnabled,l=e.objectIdField,u=e.typeIdField,i.includes(n,"*")?[2,["*"]]:(p=a.fixFields,h=[e.fields],f=(c=n).concat,g=[[u]],(y=s)?[4,a.getFeatureEditFields(e)]:[3,3]);case 2:y=r.sent(),r.label=3;case 3:return(d=p.apply(void 0,h.concat([f.apply(c,g.concat([y||null]))])))&&l&&a.hasField(e.fields,l)&&-1===d.indexOf(l)&&d.push(l),[2,d]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:o.isSome(t)&&t.defaultPopupTemplateEnabled&&o.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,n))||(e.exports=i)},1687:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return r.create(function(r,n){t._deferreds.push({resolve:r,reject:n}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return r.create(function(r,n){t._deferreds.unshift({resolve:r,reject:n}),t._values.unshift(e)})},Object.defineProperty(e.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),e.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,n=this._deferreds;t<n.length;t++)n[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.PromiseQueue=n}.apply(null,n))||(e.exports=i)},1762:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(14),r(79),r(9),r(7),r(0),r(117),r(1657)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h){Object.defineProperty(t,"__esModule",{value:!0}),t.PopupSceneLayerView=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validateFetchPopupFeatures=function(e){var t=this.layer;return t.popupEnabled?h.getFetchPopupTemplate(t,e)?void 0:new a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.prepareFetchPopupFeatures=function(e){return o(this,void 0,void 0,function(){return i(this,function(e){return[2]})})},t.prototype.fetchPopupFeatures=function(e,t){return o(this,void 0,void 0,function(){var e,r,n,o,a,d,c,f,g,y,v;return i(this,function(i){switch(i.label){case 0:return(e=this._validateFetchPopupFeatures(t))?[2,u.reject(e)]:(r=l.isSome(t)?t.clientGraphics:null)&&0!==r.length?(n=[],o=[],d=p.unpackFieldNames,c=[this.layer.fields],[4,h.getRequiredFields(this.layer,h.getFetchPopupTemplate(this.layer,t))]):[2,u.resolve([])];case 1:return a=d.apply(void 0,c.concat([i.sent()])),[4,this.prepareFetchPopupFeatures(a)];case 2:for(i.sent(),f=new Set,g=0,y=r;g<y.length;g++)v=y[g],p.populateMissingFields(a,v,f)?o.push(v):n.push(v);return 0===o.length?[2,u.resolve(n)]:[2,this.whenGraphicAttributes(o,s.valuesOfSet(f)).catch(function(){return o}).then(function(e){return n.concat(e)})]}})})},n([d.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(d.declared(e))}}.apply(null,n))||(e.exports=i)},1769:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(1729),r(1732),r(1733),r(1678),r(1734)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){for(var t=0,r=0,n=e||[];r<n.length;r++)t|=1<<n[r];return t}function u(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{name:t,storageInfo:i,useElevation:!1}}return null}function d(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t){var o="embedded-elevation"===i.encoding;return{name:t,storageInfo:o?null:i,useElevation:o}}}return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}function p(e,t){for(var r=new Float64Array(t),n=0;n<t;n++)r[n]=e[3*n+2];return r}function h(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,i=null,o=!1;"point-cloud-unique-value"===r?i=d(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?i=d(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?i=d(e.attributeStorageInfo,t.field):o="point-cloud-rgb"===r?null!=(i=u(e.attributeStorageInfo,t.field)):null!=(i=u(e.attributeStorageInfo,"RGB"));var a=null;return t&&t.colorModulation&&(a=d(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:o,primaryAttribute:i,modulationAttribute:a}},t.getFilterInfo=function(e){var t=e.filters;return t?t.map(function(t){return{filterJSON:t.toJSON(),attributeInfo:d(e.attributeStorageInfo,t.field)}}):[]},t.evaluateRenderer=function(e,t,r,a){var s=e.rendererJSON,l=e.isRGBRenderer,u=null,d=null;if(t&&l)u=t;else if(t&&"pointCloudUniqueValueRenderer"===s.type){var p=(d=o.fromJSON(s)).colorUniqueValueInfos;u=new Uint8Array(3*a);for(var c=h(d.fieldTransformType),f=0;f<a;f++)for(var g=(m=c?c(t[f]):t[f])+"",y=0;y<p.length;y++)if(p[y].values.indexOf(g)>=0){u[3*f]=p[y].color.r,u[3*f+1]=p[y].color.g,u[3*f+2]=p[y].color.b;break}}else if(t&&"pointCloudStretchRenderer"===s.type){var v=(d=i.fromJSON(s)).stops;for(u=new Uint8Array(3*a),c=h(d.fieldTransformType),f=0;f<a;f++){var m=c?c(t[f]):t[f],_=v.length-1;if(m<v[0].value)u[3*f]=v[0].color.r,u[3*f+1]=v[0].color.g,u[3*f+2]=v[0].color.b;else if(m>=v[_].value)u[3*f]=v[_].color.r,u[3*f+1]=v[_].color.g,u[3*f+2]=v[_].color.b;else for(y=1;y<v.length;y++)if(m<v[y].value){var b=(m-v[y-1].value)/(v[y].value-v[y-1].value);u[3*f]=v[y].color.r*b+v[y-1].color.r*(1-b),u[3*f+1]=v[y].color.g*b+v[y-1].color.g*(1-b),u[3*f+2]=v[y].color.b*b+v[y-1].color.b*(1-b);break}}}else if(t&&"pointCloudClassBreaksRenderer"===s.type){var S=(d=n.fromJSON(s)).colorClassBreakInfos;for(u=new Uint8Array(3*a),c=h(d.fieldTransformType),f=0;f<a;f++)for(m=c?c(t[f]):t[f],y=0;y<S.length;y++)if(m>=S[y].minValue&&m<=S[y].maxValue){u[3*f]=S[y].color.r,u[3*f+1]=S[y].color.g,u[3*f+2]=S[y].color.b;break}}else for(u=new Uint8Array(3*a),f=0;f<u.length;f++)u[f]=255;if(r&&d&&d.colorModulation){var P=d.colorModulation.minValue,w=d.colorModulation.maxValue;for(f=0;f<a;f++){var x=(m=r[f])>=w?1:m<=P?.3:.3+.7*(m-P)/(w-P);u[3*f]=x*u[3*f],u[3*f+1]=x*u[3*f+1],u[3*f+2]=x*u[3*f+2]}}return u},t.filterInPlace=function(e,t,r,n,i){for(var o=e.length/3,a=0,s=0;s<o;s++){for(var u=!0,d=0;d<n.length&&u;d++){var p=n[d].filterJSON,h=i[d].values[s];switch(p.type){case"pointCloudValueFilter":var c="exclude"===p.mode;-1!==p.values.indexOf(h)===c&&(u=!1);break;case"pointCloudBitfieldFilter":var f=l(p.requiredSetBits),g=l(p.requiredClearBits);(h&f)===f&&0==(h&g)||(u=!1);break;case"pointCloudReturnFilter":for(var y=15&h,v=h>>>4&15,m=v>1,_=1===y,b=y===v,S=!1,P=0,w=p.includedReturns;P<w.length;P++){var x=w[P];if("last"===x&&b||"firstOfMany"===x&&_&&m||"lastOfMany"===x&&b&&m||"single"===x&&!m){S=!0;break}}S||(u=!1)}}u&&(r[a]=s,e[3*a]=e[3*s],e[3*a+1]=e[3*s+1],e[3*a+2]=e[3*s+2],t[3*a]=t[3*s],t[3*a+1]=t[3*s+1],t[3*a+2]=t[3*s+2],a++)}return a},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type},t.getAttributeInfo=d,t.elevationFromPositions=p,t.getAttributeValues=function(e,t,n){return r.isSome(e)&&e.attributeInfo.useElevation?p(t,n):r.isSome(e)?a.readBinaryAttribute(e.attributeInfo.storageInfo,e.buffer,n):null},t.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=a.createGeometryIndexFromSchema(t,e),n=a.createTypedView(t,r.vertexAttributes.position),i=r.header.fields,o=[i.offsetX,i.offsetY,i.offsetZ],l=[i.scaleX,i.scaleY,i.scaleZ],u=n.length/3,d=new Float64Array(3*u),p=0;p<u;p++)d[3*p]=n[3*p]*l[0]+o[0],d[3*p+1]=n[3*p+1]*l[1]+o[1],d[3*p+2]=n[3*p+2]*l[2]+o[2];return d}if("lepcc-xyz"===e.encoding)return s.decodeXYZ(t).result}}.apply(null,n))||(e.exports=i)},2569:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(44),r(43),r(43),r(58),r(29),r(79),r(6),r(9),r(7),r(17),r(121),r(71),r(0),r(8),r(288),r(45),r(33),r(103),r(683),r(428),r(117),r(1687),r(418),r(1640),r(1597),r(1641),r(2570),r(2571),r(1769),r(2572),r(2573),r(1645),r(1762),r(30),r(1655),r(41),r(1633),r(145),r(651)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g,y,v,m,_,b,S,P,w,x,I,N,R,O,A,M,z,C,F,j,V,k,E,L,T,H,U,D,W,B){var G=h.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),Q=T.plane.create(),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maximumPointCount=4e6,t.slicePlaneEnabled=!1,t._renderer=null,t._rendererAdded=!1,t._renderedNodes=new Set,t._nodeScales=new Map,t._updateViewNeeded=!0,t._lodFactor=1,t._worker=new M.PointCloudWorker,t._maxLoggedBoxWarnings=5,t._pageMultiplier=1,t._nodeLoadEpoch=0,t._indexQueue=[],t._workQueue=[],t._idleQueue=new R.PromiseQueue,t._indexPagesLoading=new Map,t._loadingNodes=new Map,t._layerIsVisible=!1,t._codedDomainPopulationPromise=null,t._codedDomainPopulationAbortController=null,t._totalWork=0,t._index=null,t._loadingInitNodePage=!1,t._nodeIdArray=[],t}return r(t,e),Object.defineProperty(t.prototype,"pointScale",{get:function(){var e=j.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRealWorldSymbolSizes",{get:function(){var e=j.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointSize",{get:function(){var e=j.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverseDensity",{get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=j.getRendererInfo(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);var r=j.getFilterInfo(this.layer);if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n];t.add(o.attributeInfo.name)}if(this.layer.outFields)for(var a=0,s=N.unpackFieldNames(this.layer.fields,this.layer.outFields);a<s.length;a++){var l=s[a];t.add(l)}return p.valuesOfSet(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_clippingBox",{get:function(){if(!this.view||!this.view.clippingArea)return null;var e=S.create(),t=this.view.renderSpatialReference;return U.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_elevationOffset",{get:function(){var e=this.layer&&this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=v.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=O.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._tmpPoint=w.makeDehydratedPoint(0,0,0,this.layer.spatialReference),z.checkPointCloudLayerValid(this.layer),z.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var t=this._initNodePages(),r=this.view.resourceController.memoryController;this._memCache=r.getMemCache(this.layer.uid),this.updatingHandles.add(this,"_clippingBox",function(){return e._setUpdateViewNeeded()},2),this.updatingHandles.add(this,"_elevationOffset",function(){return e._elevationOffsetChanged()},2),this.updatingHandles.add(this.layer,"renderer",function(){return e._rendererChanged()},2),this.updatingHandles.add(this.layer,"filters",function(){return e._reload()},2),this.updatingHandles.add(this.layer,"outFields",function(){return e._reload()},2),this.updatingHandles.add(this.layer,"scaleRangeId",function(){return e._setUpdateViewNeeded()}),this.updatingHandles.add(this,"clippingArea",function(){return e._setUpdateViewNeeded()},2),this.updatingHandles.add(this.view.state,"camera",function(){return e._setUpdateViewNeeded()}),this.handles.add([this.view.basemapTerrain.on("scale-change",function(t){return e._scaleUpdateHandler(t)}),r.events.on("quality-changed",function(){return e._setUpdateViewNeeded()})]),this.addResolvingPromise(t);var n=this.view.resourceController.scheduler;this.when(function(){e.handles.add([n.registerTask(W.Task.POINT_CLOUD_LAYER,function(t){return e._process(t)},function(){return e._needsUpdate()}),n.registerIdleStateCallbacks(function(){return e._idleBegin()},function(){return e._idleEnd()}),e.updatingHandles.add(e,"suspended",function(t){t?e._clearNodeState():e._setUpdateViewNeeded()},2)])},function(){e.updatingHandles.removeAll(),e.handles.removeAll()})},t.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},t.prototype.destroy=function(){this.cancelLoading(),this._worker.destroy(),this._worker=null,this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null},t.prototype._initRenderer=function(){var e=this;this._renderer=new k.PointRenderer({createGraphic:function(t,r,n){return e._createGraphic(t,r,n)}}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,"_clippingBox",function(t){return e._renderer.clippingBox=t},2),this.updatingHandles.add(this,"suspended",function(t){return e._setPointsVisible(!t)},2),this.updatingHandles.add(this,"pointScale",function(t){return e._renderer.scaleFactor=t},2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,"useRealWorldSymbolSizes",function(t){return e._renderer.useRealWorldSymbolSizes=t},2),this.updatingHandles.add(this,"pointSize",function(t){var r=g.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r},2),this.updatingHandles.add(this,"slicePlaneEnabled",function(t){return e._renderer.slicePlaneEnabled=t},2),this.updatingHandles.add(this,"inverseDensity",function(){return e._setUpdateViewNeeded()},2),this.updatingHandles.add(this,"maximumPointCount",function(){return e._setUpdateViewNeeded()},2),this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()},2)},t.prototype._destroyRenderer=function(){this._renderer.removeAll(),this._setPointsVisible(!1)},t.prototype._createGraphic=function(e,t,r){var n=c.isSome(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,i=this.view.computeMapPointFromVec3d(r),o=this._createGraphicAttributes(e,n);return new V.PointGraphic({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:n,epoch:this._nodeLoadEpoch},geometry:i,attributes:o,layer:this.layer,sourceLayer:this.layer})},t.prototype._createGraphicAttributes=function(e,t){for(var r={},n=0,i=e.attributes;n<i.length;n++){var o=i[n];this._encodeGraphicAttribute(o.attributeInfo,o.values,t,r)}return r},t.prototype._encodeGraphicAttribute=function(e,t,r,n){var i=e.storageInfo&&e.storageInfo.attributeValues,o=i?i.valuesPerElement:1;if(1===o)n[e.name]=t[r];else if("UInt8"===i.valueType&&o<=4){for(var a=0,s=r*o,l=s;l<s+o;l++)a=(a<<8)+t[l];n[e.name]=a}else n[e.name]=void 0},t.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([6],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)},t.prototype._rendererChanged=function(){this._renderer.useFixedSizes=j.rendererUsesFixedSizes(this.layer.renderer),this._reload()},t.prototype._reload=function(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()},t.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()},t.prototype._scaleUpdateHandler=function(e){var t=this;this.layer.minScale||this.layer.maxScale?U.boundingRectToBoundingRect(e.extent,e.spatialReference,J,this.layer.spatialReference)&&(this._nodeScales.forEach(function(r,n){if(t._renderedNodes.has(n)){var i=t._index.getNode(n);P.containsPoint(J,i.obb.center)&&t._nodeScales.set(n,e.scale)}else t._nodeScales.delete(n)}),this._setUpdateViewNeeded()):this._nodeScales.clear()},t.prototype.displayNodes=function(e){this._workQueue=C.nodeDiff(s.keysOfSet(this._renderedNodes),e,this._index),C.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),C.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},t.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},t.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){var r=t.abortController;return e.push(r)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,i){t.has(i)?n.set(i,e):r.push(e)}),this._loadingNodes=n;for(var i=0,o=r;i<o.length;i++)o[i].abortController.abort();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var i=n[r];if(e._loadingNodes.has(i))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.abortController.abort()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._clearNodeState=function(){var e=this;this._nodeLoadEpoch++,this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},t.prototype._idleBegin=function(){this._setUpdateViewNeeded()},t.prototype._idleEnd=function(){this._setUpdateViewNeeded()},t.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0},t.prototype._process=function(e){var t=this;if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var r=this._isRootNodeVisible();r!==this._layerIsVisible&&(this._layerIsVisible=r,this.notifyChange("suspended")),this._updateLoading()}}else{for(e.run(function(){return t._updateWorkQueues()});this._indexQueue.length>0&&e.run(function(){return t._processIndexQueue()}););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run(function(){return t._idleQueue.process()}););}},t.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift(),r=this._loadNodePage(t);return this._indexPagesLoading.set(t,r),r.promise.then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).then(function(){e._indexPagesLoading.delete(t)},function(){e._indexPagesLoading.delete(t)}),!0},t.prototype._processWorkQueue=function(e){for(;!e.done;){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t),e.madeProgress()}},t.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!l.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},t.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)f.all(e.load.map(function(e){var r=f.createAbortController(),n=t._memCache.pop(e.toString());return n?t._loadingNodes.set(e,{abortController:r,promise:f.resolve(n)}):t._loadingNodes.has(e)||t._loadingNodes.set(e,{abortController:r,promise:u.safeCast(t.loadNode(e,r.signal))}),t._loadingNodes.get(e).promise})).then(function(r){for(var n=0;n<e.load.length;n++)if(r[n]){var i=t._setupRendererData(e.load[n],r[n]);t._addToRenderer(i)}for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).catch(function(){}).then(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},t.prototype.populateClassCodeCodedDomain=function(e,t){return o(this,void 0,void 0,function(){var r,n,o,a,s;return i(this,function(i){switch(i.label){case 0:return r="CLASS_CODE",!(n=this.layer.fieldsIndex.get(r))||n.domain?[2]:-1===e.indexOf(n.name)?[2]:[4,u.result(this.layer.queryCachedStatistics(r,{signal:t}))];case 1:return!1===(o=i.sent()).ok?[2]:(a=o.value,(s=a&&a.labels&&a.labels.labels)&&Array.isArray(s)?(n.domain=new I.CodedValueDomain({name:"CLASS_CODE",codedValues:s.map(function(e){return new x.default({code:e.value,name:e.label})})}),[2]):[2])}})})},t.prototype.prepareFetchPopupFeatures=function(e){return o(this,void 0,void 0,function(){var t=this;return i(this,function(r){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=f.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then(function(){t._codedDomainPopulationAbortController=null})),[2,this._codedDomainPopulationPromise]})})},t.prototype.whenGraphicAttributes=function(e,t){return o(this,void 0,void 0,function(){var r,n,a,s,l,d=this;return i(this,function(p){switch(p.label){case 0:return r=this._splitGraphicsPerNode(e),n=this.layer.attributeStorageInfo,a=t.map(function(e){return j.getAttributeInfo(n,e)}),s=function(e,t){return o(d,void 0,void 0,function(){var r,n=this;return i(this,function(s){switch(s.label){case 0:return r=this._index.getNode(t),[4,u.forEach(a,function(t){return o(n,void 0,void 0,function(){var n,o,a,s,l,u;return i(this,function(i){switch(i.label){case 0:return t.useElevation?[4,this._loadElevationAttributeFromGeometry(r.resourceId)]:[3,2];case 1:return o=i.sent(),[3,4];case 2:return[4,this._loadAndParseAttribute(r,t)];case 3:o=i.sent(),i.label=4;case 4:if(!(n=o))return[2];for(a=0,s=e;a<s.length;a++)l=s[a],this._isValidPointGraphic(l)&&(u=l.pointCloudMetadata.attributePointIndexInNode,this._encodeGraphicAttribute(t,n,u,l.attributes));return[2]}})})})];case 1:return s.sent(),[2]}})})},l=[],r.forEach(function(e,t){l.push(s(e,t))}),[4,f.eachAlways(l)];case 1:return p.sent(),[2,e]}})})},t.prototype._isValidPointGraphic=function(e){return e instanceof V.PointGraphic&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch},t.prototype._splitGraphicsPerNode=function(e){for(var t=new Map,r=0,n=e;r<n.length;r++){var i=n[r];if(this._isValidPointGraphic(i)){var o=i.pointCloudMetadata,a=t.get(o.nodeId);a?a.push(i):t.set(o.nodeId,[i])}}return t},t.prototype._loadAndParseAttribute=function(e,t){return o(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return[4,this.loadAttribute(e.resourceId,t,null)];case 1:return r=n.sent(),[2,c.isSome(r)?j.getAttributeValues({attributeInfo:t,buffer:r},null,e.vertexCount):null]}})})},t.prototype._loadElevationAttributeFromGeometry=function(e){return o(this,void 0,void 0,function(){var t,r,n,o;return i(this,function(i){switch(i.label){case 0:return t=this.layer.store.defaultGeometrySchema,n=j.readGeometry,o=[t],[4,this.loadGeometry(e,null)];case 1:return r=n.apply(void 0,o.concat([i.sent()])),[2,j.elevationFromPositions(r,r.length/3)]}})})},t.prototype.highlight=function(e,t){var r=this;if(void 0===t&&(t={}),!e)return{remove:function(){},pause:function(){},resume:function(){}};var n=d.isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(n.map(function(e){return r._graphicToPointDefinition(e)}),t)},t.prototype._graphicToPointDefinition=function(e){if(!this._isValidPointGraphic(e))return null;var t=e.pointCloudMetadata,r=t.nodeId,n=t.pointIndexInNode;return null!=r&&null!=n?{nodeId:r,pointId:n}:null},t.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),t.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},t.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},t.prototype.isUpdating=function(){return this._computeWork()>0},t.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new F(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).promise.then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},t.prototype._loadNodePage=function(e){var t=this,r=f.createAbortController(),n=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return{promise:this._requestJSON(n,r.signal).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})}),abortController:r}},t.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(n/(.75*t));n>t;)e*=i,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(2);return this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading(),!0},t.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},t.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor},t.prototype._isRootNodeVisible=function(){var e=!1;return this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(t,r,n){return e=n,!1},pageMiss:function(e,t){}}),e},t.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustum,i=this._clippingBox,o=r.viewForward,a=_.vec3.dot(o,r.eye),s=T.plane.fromNormalAndOffset(o,-a,Q),l=r.perScreenPixelRatio/2,u=e*e,d=this._nodeIdArray;d.length=0;var p=B.extractSafeScaleBounds(this.layer),h=p.minScale,c=p.maxScale,f=0===h&&0===c?function(e){return d.push(e)}:function(e){var r=t._getScale(e);B.scaleBoundsPredicate(r,h,c)&&d.push(e)};return this._traverseVisible({frustumPlanes:n.planes,clippingBox:i},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return f(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,r.lodThreshold,r.vertexCount,s,l)<=u&&(f(e),1))},pageMiss:function(e,r){f(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),d},t.prototype._getScale=function(e){var t=this._nodeScales.get(e);if(null==t){var r=this._index.getNode(e).obb.center;this._tmpPoint.x=r[0],this._tmpPoint.y=r[1],this._tmpPoint.z=r[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t},t.prototype._computeAveragePixelArea=function(e,t,r,n,i){var o=Math.max(1e-7,H.minimumDistancePlane(e,n));return t/(o*o)/(4*i*i)/r},t.prototype.loadNode=function(e,t){return o(this,void 0,void 0,function(){return i(this,function(r){try{return[2,this.loadNodeAsync(e,t)]}catch(e){throw f.isAbortError(e)||G.error(e),e}return[2]})})},t.prototype.loadAdditionalUserAttributes=function(e,t,r){return o(this,void 0,void 0,function(){var n,o,a,s,l,u,d,h,g,y;return i(this,function(i){switch(i.label){case 0:if(!(n=this.layer.outFields))return[2,[]];for(o=N.unpackFieldNames(this.layer.fields,n),a=p.SetFromValues(e.map(function(e){return c.isSome(e)?e.name:null})),s=this.layer.attributeStorageInfo,l=[],u=0,d=o;u<d.length;u++)h=d[u],a.has(h)||(g=j.getAttributeInfo(s,h))&&l.push(t(g));return[4,f.eachAlwaysValues(l)];case 1:return y=i.sent(),f.throwIfAborted(r),[2,c.mapSome(y,function(e){return e})]}})})},t.prototype.loadNodeAsync=function(e,t){return o(this,void 0,void 0,function(){var r,n,a,s,l,u,d,p,h,g,y,v,m,_,b,S,P,w,x,I,N,R,O,A,M,z=this;return i(this,function(C){switch(C.label){case 0:return r=this._index.getNode(e),n=j.getRendererInfo(this.layer),a=j.getFilterInfo(this.layer),s=r.resourceId,l=function(e){return o(z,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return c.isNone(e)?[2,null]:e.useElevation?[2,{attributeInfo:e,buffer:null}]:[4,this.loadAttribute(s,e,t)];case 1:return r=n.sent(),[2,c.isSome(r)?{attributeInfo:e,buffer:r}:null]}})})},[4,this._idleQueue.push()];case 1:return C.sent(),u=this.loadGeometry(s,t),d=n.primaryAttribute,p=n.modulationAttribute,h=l(d),g=l(p),y=a.map(function(e){return e.attributeInfo}),v=y.map(function(e){return l(e)}),m=this.loadAdditionalUserAttributes([d,p].concat(y),l,t),[4,u];case 2:return _=C.sent(),[4,h];case 3:return b=C.sent(),[4,g];case 4:return S=C.sent(),[4,f.all(v)];case 5:return P=C.sent(),[4,m];case 6:for(w=C.sent(),f.throwIfAborted(t),x=[_],c.isSome(b)&&b.buffer&&x.push(b.buffer),c.isSome(S)&&S.buffer&&x.push(S.buffer),I=0,N=P;I<N.length;I++)A=N[I],c.isSome(A)&&A.buffer&&x.push(A.buffer);for(R=0,O=w;R<O.length;R++)(A=O[R]).buffer&&x.push(A.buffer);return M={geometryBuffer:_,primaryAttributeData:b,modulationAttributeData:S,filterAttributesData:P,userAttributesData:w,schema:this.layer.store.defaultGeometrySchema,rendererInfo:n,filterInfo:a,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()},[4,this._worker.transform(M,x,t)];case 7:return[2,C.sent()]}})})},t.prototype.loadGeometry=function(e,t){return o(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return r=this.baseUrl+"/nodes/"+e+"/geometries/0",[4,this._requestBinary(r,t)];case 1:return[2,n.sent().data]}})})},t.prototype.loadAttribute=function(e,t,r){return o(this,void 0,void 0,function(){var n,o;return i(this,function(i){switch(i.label){case 0:return c.isNone(t)||!t.storageInfo?[2,null]:(n=t.storageInfo.key,o=this.baseUrl+"/nodes/"+e+"/attributes/"+n,[4,this._requestBinary(o,r)]);case 1:return[2,i.sent().data]}})})},t.prototype._requestJSON=function(e,t){return a(e,{query:{f:"json"},responseType:"json",signal:t})},t.prototype._requestBinary=function(e,t){return a(e,{responseType:"array-buffer",signal:t})},t.prototype._removeFromRenderer=function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}},t.prototype._addToRenderer=function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))},t.prototype._setupRendererData=function(e,t){var r=this._index.getNode(e),n=Math.sqrt(r.lodThreshold/r.vertexCount),i=this._index.getRenderObb(e);if(k.PointRenderer.isInstanceOfNode(t))return t.splatSize=n,t.obb=i,t.origin=b.vec3f32.clone(t.obb.center),t;if(t.obb.halfSize[0]>i.halfSize[0]||t.obb.halfSize[1]>i.halfSize[1]||t.obb.halfSize[2]>i.halfSize[2]){if(this._maxLoggedBoxWarnings>0){var o=function(e){return"["+e.halfSize[0]+", "+e.halfSize[1]+", "+e.halfSize[2]+"]"};G.warn("Node "+e+" reported bounding box too small. got "+o(i)+" but points cover "+o(t.obb)),0==--this._maxLoggedBoxWarnings&&G.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:b.vec3f32.clone(i.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:n,obb:i,isLeaf:0===r.childCount}},t.prototype.getUsedMemory=function(){var e=0;return this._renderer.forEachNode(function(t){e+=X,e+=y.estimateSize(t.coordinates);for(var r=0,n=t.attributes;r<n.length;r++){var i=n[r].values;y.isArrayBuffer(i.buffer)&&(e+=y.estimateSize(i))}}),e},t.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=s.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)n+=this._workQueue[i].load.length,n-=this._workQueue[i].remove.length;return n<0?0:n*r/t*((this.getUsedMemory()-t*X)/r)+n*X},t.prototype.ignoresMemoryFactor=function(){return!1},t.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":s.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}},n([m.property()],t.prototype,"layer",void 0),n([m.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],t.prototype,"baseUrl",void 0),n([m.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointScale",null),n([m.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"useRealWorldSymbolSizes",null),n([m.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointSize",null),n([m.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"inverseDensity",null),n([m.property()],t.prototype,"maximumPointCount",void 0),n([m.property({readOnly:!0,dependsOn:["layer.renderer","layer.filters","layer.outFields"]})],t.prototype,"availableFields",null),n([m.property({readOnly:!0,dependsOn:["view.clippingArea"]})],t.prototype,"_clippingBox",null),n([m.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],t.prototype,"_elevationOffset",null),n([m.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),n([m.property()],t.prototype,"updating",void 0),n([m.property(E.updatingPercentage)],t.prototype,"updatingPercentage",void 0),n([m.property({readOnly:!0})],t.prototype,"updatingPercentageValue",null),n([m.subclass("esri.views.3d.layers.PointCloudLayerView3D")],t)}(m.declared(L.PopupSceneLayerView(A.LayerView3D(D)))),J=P.create(),X=160;return q}.apply(null,n))||(e.exports=i)},2570:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var i=t.indexOf(n);if(i>=0)return i;n=r.getParentId(n)}return t.indexOf(n)}function i(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var i=r.pop();n.length=0;for(var o=0;o<e.load.length;o++){for(var a=e.load[o],s=t.getParentId(a);s!==i;)a=s,s=t.getParentId(a);var l=r.indexOf(a);l<0&&(l=r.length,r.push(a),n.push([])),n[l].push(e.load[o])}}var u=[];u.push({remove:e.remove,load:r});for(o=0;o<r.length;o++)n[o].length>1?u.push({remove:[r[o]],load:n[o]}):r[o]=n[o][0];return u}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var i=0;i<t.length;i++)s[i]=!1,l[i]=null;for(i=0;i<e.length;i++)o[i]=!1,a[i]=null;for(i=0;i<t.length;i++)(u=n(t[i],e,r))>=0&&(s[i]=!0,null!=a[u]?a[u].push(t[i]):a[u]=[t[i]]);for(i=0;i<e.length;i++){var u;(u=n(e[i],t,r))>=0&&(o[i]=!0,null!=l[u]?l[u].push(e[i]):l[u]=[e[i]])}var d=[];for(i=0;i<e.length;i++)null!=a[i]||o[i]||d.push({load:[],remove:[e[i]]});for(i=0;i<t.length;i++)null!=l[i]||s[i]||d.push({load:[t[i]],remove:[]});for(i=0;i<t.length;i++)null!=l[i]&&(l[i].length>1||l[i][0]!==t[i])&&d.push({load:[t[i]],remove:l[i]});for(i=0;i<e.length;i++)null!=a[i]&&(a[i].length>1||a[i][0]!==e[i])&&d.push({load:a[i],remove:[e[i]]});return d};var o=[!1],a=[null],s=[!1],l=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,i){if(0===e.load.length&&0===i.load.length)return 0;if(0===e.load.length)return-1;if(0===i.load.length)return 1;if(0===e.remove.length&&0===i.remove.length){var o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]);return r.vec3.dot(o,t)-r.vec3.dot(a,t)}return 0===e.remove.length?-1:0===i.remove.length?1:1===e.load.length&&1===i.load.length?(o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t)):1===e.load.length?-1:1===i.load.length?1:(o=n.getRenderCenter(e.remove[0]),a=n.getRenderCenter(i.remove[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var o=e[n];if(o.load.length>t&&1===o.remove.length){var a=i(o,r);e[n]=a[0];for(var s=1;s<a.length;s++)e.push(a[s])}}},t.splitWorkEntry=i}.apply(null,n))||(e.exports=i)},2571:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(45),r(1641),r(1655)],void 0===(i=function(e,t,r,n,i){function o(e,t,n){var o=e.index;if(o.hasNodes(0,1)){var a=e.queue;a.length=0,a.push(0);var l=e.masks;for(l.length=0,l.push(0);a.length>0;){var u=a.pop(),d=l.pop(),p=o.getNode(u),h=o.getRenderObb(u),c=!0;if(null!=t.clippingBox)if(0==(d&(y=1<<t.frustumPlanes.length))){var f=i.toAaBoundingBox(h,e.tempAabb);r.contains(t.clippingBox,f)?d|=y:r.intersects(t.clippingBox,f)||(c=!1)}for(var g=0;g<t.frustumPlanes.length&&c;g++){var y;if(0==(d&(y=1<<g))){var v=i.intersectPlane(h,t.frustumPlanes[g]);v>0?c=!1:v<0&&(d|=y)}}if(n.predicate(u,p,c)){for(var m=p.firstChild,_=p.childCount,b=!1,S=s(m,o.pageSize),P=s(m+_-1,o.pageSize),w=S;w<=P;w++)if(!o.hasPage(w)){n.pageMiss(u,w),b=!0;break}if(!b)for(g=0;g<_;g++)a.push(m+g),l.push(d)}}}}function a(e,t,r,o){for(var a=new i.ObbArray(e.length),s=0;s<e.length;s++)n.transformObb(e[s].obb,t,a.obbs[s],r,o);return a.obbs}function s(e,t){return e/t|0}function l(e,t){return e%t}return function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=a(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),i=e[s(n,t)].nodes[l(n,t)],o=0;o<i.childCount;o++){var a=i.firstChild+o;null!=e[s(a,t)]&&(e[s(a,t)].parents[l(a,t)]=n,r.push(a))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[s(e,t)].nodes[l(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[s(e,t)].renderObbs[l(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;i.set(t,this._pages[s(e,r)].renderObbs[l(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[s(e,t)].parents[l(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=s(e,this.pageSize),n=s(e+t-1,this.pageSize),i=r;i<=n;i++)if(null==this._pages[i])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:r.create()};return function(t,r){return o(e,t,r)}},e}()}.apply(null,n))||(e.exports=i)},2572:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(2),r(4),r(97),r(0)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}var o;return n(t,e),o=t,t.prototype.clone=function(){return new o(this.cloneProperties())},t.prototype.cloneProperties=function(){var e=this.pointCloudMetadata;return i({},this.inherited(arguments),{pointCloudMetadata:e})},r([a.property({constructOnly:!0})],t.prototype,"pointCloudMetadata",void 0),o=r([a.subclass("esri.views.3d.layers.i3s.PointGraphic")],t)}(a.declared(o));t.PointGraphic=s}.apply(null,n))||(e.exports=i)},2573:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(21),r(290),r(19),r(8),r(288),r(5),r(60),r(45),r(2574),r(30),r(30),r(1655),r(95),r(151),r(710),r(50),r(2575),r(73),r(46),r(77)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g,y,v,m,_,b,S,P){function w(e){return e?256:64}function x(e,t,r,n,i){if(r.drawScreenSpace)return r.fixedSize*t*n;var o=w(i)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,o):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),o):Math.min(e/2,o)}function I(e,t,r,n,i){return r.drawScreenSpace?0:x(e,t,r,n,i)}function N(e,t,r){return null==r&&(r=l.vec3f64.create()),r[0]=e.origin[0]+e.coordinates[3*t],r[1]=e.origin[1]+e.coordinates[3*t+1],r[2]=e.origin[2]+e.coordinates[3*t+2],r}Object.defineProperty(t,"__esModule",{value:!0});var R=o.mat4f64.create(),O={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]},A=function(){function e(e){var t=this;this._params=e,this._highlights=new p.PointHighlights({forEachNode:function(e){return t.forEachNode(e)},addHighlight:function(e,r,n,i){return t.addHighlight(e,r,n,i)},removeHighlight:function(e,r){return t.removeHighlight(e,r)}}),this.canRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=d.create(d.POSITIVE_INFINITY),this._programRep=null,this._recreatePrograms=!0,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this._programWorldHighlight=null,this._programScreenHighlight=null,this.tempMatrix4=i.mat4f32.create(),this.tempVec3=s.vec3f32.create(),this.nodes=[]}return Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this._highlights.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.initializeRenderContext=function(e){this._initContext=e;var t=e.rctx;this._programRep=new v(t),e.requestRender(),this._recreatePrograms=!0},e.prototype.uninitializeRenderContext=function(e){this._programRep.dispose(),this._programRep=null,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this._programWorldHighlight=null,this._programScreenHighlight=null},e.prototype.intersect=function(e,t,r,n){var i=this,o=l.vec3f64.create(),s=l.vec3f64.create(),p=l.vec3f64.create(),g=l.vec3f64.create(),v=c.plane.create(),m=e.camera.perScreenPixelRatio/2,_=e.camera.near,b=this._getSizeParams();a.vec3.subtract(s,n,r);var S=1/a.vec3.length(s);a.vec3.scale(s,s,S),a.vec3.negate(p,s),u.vec4.set(v,s[0],s[1],s[2],-a.vec3.dot(s,r));var P=function(){return function(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=""}}(),w=new P,O=new P,A=[],M=d.create(),z=d.create(this._clipBox);d.offset(z,-r[0],-r[1],-r[2],z);for(var C=this,F=0,j=this.nodes;F<j.length;F++){!function(l){var u=l.splatSize*C._scaleFactor,h=f.minimumDistancePlane(l.obb,v),c=f.maximumDistancePlane(l.obb,v);h-=I(u,h+_,b,m,l.isLeaf);var y=(c-=I(u,c+_,b,m,l.isLeaf))<0,R=null!=w.dist&&null!=O.dist&&w.dist<h*S&&O.dist>c*S;if(y||R)return"continue";var F=x(u,c+_,b,m,l.isLeaf);if(!f.intersectLine(l.obb,r,s,F))return"continue";var j=F*F;f.toAaBoundingBox(l.obb,M),d.offset(M,-r[0],-r[1],-r[2],M);var V=!d.contains(z,M);a.vec3.subtract(g,l.origin,r);for(var k=l.coordinates.length/3,E=0;E<k;E++)!function(h){if(o[0]=g[0]+l.coordinates[3*h],o[1]=g[1]+l.coordinates[3*h+1],o[2]=g[2]+l.coordinates[3*h+2],V&&!d.containsPoint(z,o))return"continue";var c=a.vec3.dot(o,s),f=a.vec3.squaredLength(o)-c*c;if(f>j)return"continue";var y=c+_,v=I(u,y,b,m,l.isLeaf);if(c-v<0)return"continue";var R=x(u,y-=v,b,m,l.isLeaf);if(f>R*R)return"continue";var M=(c-v)*S,C=function(e){e.point=N(l,h,e.point),e.dist=M,e.normal=p,e.node=l,e.pointId=h,e.layerUid=i.layerUid};if((null==w.dist||M<w.dist)&&(null==t||t(r,n,M))&&C(w),(null==O.dist||M>O.dist)&&(null==t||t(r,n,M))&&C(O),(null==t||t(r,n,M))&&e.enable.storeAll){var F=new P;C(F),A.push(F)}}(E)}(j[F])}var V=function(e,t){var r=function(e){var t=e.layerUid,r=e.node,n=e.pointId;return{type:"external",point:e.point,metadata:{layerUid:t,createGraphic:function(){return i._params.createGraphic(r,n,e.point)}}}}(t),n=t.layerUid+"/"+t.node.id+"/"+t.pointId;e.set(r,n,t.dist,t.normal,R,void 0),e.intersector="PointRenderer"};if(null!=w.dist){var k=e.results.min;(null==k.dist||w.dist<k.dist)&&V(k,w)}if(null!=O.dist){var E=e.results.max;(null==E.dist||O.dist>E.dist)&&V(E,O)}if(e.enable.storeAll)for(var L=h.ray.fromPoints(r,n),T=0,H=A;T<H.length;T++){var U=H[T],D=new y.IntersectorResult(L);V(D,U),e.results.all.push(D)}},e.prototype.render=function(e){if(0!==e.pass&&1!==e.pass&&4!==e.pass)return!1;for(var t=1===e.pass,r=e.rctx,i=0,o=this.nodes;i<o.length;i++){null==(v=o[i]).vao&&this._initNode(e,v)}this._ensurePrograms();var s=this._getSizeParams(),l=this._selectProgram(e.pass,s);if(null==l||0===this.nodes.length)return!0;var u=this._clipBox,p=!d.equals(u,d.POSITIVE_INFINITY,function(e,t){return e===t});if(p||(a.vec3.set(this.tempVec3,-1/0,-1/0,-1/0),l.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set(this.tempVec3,1/0,1/0,1/0),l.setUniform3fv("uClipMax",this.tempVec3)),r.bindProgram(l),r.setPipelineState(this._pipelineState),l.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),t&&l.setUniform2f("nearFar",e.camera.near,e.camera.far),e.isHighlightPass){var h={viewport:e.camera.fullViewport,highlightDepthTexture:e.highlightDepthTexture};m.bindHighlightRendering(r,h,l)}var c=e.camera.pixelRatio;s.drawFixedSize&&l.setUniform2f("uPointScale",s.fixedSize*c,e.camera.fullHeight);for(var f=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null,g=0,y=this.nodes;g<y.length;g++){var v;if(0!==(v=y[g]).coordinates.length&&(!e.isHighlightPass||v.highlights)){if(l.setUniform2f("uScreenMinMaxSize",s.screenMinSize*c,w(v.isLeaf)*c),!s.drawFixedSize){var _=v.splatSize*this._scaleFactor;l.setUniform2f("uPointScale",_*c,e.camera.fullHeight/c)}var b=v.origin;p&&(a.vec3.set(this.tempVec3,u[0]-b[0],u[1]-b[1],u[2]-b[2]),l.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set(this.tempVec3,u[3]-b[0],u[4]-b[1],u[5]-b[2]),l.setUniform3fv("uClipMax",this.tempVec3)),n.mat4.identity(this.tempMatrix4),n.mat4.translate(this.tempMatrix4,this.tempMatrix4,b),n.mat4.multiply(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),l.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),f&&m.bindSlicePlane(b,f,l),r.bindVAO(v.vao),e.isHighlightPass?this._renderHighlightFragments(r,v):r.drawArrays(0,0,v.coordinates.length/3)}}return!0},e.prototype._renderHighlightFragments=function(e,t){var n=t.highlights;if(n){for(var i=r.unwrap(n[0].component),o=i+1,a=1;a<n.length;a++){var s=r.unwrap(n[a].component);if(s!==o){var l=o-i;l>0&&e.drawArrays(0,i,l),i=s}o=s+1}var u=o-i;u>0&&e.drawArrays(0,i,u)}},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){d.set(this._clipBox,e||d.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender(),this._recreatePrograms=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()},e.prototype.removeNode=function(e){var t=this,r=null;return this.nodes=this.nodes.filter(function(n){return n.id!==e||(r=n,n.vao&&(n.vao.dispose(!0),n.vao=null),t._highlights.nodeRemoved(n),!1)}),this._requestRender(),r},e.prototype.forEachNode=function(e){this.nodes.forEach(e)},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this._highlights.removeAll(),this.nodes=[],this._requestRender()},e.prototype.highlight=function(e,t){return this._highlights.add(e,t)},e.prototype.addHighlight=function(e,t,r,n){e.highlights=g.addHighlight(e.highlights,t,r,n),this._requestRender()},e.prototype.removeHighlight=function(e,t){e.highlights=g.removeHighlight(e.highlights,t),this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new P(r,_.program.attributes,O,{positions:b.createVertex(r,35044,t.coordinates),colors:b.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e.prototype._selectProgram=function(e,t){var r=t.drawScreenSpace;switch(e){case 1:return r?this._programScreenDepth:this._programWorldDepth;case 4:return r?this._programScreenHighlight:this._programWorldHighlight;default:return r?this._programScreen:this._programWorld}},e.prototype._ensurePrograms=function(){this._recreatePrograms&&(this._recreatePrograms=!1,this._programWorld=this._programRep.getProgram(_.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(_.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(_.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(_.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldHighlight=this._programRep.getProgram(_.program,{highlightPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenHighlight=this._programRep.getProgram(_.program,{drawScreenSize:!0,highlightPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._pipelineState=S.makePipelineState({depthTest:{func:513},depthWrite:S.defaultDepthWriteParams,colorWrite:S.defaultColorWriteParams}))},e}();t.PointRenderer=A,function(e){e.isInstanceOfNode=function(e){return e.hasOwnProperty("splatSize")}}(A=t.PointRenderer||(t.PointRenderer={})),t.PointRenderer=A}.apply(null,n))||(e.exports=i)},2574:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(79),r(9),r(317)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.context=e,this.highlights=new Set}return Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this.highlights.size>0},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.highlights=null},e.prototype.add=function(e,t){var r=this,n=new a(e,t);return this.highlights.add(n),this.enableSet(n),{remove:function(){return r.removeSet(n)},pause:function(){r.disableSet(n)},resume:function(){r.enableSet(n)}}},e.prototype.removeSet=function(e){this.disableSet(e),this.highlights.delete(e)},e.prototype.enableSet=function(e){var t=this;e.enabled||(e.enabled=!0,this.context.forEachNode(function(r){return t.enableSetForNode(e,r)}))},e.prototype.enableSetForNode=function(e,t){var r=this;if(e.enabled){var n=e.ids.get(t.id);n&&n.forEach(function(n){return r.context.addHighlight(t,n,e.options,e.id)})}},e.prototype.disableSet=function(e){var t=this;e.enabled&&(e.enabled=!1,this.context.forEachNode(function(r){return t.disableSetForNode(e,r)}))},e.prototype.disableSetForNode=function(e,t){e.enabled||this.context.removeHighlight(t,e.id)},e.prototype.nodeAdded=function(e){var t=this;this.highlights.forEach(function(r){return t.enableSetForNode(r,e)})},e.prototype.nodeRemoved=function(e){var t=this;this.highlights.forEach(function(r){return t.disableSetForNode(r,e)})},e.prototype.removeAll=function(){var e=this;this.highlights.forEach(function(t){return e.disableSet(t)})},e}();t.PointHighlights=o;var a=function(){function e(e,t){this.options=t,this.id=i.generateHighlightId(),this.ids=new Map,this.enabled=!1;for(var r=0,o=e;r<o.length;r++){var a=o[r];n.isSome(a)&&this.add(a.nodeId,a.pointId)}}return e.prototype.add=function(e,t){var n=this.ids.get(e);n?n.add(t):this.ids.set(e,r.SetFromValues([t]))},e}()}.apply(null,n))||(e.exports=i)},2575:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(67),r(54)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({DEPTH_PASS:e.depthPass,HIGHLIGHT_PASS:e.highlightPass,DRAW_SCREEN_SIZE:e.drawScreenSize,SLICE:e.slicePlaneEnabled})};t.program={name:"point-renderer",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}}.apply(null,n))||(e.exports=i)}}]);